cscope 15 /playpen/software/sreps/Pablo2/lib/register/src               0000683308
	@Anastruct.cpp

1 
	~<io¡»am
>

2 
	~<veùÜ
>

3 
	~"Image3D.h
"

6 #ifdeà
AE2_BUILD


8 
	~"AÇ¡ruù.h
"

14 
	gAÇ¡ruù3D
::
	$AÇ¡ruù3D
() {

15 
cÚtours
 = 
NULL
;

16 
Çme
 = 
NULL
;

17 
cÚtour_couÁ
 = 0;

18 
	}
}

20 
	gAÇ¡ruù3D
::~
	$AÇ¡ruù3D
() {

21 
c
 = 0; c < 
cÚtour_couÁ
; c++) {

22 
d–‘e
 [] 
cÚtours
[
c
].
mod–X
;

23 
d–‘e
 [] 
cÚtours
[
c
].
mod–Y
;

26 
d–‘e
 [] 
cÚtours
;

27 
	}
}

33 
	gAÇ¡ruùLi¡
::~
	$AÇ¡ruùLi¡
() {

34 
a
 = 0;‡ < 
ªa
.
	`size
();‡++)

35 
d–‘e
 
ªa
[
a
];

36 
ªa
.
	`ş—r
();

37 
	}
}

39 
boŞ
 
	gAÇ¡ruùLi¡
::
	$cÚv”tAÇ¡ruùCoÜds
(
Image3D
 * 
im
)

41 
VeùÜ3D
 
coÜd
;

43 ià(
im
 =ğ
NULL
)

44  
çl£
;

46 
a
 = 0;‡ < 
ªa
.
	`size
();‡++) {

47 ià(
ªa
[
a
]->
cÚtours
->
mod–X
 !ğ
NULL
)

48  
Œue
;

50 
c
 = 0; c < 
ªa
[
a
]->
cÚtour_couÁ
; c++) {

51 
ªa
[
a
]->
cÚtours
[
c
].
mod–X
 = 
Ãw
 [ªa[a]->cÚtours[c].
poštCouÁ
];

52 
ªa
[
a
]->
cÚtours
[
c
].
mod–Y
 = 
Ãw
 [ªa[a]->cÚtours[c].
poštCouÁ
];

54 
coÜd
 = 
	`VeùÜ3D
(
ªa
[
a
]->
cÚtours
[
c
].
mš
[0],‡na[a]->contours[c].min[1],‡na[a]->contours[c].min[2]);

55 
im
->
	`wÜldToMod–CoÜdš©es
(
coÜd
);

56 
ªa
[
a
]->
cÚtours
[
c
].
mš
[0] = 
coÜd
.
	`g‘X
();

57 
ªa
[
a
]->
cÚtours
[
c
].
mš
[1] = 
coÜd
.
	`g‘Y
();

58 
ªa
[
a
]->
cÚtours
[
c
].
mš
[2] = 
coÜd
.
	`g‘Z
();

60 
coÜd
 = 
	`VeùÜ3D
(
ªa
[
a
]->
cÚtours
[
c
].
max
[0],‡na[a]->contours[c].max[1],‡na[a]->contours[c].max[2]);

61 
im
->
	`wÜldToMod–CoÜdš©es
(
coÜd
);

62 
ªa
[
a
]->
cÚtours
[
c
].
max
[0] = 
coÜd
.
	`g‘X
();

63 
ªa
[
a
]->
cÚtours
[
c
].
max
[1] = 
coÜd
.
	`g‘Y
();

64 
ªa
[
a
]->
cÚtours
[
c
].
max
[2] = 
coÜd
.
	`g‘Z
();

66 
coÜd
 = 
	`VeùÜ3D
(
ªa
[
a
]->
cÚtours
[
c
].
x
[0],‡Ç[a]->cÚtours[c].
y
[0],‡Ç[a]->cÚtours[c].
z
);

67 
im
->
	`wÜldToMod–CoÜdš©es
(
coÜd
);

68 
ªa
[
a
]->
cÚtours
[
c
].
mod–X
[0] = 
coÜd
.
	`g‘X
();

69 
ªa
[
a
]->
cÚtours
[
c
].
mod–Y
[0] = 
coÜd
.
	`g‘Y
();

70 
ªa
[
a
]->
cÚtours
[
c
].
mod–Z
 = 
coÜd
.
	`g‘Z
();

72 
i
 = 1; i < 
ªa
[
a
]->
cÚtours
[
c
].
poštCouÁ
; i++) {

73 
coÜd
 = 
	`VeùÜ3D
(
ªa
[
a
]->
cÚtours
[
c
].
x
[
i
],‡Ç[a]->cÚtours[c].
y
[i],‡Ç[a]->cÚtours[c].
z
);

74 
im
->
	`wÜldToMod–CoÜdš©es
(
coÜd
);

75 
ªa
[
a
]->
cÚtours
[
c
].
mod–X
[
i
] = 
coÜd
.
	`g‘X
();

76 
ªa
[
a
]->
cÚtours
[
c
].
mod–Y
[
i
] = 
coÜd
.
	`g‘Y
();

80 
ªa
[
a
]->
cŞÜ
) {

81 0: 
ªa
[
a
]->
glCŞÜ
[0] = 1.0f;

82 
ªa
[
a
]->
glCŞÜ
[1] = 0.0f;

83 
ªa
[
a
]->
glCŞÜ
[2] = 0.0f;

85 1: 
ªa
[
a
]->
glCŞÜ
[0] = 0.0f;

86 
ªa
[
a
]->
glCŞÜ
[1] = 1.0f;

87 
ªa
[
a
]->
glCŞÜ
[2] = 0.0f;

89 2: 
ªa
[
a
]->
glCŞÜ
[0] = 0.0f;

90 
ªa
[
a
]->
glCŞÜ
[1] = 0.0f;

91 
ªa
[
a
]->
glCŞÜ
[2] = 1.0f;

93 3: 
ªa
[
a
]->
glCŞÜ
[0] = 1.0f;

94 
ªa
[
a
]->
glCŞÜ
[1] = 1.0f;

95 
ªa
[
a
]->
glCŞÜ
[2] = 0.0f;

97 4: 
ªa
[
a
]->
glCŞÜ
[0] = 1.0f;

98 
ªa
[
a
]->
glCŞÜ
[1] = 0.0f;

99 
ªa
[
a
]->
glCŞÜ
[2] = 1.0f;

101 5: 
ªa
[
a
]->
glCŞÜ
[0] = 0.0f;

102 
ªa
[
a
]->
glCŞÜ
[1] = 1.0f;

103 
ªa
[
a
]->
glCŞÜ
[2] = 1.0f;

105 6: 
ªa
[
a
]->
glCŞÜ
[0] = 1.0f;

106 
ªa
[
a
]->
glCŞÜ
[1] = 1.0f;

107 
ªa
[
a
]->
glCŞÜ
[2] = 1.0f;

109 7: 
ªa
[
a
]->
glCŞÜ
[0] = 0.0f;

110 
ªa
[
a
]->
glCŞÜ
[1] = 0.0f;

111 
ªa
[
a
]->
glCŞÜ
[2] = 0.0f;

116  
Œue
;

117 
	}
}

119 
	gAÇ¡ruùLi¡
::
	$addAÇ¡ruù
(
AÇ¡ruù3D
 * 
a
)

121 
ªa
.
	`push_back
(
a
);

122 
	}
}

124 
	gAÇ¡ruùLi¡
::
	$d–‘eAÇ¡ruù
(
šdex
)

126 ià(
šdex
 >ğ
ªa
.
	`size
() || index < 0)

128 ià(
šdex
 =ğ
ªa
.
	`size
() - 1)

129 
ªa
.
	`pİ_back
();

131 
AÇ¡ruù3D
 * 
a
 = 
ªa
[
šdex
];

132 
ªa
[
šdex
] =‡Ç[ªa.
	`size
() - 1];

133 
ªa
[ªa.
	`size
(è- 1] = 
a
;

134 
ªa
.
	`pİ_back
();

136 
	}
}

138 
AÇ¡ruù3D
 * 
	gAÇ¡ruùLi¡
::
	$g‘AÇ¡ruù
(
šdex
) const

140 ià(
šdex
 >ğ
ªa
.
	`size
() || index < 0)

141  
NULL
;

142  
ªa
[
šdex
];

143 
	}
}

145 cÚ¡ * 
	gAÇ¡ruùLi¡
::
	$g‘Name
(
šdex
) const

147 ià(
šdex
 >ğ
ªa
.
	`size
() || index < 0)

148  
NULL
;

149  
ªa
[
šdex
]->
Çme
;

150 
	}
}

152 
	gAÇ¡ruùLi¡
::
	$cÚtourCouÁ
(
šdex
) const

154 ià(
šdex
 >ğ
ªa
.
	`size
() || index < 0)

156  
ªa
[
šdex
]->
cÚtour_couÁ
;

157 
	}
}

159 
	gAÇ¡ruùLi¡
::
	$poštCouÁ
(
šdex
, 
cÚtourId
) const

161 ià(
šdex
 >ğ
ªa
.
	`size
() || index < 0)

163  
ªa
[
šdex
]->
	`poštCouÁ
(
cÚtourId
);

164 
	}
}

166 
	gAÇ¡ruùLi¡
::
	$g‘CŞÜ
(
šdex
) const

168 ià(
šdex
 >ğ
ªa
.
	`size
() || index < 0)

170  
ªa
[
šdex
]->
	`g‘CŞÜ
();

171 
	}
}

	@DistanceToPointSetFunction.cpp

1 
	~"Di¡ªûToPoštS‘FunùiÚ.h
"

3 
	#D_XFERLIST


	)

4 
	#D_POINTLIST_SERVER2


	)

5 
	#D_LINALG


	)

6 
	~"Sh­ed•’d.h
"

7 
	~"M3DPGASts.h
"

8 
	~<io¡»am
>

9 
	~<f¡»am
>

10 
	~"P3DCÚŒŞ.h
"

11 
	~"SimT¿nsSh­eS·û.h
"

12 
	~"SÿËT¿nsSh­eS·û.h
"

13 
	~"OùT»eTauBªd.h
"

15 
	~<®gÜ™hm
>

17 
usšg
 
	g¡d
::
if¡»am
;

18 
usšg
 
	g¡d
::
cout
;

19 
usšg
 
	g¡d
::
’dl
;

20 
usšg
 
	g¡d
::
veùÜ
;

21 
usšg
 
	g¡d
::
sÜt
;

24 
	gDi¡ªûToPoštS‘FunùiÚ
::
	$Di¡ªûToPoštS‘FunùiÚ
(

25 cÚ¡ * 
poštsFeName
, 
SimT¿nsTy³
 
simTy³
, 
Ëv–
,

26 
figu»Id
, 
Image3D
 * 
img
, 
·ddšg
)

28 
pgaOrd”
 = -1;

29 
image
 = 
img
;

30 
¦iûPaddšg
 = 
·ddšg
;

31 ià(
poštsFeName
)

32 ià(! 
	`lßdPoštS‘
(
poštsFeName
)) {

33 
simTy³
 = 
Fa
;

37 
subdivLev–
 = 
Ëv–
;

38 
figu»_id
 = 
figu»Id
;

39 
sizeWeight
 = 0.0;

40 ià(
simTy³
 =ğ
FuÎ
)

41 
¥aû
 = 
Ãw
 
SimT¿nsSh­eS·û
;

43 
¥aû
 = 
Ãw
 
SÿËT¿nsSh­eS·û
;

44 ià(
simTy³
 =ğ
SÿË
)

45 ((
SÿËT¿nsSh­eS·û
 *è
¥aû
)->
	`£tTy³
(SÿËT¿nsSh­eS·û::
SÿË
);

46 ià(
simTy³
 =ğ
T¿n¦©iÚ
)

47 ((
SÿËT¿nsSh­eS·û
 *è
¥aû
)->
	`£tTy³
(SÿËT¿nsSh­eS·û::
T¿n¦©iÚ
);

50 
	`£tClo£ÃssLim™
(0.04);

52 
İtimiz©iÚS‹p
 = 
NÚe
;

53 
»ã»nûObjeù
 = 
NULL
;

54 
	}
}

56 
	gDi¡ªûToPoštS‘FunùiÚ
::
	$Di¡ªûToPoštS‘FunùiÚ
(

57 
VeùÜ3D
 * 
poštS‘
, 
numPošts
, 
SimT¿nsTy³
 
simTy³
, 
Ëv–
,

58 
figu»Id
, 
Image3D
 * 
img
, 
·ddšg
)

60 
pgaOrd”
 = -1;

61 
image
 = 
img
;

62 
¦iûPaddšg
 = 
·ddšg
;

63 ià(
poštS‘
)

64 ià(! 
	`addPoštS‘
(
poštS‘
, 
numPošts
)) {

65 
simTy³
 = 
Fa
;

69 
subdivLev–
 = 
Ëv–
;

70 
figu»_id
 = 
figu»Id
;

71 
sizeWeight
 = 0.0;

72 ià(
simTy³
 =ğ
FuÎ
)

73 
¥aû
 = 
Ãw
 
SimT¿nsSh­eS·û
;

75 
¥aû
 = 
Ãw
 
SÿËT¿nsSh­eS·û
;

76 ià(
simTy³
 =ğ
SÿË
)

77 ((
SÿËT¿nsSh­eS·û
 *è
¥aû
)->
	`£tTy³
(SÿËT¿nsSh­eS·û::
SÿË
);

78 ià(
simTy³
 =ğ
T¿n¦©iÚ
)

79 ((
SÿËT¿nsSh­eS·û
 *è
¥aû
)->
	`£tTy³
(SÿËT¿nsSh­eS·û::
T¿n¦©iÚ
);

81 
	`£tClo£ÃssLim™
(0.04);

82 
İtimiz©iÚS‹p
 = 
NÚe
;

83 
»ã»nûObjeù
 = 
NULL
;

84 
	}
}

86 
	gDi¡ªûToPoštS‘FunùiÚ
::~
	$Di¡ªûToPoštS‘FunùiÚ
()

88 
d–‘e
 
¥aû
;

89 
	}
}

91 
boŞ
 
	gDi¡ªûToPoštS‘FunùiÚ
::
	$lßdPoštS‘
(cÚ¡ * 
poštsFeName
)

93 
x
, 
y
, 
z
;

95 
pošts
.
	`ş—r
();

96 
if¡»am
 
	`š
(
poštsFeName
);

97 
š
 >> 
x
 >> 
y
 >> 
z
;

98 ià(! 
š
) {

99 
cout
 << "E¼Ü: CªnÙ„—d…ošt äom f" << 
poštsFeName
 << 
’dl
;

100  
çl£
;

103 
š
) {

104 
š
 >> 
x
 >> 
y
 >> 
z
;

105 ià(
š
) {

106 
VeùÜ3D
 
	`²t
(
x
, 
y
, 
z
);

107 
pošts
.
	`push_back
(
²t
);

111 
	`adju¡PoštS‘
();

112 
	`nÜm®izePoštS‘
();

113  
Œue
;

114 
	}
}

116 
boŞ
 
	gDi¡ªûToPoštS‘FunùiÚ
::
	$addPoštS‘
(
VeùÜ3D
 * 
poštS‘
,

117 
numPošts
)

119 ià(
poštS‘
 =ğ
NULL
è 
çl£
;

120 
pošts
.
	`ş—r
();

121 
i
 = 0; i < 
numPošts
; i++)

122 
pošts
.
	`push_back
(
poštS‘
[
i
]);

124 
	`adju¡PoštS‘
();

125 
	`nÜm®izePoštS‘
();

126  
Œue
;

127 
	}
}

130 
	gDi¡ªûToPoštS‘FunùiÚ
::
	$adju¡PoštS‘
() {

131 ià(
image
) {

132  
veùÜ
<
VeùÜ3D
>::
™”©Ü
 
™
 = 
pošts
.
	`begš
();

133 
™
 !ğ
pošts
.
	`’d
();

134 
™
++) {

135 
image
->
	`wÜldToMod–CoÜdš©es
(*
™
);

145 
mšX
 = 
pošts
[0].
	`g‘X
();

146 
mšY
 = 
pošts
[0].
	`g‘Y
();

147 
mšZ
 = 
pošts
[0].
	`g‘Z
();;

148 
maxX
 = 
mšX
;

149 
maxY
 = 
mšY
;

150 
maxZ
 = 
mšZ
;

152 
numPošts
 = 
pošts
.
	`size
();

154 
i
 = 1; i < 
numPošts
; i++) {

155 ià(
pošts
[
i
].
	`g‘X
(è< 
mšX
) { minX =…oints[i].getX(); }

156 ià(
pošts
[
i
].
	`g‘X
(è> 
maxX
) { maxX =…oints[i].getX(); }

158 ià(
pošts
[
i
].
	`g‘Y
(è< 
mšY
) { minY =…oints[i].getY(); }

159 ià(
pošts
[
i
].
	`g‘Y
(è> 
maxY
) { maxY =…oints[i].getY(); }

161 ià(
pošts
[
i
].
	`g‘Z
(è< 
mšZ
) { minZ =…oints[i].getZ(); }

162 ià(
pošts
[
i
].
	`g‘Z
(è> 
maxZ
) { maxZ =…oints[i].getZ(); }

164 
	}
}

166 
	gDi¡ªûToPoštS‘FunùiÚ
::
	$nÜm®izePoštS‘
()

168 
nÜm®izedPošts
.
	`ş—r
();

170 
ËnX
 = 
maxX
 - 
mšX
;

171 
ËnY
 = 
maxY
 - 
mšY
;

172 
ËnZ
 = 
maxZ
 - 
mšZ
;

174 
veùÜ
<
VeùÜ3D
>::
™”©Ü
 
™
 = 
pošts
.
	`begš
();

175 
™
 !ğ
pošts
.
	`’d
(); it++) {

177 
VeùÜ3D
 
	`‹mp
((
™
->
	`g‘X
(è- 
mšX
è/ 
ËnX
,

178 (
™
->
	`g‘Y
(è- 
mšY
è/ 
ËnY
,

179 (
™
->
	`g‘Z
(è- 
mšZ
è/ 
ËnZ
);

180 
nÜm®izedPošts
.
	`push_back
(
‹mp
);

183 
	}
}

185 
M3DObjeù
 * 
	gDi¡ªûToPoštS‘FunùiÚ
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 & 
v
)

187 #ifdeà
UNFLIPPED


188 cÚ¡ 
VeùÜ3D
 
	`ûÁ”
(0.0, 1.0, 0.0);

190 cÚ¡ 
VeùÜ3D
 
	`ûÁ”
(0.0, 0.0, 0.0);

193 
M3DObjeù
 * 
xfÜmed
 = 
»ã»nûObjeù
->
	`assign
();

197 ià(
pgaOrd”
 >= 0) {

198 
veùÜ
<> 
cÛfs
;

200 
M3DPGASts
 * 
¡©s
 = 
»ã»nûObjeù
->
	`g‘PGASts
();

201 
¡©s
->
	`£tIÁ”medObj
(
xfÜmed
);

203 ià(
İtimiz©iÚS‹p
 =ğ
PGA
) {

204 
i
 = 0; i < 
v
.
	`size
(); i++)

205 
cÛfs
.
	`push_back
(
	`v
(
i
));

207 
¡©s
->
	`doPGADefÜm
(
xfÜmed
, 
cÛfs
, 
pgaOrd”
, 
çl£
 );

209 ià(
pgaCÛfs
.
	`size
() > 0)

210 
¡©s
->
	`doPGADefÜm
(
xfÜmed
, 
pgaCÛfs
, 
pgaOrd”
, 
çl£
 );

214 
Sim¬™yT¿nsfÜm3D
 
v¬XfÜm
;

215 ià(
İtimiz©iÚS‹p
 =ğ
SimT
)

216 
v¬XfÜm
 = 
¥aû
->
	`ü—‹SimT¿ns
(
v
);

218 
v¬XfÜm
 = 
¥aû
->
	`ü—‹SimT¿ns
(
po¡SimT¿nsCÛfs
);

219 
xfÜmed
->
	`­¶ySim¬™y
(
v¬XfÜm
, 
ûÁ”
);

221  
xfÜmed
;

222 
	}
}

224 
	gDi¡ªûToPoštS‘FunùiÚ
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 & 
v
)

226 
M3DObjeù
 * 
obj
 = 
	`ü—‹T¬g‘Objeù
(
v
);

227 
di¡
 = 
	`compu‹Di¡ªûSqr
(
obj
);

228 
d–‘e
 
obj
;

229  
di¡
;

230 
	}
}

232 
	gDi¡ªûToPoštS‘FunùiÚ
::
	$compu‹Di¡ªûSqr
(
M3DObjeù
 * 
obj
)

234 
M3DFigu»
 * 
fig
 = 
obj
->
	`g‘Figu»PŒ
(
figu»_id
);

235 
Xã¾i¡
 * 
xãrLi¡
 = 
	`cÚv”tM3DtoXãr
(
fig
);

236 
Th®lCode
::
Poši¡_£rv”2
 
pLi¡
;

237 
pLi¡
.
	`š™
(
xãrLi¡
);

238 
pLi¡
.
	`Compu‹SubdivPoštCloud
(
subdivLev–
);

240 
numPošts
;

241 
Bpošt
 * 
bPošts
 = 0;

242 
pLi¡
.
	`subdivbound¬yšfo
(&
numPošts
, &
bPošts
);

244 if(
numPošts
 > 0) {

245 
OùT»eTauBªd
 
	`m»pOùT»e
(
bPošts
[0].
²t
);

247 
i
 = 1; i<
numPošts
; i++) {

248 
m»pOùT»e
.
	`š£¹
(
bPošts
[
i
].
²t
);

251 
m»pOùT»e
.
	`nÜm®ize
();

253 
m»pOùT»e
.
xLim™
 = 
Œue
;

254 
m»pOùT»e
.
yLim™
 = 
Œue
;

255 
m»pOùT»e
.
zLim™
 = 
Œue
;

257 
tÙ®Di¡Sqr
 = 0;

258 
veùÜ
<
VeùÜ3D
>::
™”©Ü
 
pIt
 = 
pošts
.
	`begš
();

259 
veùÜ
<
VeùÜ3D
>::
™”©Ü
 
nIt
 = 
nÜm®izedPošts
.
	`begš
();

260 (
pIt
 !ğ
pošts
.
	`’d
()) &&

261 (
nIt
 !ğ
nÜm®izedPošts
.
	`’d
())) {

262 
tÙ®Di¡Sqr
 +ğ
m»pOùT»e
.
	`g‘Di¡ªûSqr
(*
pIt
,

263 *
nIt
, 
sq¹Clo£ÃssLim™
);

264 
pIt
++;

265 
nIt
++;

268  (
tÙ®Di¡Sqr
);

272 
	}
}

274 
	gDi¡ªûToPoštS‘FunùiÚ
::
	$·¿m‘”CouÁ
()

276  
¥aû
->
	`·¿m‘”CouÁ
();

277 
	}
}

279 
	gDi¡ªûToPoštS‘FunùiÚ
::
	$£tPGACÛfs
(cÚ¡ 
VeùÜ
 & 
pg
)

281 
pgaCÛfs
.
	`ş—r
();

282 
i
 = 0; i < 
pg
.
	`size
(); i++) {

283 
pgaCÛfs
.
	`push_back
(
	`pg
(
i
));

285 
	}
}

	@FitUnlabeledPoints.cpp

1 
	~<c¡dlib
>

2 
	~<veùÜ
>

3 
	~<f¡»am
>

4 
	~<io¡»am
>

5 
	~<s¡»am
>

6 
	~"m©rix.h
"

7 
	~"Di¡ªûToPoštS‘FunùiÚ.h
"

8 
	~"M3DObjeù.h
"

9 
	~"CÚjug©eG¿d›ÁM‘hod.h
"

10 
	~"Sim¬™yT¿nsfÜm3D.h
"

11 
	~"SimT¿nsSh­eS·û.h
"

12 
	~"M3DPGASts.h
"

13 
	~"F™UÆab–edPošts.h
"

15 
usšg
 
	g¡d
::
veùÜ
;

16 
usšg
 
	g¡d
::
ios
;

19 
	gF™UÆab–edPošts
::
	$F™UÆab–edPošts
(
Ëv–
, 
figu»Id
,

20 
Üd”
, 
şo£Ãss
, 
ou‹rLim™
, 
šÃrLim™
)

22 
şo£ÃssLim™
 = 
şo£Ãss
;

23 
figu»_id
 = 
figu»Id
;

24 
pg_Üd”
 = 
Üd”
;

25 
cÚv”g’û_lim™
 = 
ou‹rLim™
;

26 
f™_lim™
 = 
šÃrLim™
;

27 
surf_Ëv–
 = 
Ëv–
;

28 
be¡Obj
 = 
NULL
;

29 
pga_cÛfs
 = 
NULL
;

30 
xfÜm
 = 
NULL
;

31 
	}
}

33 
	gF™UÆab–edPošts
::~
	$F™UÆab–edPošts
()

35 ià(
xfÜm
)

36 
d–‘e
 
xfÜm
;

37 ià(
be¡Obj
)

38 
d–‘e
 
be¡Obj
;

39 ià(
pga_cÛfs
)

40 
d–‘e
 
pga_cÛfs
;

41 
	}
}

43 
boŞ
 
	gF™UÆab–edPošts
::
	$f™
(
M3DObjeù
 * 
mod–
, cÚ¡ * 
f’ame
,

44 
Image3D
 * 
image
, 
PoštF™Ty³
 
ty³
)

46 
Di¡ªûToPoštS‘FunùiÚ
::
SimT¿nsTy³
 
f™Ty³
;

48 ià(
mod–
 =ğ
NULL
)

49  
çl£
;

51 ià(
f’ame
 =ğ
NULL
 || *filename == '\0')

52  
çl£
;

55 ià(
ty³
 =ğ
SÿËT¿ns
)

56 
f™Ty³
 = 
Di¡ªûToPoštS‘FunùiÚ
::
BÙh
;

57 ià(
ty³
 =ğ
T¿ns
)

58 
f™Ty³
 = 
Di¡ªûToPoštS‘FunùiÚ
::
T¿n¦©iÚ
;

59 ià(
ty³
 =ğ
SÿË
 ||y³ =ğ
SÿËPGA
)

60 
f™Ty³
 = 
Di¡ªûToPoštS‘FunùiÚ
::
SÿË
;

62 
f™Ty³
 = 
Di¡ªûToPoštS‘FunùiÚ
::
FuÎ
;

64 
Di¡ªûToPoštS‘FunùiÚ
 
	`f
(
f’ame
, 
f™Ty³
, 
surf_Ëv–
,

65 
figu»_id
, 
image
);

66  
	`runPoštsF™
(
f
, 
mod–
, 
image
, 
ty³
);

67 
	}
}

69 
boŞ
 
	gF™UÆab–edPošts
::
	$f™
(
M3DObjeù
 * 
mod–
, * 
x
, * 
y
,

70 * 
z
, 
numPošts
, 
Image3D
 * 
image
, 
PoštF™Ty³
 
ty³
)

72 
i
;

73 
Di¡ªûToPoštS‘FunùiÚ
::
SimT¿nsTy³
 
f™Ty³
;

75 ià(
mod–
 =ğ
NULL
)

76  
çl£
;

79 
VeùÜ3D
 * 
pošts
 = 
Ãw
 VeùÜ3D[
numPošts
];

80 
i
 = 0; i < 
numPošts
; i++)

81 
pošts
[
i
] = 
	`VeùÜ3D
(
x
[i], 
y
[i], 
z
[i]);

82 ià(
ty³
 =ğ
SÿËT¿ns
)

83 
f™Ty³
 = 
Di¡ªûToPoštS‘FunùiÚ
::
BÙh
;

84 ià(
ty³
 =ğ
T¿ns
)

85 
f™Ty³
 = 
Di¡ªûToPoštS‘FunùiÚ
::
T¿n¦©iÚ
;

86 ià(
ty³
 =ğ
SÿË
 ||y³ =ğ
SÿËPGA
)

87 
f™Ty³
 = 
Di¡ªûToPoštS‘FunùiÚ
::
SÿË
;

89 
f™Ty³
 = 
Di¡ªûToPoštS‘FunùiÚ
::
FuÎ
;

91 
Di¡ªûToPoštS‘FunùiÚ
 
	`f
(
pošts
, 
numPošts
, 
f™Ty³
, 
surf_Ëv–
,

92 
figu»_id
, 
image
);

93 
d–‘e
 [] 
pošts
;

94  
	`runPoštsF™
(
f
, 
mod–
, 
image
, 
ty³
);

95 
	}
}

97 
boŞ
 
	gF™UÆab–edPošts
::
	$runPoštsF™
(
Di¡ªûToPoštS‘FunùiÚ
 & 
f
,

98 
M3DObjeù
 * 
mod–
, 
Image3D
 * 
image
, 
PoštF™Ty³
 
ty³
)

100 
i
, 
numPGs
;

101 
™”
;

102 
fš®ScÜe
, 
Ï¡ScÜe
;

104 
f
.
	`£tMod–
(
mod–
);

105 
f
.
	`£tClo£ÃssLim™
(
şo£ÃssLim™
);

106 
f
.
	`£tPGAOrd”
(
pg_Üd”
);

107 ià(
pg_Üd”
 >= 0) {

108 
numPGs
 =

109 (
pg_Üd”
 >ğ0è? 
mod–
->
	`g‘PGASts
()->
	`g‘PGD©aPŒ
Õg_Üd”)->
numPGs
 : 0;

110 ià(
pga_cÛfs
)

111 
d–‘e
 
pga_cÛfs
;

112 
pga_cÛfs
 = 
Ãw
 
	`VeùÜ
(
numPGs
);

113 
f
.
	`£tPGACÛfs
(*
pga_cÛfs
);

115 
f
.
	`£tLev–
(
surf_Ëv–
);

117 
numP¬ams
 = 
f
.
	`·¿m‘”CouÁ
();

119 
VeùÜ
 
	`po¡SimT¿nsCÛfs
(
numP¬ams
);

120 
i
 = 0; i < 
numP¬ams
; i++)

121 
	`po¡SimT¿nsCÛfs
(
i
) = 0.0;

122 
f
.
	`£tPo¡SimT¿ns
(
po¡SimT¿nsCÛfs
);

124 ià(
glob®V”bos™y
 >= 1) {

125 
cout
 << "Point fitting…arameters:\n";

126 
cout
 << " Lev– = " << 
surf_Ëv–
 << '\n';

127 
cout
 << " Clo£Ãs ğ" << 
şo£ÃssLim™
 << '\n';

128 
cout
 << " PG ord” = " << 
pg_Üd”
 << '\n';

129 
cout
 << " Numb” oàPG cÛffic›Á ğ" << 
numPGs
 << '\n';

130 
cout
 << " Numb” oà·¿m‘” ğ" << 
numP¬ams
 << 
’dl
;

133 
VeùÜ
 
be¡
;

134 
Num”iÿlFunùiÚ
 
	`w¿µ”
(
f
, 
f™_lim™
);

136 
simT¿nsScÜe
 = 1.0e9;

142 ià(
ty³
 >ğ
PGA
)

143 
fš®ScÜe
 = 1.0e9;

145 
fš®ScÜe
 = 0.0;

147 
g¿ndI‹r
 = 0;

151 
Ï¡ScÜe
 = 
fš®ScÜe
;

152 ià(
ty³
 !ğ
PGA
) {

154 
f
.
	`£tSge
(
Di¡ªûToPoštS‘FunùiÚ
::
SimT
);

155 
™”
 = 0;

156 
CÚjug©eG¿d›ÁM‘hod
 
	`İt
(
w¿µ”
, 
po¡SimT¿nsCÛfs
);

157 ! 
İt
.
	`isFšished
()) {

158 
be¡
 = 
İt
.
	`g‘Be¡Ev”X
();

159 
v
 = 
İt
.
	`g‘Be¡Ev”V®ue
();

160 ià(
glob®V”bos™y
 >= 1) {

161 
cout
 << "[POST-ST] I‹r: " << 
g¿ndI‹r
 << ", " << 
™”
 << " bestX: ";

162 
be¡
.
	`´št
();

163 
cout
 << " be¡V®: " << 
v
 << 
’dl
;

165 
İt
.
	`³rfÜmI‹¿tiÚ
();

166 
™”
++;

168 
po¡SimT¿nsCÛfs
 = 
İt
.
	`g‘Be¡Ev”X
();

169 
fš®ScÜe
 = 
İt
.
	`g‘Be¡Ev”V®ue
();

170 
simT¿nsScÜe
 = 
fš®ScÜe
;

171 
f
.
	`£tPo¡SimT¿ns
(
po¡SimT¿nsCÛfs
);

173 ià(
glob®V”bos™y
 >= 1)

174 
cout
 << "I‹r: " << 
™”
 << " be¡X: " << 
	`po¡SimT¿nsCÛfs
(0)

175 << " be¡V®: " << 
fš®ScÜe
 << 
’dl
;

176 ià(
glob®V”bos™y
 == 0)

177 
cout
 << "ResuÉ‡á” " << 
™”
 << " sim¿n ™”©iÚ ğ" << 
fš®ScÜe
 << 
’dl
;

180 ià(
ty³
 >ğ
PGA
 && 
pg_Üd”
 >= 0) {

181 
f
.
	`£tSge
(
Di¡ªûToPoštS‘FunùiÚ
::
PGA
);

182 
™”
 = 0;

183 
CÚjug©eG¿d›ÁM‘hod
 
	`İt
(
w¿µ”
, *
pga_cÛfs
);

184 ! 
İt
.
	`isFšished
()) {

185 
be¡
 = 
İt
.
	`g‘Be¡Ev”X
();

186 
v
 = 
İt
.
	`g‘Be¡Ev”V®ue
();

187 ià(
glob®V”bos™y
 >= 1) {

188 
cout
 << "[PG] I‹r: " << 
g¿ndI‹r
 << ", " << 
™”
 << " bestX: ";

189 
be¡
.
	`´št
();

190 
cout
 << " be¡V®: " << 
v
 << 
’dl
;

192 
İt
.
	`³rfÜmI‹¿tiÚ
();

193 
™”
++;

195 *
pga_cÛfs
 = 
İt
.
	`g‘Be¡Ev”X
();

196 
fš®ScÜe
 = 
İt
.
	`g‘Be¡Ev”V®ue
();

197 ià(
glob®V”bos™y
 >= 1)

198 
cout
 << "I‹r: " << 
™”
 << " be¡X: " << (*
pga_cÛfs
)(0) << " bestVal: "

199 << 
fš®ScÜe
 << 
’dl
;

200 ià(
glob®V”bos™y
 == 0)

201 
cout
 << "ResuÉ‡á” " << 
™”
 << " PGA i‹¿tiÚ ğ" << 
fš®ScÜe
 << 
’dl
;

202 
f
.
	`£tPGACÛfs
(*
pga_cÛfs
);

205 
g¿ndI‹r
++;

207 ià(
ty³
 >ğ
PGA
 && 
glob®V”bos™y
 >= 1)

209 
cout
 << "[ALTERNATION] difã»nû is: " << (
simT¿nsScÜe
 - 
fš®ScÜe
)

210 << 
’dl
;

212 } (
Ï¡ScÜe
 - 
fš®ScÜe
è> 
cÚv”g’û_lim™
);

215 ià(! 
xfÜm
)

216 
xfÜm
 = 
Ãw
 
Sim¬™yT¿nsfÜm3D
;

217 *
xfÜm
 = 
f
.
	`g‘S·û
()->
	`ü—‹SimT¿ns
(
po¡SimT¿nsCÛfs
);

219 ià(
ty³
 !ğ
PGA
 || 
pg_Üd”
 >= 0)

220 
be¡Obj
 = 
f
.
	`ü—‹T¬g‘Objeù
(
be¡
);

222  
Œue
;

223 
	}
}

225 
	gF™UÆab–edPošts
::
	$»suÉ
(
Sim¬™yT¿nsfÜm3D
 & 
ouutXfÜm
)

227 
ouutXfÜm
 = *
xfÜm
;

228 
	}
}

230 
	gF™UÆab–edPošts
::
»suÉ
(
¡d
::
veùÜ
<> & 
pgaCÛfs
)

232 
pgaCÛfs
.
ş—r
();

233 ià(
	gpga_cÛfs
 !ğ
NULL
) {

234 
i
 = 0; 
	gi
 < 
	gpga_cÛfs
->
size
(); i++)

235 
	gpgaCÛfs
.
push_back
((*
pga_cÛfs
)(
i
));

	@FunctionExplorer.cpp

2 
	~"glob®BudP¬ms.h
"

3 #ifdeà
OPTIMIZATION_VISUALIZER


6 
	~<io¡»am
>

7 
	~"LogMªag”.h
"

8 
	~"FunùiÚEx¶Ü”.h
"

11 
usšg
 
	g¡d
::
cout
;

12 
usšg
 
	g¡d
::
’dl
;

16 cÚ¡ 
VeùÜ
 
	gFunùiÚEx¶Ü”
::
	$ü—‹O¹hogÚ®VeùÜ
(cÚ¡ 
VeùÜ
 & 
v
)

18 
n
 = 
v
.
	`size
();

19 
VeùÜ
 
	`o
(
n
);

20 
i
 = 0; i + 1 < 2*(
n
/2); i += 2) {

21 
	`o
(
i
èğ
	`v
(i+1);

22 
	`o
(
i
+1èğ-
	`v
(i);

24 ià(
n
 % 2 == 1) {

25 
	`o
(
n
 - 1) = 0;

27  
o
;

28 
	}
}

30 
	gFunùiÚEx¶Ü”
::
	$ex¶ÜePÏÃ
(
FunùiÚ
 * 
f
, cÚ¡ 
VeùÜ
 & 
v
, cÚ¡ VeùÜ & 
dœ1
, cÚ¡ VeùÜ & 
dœ2
)

32 
cout
 << "BefÜex¶Üšg…ÏÃ" << 
’dl
;

33 
cout
 << "Center…oint: ";

34 
v
.
	`´št
(); 
cout
 << 
’dl
;

36 
cout
 << "Dir 1: ";

37 
dœ1
.
	`´št
();

38 
cout
 << 
’dl
;

39 
cout
 << "Dir 2: ";

40 
dœ2
.
	`´št
();

41 
cout
 << 
’dl
;

43 
VeùÜ
* 
pošt
;

44 
glob®LogMªag”
.
	`ş—rC©egÜy
(2);

45 
glob®LogMªag”
.
	`£tC©egÜy
(2);

46 ià(!
f
) { ; }

47 
x
 = -10; x <= 10; x++) {

48 
y
 = -10; y <= 10; y++) {

49 
pošt
 = 
Ãw
 
	`VeùÜ
(
v
 + (0.1 * 
x
 * 
dœ1
è+ (0.1 * 
y
 * 
dœ2
));

51 
f
->
	`ev®u©e
(*
pošt
);

54 
cout
 << "dÚex¶Üšg…ÏÃ" << 
’dl
;

55 
	}
}

	@ImagePlanes.cpp

1 
	~<memÜy.h
>

2 
	~<m©h.h
>

3 
	~"ImagePÏÃs.h
"

8 #ifdeà
DEBUG


9 
	~<io¡»am
>

10 
usšg
 
Çme¥aû
 
	g¡d
;

14 
	gImagePÏÃs
::
	$š™
(
Image3D
 * 
im
, 
size
, 
boŞ
 
smoÙhÃss
)

16 
image
 = 
im
;

17 
yFl
 = 
çl£
;

18 
zFl
 = 
çl£
;

20 ià(
size
 > 0 && siz!ğ
imagePÏÃSize
) {

21 
imagePÏÃSize
 = 
size
;

22 
	`®loÿ‹PÏÃMemÜy
();

24 ià(
image
 !ğ
NULL
) {

26 
xCutPÏÃWÜldPos
 = 
image
->
	`imageXToWÜld
(image->
	`g‘XDim
()/2);

27 
yCutPÏÃWÜldPos
 = 
image
->
	`imageYToWÜld
(image->
	`g‘YDim
()/2);

28 
zCutPÏÃWÜldPos
 = 
image
->
	`imageZToWÜld
(image->
	`g‘ZDim
()/2);

32 
imagePÏÃSize
 = 
size
;

34 
smoÙh
 = 
smoÙhÃss
;

36 ià(
im
 =ğ
NULL
) {

37 
imagePÏÃSize
 = 0;

41 #iâdeà
UNFLIPPED


42 ià(
image
->
	`g‘YS·cšg
() < 0.0)

43 
yFl
 = 
Œue
;

44 ià(
image
->
	`g‘ZS·cšg
() < 0.0)

45 
zFl
 = 
Œue
;

48 ià(
im
->
	`g‘IsImageScked
(è=ğ
Œue
)

49 
lut_max
 = 
MAX_STACKED_GREY_VALUE
;

51 
G»yV®ue
 
mš
;

52 
image
->
	`¿nge
(
mš
, 
lut_max
);

53 ià(
lut_max
 < 
mš
)

54 
lut_max
 = 
MAX_GREY_VALUE
;

56 #ifdeà
DEBUG


57 
cout
 << "ImagePÏÃs::lut_max = " << 
lut_max
 << 
’dl
;

60 ià(
cŞÜLUT
 =ğ
NULL
) {

61 
šdex
;

62 
cŞÜLUT
 = 
Ãw
 [
MAX_GREY_VALUE
 - 
MIN_GREY_VALUE
 + 1];

63 
šdex
 = 
MIN_GREY_VALUE
; index <ğ(è
MAX_GREY_VALUE
; index++)

64 
cŞÜLUT
[
šdex
] = ()(((èšdex / (è
lut_max
) * 255.0f);

66 
	}
}

68 
	gImagePÏÃs
::
	$ImagePÏÃs
()

70 
cŞÜLUT
 = 
NULL
;

71 
xCutPÏÃ
 = 
NULL
;

72 
yCutPÏÃ
 = 
NULL
;

73 
zCutPÏÃ
 = 
NULL
;

74 
¬bCutPÏÃ
 = 
NULL
;

75 
imagePÏÃSize
 = 0;

77 
	`š™
(
NULL
, 0, 
Œue
);

78 
	}
}

80 
	gImagePÏÃs
::
	$ImagePÏÃs
(
Image3D
 * 
im
, 
size
)

82 
cŞÜLUT
 = 
NULL
;

83 
xCutPÏÃ
 = 
NULL
;

84 
yCutPÏÃ
 = 
NULL
;

85 
zCutPÏÃ
 = 
NULL
;

86 
¬bCutPÏÃ
 = 
NULL
;

87 
imagePÏÃSize
 = 0;

89 
	`š™
(
im
, 
size
, 
Œue
);

90 
	}
}

94 
	gImagePÏÃs
::
	$£tImagePŒ
(
Image3D
 * 
im
, 
size
, 
boŞ
 
ex‹º®
)

96 #ifdeà
DEBUG


97 
cout
 << "ImagePÏÃs::£tImagePŒ(im = 0x" << 
hex
 << 
im
 << 
dec
 << ")\n";

99 ià(
im
 =ğ
NULL
 || 
size
 !ğ
imagePÏÃSize
)

100 
	`ä“PÏÃMemÜy
();

102 ià(
image
 !ğ
NULL
 && imag!ğ
im
 && ! 
ex‹º®
)

104 
d–‘e
 
image
;

105 
image
 = 
NULL
 ;

108 
	`š™
(
im
, 
size
, 
smoÙh
);

109 
	}
}

111 
	gImagePÏÃs
::~
	$ImagePÏÃs
()

113 
	`ä“PÏÃMemÜy
();

115 ifĞ
cŞÜLUT
 !ğ
NULL
 )

116 
d–‘e
 [] 
cŞÜLUT
;

117 
cŞÜLUT
 = 
NULL
 ;

125 
	}
}

127 
	gImagePÏÃs
::
	$£tSmoÙhšg
(
boŞ
 
smoÙhImages
) {

128 
smoÙh
 = 
smoÙhImages
;

129 
	}
}

131 * 
	gImagePÏÃs
::
	$g‘XCutPÏÃ
(
boŞ
 
fš®
)

133 #ifdeà
DEBUG


136 ià(
fš®
 && 
smoÙh
)

137 
	`flXCutPÏÃ
();

139 
	`ç¡FlXCutPÏÃ
();

141  
xCutPÏÃ
;

142 
	}
}

144 * 
	gImagePÏÃs
::
	$g‘YCutPÏÃ
(
boŞ
 
fš®
)

146 #ifdeà
DEBUG


149 ià(
fš®
 && 
smoÙh
)

150 
	`flYCutPÏÃ
();

152 
	`ç¡FlYCutPÏÃ
();

154  
yCutPÏÃ
;

155 
	}
}

157 * 
	gImagePÏÃs
::
	$g‘ZCutPÏÃ
(
boŞ
 
fš®
)

159 #ifdeà
DEBUG


162 ià(
fš®
 && 
smoÙh
)

163 
	`flZCutPÏÃ
();

165 
	`ç¡FlZCutPÏÃ
();

167  
zCutPÏÃ
;

168 
	}
}

169 
	gImagePÏÃs
::
	$g‘XCutPÏÃMod–Pos
() const

171 ià(
image
 =ğ
NULL
)

174  
image
->
	`wÜldXToMod–
(
xCutPÏÃWÜldPos
);

175 
	}
}

177 
	gImagePÏÃs
::
	$g‘YCutPÏÃMod–Pos
() const

179 ià(
image
 =ğ
NULL
)

182  
image
->
	`wÜldYToMod–
(
yCutPÏÃWÜldPos
);

183 
	}
}

185 
	gImagePÏÃs
::
	$g‘ZCutPÏÃMod–Pos
() const

187 ià(
image
 =ğ
NULL
)

190  
image
->
	`wÜldZToMod–
(
zCutPÏÃWÜldPos
);

191 
	}
}

196 
boŞ
 
	gImagePÏÃs
::
	$g‘CutPÏÃMod–Pos™iÚs
(& 
x
, & 
y
,

197 & 
z
) const

199 ià(
image
 =ğ
NULL
)

200  
çl£
;

202 
x
 = 
image
->
	`wÜldXToMod–
(
xCutPÏÃWÜldPos
);

203 
y
 = 
image
->
	`wÜldYToMod–
(
yCutPÏÃWÜldPos
);

204 
z
 = 
image
->
	`wÜldZToMod–
(
zCutPÏÃWÜldPos
);

205  
Œue
;

206 
	}
}

208 
	gImagePÏÃs
::
	$g‘XCutPÏÃIndex
() const

210 
xIndex
;

212 ià(
image
 =ğ
NULL
)

215 
xIndex
 = 
image
->
	`wÜldXToImage
(
xCutPÏÃWÜldPos
);

218 ià(
xIndex
 < 0 || xIndex >ğ
image
->
	`g‘XDim
())

221  
xIndex
;

222 
	}
}

224 
	gImagePÏÃs
::
	$g‘YCutPÏÃIndex
() const

226 
yIndex
;

228 ià(
image
 =ğ
NULL
)

231 
yIndex
 = 
image
->
	`wÜldYToImage
(
yCutPÏÃWÜldPos
);

234 ià(
yIndex
 < 0 || yIndex >ğ
image
->
	`g‘YDim
())

237  
yIndex
;

238 
	}
}

240 
	gImagePÏÃs
::
	$g‘ZCutPÏÃIndex
() const

242 
zIndex
;

244 ià(
image
 =ğ
NULL
)

247 
zIndex
 = 
image
->
	`wÜldZToImage
(
zCutPÏÃWÜldPos
);

250 ià(
zIndex
 < 0 || zIndex >ğ
image
->
	`g‘ZDim
())

253  
zIndex
;

254 
	}
}

256 * 
	gImagePÏÃs
::
	$g‘ArbCutPÏÃ
(
boŞ
 
fš®
)

258 ià(
fš®
 && 
smoÙh
)

259 
	`flArbCutPÏÃ
();

261 
	`ç¡FlArbCutPÏÃ
();

263  
¬bCutPÏÃ
;

264 
	}
}

266 
	gImagePÏÃs
::
	$£tXCutPÏÃSliû
(
¦iûIndex
)

268 ià(
image
 =ğ
NULL
)

271 
xCutPÏÃWÜldPos
 = 
image
->
	`imageXToWÜld
(
¦iûIndex
);

272 
	}
}

274 
	gImagePÏÃs
::
	$£tYCutPÏÃSliû
(
¦iûIndex
)

276 ià(
image
 =ğ
NULL
)

279 
yCutPÏÃWÜldPos
 = 
image
->
	`imageYToWÜld
(
¦iûIndex
);

280 
	}
}

282 
	gImagePÏÃs
::
	$£tZCutPÏÃSliû
(
¦iûIndex
)

284 ià(
image
 =ğ
NULL
)

287 
zCutPÏÃWÜldPos
 = 
image
->
	`imageZToWÜld
(
¦iûIndex
);

288 
	}
}

290 
	gImagePÏÃs
::
	$£tArbCutPÏÃWÜldPos
(cÚ¡ 
VeùÜ3D
 & 
pos
)

292 ià(
¬bCutPÏÃWÜldPos
 !ğ
pos
)

293 
¬bCutPÏÃWÜldPos
 = 
pos
;

294 
	}
}

296 
	gImagePÏÃs
::
	$£tArbCutPÏÃXDœ
(cÚ¡ 
VeùÜ3D
 & 
xdœ
)

298 ià(
¬bCutPÏÃXDœ
 !ğ
xdœ
)

299 
¬bCutPÏÃXDœ
 = 
xdœ
;

300 
	}
}

302 
	gImagePÏÃs
::
	$£tArbCutPÏÃYDœ
(cÚ¡ 
VeùÜ3D
 & 
ydœ
)

304 ià(
¬bCutPÏÃYDœ
 !ğ
ydœ
)

305 
¬bCutPÏÃYDœ
 = 
ydœ
;

306 
	}
}

308 
	gImagePÏÃs
::
	$£tArbCutPÏÃEx‹Á
(
ex‹Á
)

310 ià(
¬bCutPÏÃEx‹Á
 !ğ
ex‹Á
)

311 
¬bCutPÏÃEx‹Á
 = 
ex‹Á
;

312 
	}
}

315 
	gImagePÏÃs
::
	$£tIÁ’s™yWšdow
(
mš
, 
max
)

317 
šdex
;

319 #ifdeà
DEBUG


320 
cout
 << "C®Ëd ImagePÏÃs::£tIÁ’s™yWšdow(èw™h mš = " << 
mš


321 << "‡nd max = " << 
max
 << 
’dl
;

323 
šdex
 = 
MIN_GREY_VALUE
; index <ğ
MAX_GREY_VALUE
; index++) {

324 
Ëv–
 = (è
šdex
 / (è
lut_max
;

325 ià(
Ëv–
 <ğ
mš
)

326 
cŞÜLUT
[
šdex
] = 0;

327 ià(
Ëv–
 >ğ
max
)

328 
cŞÜLUT
[
šdex
] = 255;

330 
cŞÜLUT
[
šdex
] = (è(255.0 * (
Ëv–
 - 
mš
è/ (
max
 - min));

332 
	}
}

335 
	gImagePÏÃs
::
	$flXCutPÏÃ
()

337 
xIndex
;

338 
yIndex
, 
zIndex
;

339 
yDim
, 
zDim
;

340 
i
, 
j
;

341 
G»yV®ue
 * 
vox–PŒ
;

342 
G»yV®ue
 
vox–
;

343 * 
xCutPÏÃPŒ
;

345 ià(
image
 =ğ
NULL
) {

346 
	`ä“PÏÃMemÜy
();

350 ià(
xCutPÏÃ
 =ğ
NULL
)

353 
vox–PŒ
 = 
image
->
	`g‘Vox–s
();

354 ià(
vox–PŒ
 =ğ
NULL
) {

355 
d–‘e
 [] 
xCutPÏÃ
;

356 
xCutPÏÃ
 = 
NULL
;

360 
xIndex
 = 
image
->
	`wÜldXToImage
(
xCutPÏÃWÜldPos
);

361 #ifdeà
DEBUG


362 
cout
 << "ImagePlanes::fillXCutPlane(): Filling X slice "

363 << 
xIndex
 << ", " << 
xCutPÏÃWÜldPos
 << " cm" << 
’dl
;

367 ià(
xIndex
 < 0 || xIndex >ğ
image
->
	`g‘XDim
()) {

368 
	`mem£t
((*è
xCutPÏÃ
, 0, 
imagePÏÃSize
*imagePlaneSize);

372 
yDim
 = 
image
->
	`g‘YDim
() - 1;

373 
zDim
 = 
image
->
	`g‘ZDim
() - 1;

375 
xCutPÏÃPŒ
 = 
xCutPÏÃ
;

376 
i
 = 0; i < 
imagePÏÃSize
; i++) {

377 
zIndex
 = ((è(
i
*
zDim
))/(
imagePÏÃSize
 - 1);

378 
j
 = 0; j < 
imagePÏÃSize
; j++) {

379 
yIndex
 = ((è(
j
*
yDim
))/(
imagePÏÃSize
 - 1);

381 
vox–
 = (
G»yV®ue
è(0.5 + 
image
->
	`g‘IÁ”pŞ©edVox–V®ue
(

382 (è
xIndex
, 
yIndex
, 
zIndex
));

383 (*
xCutPÏÃPŒ
èğ
cŞÜLUT
[
vox–
];

384 
xCutPÏÃPŒ
++;

387 
	}
}

396 
	gImagePÏÃs
::
	$ç¡FlXCutPÏÃ
()

398 
xIndex
;

399 
xDim
, 
yDim
, 
zDim
;

400 
yInüem’t
, 
zInüem’t
;

401 
zL—p
;

402 
yModulo
, 
zModulo
;

403 
yCouÁ”
, 
zCouÁ”
;

404 
j
, 
k
;

406 
G»yV®ue
 * 
vox–PŒ
;

407 
G»yV®ue
 * 
ŞdPŒ
;

408 * 
xCutPÏÃPŒ
;

410 ià(
image
 =ğ
NULL
) {

411 
	`ä“PÏÃMemÜy
();

415 ià(
xCutPÏÃ
 =ğ
NULL
)

418 
vox–PŒ
 = 
image
->
	`g‘Vox–s
();

419 ià(
vox–PŒ
 =ğ
NULL
) {

420 
d–‘e
 [] 
xCutPÏÃ
;

421 
xCutPÏÃ
 = 
NULL
;

425 
xDim
 = 
image
->
	`g‘XDim
();

426 
yDim
 = 
image
->
	`g‘YDim
();

427 
zDim
 = 
image
->
	`g‘ZDim
();

429 
xIndex
 = 
image
->
	`wÜldXToImage
(
xCutPÏÃWÜldPos
);

431 #ifdeà
DEBUG


432 
cout
 << "ImagePlanes::fastFillXCutPlane() Filling X slice "

433 << 
xIndex
 << ", " << 
xCutPÏÃWÜldPos
 << " cm" << 
’dl
;

437 ià(
xIndex
 < 0 || xIndex >ğ
xDim
) {

438 
	`mem£t
((*è
xCutPÏÃ
, 0, 
imagePÏÃSize
*imagePlaneSize);

442 
zL—p
 = 
xDim
 * 
yDim
;

444 
yInüem’t
 = (
yDim
 / 
imagePÏÃSize
è* 
xDim
;

445 
yModulo
 = 
yDim
 % 
imagePÏÃSize
;

447 
zInüem’t
 = (
zDim
 / 
imagePÏÃSize
è* 
zL—p
;

448 
zModulo
 = 
zDim
 % 
imagePÏÃSize
;

450 
xCutPÏÃPŒ
 = 
xCutPÏÃ
;

451 
yCouÁ”
 = 0;

452 
zCouÁ”
 = 0;

454 ià(
yFl
) {

455 ià(
zFl
) {

456 
yInüem’t
 = -yIncrement;

457 
vox–PŒ
 +ğ(
xDim
*
yDim
*
zDim
 - 1è- (xDim - 
xIndex
 - 1);

458 
xDim
 = -xDim;

459 
zL—p
 = -zLeap;

462 
yInüem’t
 = -yIncrement;

463 
vox–PŒ
 +ğ(
xDim
*
yDim
 - 1è- (xDim - 
xIndex
 - 1);

464 
xDim
 = -xDim;

467 ià(
zFl
) {

468 
zInüem’t
 = -zIncrement;

469 
vox–PŒ
 +ğ
xDim
*
yDim
*(
zDim
 - 1è+ 
xIndex
;

470 
zL—p
 = -zLeap;

473 
vox–PŒ
 +ğ
xIndex
;

475 
k
 = 0; k < 
imagePÏÃSize
; k++) {

476 
ŞdPŒ
 = 
vox–PŒ
;

477 
j
 = 0; j < 
imagePÏÃSize
; j++) {

478 #ifdeà
AE2_BUILD


479 (*
xCutPÏÃPŒ
èğ
cŞÜLUT
[
IMAGE_BITS
 & *
vox–PŒ
];

481 (*
xCutPÏÃPŒ
èğ
cŞÜLUT
[*
vox–PŒ
];

483 
vox–PŒ
 +ğ
yInüem’t
;

484 
yCouÁ”
 +ğ
yModulo
;

485 ià(
yCouÁ”
 >ğ
imagePÏÃSize
) {

486 
yCouÁ”
 -ğ
imagePÏÃSize
;

487 
vox–PŒ
 +ğ
xDim
;

489 
xCutPÏÃPŒ
++;

491 
vox–PŒ
 = 
ŞdPŒ
;

492 
vox–PŒ
 +ğ
zInüem’t
;

493 
zCouÁ”
 +ğ
zModulo
;

494 ià(
zCouÁ”
 >ğ
imagePÏÃSize
) {

495 
zCouÁ”
 -ğ
imagePÏÃSize
;

496 
vox–PŒ
 +ğ
zL—p
;

499 
	}
}

502 
	gImagePÏÃs
::
	$flYCutPÏÃ
()

504 
yIndex
;

505 
xIndex
, 
zIndex
;

506 
xDim
, 
zDim
;

507 
i
, 
j
;

508 
G»yV®ue
 
vox–
;

509 
G»yV®ue
 * 
vox–PŒ
;

510 * 
yCutPÏÃPŒ
;

512 ià(
image
 =ğ
NULL
) {

513 
	`ä“PÏÃMemÜy
();

517 ià(
yCutPÏÃ
 =ğ
NULL
)

520 
vox–PŒ
 = 
image
->
	`g‘Vox–s
();

521 ià(
vox–PŒ
 =ğ
NULL
) {

522 
d–‘e
 [] 
yCutPÏÃ
;

523 
yCutPÏÃ
 = 
NULL
;

527 
yIndex
 = 
image
->
	`wÜldYToImage
(
yCutPÏÃWÜldPos
);

528 #ifdeà
DEBUG


529 
cout
 << "ImagePlanes::fillYCutPlane() Filling Y slice "

530 << 
yIndex
 << ", " << 
yCutPÏÃWÜldPos
 << " cm" << 
’dl
;

534 ià(
yIndex
 < 0 || yIndex >ğ
image
->
	`g‘YDim
()) {

535 
	`mem£t
((*è
yCutPÏÃ
, 0, 
imagePÏÃSize
*imagePlaneSize);

539 
xDim
 = 
image
->
	`g‘XDim
() - 1;

540 
zDim
 = 
image
->
	`g‘ZDim
() - 1;

542 
yCutPÏÃPŒ
 = 
yCutPÏÃ
;

543 
i
 = 0; i < 
imagePÏÃSize
; i++) {

544 
zIndex
 = ((è(
i
*
zDim
))/(
imagePÏÃSize
 - 1);

545 
j
 = 0; j < 
imagePÏÃSize
; j++) {

546 
xIndex
 = ((è(
j
*
xDim
))/(
imagePÏÃSize
 - 1);

548 
vox–
 = (
G»yV®ue
è(0.5 + 
image
->
	`g‘IÁ”pŞ©edVox–V®ue
(

549 
xIndex
, (è
yIndex
, 
zIndex
));

550 (*
yCutPÏÃPŒ
èğ
cŞÜLUT
[
vox–
];

551 
yCutPÏÃPŒ
++;

554 
	}
}

557 
	gImagePÏÃs
::
	$ç¡FlYCutPÏÃ
()

559 
yIndex
;

560 
xDim
, 
yDim
, 
zDim
;

561 
xInüem’t
, 
zInüem’t
;

562 
zL—p
;

563 
xModulo
, 
zModulo
;

564 
xCouÁ”
, 
zCouÁ”
;

565 
i
, 
k
;

567 
G»yV®ue
 * 
vox–PŒ
;

568 
G»yV®ue
 * 
ŞdPŒ
;

569 * 
yCutPÏÃPŒ
;

571 ià(
image
 =ğ
NULL
) {

572 
	`ä“PÏÃMemÜy
();

576 ià(
yCutPÏÃ
 =ğ
NULL
)

579 
vox–PŒ
 = 
image
->
	`g‘Vox–s
();

580 ià(
vox–PŒ
 =ğ
NULL
) {

581 
d–‘e
 [] 
yCutPÏÃ
;

582 
yCutPÏÃ
 = 
NULL
;

586 
xDim
 = 
image
->
	`g‘XDim
();

587 
yDim
 = 
image
->
	`g‘YDim
();

588 
zDim
 = 
image
->
	`g‘ZDim
();

590 
yIndex
 = 
image
->
	`wÜldYToImage
(
yCutPÏÃWÜldPos
);

591 ià(
yFl
) {

595 
yIndex
 = 
yDim
 - 1 - yIndex;

597 #ifdeà
DEBUG


598 
cout
 << "ImagePlanes::fastFillYCutPlane() Filling Y slice "

599 << 
yIndex
 << ", " << 
yCutPÏÃWÜldPos
 << " cm" << 
’dl
;

603 ià(
yIndex
 < 0 || yIndex >ğ
yDim
) {

604 
	`mem£t
((*è
yCutPÏÃ
, 0, 
imagePÏÃSize
*imagePlaneSize);

608 
zL—p
 = 
xDim
 * 
yDim
;

610 
xInüem’t
 = (
xDim
 / 
imagePÏÃSize
);

611 
xModulo
 = 
xDim
 % 
imagePÏÃSize
;

613 
zInüem’t
 = (
zDim
 / 
imagePÏÃSize
è* 
zL—p
;

614 
zModulo
 = 
zDim
 % 
imagePÏÃSize
;

616 ià(
zFl
) {

617 
zInüem’t
 = -zIncrement;

618 
vox–PŒ
 +ğ
xDim
*
yDim
*(
zDim
 - 1);

619 
zL—p
 = -zLeap;

621 
vox–PŒ
 +ğ
yIndex
 * 
xDim
;

623 
yCutPÏÃPŒ
 = 
yCutPÏÃ
;

624 
xCouÁ”
 = 0;

625 
zCouÁ”
 = 0;

627 
k
 = 0; k < 
imagePÏÃSize
; k++) {

628 
ŞdPŒ
 = 
vox–PŒ
;

629 
i
 = 0; i < 
imagePÏÃSize
; i++) {

630 #ifdeà
AE2_BUILD


631 (*
yCutPÏÃPŒ
èğ
cŞÜLUT
[
IMAGE_BITS
 & *
vox–PŒ
];

633 (*
yCutPÏÃPŒ
èğ
cŞÜLUT
[*
vox–PŒ
];

635 
vox–PŒ
 +ğ
xInüem’t
;

636 
xCouÁ”
 +ğ
xModulo
;

637 ià(
xCouÁ”
 >ğ
imagePÏÃSize
) {

638 
xCouÁ”
 -ğ
imagePÏÃSize
;

639 
vox–PŒ
++;

641 
yCutPÏÃPŒ
++;

643 
vox–PŒ
 = 
ŞdPŒ
;

644 
vox–PŒ
 +ğ
zInüem’t
;

645 
zCouÁ”
 +ğ
zModulo
;

646 ià(
zCouÁ”
 >ğ
imagePÏÃSize
) {

647 
zCouÁ”
 -ğ
imagePÏÃSize
;

648 
vox–PŒ
 +ğ
zL—p
;

651 
	}
}

654 
	gImagePÏÃs
::
	$flZCutPÏÃ
()

656 
zIndex
;

657 
xIndex
, 
yIndex
;

658 
xDim
, 
yDim
;

659 
i
, 
j
;

660 
G»yV®ue
 
vox–
;

661 
G»yV®ue
 * 
vox–PŒ
;

662 * 
zCutPÏÃPŒ
;

664 ià(
image
 =ğ
NULL
) {

665 
	`ä“PÏÃMemÜy
();

669 ià(
zCutPÏÃ
 =ğ
NULL
)

672 
vox–PŒ
 = 
image
->
	`g‘Vox–s
();

673 ià(
vox–PŒ
 =ğ
NULL
) {

674 
d–‘e
 [] 
zCutPÏÃ
;

675 
zCutPÏÃ
 = 
NULL
;

679 
zIndex
 = 
image
->
	`wÜldZToImage
(
zCutPÏÃWÜldPos
);

680 #ifdeà
DEBUG


681 
cout
 << "ImagePlanes::fillZCutPlane(): Filling Z slice "

682 << 
zIndex
 << ", " << 
zCutPÏÃWÜldPos
 << " cm" << 
’dl
;

686 ià(
zIndex
 < 0 || zIndex >ğ
image
->
	`g‘ZDim
()) {

687 
	`mem£t
((*è
zCutPÏÃ
, 0, 
imagePÏÃSize
*imagePlaneSize);

691 
xDim
 = 
image
->
	`g‘XDim
() - 1;

692 
yDim
 = 
image
->
	`g‘YDim
() - 1;

694 
zCutPÏÃPŒ
 = 
zCutPÏÃ
;

695 
i
 = 0; i < 
imagePÏÃSize
; i++) {

696 
yIndex
 = ((è(
i
*
yDim
))/(
imagePÏÃSize
 - 1);

697 
j
 = 0; j < 
imagePÏÃSize
; j++) {

698 
xIndex
 = ((è(
j
*
xDim
))/(
imagePÏÃSize
 - 1);

700 
vox–
 = (
G»yV®ue
è(0.5 + 
image
->
	`g‘IÁ”pŞ©edVox–V®ue
(

701 
xIndex
, 
yIndex
, (è
zIndex
));

702 (*
zCutPÏÃPŒ
èğ
cŞÜLUT
[
vox–
];

703 
zCutPÏÃPŒ
++;

706 
	}
}

709 
	gImagePÏÃs
::
	$ç¡FlZCutPÏÃ
()

711 
zIndex
;

712 
xDim
, 
yDim
, 
zDim
;

713 
xInüem’t
, 
yInüem’t
;

714 
xModulo
, 
yModulo
;

715 
xCouÁ”
, 
yCouÁ”
;

716 
i
, 
j
;

718 
G»yV®ue
 * 
vox–PŒ
;

719 
G»yV®ue
 * 
ŞdPŒ
;

720 * 
zCutPÏÃPŒ
;

722 ià(
image
 =ğ
NULL
) {

723 
	`ä“PÏÃMemÜy
();

727 ià(
zCutPÏÃ
 =ğ
NULL
)

730 
vox–PŒ
 = 
image
->
	`g‘Vox–s
();

731 ià(
vox–PŒ
 =ğ
NULL
) {

732 
d–‘e
 [] 
zCutPÏÃ
;

733 
zCutPÏÃ
 = 
NULL
;

737 
xDim
 = 
image
->
	`g‘XDim
();

738 
yDim
 = 
image
->
	`g‘YDim
();

739 
zDim
 = 
image
->
	`g‘ZDim
();

741 
zIndex
 = 
image
->
	`wÜldZToImage
(
zCutPÏÃWÜldPos
);

742 ià(
zFl
) {

746 
zIndex
 = 
zDim
 - 1 - zIndex;

748 #ifdeà
DEBUG


749 
cout
 << "ImagePlanes::fastFillZCutPlane(): Filling Z slice "

750 << 
zIndex
 << ", " << 
zCutPÏÃWÜldPos
 << " cm" << 
’dl
;

754 ià(
zIndex
 < 0 || zIndex >ğ
zDim
) {

755 
	`mem£t
((*è
zCutPÏÃ
, 0, 
imagePÏÃSize
*imagePlaneSize);

759 
xInüem’t
 = (
xDim
 / 
imagePÏÃSize
);

760 
xModulo
 = 
xDim
 % 
imagePÏÃSize
;

762 
yInüem’t
 = (
yDim
 / 
imagePÏÃSize
è* 
xDim
;

763 
yModulo
 = 
yDim
 % 
imagePÏÃSize
;

765 ià(
yFl
) {

766 
yInüem’t
 = -yIncrement;

767 
vox–PŒ
 +ğ
xDim
*
yDim
*
zIndex
 + xDim*(yDim - 1);

768 
xDim
 = -xDim;

771 
vox–PŒ
 +ğ
zIndex
 * 
xDim
 * 
yDim
;

773 
zCutPÏÃPŒ
 = 
zCutPÏÃ
;

774 
xCouÁ”
 = 0;

775 
yCouÁ”
 = 0;

777 
j
 = 0; j < 
imagePÏÃSize
; j++) {

778 
ŞdPŒ
 = 
vox–PŒ
;

779 
i
 = 0; i < 
imagePÏÃSize
; i++) {

780 #ifdeà
AE2_BUILD


781 (*
zCutPÏÃPŒ
èğ
cŞÜLUT
[
IMAGE_BITS
 & *
vox–PŒ
];

783 (*
zCutPÏÃPŒ
èğ
cŞÜLUT
[*
vox–PŒ
];

785 
vox–PŒ
 +ğ
xInüem’t
;

786 
xCouÁ”
 +ğ
xModulo
;

787 ià(
xCouÁ”
 >ğ
imagePÏÃSize
) {

788 
xCouÁ”
 -ğ
imagePÏÃSize
;

789 
vox–PŒ
++;

791 
zCutPÏÃPŒ
++;

793 
vox–PŒ
 = 
ŞdPŒ
;

794 
vox–PŒ
 +ğ
yInüem’t
;

795 
yCouÁ”
 +ğ
yModulo
;

796 ià(
yCouÁ”
 >ğ
imagePÏÃSize
) {

797 
yCouÁ”
 -ğ
imagePÏÃSize
;

798 
vox–PŒ
 +ğ
xDim
;

801 
	}
}

803 
	gImagePÏÃs
::
	$flArbCutPÏÃ
()

806 
	}
}

808 
ImagePÏÃs
::
	$ç¡FlArbCutPÏÃ
()

811 
	}
}

813 
ImagePÏÃs
::
	$®loÿ‹PÏÃMemÜy
()

815 
tÙ®Size
;

817 #ifdeà
DEBUG


818 
cout
 << "ImagePlanes::allocatePlaneMemory()\n";

820 
tÙ®Size
 = 
imagePÏÃSize
 * imagePlaneSize;

822 ià(
xCutPÏÃ
 !ğ
NULL
)

823 
d–‘e
 [] 
xCutPÏÃ
;

824 ià(
yCutPÏÃ
 !ğ
NULL
)

825 
d–‘e
 [] 
yCutPÏÃ
;

826 ià(
zCutPÏÃ
 !ğ
NULL
)

827 
d–‘e
 [] 
zCutPÏÃ
;

828 ià(
¬bCutPÏÃ
 !ğ
NULL
)

829 
d–‘e
 [] 
¬bCutPÏÃ
;

831 ià(
tÙ®Size
 <= 0) {

832 
xCutPÏÃ
 = 
NULL
;

833 
yCutPÏÃ
 = 
NULL
;

834 
zCutPÏÃ
 = 
NULL
;

835 
¬bCutPÏÃ
 = 
NULL
;

838 
xCutPÏÃ
 = 
Ãw
 [
tÙ®Size
];

839 
yCutPÏÃ
 = 
Ãw
 [
tÙ®Size
];

840 
zCutPÏÃ
 = 
Ãw
 [
tÙ®Size
];

841 
¬bCutPÏÃ
 = 
Ãw
 [
tÙ®Size
];

843 
	}
}

845 
	gImagePÏÃs
::
	$ä“PÏÃMemÜy
()

847 #ifdeà
DEBUG


848 
cout
 << "ImagePlanes::freePlaneMemory()\n";

850 ià(
xCutPÏÃ
 !ğ
NULL
) {

851 
d–‘e
 [] 
xCutPÏÃ
;

852 
xCutPÏÃ
 = 
NULL
;

854 ià(
yCutPÏÃ
 !ğ
NULL
) {

855 
d–‘e
 [] 
yCutPÏÃ
;

856 
yCutPÏÃ
 = 
NULL
;

858 ià(
zCutPÏÃ
 !ğ
NULL
) {

859 
d–‘e
 [] 
zCutPÏÃ
;

860 
zCutPÏÃ
 = 
NULL
;

862 ià(
¬bCutPÏÃ
 !ğ
NULL
) {

863 
d–‘e
 [] 
¬bCutPÏÃ
;

864 
¬bCutPÏÃ
 = 
NULL
;

866 
	}
}

	@LandmarkDeformation.cpp

67 
	~<io¡»am
>

68 
	~<¡dlib.h
>

69 
	~"Lªdm¬kDefÜm©iÚ.h
"

70 
	~"m©rix.h
"

73 
usšg
 
Çme¥aû
 
	g¡d
;

74 
usšg
 
Çme¥aû
 
	g·uly
;

79 
	gLªdm¬kDefÜm©iÚ
::
	$Lªdm¬kDefÜm©iÚ
(
M©rix
 & 
m1
, M©rix & 
m2
, 
rows
)

80 : 
	`n
(
rows
), 
	`X1
(
n
,3), 
	$X2
(
n
,3)

82 
	`compu‹_C_m©rix
();

84 
P»C’‹»d_X1
 = 
m1
;

85 #ifdeà
DEBUG


86 
cout
 << "Thi i thP»ûÁ”ed X1 m©rix." << 
’dl
;

87 
P»C’‹»d_X1
.
	`´št
();

90 
X1
 = 
C_M©rix
 * 
m1
;

91 #ifdeà
DEBUG


92 
cout
 << "Andhi i thC’‹»d X1." << 
’dl
;

93 
X1
.
	`´št
();

96 
P»C’‹»d_X2
 = 
m2
;

97 #ifdeà
DEBUG


98 
cout
 << "Thi i thP»C’‹»d X2 m©rix." << 
’dl
;

99 
P»C’‹»d_X2
.
	`´št
();

102 
X2
 = 
C_M©rix
 * 
m2
;

103 #ifdeà
DEBUG


104 
cout
 << "Andhi i thC’‹»d X2. " << 
’dl
;

105 
X2
.
	`´št
();

108 
P»C’‹»d_X1MšusX1
 = 
P»C’‹»d_X1
 - 
X1
;

109 
P»C’‹»d_X2MšusX2
 = 
P»C’‹»d_X2
 - 
X2
;

110 
X1_Euşid—n_NÜm
 = 
X1
.
	`twoNÜm
();

111 
X2_Euşid—n_NÜm
 = 
X2
.
	`twoNÜm
();

113 
	`run
();

114 
	}
}

116 
	gLªdm¬kDefÜm©iÚ
::
	$run
()

118 
M©rix
 
X2T
, 
X1T
;

119 
M©rix
 
X2TX1
;

120 
M©rix
 
SVDM©rix
;

122 
X2T
 = 
X2
.
	`t
();

123 
X1T
 = 
X1
.
	`t
();

124 
X2TX1
 = 
X2T
 * 
X1
;

126 #ifdeà
DEBUG


127 
cout
 << "ThnÜm i " << 
X2_Euşid—n_NÜm
 << 
’dl
;

130 
SVDM©rix
 = 
X2TX1
 / (
X1_Euşid—n_NÜm
 * 
X2_Euşid—n_NÜm
);

132 
M©rix
 
V
;

133 
VeùÜ
 
Sigma
;

134 
M©rix
 
UŒªs
;

135 
M©rix
 
U
;

136 
M©rix
 
VŒªs
;

138 
SVDM©rix
.
	`çùÜSVD
(
V
,
UŒªs
,
Sigma
,0);

139 
U
 = 
UŒªs
.
	`t
();

140 
VŒªs
 = 
V
.
	`t
();

142 (
gamma
èğ(
U
è* (
VŒªs
);

144 #ifdeà
DEBUG


145 
cout
 << "Thv®uoàgamm¨i " << 
’dl
;

146 
gamma
.
	`´št
();

149 
M©rix
 
num”©Ü
 = (
X2TX1
 * 
gamma
);

150 
M©rix
 
d’om
 = (
X1T
 * 
X1
);

152 
b‘a
 = 
num”©Ü
.
	`Œaû
()/ 
d’om
.trace();

153 #ifdeà
DEBUG


154 
cout
 << "Thv®uoàb‘¨i " << 
b‘a
 << 
’dl
;

157 
X1_off£t
 = 
P»C’‹»d_X1MšusX1
.
	`g‘Row
(0);

158 
X2_off£t
 = 
P»C’‹»d_X2MšusX2
.
	`g‘Row
(0);

159 
fš®_off£t
 = 
X2_off£t
 - 
X1_off£t
;

160 
	}
}

162 
	gLªdm¬kDefÜm©iÚ
::
	$´štResuÉs
()

164 
cout
 << "ThrÙ©iÚ m©rix i " << 
’dl
;

165 
gamma
.
	`´št
();

166 
cout
 << "Thv®uoàb‘¨i " << 
b‘a
 << 
’dl
;

167 
cout
 << "Thv®uoàP»ûÁ”edX1 - X1 i " << 
’dl
;

168 
P»C’‹»d_X1MšusX1
.
	`´št
();

169 
cout
 << "Thv®uoàP»C’‹»d X2 - X2 i " << 
’dl
;

170 
P»C’‹»d_X2MšusX2
.
	`´št
();

171 
cout
 << "Thv®uoàthfš®¿n¦©iÚ veùÜ i " << 
’dl
;

172 
fš®_off£t
.
	`´št
();

173 
	}
}

175 
	gLªdm¬kDefÜm©iÚ
::
	$compu‹_C_m©rix
()

177 
M©rix
 
	`Id’t™y
(
n
,n), 
	`OÃOv”N
(n,n);

178 
Id’t™y
 = 1.0;

180 
i
 = 0; i < 
n
; i++)

181 
j
 = 0; j < 
n
; j++)

182 
	`OÃOv”N
(
i
, 
j
èğ1.0 / 
n
;

184 
C_M©rix
 = 
Id’t™y
 - 
OÃOv”N
;

186 #ifdeà
DEBUG


187 
cout
 << "Now…ršˆth»suÉ oàthC’‹¸m©rix." << 
’dl
;

188 
C_M©rix
.
	`´št
();

190 
	}
}

	@M3DAdaptiveRegistrationPGAOptimizer.cpp

1 
	~<f¡»am
>

2 
	~<¡dio.h
>

3 
	~<m©h.h
>

4 
	~"O±imiz”Ba£.h
"

5 
	~"M3DAd­tiveRegi¡¿tiÚPGAO±imiz”.h
"

7 
usšg
 
Çme¥aû
 
	g¡d
;

9 
	gM3DAd­tiveRegi¡¿tiÚPGAO±imiz”
::
	$M3DAd­tiveRegi¡¿tiÚPGAO±imiz”
(
M3DPGASts
 * 
pgaPŒ
, 
Üd”
)

10 : 
	$M3DRegi¡¿tiÚO±imiz”
(
Œue
)

12 
boundsFunùiÚ
 = 
Ãw
 
M3DAd­tiveRegi¡¿tiÚPGAProbËmBoundsFunùiÚ
;

14 
´obËm
 = 
Ãw
 
	`M3DAd­tiveRegi¡¿tiÚPGAProbËm
(
pgaPŒ
, 
Üd”
);

15 
numP¬am‘”s
 = ((
M3DAd­tiveRegi¡¿tiÚPGAProbËm
 *è
´obËm
)->
	`·¿m‘”CouÁ
();

16 
	}
}

	@M3DAdaptiveRegistrationPGAProblem.cpp

1 
	~<m©h.h
>

2 
	~<io¡»am
>

3 
	~"M3DAd­tiveRegi¡¿tiÚPGAProbËm.h
"

11 
	#USE_MAHALANOBIS_PENALTY


	)

14 
usšg
 
Çme¥aû
 
	g¡d
;

17 
	gM3DAd­tiveRegi¡¿tiÚPGAProbËm
::
	$M3DAd­tiveRegi¡¿tiÚPGAProbËm
(
M3DPGASts
 * 
pgaPŒ
, 
_Üd”
)

18 : 
	$M3DRegi¡¿tiÚProbËm
()

20 
pga
 = 
pgaPŒ
;

21 
Üd”
 = 
_Üd”
;

23 
M3DObjeù
 * 
‹mpObj
 = 
pga
->
	`g‘M—nObjPŒ
()->
	`assign
();

24 
pga
->
	`­¶yM—nResidue
(
‹mpObj
, 
Üd”
);

25 
d–‘e
 
‹mpObj
;

26 
	}
}

28 
	gM3DAd­tiveRegi¡¿tiÚPGAProbËm
::
	$·¿m‘”CouÁ
() const

30  
pga
->
	`g‘PGD©aPŒ
(
Üd”
)->
numPGs
;

31 
	}
}

33 
	gM3DAd­tiveRegi¡¿tiÚPGAProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 &
x
)

35 
m©chV®
;

36 
³ÇÉyV®
;

37 
tÙ®P’®ty
;

38 
M3DObjeù
 * 
rg‘Objeù
;

39 
i
;

41 
ev®u©iÚCo¡
 += 1;

43 ià(
m©ch
 =ğ
NULL
)

44  
ENSEMBLE_MAX_RETURN
;

46 
rg‘Objeù
 = 
	`ü—‹T¬g‘Objeù
(
x
);

49 
boŞ
 
cÚ¡¿štOÆy
 = 
Œue
;

50 ià(
cÚ¡¿štsP’®tyWeight
 =ğ
ENSEMBLE_CONSTRAINT_PENALTY_SCALE_FACTOR
) {

51 
m©chV®
 = 0.0;

52 
³ÇÉyV®
 = 0.0;

53 
cÚ¡¿štOÆy
 = 
çl£
;

56 #ifdeà
NO_MATCH_PENALTY


57 
m©chV®
 = 0.0;

59 
m©chV®
 = 
m©ch
->
	`compu‹Mod–M©ch
(
rg‘Objeù
);

62 #ifdeà
USE_MAHALANOBIS_PENALTY


63 ià(
³ÇÉyWeight
 > 0.0) {

64 
³ÇÉyV®
 = 0.0;

65 
i
 = 0; i < 
x
.
	`size
(); i++)

66 
³ÇÉyV®
 +ğ
	`x
(
i
) * x(i);

67 
³ÇÉyV®
 *ğ
³ÇÉyWeight
;

71 ià(
³ÇÉyWeight
 > 0.0)

72 
³ÇÉyV®
 = 
m©ch
->
	`compu‹Mod–P’®ty
(
rg‘Objeù
è* 
³ÇÉyWeight
;

75 
³ÇÉyV®
 = 0.0;

78 
Ï¡P’®ty
 = 
³ÇÉyV®
;

79 
tÙ®P’®ty
 = (
Ï¡P’®ty
 - 
m©chV®
)*
ENSEMBLE_OBJECTIVE_SCALE_FACTOR
;

80 #ifdeà
DISPLAY_PENALTIES


81 
¡d
::
cout
 << " " << 
³ÇÉyV®
 << " mod– - " << 
m©chV®
 << " m©ch = " << 
tÙ®P’®ty


82 << 
¡d
::
’dl
;

85 ià(
rg‘Objeù
 !ğ
NULL
)

86 
d–‘e
 
rg‘Objeù
;

88  
tÙ®P’®ty
;

89 
	}
}

91 
M3DObjeù
 * 
	gM3DAd­tiveRegi¡¿tiÚPGAProbËm
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 & 
x
)

95 
M3DObjeù
 * 
rg‘Objeù
 = 
pga
->
	`g‘M—nObjPŒ
()->
	`assign
();

97 if(
rg‘Objeù
 =ğ
NULL
 || 
x
.
	`size
(è!ğ
	`·¿m‘”CouÁ
())

98  
NULL
;

101 
¡d
::
veùÜ
<> 
v®s
;

102 
i
 = 0; i < 
x
.
	`size
(); i++)

103 
v®s
.
	`push_back
(
	`x
(
i
è* 
ENSEMBLE_PGA_SCALE_FACTOR
);

106 
pga
->
	`doPGADefÜm
(
rg‘Objeù
, 
v®s
, 
Üd”
);

109 
Sim¬™yT¿nsfÜm3D
 
š™ŸlT¿nsfÜm
 = 
m©ch
->
	`g‘In™ŸlT¿nsfÜm
();

110 
rg‘Objeù
->
	`£Ëù
();

112 
Qu©
 
q
 = 
š™ŸlT¿nsfÜm
.
	`g‘RÙ©iÚ
();

113 #ifdeà
UNFLIPPED


114 
VeùÜ3D
 
	`ûÁ”
(0.0, 1.0, 0.0);

115 
rg‘Objeù
->
	`rÙ©eBy
(
q
, 
ûÁ”
);

117 
VeùÜ3D
 
	`ûÁ”
(0.0, 0.0, 0.0);

118 
rg‘Objeù
->
	`rÙ©eBy
(
q
, 
ûÁ”
);

120 
rg‘Objeù
->
	`sÿËBy
(
š™ŸlT¿nsfÜm
.
	`g‘SÿË
(), 
ûÁ”
);

121 
rg‘Objeù
->
	`Œª¦©eBy
(
š™ŸlT¿nsfÜm
.
	`g‘T¿n¦©iÚ
());

123  
rg‘Objeù
;

124 
	}
}

126 
	gM3DAd­tiveRegi¡¿tiÚPGAProbËmBoundsFunùiÚ
::
	$M3DAd­tiveRegi¡¿tiÚPGAProbËmBoundsFunùiÚ
()

128 
bounds
 = 
	`VeùÜ
(1, 3.0);

129 
çùÜs
 = 
	`VeùÜ
(1, 
M3DAd­tiveRegi¡¿tiÚPGAProbËm
::
ENSEMBLE_PGA_SCALE_FACTOR
 );

130 
	}
}

	@M3DBoundingSphere.cpp

1 
	~<m©h.h
>

2 
	~"M3DBoundšgSph”e.h
"

3 
	~"M3DFigu».h
"

5 
	#D_XFERLIST


	)

6 
	#D_POINTLIST_SERVER2


	)

7 
	~"Sh­ed•’d.h
"

9 
	gM3DBoundšgSph”e
::
	$M3DBoundšgSph”e
(cÚ¡ 
M3DObjeù
 & 
objeù
, 
subdivisiÚs
)

11 
figu»CouÁ
;

12 
numPošts
;

13 
i
, 
j
;

15 
M3DFigu»
 * 
figu»
;

16 
Xã¾i¡
 * 
xãrLi¡
;

17 
Th®lCode
::
Poši¡_£rv”2
 * 
pLi¡
;

19 
Bpošt
 * 
bPošts
;

20 
Bpošt
 * 
bPoštPŒ
;

21 
VeùÜ3D
 
pos
;

22 
VeùÜ3D
 
diff
;

23 
di¡Sqr
, 
maxDi¡Sqr
;

26 
ûÁ”
 = 
objeù
.
	`g‘COG
();

28 
maxDi¡Sqr
 = 0.0;

30 
figu»CouÁ
 = 
objeù
.
	`g‘Figu»CouÁ
();

31 
i
 = 0; i < 
figu»CouÁ
; i++)

33 
figu»
 = 
objeù
.
	`g‘Figu»PŒ
(
i
);

35 if(
figu»
 =ğ
NULL
)

38 
xãrLi¡
 = 
	`cÚv”tM3DtoXãr
(
figu»
);

40 
pLi¡
 = 
Ãw
 
Th®lCode
::
Poši¡_£rv”2
;

41 
pLi¡
->
	`š™
(
xãrLi¡
);

42 
pLi¡
->
	`Compu‹SubdivPoštCloud
(
subdivisiÚs
);

43 
pLi¡
->
	`subdivbound¬yšfo
(&
numPošts
, &
bPošts
);

45 
bPoštPŒ
 = 
bPošts
;

46 
j
 = 0; j < 
numPošts
; j++, 
bPoštPŒ
++)

48 
pos
.
	`£t
(
bPoštPŒ
->
²t
[0], bPointPtr->pnt[1], bPointPtr->pnt[2]);

49 
diff
 = (
pos
 - 
ûÁ”
);

50 
di¡Sqr
 = 
diff
 * diff;

52 if(
di¡Sqr
 > 
maxDi¡Sqr
)

53 
maxDi¡Sqr
 = 
di¡Sqr
;

57 
¿dius
 = 
	`sq¹
(
maxDi¡Sqr
);

58 
	}
}

60 
	gM3DBoundšgSph”e
::
	$M3DBoundšgSph”e
(cÚ¡ 
M3DFigu»
 & 
figu»
, 
subdivisiÚs
)

62 
ûÁ”
 = 
figu»
.
	`g‘COG
();

63 
	}
}

	@M3DDeformationOptimizer.cpp

1 
	~<m©h.h
>

2 
	~"O±imiz”Ba£.h
"

3 
	~"M3DDefÜm©iÚO±imiz”.h
"

4 
	~"M3DDefÜm©iÚProbËm.h
"

5 
	~"M3DPGAPrim™iveSts.h
"

6 
	~"M3DAtomP»diùÜQuad.h
"

7 
	~"M3DQuadPrim™ive.h
"

8 
	~"Tunšg.h
"

9 
	~"P3DCÚŒŞ.h
"

17 
	#VERBOSE1


	)

18 
	#VERBOSE2


	)

29 #iâdeà
BINARY


30 
	#RANDOMIZE


	)

36 cÚ¡ 
	gMIN_PENALTY_WEIGHT
 = -1;

37 cÚ¡ 
	gMIN_PENALTY_WEIGHT_EXP
 = 0.0;

38 cÚ¡ 
	gMAX_PENALTY_WEIGHT_EXP
 = 10.0;

39 cÚ¡ 
	gPENALTY_WEIGHT_SCALE_FACTOR
 = 10.0;

40 cÚ¡ 
	gPENALTY_SCALE_FACTOR
 =200;

41 cÚ¡ 
	gCONSTRAINT_PENALTY_SCALE_FACTOR
 = 0.02;

43 #iâdeà
BINARY


44 cÚ¡ 
	gSKIPPED_PASSES
 = 1;

45 cÚ¡ 
	gDEFAULT_THRESHOLD
 = 1.0e-3;

46 cÚ¡ 
	gDEFAULT_NUM_CONJGRAD_ITERATIONS
 = 2;

47 cÚ¡ 
	gDEFAULT_SCHEDULE_MULTIPLIER
 = 1;

50 #ifdeà
DEFORMATION_OUTPUT_TEST


51 
	~<f¡»am
>

55 
usšg
 
Çme¥aû
 
	g¡d
;

58 
glob®V”bos™y
;

61 
	gM3DDefÜm©iÚO±imiz”
::
	$M3DDefÜm©iÚO±imiz”
(
­pID
)

63 #ifdeà
DEBUG


64 
cout
 << "M3DDeformationOptimizer::M3DDeformationOptimizer()\n";

66 
ty³
 = 
DefÜm©iÚ
;

67 
m‘hod
 = 
NULL
;

69 
´imPga
 = 
NULL
;

70 
m—nFigPgaObjeù
 = 
NULL
;

71 
figResidu®AtomDifObj
 = 
NULL
;

72 
figu»SgeObj
 = 
NULL
;

73 
¡¬tAtomObjeù
 = 
NULL
;

75 
»ã»nûObjeù
 = 
NULL
;

76 
ÿndid©eObjeù
 = 
NULL
;

78 
Ï¡Be¡Sigma
 = 
NULL
;

79 
Ï¡P’®ty
 = 0.0;

83 
­¶iÿtiÚID
 = 
­pID
;

85 
couÁ”
 = 
NULL
;

86 
sk
 = 
NULL
;

87 
Ï¡ResuÉ
 = 
NULL
;

88 
Ï¡ResuÉSize
 = 0;

89 #ifdeà
BINARY


90 ià(
	`tunšgWt
(
BpAtomRªdomOrd”
) == 1)

91 
³rm
 = 
NULL
;

93 #ifdeà
RANDOMIZE


94 
³rm
 = 
NULL
;

97 
ÃxtAtom
 = 0;

98 
Ï¡Figu»Id
 = -1;

100 #iâdeà
BINARY


101 
numCÚjG¿d›ÁI‹¿tiÚs
 = 
DEFAULT_NUM_CONJGRAD_ITERATIONS
;

102 
scheduËMuÉl›r
 = 
DEFAULT_SCHEDULE_MULTIPLIER
;

103 
th»shŞd
 = 
DEFAULT_THRESHOLD
;

106 
tÙ®Ev®u©iÚCo¡
 = 0;

107 
	}
}

109 #iâdeà
BINARY


111 
	gM3DDefÜm©iÚO±imiz”
::
	$£tP’®tyWeightsInM©ch
(cÚ¡ * 
³ÇÉyNames
,

112 cÚ¡ * 
³ÇÉyWeights
, 
numP’®t›s
)

114 
wt
;

116 ià(
m©ch
 =ğ
NULL
) {

117 
cout
 << "Unableoransfer…enalties before Matchƒxists\n";

120 ià(
numP’®t›s
 <= 0)

123 
i
 = 0; i < 
numP’®t›s
; i++) {

124 
³ÇÉyNames
[
i
]) {

125 
GpAtomHi¡og¿mM©ch
:

126 
wt
 = 
³ÇÉyWeights
[
i
];

128 
GpAtomMuÉiP©chM©ch
:

129 
wt
 = 
³ÇÉyWeights
[
i
];

131 
AtomMah®ªobisM©ch
:

132 
wt
 = 
PENALTY_SCALE_FACTOR
*
³ÇÉyWeights
[
i
];

134 
GpAtomGeom‘ryWeight
:

135 
wt
 = 
PENALTY_WEIGHT_SCALE_FACTOR
*
³ÇÉyWeights
[
i
];

137 
GpAtomNeighbÜWeight
:

138 
wt
 = 
³ÇÉyWeights
[
i
];

140 
GpAtomIÁ”Weight
:

141 
wt
 = 
CONSTRAINT_PENALTY_SCALE_FACTOR
*
³ÇÉyWeights
[
i
];

144 
GpAtomProfeM©ch
:

147 
cout
 << "UnknowÀ³ÇÉy weight: " << 
	`tunšgShÜtName
(
³ÇÉyNames
[
i
]è<< 
’dl
;

150 
m©ch
->
	`£tWeight
(
ty³
, 
³ÇÉyNames
[
i
], 
wt
);

152 
	}
}

156 
	gM3DDefÜm©iÚO±imiz”
::~
	$M3DDefÜm©iÚO±imiz”
()

158 #ifdeà
DEBUG


159 
cout
 << "M3DDefÜm©iÚO±imiz”::~M3DDefÜm©iÚO±imiz”()" << 
’dl
;

161 
	`d–‘e_š‹º®
();

162 
	}
}

164 
	gM3DDefÜm©iÚO±imiz”
::
	$d–‘e_š‹º®
()

166 
numLa¡Be¡Sigma
, 
i
;

168 if(
»ã»nûObjeù
 !ğ
NULL
)

169 
d–‘e
 
»ã»nûObjeù
;

170 
»ã»nûObjeù
 = 
NULL
;

172 if(
ÿndid©eObjeù
 !ğ
NULL
)

173 
d–‘e
 
ÿndid©eObjeù
;

174 
ÿndid©eObjeù
 = 
NULL
;

177 ià(
m—nFigPgaObjeù
 !ğ
NULL
)

178 
d–‘e
 
m—nFigPgaObjeù
;

179 
m—nFigPgaObjeù
 = 
NULL
;

182 ià(
figResidu®AtomDifObj
 !=
NULL
)

183 
d–‘e
 
figResidu®AtomDifObj
;

184 
figResidu®AtomDifObj
 = 
NULL
;

186 ià(
figu»SgeObj
 !ğ
NULL
)

187 
d–‘e
 
figu»SgeObj
;

188 
figu»SgeObj
 = 
NULL
;

191 ià(
¡¬tAtomObjeù
 !=
NULL
)

192 
d–‘e
 
¡¬tAtomObjeù
;

193 
¡¬tAtomObjeù
 = 
NULL
;

196 if(
Ï¡Be¡X
)

198 
i
 = 0; i < 
Ï¡Be¡XSize
; i++)

200 ià(
Ï¡Be¡X
[
i
] !ğ
NULL
)

201 
d–‘e
 
Ï¡Be¡X
[
i
];

203 
d–‘e
 [] 
Ï¡Be¡X
;

204 
Ï¡Be¡X
 = 
NULL
;

207 if(
Ï¡Be¡Sigma
)

209 
numLa¡Be¡Sigma
 = 
Ï¡Be¡Sigma
->
	`size
();

210 
i
 = 0; i < 
numLa¡Be¡Sigma
; i++)

212 if((*
Ï¡Be¡Sigma
)[
i
] !ğ
NULL
)

213 
	`d–‘e
 (*
Ï¡Be¡Sigma
)[
i
];

215 
d–‘e
 
Ï¡Be¡Sigma
;

216 
Ï¡Be¡Sigma
 = 
NULL
;

219 if(
couÁ”
 !ğ
NULL
)

221 
d–‘e
 [] 
couÁ”
;

222 
couÁ”
 = 
NULL
;

224 if(
sk
 !ğ
NULL
)

226 
d–‘e
 [] 
sk
;

227 
sk
 = 
NULL
;

229 if(
Ï¡ResuÉ
 !ğ
NULL
)

231 
d–‘e
 [] 
Ï¡ResuÉ
;

232 
Ï¡ResuÉ
 = 
NULL
;

233 
Ï¡ResuÉSize
 = 0;

236 #ifdeà
BINARY


237 ià(
	`tunšgWt
(
BpAtomRªdomOrd”
) == 1) {

238 if(
³rm
 !ğ
NULL
) {

239 
d–‘e
 [] 
³rm
;

240 
³rm
 = 
NULL
;

244 #ifdeà
RANDOMIZE


245 if(
³rm
 !ğ
NULL
)

247 
d–‘e
 [] 
³rm
;

248 
³rm
 = 
NULL
;

252 
	}
}

255 
boŞ
 
	gM3DDefÜm©iÚO±imiz”
::
	$addDiffToPrim™ive
(
M3DFigu»
 * 
figu»
, cÚ¡ 
©omId
, M3DFigu» * 
®igÃdToFigu»
, cÚ¡ 
M3DPrim™ive
 * 
d–Prim
)

257 
M3DPrim™ive
 * 
´im
 = 
NULL
;

259 
numPrims
;

260 
M3DPrim™ive
 * 
®ignS‘s
[5];

261 
M3DPrim™ive
 * 
®ignToS‘s
[5];

263 
M3DPrim™ive
 * 
d–PrimAlign
;

265 
´im
 = 
figu»
->
	`g‘Prim™ivePŒ
(
©omId
);

268 
figu»
->
	`g‘AtomsNeighbÜs
(
©omId
, 
numPrims
, 
®ignS‘s
, 
ALL_FIRST_NEIGHBORS
);

269 
®igÃdToFigu»
->
	`g‘AtomsNeighbÜs
(
©omId
, 
numPrims
, 
®ignToS‘s
, 
ALL_FIRST_NEIGHBORS
);

272 
®ignS‘s
[
numPrims
] = 
figu»
->
	`g‘Prim™ivePŒ
(
©omId
);

273 
®ignToS‘s
[
numPrims
] = 
®igÃdToFigu»
->
	`g‘Prim™ivePŒ
(
©omId
);

274 
numPrims
++;

276 
d–PrimAlign
 = 
d–Prim
->
	`cİyPŒ
();

288 ià(! 
M3DPrim™ive
::
	`compo£Prim™ives
(
d–PrimAlign
,
´im
) ) {

289 
cout
<<"”rÜ‡ˆcompo£Prim™ive š M3DDefÜm©iÚO±imiz”\n"<<
’dl
;

290  
çl£
;

292 
d–‘e
 
d–PrimAlign
;

294  
Œue
;

295 
	}
}

298 
M3DPrim™ive
 * 
	gM3DDefÜm©iÚO±imiz”
 ::
	$g‘FigResidu®AtomDifã»nû
(cÚ¡ 
M3DPrim™ive
 * 
figSgeAtom
,

299 cÚ¡ 
M3DPrim™ive
 * 
´ediùedAtom
, 
figId
, 
©omId
)

301 
M3DPrim™ive
 * 
´imFigOff£t
 = 
figSgeAtom
->
	`cİyPŒ
();

304 
M3DPrim™ive
::
	`subŒaùPrim™ives
Ğ
´imFigOff£t
,
´ediùedAtom
);

307 ià(
´imPga
 ==
NULL
)

308  
çl£
;

310 
PGD©a
 * 
pgD©a
 = 
´imPga
->
	`g‘PGD©aPŒ
(
figId
,
©omId
);

311 
numPGs
 = 
pgD©a
->numPGs;

312 
ËnPG
 = 
pgD©a
->lenPG;

314 
VeùÜ
 
cÛff
 = 
	`VeùÜ
 (
numPGs
);

315 
i
,
j
;

317 
VeùÜ
 
vecFigOff£t
;

318 
M3DPrim™ive
::
	`´ojeùAtom2Vec
(
´imFigOff£t
, 
vecFigOff£t
);

320 
i
 = 0; i < 
numPGs
; i++)

321 
j
 = 0; j < 
ËnPG
; j++)

322 
	`cÛff
(
i
è+ğ(
	`vecFigOff£t
(
j
è* ((
pgD©a
->
pgVec
[i])[j]));

324 
VeùÜ
 
vecProjAtom
 = 
	`VeùÜ
(9,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0);

326 
j
 = 0; j < 
ËnPG
; j++)

327 
i
 = 0; i < 
numPGs
; i++)

328 
	`vecProjAtom
(
j
è+ğ
	`cÛff
(
i
)* ((
pgD©a
->
pgVec
[i])[j]);

330 
M3DPrim™ive
 * 
´ojPrim
;

331 ià(
figSgeAtom
->
	`ty³
(è=ğ
M3D_END_PRIMITIVE
)

332 
´ojPrim
 = 
Ãw
 
	`M3DQuadEndPrim™ive
();

334 
´ojPrim
 = 
Ãw
 
	`M3DQuadPrim™ive
();

337 
´ojPrim
->
	`vec2Atom
(
vecProjAtom
);

340 
M3DPrim™ive
::
	`subŒaùPrim™ives
Ğ
´imFigOff£t
,
´ojPrim
);

343 
d–‘e
 
´ojPrim
;

344  
´imFigOff£t
;

346 
	}
}

350 
boŞ
 
	gM3DDefÜm©iÚO±imiz”
::
	$š™ŸlizeAtomPGASge
(
M3DPGAPrim™iveSts
 * 
_´imPga
,
figId
,
M3DObjeù
 * 
_»ãrObj
)

352 ià(
_»ãrObj
!=
NULL
)

354 
»ã»nûObjeù
 = 
_»ãrObj
->
	`assign
();

355 
figu»SgeObj
 = 
_»ãrObj
->
	`assign
();

356 
¡¬tAtomObjeù
 = 
_»ãrObj
->
	`assign
();

357 
ÿndid©eObjeù
 = 
»ã»nûObjeù
->
	`assign
();

360 ià(
_´imPga
 !ğ
NULL
){

361 
m—nFigPgaObjeù
 = 
_´imPga
->
	`g‘AlignReã»nûObj
()->
	`assign
();

362 
´imPga
 = 
_´imPga
;

363  
Œue
;

366  
çl£
;

367 
	}
}

370 
boŞ
 
	gM3DDefÜm©iÚO±imiz”
::
	$š™Ÿlize
(
M©ch
 * 
_m©ch
, 
M3DObjeù
 * 
_»ã»nûObjeù
)

375 
Image3D
 * 
image
;

378 #ifdeà
DEBUG


379 
cout
 << "M3DDeformationOptimizer::initialize()\n";

381 if(
_m©ch
 =ğ
NULL
 || 
_»ã»nûObjeù
 == NULL)

382  
çl£
;

384 
	`d–‘e_š‹º®
();

386 
»ã»nûObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

388 
figu»SgeObj
 = 
_»ã»nûObjeù
->
	`assign
();

389 
¡¬tAtomObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

391 
ÿndid©eObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

392 
m©ch
 = 
_m©ch
;

394 
m©ch
->
	`»£tReã»nûObjeù
(
»ã»nûObjeù
);

396 
image
 = 
m©ch
->
	`g‘T¬g‘Image
();

397 if(
image
 =ğ
NULL
)

398  
çl£
;

416 
Ï¡Figu»Id
 = -1;

417 
ÃxtAtom
 = 0;

419 #ifdeà
DEFORMATION_OUTPUT_TEST


420 cÚ¡ 
NUM_TICKS
 = 100;

421 
START_TICK
 = -0.25;

422 
END_TICK
 = 0.25;

423 
TICK_SIZE
 = (
END_TICK
 - 
START_TICK
è/ ((è
NUM_TICKS
);

425 
of¡»am
 
outFe
;

426 
row
, 
cŞ
;

427 
x
, 
v®
;

428 
j
;

430 
M3DFigu»
 * 
rg‘Figu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(0);

431 if(
rg‘Figu»
 =ğ
NULL
)

433 
numPrim™ives
 = 
rg‘Figu»
->
	`g‘Prim™iveCouÁ
();

435 
i
 = 0; i < 
numPrim™ives
; i++)

437 
´imPŒ
 = 
rg‘Figu»
->
	`g‘Prim™ivePŒ
(
i
);

438 if(
´imPŒ
 =ğ
NULL
 || !ÕrimPŒ->
	`isS–eùed
()))

441 
M3DDefÜm©iÚProbËm
 
	`´obËm
 (
m©ch
, 
»ã»nûObjeù
, 
ÿndid©eObjeù
, 0, 
i
, 
­¶iÿtiÚID
);

443 
vecsize
 = 8;

444 ià(
´imPŒ
->
	`ty³
(è=ğ
M3D_END_PRIMITIVE
)

445 
vecsize
 = 9;

446 
VeùÜ
 
	`zv
(
vecsize
);

447 
k
 = 0; k < 
vecsize
; k++)

448 
	`zv
(
k
) = 0.0;

450 
outFe
.
	`İ’
("xtrans.dat");

451 
j
 = 0; j < 
NUM_TICKS
; j++)

453 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

455 
VeùÜ
 
	`v
(
zv
);

456 
	`v
(0èğ
x
;

457 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

459 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

461 
outFe
.
	`şo£
();

463 
outFe
.
	`İ’
("ytrans.dat");

464 
j
 = 0; j < 
NUM_TICKS
; j++)

466 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

468 
VeùÜ
 
	`v
(
zv
);

469 
	`v
(1èğ
x
;

470 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

472 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

474 
outFe
.
	`şo£
();

476 
outFe
.
	`İ’
("ztrans.dat");

477 
j
 = 0; j < 
NUM_TICKS
; j++)

479 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

481 
VeùÜ
 
	`v
(
zv
);

482 
	`v
(2èğ
x
;

483 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

485 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

487 
outFe
.
	`şo£
();

489 
outFe
.
	`İ’
("xrot.dat");

490 
j
 = 0; j < 
NUM_TICKS
; j++)

492 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

494 
VeùÜ
 
	`v
(
zv
);

495 
	`v
(3èğ
x
;

496 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

498 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

500 
outFe
.
	`şo£
();

502 
outFe
.
	`İ’
("yrot.dat");

503 
j
 = 0; j < 
NUM_TICKS
; j++)

505 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

507 
VeùÜ
 
	`v
(
zv
);

508 
	`v
(4èğ
x
;

509 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

511 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

513 
outFe
.
	`şo£
();

515 
outFe
.
	`İ’
("zrot.dat");

516 
j
 = 0; j < 
NUM_TICKS
; j++)

518 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

520 
VeùÜ
 
	`v
(
zv
);

521 
	`v
(5èğ
x
;

522 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

524 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

526 
outFe
.
	`şo£
();

528 
outFe
.
	`İ’
("scale.dat");

529 
j
 = 0; j < 
NUM_TICKS
; j++)

531 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

533 
VeùÜ
 
	`v
(
zv
);

534 
	`v
(6èğ
x
;

535 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

537 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

539 
outFe
.
	`şo£
();

541 
outFe
.
	`İ’
("theta.dat");

542 
j
 = 0; j < 
NUM_TICKS
; j++)

544 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

546 
VeùÜ
 
	`v
(
zv
);

547 
	`v
(7èğ
x
;

548 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

550 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

552 
outFe
.
	`şo£
();

554 ià(
vecsize
 == 9)

556 
outFe
.
	`İ’
("eta.dat");

557 
j
 = 0; j < 
NUM_TICKS
; j++)

559 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

561 
VeùÜ
 
	`v
(
zv
);

562 
	`v
(8èğ
x
;

563 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

565 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

567 
outFe
.
	`şo£
();

571  
Œue
;

572 
	}
}

574 
	gM3DDefÜm©iÚO±imiz”
::
	$»£t
(
M©ch
 * 
_m©ch
, 
M3DObjeù
 * 
_»ã»nûObjeù
)

576 if(
_m©ch
 =ğ
NULL
 || 
_»ã»nûObjeù
 == NULL)

579 
	`d–‘e_š‹º®
();

581 
»ã»nûObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

582 
ÿndid©eObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

584 
m©ch
 = 
_m©ch
;

586 
m©ch
->
	`»£tReã»nûObjeù
(
»ã»nûObjeù
);

588 
Ï¡Figu»Id
 = -1;

589 
ÃxtAtom
 = 0;

590 
	}
}

594 
boŞ
 
	gM3DDefÜm©iÚO±imiz”
::
	$³rfÜmI‹¿tiÚs
(
figu»Id
)

596 
cout
 << "Error: wrong version of M3DDeformationOptimizer::performIterations() called\n";

597  
çl£
;

598 
	}
}

613 
boŞ
 
	gM3DDefÜm©iÚO±imiz”
::
	$³rfÜmI‹¿tiÚs
(
figu»Id
, 
boŞ
 
´ev›w
,

614 
boŞ
 
v”bos™y
)

616 
numFigs
;

618 if(
m©ch
 =ğ
NULL
 || 
»ã»nûObjeù
 =ğNULL || 
ÿndid©eObjeù
 == NULL)

619  
çl£
;

621 
numFigs
 = 
ÿndid©eObjeù
->
	`g‘Figu»CouÁ
();

623 #ifdeà
BINARY


624 ià(
	`tunšgWt
(
BpAtomRS¿dP’®ty
è!ğ0.0 ||unšgWt(
BpAtomD–NeighbÜM©ch
) != 0.0)

625 
m©ch
->
	`£tUpAtomP»diùÜ
(
figu»Id
);

627 ià(
	`tunšgWt
(
BpAtomRªdomOrd”
) == 1)

629 
i
;

630 
M3DFigu»
 * 
cu¼Figu»
;

633 
numPrims
 = 0;

634 ià(
³rm
 =ğ
NULL
) {

635 
cu¼Figu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

636 if(
cu¼Figu»
 =ğ
NULL
)

637  
çl£
;

638 
numPrims
 = 
cu¼Figu»
->
	`g‘Prim™iveCouÁ
();

639 
³rm
 = 
Ãw
 [
numPrims
];

640 
i
 = 0; i < 
numPrims
; i++)

641 
³rm
[
i
] = -1;

645 #ifdeà
RANDOMIZE


646 
i
;

647 
M3DFigu»
 * 
cu¼Figu»
;

650 
numPrims
 = 0;

651 ià(
³rm
 =ğ
NULL
) {

652 
cu¼Figu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

653 if(
cu¼Figu»
 =ğ
NULL
)

654  
çl£
;

655 
numPrims
 = 
cu¼Figu»
->
	`g‘Prim™iveCouÁ
();

656 
³rm
 = 
Ãw
 [
numPrims
];

657 
i
 = 0; i < 
numPrims
; i++)

658 
³rm
[
i
] = -1;

663 #ifdeà
BINARY


664  
	`İtimizeFigu»
(
figu»Id
, 
´ev›w
, (
glob®V”bos™y
 > -1));

666  
	`İtimizeFigu»
(
figu»Id
, 
´ev›w
, 
v”bos™y
);

668 
	}
}

670 
šlše
 
	gM3DDefÜm©iÚO±imiz”
::
	$£ËùRªdomAtom
(
numPrims
)

672 
skCouÁ”
;

673 
i
;

674 
´imId
;

677 ià(
ÃxtAtom
 == 0) {

679 
šdex
, 
‹mp
;

680 
Ï¡Atom
;

682 
Ï¡Atom
 = 
³rm
[
numPrims
 - 1];

684 
i
 = 0; i < 
numPrims
; i++)

685 
³rm
[
i
] = i;

686 
i
 = 0; i < 
numPrims
; i++) {

687 
šdex
 = 
i
 + (
	`¿nd
(è% (
numPrims
 - i));

688 
‹mp
 = 
³rm
[
i
];

689 
³rm
[
i
] =…”m[
šdex
];

690 
³rm
[
šdex
] = 
‹mp
;

693 ià(
Ï¡Atom
 >= 0) {

695 ià(
³rm
[0] =ğ
Ï¡Atom
) {

696 
‹mp
 = 
³rm
[0];

697 
³rm
[0] =…”m[
numPrims
 - 1];

698 
³rm
[
numPrims
 - 1] = 
‹mp
;

702 #ifdeà
DEBUG


703 
cout
 << "Allocated…erm[]: ";

704 
i
 = 0; i < 
numPrims
; i++)

705 
cout
 << 
³rm
[
i
] << ' ';

706 
cout
 << 
’dl
;

711 
skCouÁ”
 = 0;

712 ià(
ÃxtAtom
 == 0) {

713 
i
 = 0; i < 
numPrims
; i++) {

714 ià(
couÁ”
[
i
] < 0)

715 
skCouÁ”
++;

718 #ifdeà
VERBOSE2


719 if(
ÃxtAtom
 == 0)

720 
cout
 << "skCouÁ” = " << 
skCouÁ”
 << '\n';

722 ià(
skCouÁ”
 =ğ
numPrims
) {

723 
®lSk³d
++;

724 #ifdeà
VERBOSE


725 
cout
 << "AÎ sk³d = " << 
®lSk³d
 << '\n';

730 
´imId
 = 
³rm
[
ÃxtAtom
];

731 
ÃxtAtom
++;

732 ià(
ÃxtAtom
 =ğ
numPrims
)

733 
ÃxtAtom
 = 0;

735 #iâdeà
DISPLAY_PENALTIES


736 #ifdeà
VERBOSE


737 ià(
ÃxtAtom
 == 1)

738 
cout
 << "==================\n";

740 
cout
 << "------------------\n";

744 #ifdeà
VERBOSE


745 
cout
 << "counter: ";

746 
i
 = 0; i < 
numPrims
; i++)

747 
cout
 << 
couÁ”
[
i
] << ' ';

748 
cout
 << '\n';

749 
cout
 << "skip: ";

750 
i
 = 0; i < 
numPrims
; i++)

751 
cout
 << 
sk
[
i
] << ' ';

752 
cout
 << '\n';

755  
´imId
;

756 
	}
}

758 
šlše
 
	gM3DDefÜm©iÚO±imiz”
::
	$£ËùAtom
(
numPrims
)

760 
skCouÁ”
;

761 
i
;

762 
´imId
;

765 
skCouÁ”
 = 0;

766 ià(
ÃxtAtom
 == 0) {

767 
i
 = 0; i < 
numPrims
; i++) {

768 ià(
couÁ”
[
i
] < 0)

769 
skCouÁ”
++;

772 #ifdeà
VERBOSE


773 if(
ÃxtAtom
 == 0)

774 
cout
 << "skCouÁ” = " << 
skCouÁ”
 << '\n';

776 ià(
skCouÁ”
 =ğ
numPrims
) {

777 
®lSk³d
++;

778 #ifdeà
VERBOSE


779 
cout
 << "AÎ sk³d = " << 
®lSk³d
 << '\n';

784 
´imId
 = 
ÃxtAtom
;

785 
ÃxtAtom
++;

786 ià(
ÃxtAtom
 =ğ
numPrims
)

787 
ÃxtAtom
 = 0;

789 #iâdeà
DISPLAY_PENALTIES


790 #ifdeà
VERBOSE


791 ià(
ÃxtAtom
 == 1)

792 
cout
 << "==================\n";

794 
cout
 << "------------------\n";

798 #ifdeà
VERBOSE


799 
cout
 << "counter: ";

800 
i
 = 0; i < 
numPrims
; i++)

801 
cout
 << 
couÁ”
[
i
] << ' ';

802 
cout
 << '\n';

803 
cout
 << "skip: ";

804 
i
 = 0; i < 
numPrims
; i++)

805 
cout
 << 
sk
[
i
] << ' ';

806 
cout
 << '\n';

809  
´imId
;

810 
	}
}

812 
	gM3DDefÜm©iÚO±imiz”
::
	$»adyNextRun
()

814 
i
 = 0; i < 
Ï¡ResuÉSize
; i++) {

815 
couÁ”
[
i
] = 0;

816 
sk
[
i
] = 0;

817 
Ï¡ResuÉ
[
i
] = 0.0;

820 
®lSk³d
 = 0;

821 
	}
}

845 
boŞ
 
	gM3DDefÜm©iÚO±imiz”
::
	$İtimizeFigu»
(
figId
, 
boŞ
 
´ev›w
, boŞ 
v”bos™y
,

846 
boŞ
 
®lAtomMoveTog©h”
)

849 
i
;

850 
cum_chªge
;

851 
´imId
;

852 
numPrims
;

854 
M3DFigu»
 * 
»ã»nûFigu»
 = 
»ã»nûObjeù
->
	`g‘Figu»PŒ
(
figId
);

855 
M3DFigu»
 * 
ÿndid©eFigu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figId
);

858 ià(
»ã»nûFigu»
 =ğ
NULL
 || 
ÿndid©eFigu»
 == NULL )

859  
çl£
;

861 
numPrims
 = 
ÿndid©eFigu»
->
	`g‘Prim™iveCouÁ
();

863 ià(! 
Ï¡Be¡X
)

866 #ifdeà
VERBOSE


867 
cout
 << "initializing internal optimization structures\n";

870 
Ï¡Be¡X
 = 
Ãw
 
VeùÜ
 *[
numPrims
];

871 
Ï¡Be¡XSize
 = 
numPrims
;

873 
´imId
 = 0;…rimId < 
numPrims
;…rimId++)

876 ià(
´imPga
 =ğ
NULL
) {

877 
M3DPrim™ive
 * 
cu¼Prim™ive
 = 
ÿndid©eFigu»
->
	`g‘Prim™ivePŒ
(
´imId
);

878 
VeùÜ
 * 
š™
;

880 ià((
	`tunšgWt
(
AtomEFaùÜ
è=ğ0.0)|| 
cu¼Prim™ive
->
	`ty³
(è=ğ
M3D_STANDARD_PRIMITIVE
)

881 
š™
 = 
Ãw
 
	`VeùÜ
(8, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);

883 
š™
 = 
Ãw
 
	`VeùÜ
(9, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0);

884 
Ï¡Be¡X
[
´imId
] = 
š™
;

887 
vecsize
 = (
´imPga
->
	`g‘PGD©aPŒ
(
figId
,
´imId
))->
numPGs
;

888 
Ï¡Be¡X
[
´imId
] = 
Ãw
 
	`VeùÜ
(
vecsize
);

889 
Ï¡Be¡X
[
´imId
]->
	`£tAÎ
(0.0);

893 ià(
Ï¡Figu»Id
 !ğ
figId
) {

894 ià(
couÁ”
 !ğ
NULL
) {

895 
d–‘e
 [] 
couÁ”
;

896 
d–‘e
 [] 
sk
;

897 
d–‘e
 [] 
Ï¡ResuÉ
;

900 
couÁ”
 = 
Ãw
 [
numPrims
];

901 
sk
 = 
Ãw
 [
numPrims
];

902 
Ï¡ResuÉ
 = 
Ãw
 [
numPrims
];

903 
Ï¡ResuÉSize
 = 
numPrims
;

905 
i
 = 0; i < 
numPrims
; i++) {

906 
couÁ”
[
i
] = 0;

907 
sk
[
i
] = 0;

908 
Ï¡ResuÉ
[
i
] = 0.0;

911 
®lSk³d
 = 0;

912 
Ï¡Figu»Id
 = 
figId
;

915 
´imId
 = -1;

918 
´imId
 < 0) {

919 ià(
´ev›w
)

920 
´imId
 = 
	`£ËùAtom
(
numPrims
);

922 #ifdeà
BINARY


923 ià(
	`tunšgWt
(
BpAtomRªdomOrd”
) == 1.0)

924 
´imId
 = 
	`£ËùRªdomAtom
(
numPrims
);

926 
´imId
 = 
	`£ËùAtom
(
numPrims
);

928 #ifdeà
RANDOMIZE


929 
´imId
 = 
	`£ËùRªdomAtom
(
numPrims
);

931 
´imId
 = 
	`£ËùAtom
(
numPrims
);

936 
ÿndid©ePrim™ive
 = 
ÿndid©eFigu»
->
	`g‘Prim™ivePŒ
(
´imId
);

937 iàĞ(
ÿndid©ePrim™ive
 =ğ
NULL
è|| !ÿndid©ePrim™ive->
	`isS–eùed
() )

940 
couÁ”
[
´imId
] = -1;

941 
´imId
 = -1;

946 #ifdeà
BINARY


947 ià(
®lSk³d
 >ğ
	`tunšgWt
(
BpAtomSk³dPas£s
))

949 ià(
®lSk³d
 >ğ
SKIPPED_PASSES
)

951  
Œue
;

953 ià(
sk
[
´imId
] > 0) {

955 
sk
[
´imId
]--;

957 
cout
 << "Skpšg‡tom " << 
´imId
 << '\n';

959  
çl£
;

962 
»ã»nûPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
´imId
);

964 ià(
»ã»nûPrim™ive
 =ğ
NULL
)

965  
çl£
;

969 
cum_chªge
 = 
	`İtimizeAtom
(
figId
, 
´imId
, 
ÿndid©eFigu»
, 
´ev›w
,

970 
®lAtomMoveTog©h”
);

973 #ifdeà
DISPLAY_PENALTIES


974 
cout
 << "Aá” o±imizšg‡tom " << 
´imId
 << ", cumulative change for figure "

975 << 
figId
 << " = " << 
cum_chªge
 << 
’dl
;

978 
d_abs
 = 
	`çbs
(
cum_chªge
 - 
Ï¡ResuÉ
[
´imId
]);

979 #ifdeà
VERBOSE2


980 
cout
 << "d_ab ğ" << 
d_abs
;

982 #ifdeà
BINARY


983 ià(
d_abs
 < 
	`tunšgWt
(
BpAtomSkTh»shŞd
)) {

984 
couÁ”
[
´imId
]--;

985 
sk
[
´imId
] = -((è
	`tunšgWt
(
BpAtomSkMuÉl›r
))*
couÁ”
[primId];

987 ià(
d_abs
 < 
th»shŞd
) {

988 
couÁ”
[
´imId
]--;

989 
sk
[
´imId
] = -
scheduËMuÉl›r
 * 
couÁ”
[primId];

991 #ifdeà
VERBOSE


992 #ifdeà
BINARY


993 
cout
 << " < " << 
	`tunšgWt
(
BpAtomSkTh»shŞd
);

995 
cout
 << " < " << 
th»shŞd
;

1000 
couÁ”
[
´imId
] = 0;

1001 #ifdeà
VERBOSE2


1002 
cout
 << '\n';

1005 
Ï¡ResuÉ
[
´imId
] = 
cum_chªge
;

1008  
çl£
;

1009 
	}
}

1011 
	gM3DDefÜm©iÚO±imiz”
::
	$g‘La¡Be¡V®
(
boŞ
 
´ev›w
)

1013 ià(
´ev›w
) {

1014 ià(
Ï¡Figu»Id
 < 0)

1016 
M3DFigu»
 * 
ÿndid©eFigu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
Ï¡Figu»Id
);

1017 
numPrims
 = 
ÿndid©eFigu»
->
	`g‘Prim™iveCouÁ
();

1018 
numPrimsS–eùed
 = 
ÿndid©eFigu»
->
	`numb”S–eùed
();

1020 
Ï¡Be¡V®
 = 0.0;

1021 
i
 = 0; i < 
numPrims
; i++) {

1022 
Ï¡Be¡V®
 +ğ
Ï¡ResuÉ
[
i
];

1024 
Ï¡Be¡V®
 /ğ
numPrimsS–eùed
;

1026  
Ï¡Be¡V®
;

1027 
	}
}

1030 
	gM3DDefÜm©iÚO±imiz”
::
	$İtimizeAtom
(
figId
, 
©omId
, 
M3DFigu»
 * 
ÿndid©eFigu»
,

1031 
boŞ
 
´ev›w
, boŞ 
®lAtomMoveTog©h”
)

1033 
k
,
i
,
vecsize
;

1034 
š™V®
, 
v®
;

1035 
cum_chªge
;

1036 
VeùÜ
 * 
¡¬t
;

1038 ià(
´imPga
!=
NULL
){

1040 
Ï¡Be¡X
[
©omId
]->
	`£tAÎ
(0.0);

1043 
¡¬t
 = 
Ï¡Be¡X
[
©omId
];

1044 
vecsize
 = 
¡¬t
->
	`size
();

1046 
M3DDefÜm©iÚProbËm
 * 
´obËm
 = 
Ãw
 
	`M3DDefÜm©iÚProbËm
(
m©ch
, 
»ã»nûObjeù
, 
ÿndid©eObjeù
,
figId
,
©omId
,
´imPga
, 
­¶iÿtiÚID
);

1048 
VeùÜ
 
	`•sÚ
(
vecsize
);

1049 
•sÚ
.
	`£tAÎ
(
	`tunšgWt
(
AtomEpsÚ
));

1051 
Num”iÿlFunùiÚ
 
	`funùiÚ
(* 
´obËm
, 
•sÚ
);

1052 
CÚjug©eG¿d›ÁM‘hod
 
	`m
(
funùiÚ
, *
¡¬t
);

1053 
m
.
	`£tB»ÁLš—rS—rchBoundFaùÜ
Ğ
	`tunšgWt
(
B»ÁLš—rS—rchBoundFaùÜ
) );

1056 
M3DDefÜm©iÚProbËmBoundsFunùiÚ
 
	`boundsFunùiÚ
(
´obËm
);

1057 
m
.
	`£tBoundsFunùiÚ
(&
boundsFunùiÚ
);

1059 ià(
´imPga
 !ğ
NULL
){

1060 
š™V®
 = 
´obËm
->
	`ev®u©e
(*
¡¬t
);

1061 
Ï¡Be¡V®
 = 
š™V®
;

1063 
š™V®
 = 
m
.
	`g‘Be¡Ev”V®ue
();

1068 #ifdeà
VERBOSE1


1069 
cout
 << "\ÀAtomId = " << 
©omId
 << " in™V® = " << 
š™V®
 << 
’dl
;

1072 #ifdeà
BINARY


1073 
k
 = 0; (k < 
	`tunšgWt
(
BpAtomCÚjug©eG¿d›ÁI‹¿tiÚs
)è&& ! 
m
.
	`isFšished
(); k++)

1075 
k
 = 0; (k < 
numCÚjG¿d›ÁI‹¿tiÚs
è&& ! 
m
.
	`isFšished
(); k++)

1077 
m
.
	`³rfÜmI‹¿tiÚ
();

1079 
tÙ®Ev®u©iÚCo¡
 +ğ
´obËm
->
	`g‘Ev®u©iÚCo¡
();

1082 
VeùÜ
 * 
’dX
 = 
Ï¡Be¡X
[
©omId
];

1084 
v®
 = 
m
.
	`g‘Be¡Ev”V®ue
();

1087 ià(
v®
 < 
š™V®
)

1089 
VeùÜ
 
»suÉ
 = 
m
.
	`g‘Be¡Ev”X
();

1090 
k
 = 0; k < 
vecsize
; k++)

1092 (*
Ï¡Be¡X
[
©omId
])(
k
èğ
	`»suÉ
(k);

1095 #ifdeà
VERBOSE2


1096 
cout
 << " bestx=";

1097 
i
 = 0; i < 
vecsize
; i++)

1098 
cout
 << ' ' << 
	`»suÉ
(
i
);

1099 
cout
 << '\n';

1100 
cout
 << " v® = " << 
v®
 << '\n';

1104 #ifdeà
VERBOSE1


1105 ià(
´imPga
!=
NULL
){

1106 
mpv
 = 0;

1107 
i
 = 0; i < 
vecsize
; i++)

1108 
mpv
 +ğ
	`»suÉ
(
i
) *„esult(i);

1110 
cout
 << " mah® Di¡: "<< 
mpv
<<'\n';

1113 
cum_chªge
 = 
	`çbs
(
š™V®
 - 
v®
);

1114 
Ï¡Be¡V®
 = 
v®
;

1118 
cum_chªge
 = 0.0;

1121 
´obËm
->
	`ü—‹T¬g‘Prim™ive
Ğ*
’dX
 );

1131 #iâdeà
BINARY


1132 
Ï¡P’®ty
 = 
´obËm
->
	`g‘Geom‘ricP’®ty
();

1134 
Ï¡P’®ty
 = 0;

1137 
d–‘e
 
´obËm
;

1139 #ifdeà
DEBUG_2


1141 
‹mpName
[50];

1142 
couÁ”AtomI‹¿tiÚs
=0;

1143 
P3DCÚŒŞ
 * 
gCÚŒŞ
ğ
Ãw
 
	`P3DCÚŒŞ
(0);

1144 
M3DObjeù
 * 
§veTemp
 = 
ÿndid©eObjeù
->
	`assign
();

1145 
gCÚŒŞ
->
	`ÃwMod–
(
§veTemp
);

1146 
	`¥rštf
(
‹mpName
,"./ÿndid©e%d%d.m3d",
couÁ”AtomI‹¿tiÚs
++,
©omId
);

1147 
gCÚŒŞ
->
	`wr™e
(
‹mpName
);

1149 
d–‘e
 
§veTemp
;

1152  
cum_chªge
;

1153 
	}
}

	@M3DDeformationProblem.cpp

1 
	~"M3DDefÜm©iÚProbËm.h
"

2 
	~"M3DRegi¡¿tiÚProbËm.h
"

3 
	~"Tunšg.h
"

4 
	~"M3DAtomP»diùÜQuad.h
"

5 
	~"P3DCÚŒŞ.h
"

6 
usšg
 
Çme¥aû
 
	g¡d
;

36 #ifdeà
BINARY


37 
glob®V”bos™y
;

40 
	gM3DDefÜm©iÚProbËm
::
	$M3DDefÜm©iÚProbËm
(
­pID
)

42 
»ã»nûObjeù
 = 
NULL
;

43 
m©ch
 = 
NULL
;

44 
rg‘Objeù
 = 
NULL
;

45 
´imPga
 = 
NULL
;

47 
figu»Id
 = -1;

48 
©omId
 = -1;

50 
ev®u©iÚCo¡
 = 0;

52 
­¶iÿtiÚID
 = 
­pID
;

53 
	}
}

55 
	gM3DDefÜm©iÚProbËm
::
	$M3DDefÜm©iÚProbËm
(
M©ch
 * 
_m©ch
,

56 
M3DObjeù
 * 
_»ã»nûObjeù
, M3DObjeù * 
_rg‘Objeù
,

57 
_figu»Id
, 
_©omId
,

58 
M3DPGAPrim™iveSts
 * 
_´imPga
,
­pID
)

61 
»ã»nûObjeù
 = 
_»ã»nûObjeù
;

62 
m©ch
 = 
_m©ch
;

63 
rg‘Objeù
 = 
_rg‘Objeù
;

64 
´imPga
 = 
_´imPga
;

66 
figu»Id
 = 
_figu»Id
;

67 
©omId
 = 
_©omId
;

69 
ev®u©iÚCo¡
 = 0;

70 
­¶iÿtiÚID
 = 
­pID
;

71 
figu»P»diùÜ
 = 
NULL
;

73 
	}
}

75 
	gM3DDefÜm©iÚProbËm
::~
	$M3DDefÜm©iÚProbËm
()

77 ià(
figu»P»diùÜ
 !=
NULL
)

78 
d–‘e
 
figu»P»diùÜ
 ;

79 
	}
}

81 
	gM3DDefÜm©iÚProbËm
::
	$£tPGA
(
M3DPGAPrim™iveSts
 * 
´imPgaSts
)

83 ià(
´imPgaSts
 !ğ
NULL
)

84 
´imPga
 = 
´imPgaSts
;

85 
	}
}

88 
	gM3DDefÜm©iÚProbËm
::
	$ev®u©eImageM©ch
(cÚ¡ 
VeùÜ
 & 
x
, 
M3DObjeù
 * 
_»ã»nûObjeù
)

90 
ev®u©iÚCo¡
++;

92 ià(
m©ch
 =ğ
NULL
 || 
rg‘Objeù
 =ğNULL || 
»ã»nûObjeù
 == NULL)

93  
MAX_RETURN
;

96 ià(
_»ã»nûObjeù
 !=
NULL
)

97 
»ã»nûObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

100 
M3DObjeù
 * 
ÿndid©eObjeù
 = 
»ã»nûObjeù
->
	`assign
();

102 
VeùÜ3D
 
	`z”o
(0.0, 0.0, 0.0);

104 
Sim¬™yT¿nsfÜm3D
 * 
xfÜm
 = 
ÿndid©eObjeù
->
	`g‘T¿nsfÜm©iÚ
();

105 ià(
xfÜm
!ğ
NULL
)

106 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figu»Id
)->
	`­¶ySim¬™y
Ğ*
xfÜm
, 
z”o
 );

110 #ifdeà
BINARY


111 
geomP’®ty
;

112  
m©ch
->
	`compu‹AtomM©chAndP’®t›s
(
ÿndid©eObjeù
, 
figu»Id
, 
©omId
, 
x
, 
geomP’®ty
);

114  
m©ch
->
	`compu‹AtomM©chAndP’®t›s
(
ÿndid©eObjeù
, 
figu»Id
,
©omId
, 
x
,
geomP’®ty
);

117 
	}
}

119 
	gM3DDefÜm©iÚProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 & 
x
)

121 
ev®u©iÚCo¡
++;

123 if(
m©ch
 =ğ
NULL
 || 
rg‘Objeù
 =ğNULL || 
»ã»nûObjeù
 == NULL)

124  
MAX_RETURN
;

128 
	`ü—‹T¬g‘Prim™ive
(
x
);

131 
VeùÜ3D
 
	`z”o
(0.0, 0.0, 0.0);

133 
Sim¬™yT¿nsfÜm3D
 * 
xfÜm
 = 
rg‘Objeù
->
	`g‘T¿nsfÜm©iÚ
();

135 
M3DObjeù
 * 
ÿndid©eObjeù
 = 
rg‘Objeù
->
	`assign
();

137 ià(
xfÜm
!ğ
NULL
 && 
´imPga
!= NULL )

138 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figu»Id
)->
	`­¶ySim¬™y
Ğ*
xfÜm
, 
z”o
 );

141 #ifdeà
DEBUG_2


142 
cout
 << " currentX=";

143 
i
 = 0; i < 
x
.
	`size
(); i++)

144 
cout
 << ' ' << 
	`x
(
i
);

145 
cout
 << '\n';

148 
‹mpName
[50];

149 
couÁ”AtomI‹¿tiÚs
=0;

150 
P3DCÚŒŞ
 * 
gCÚŒŞ
ğ
Ãw
 
	`P3DCÚŒŞ
(0);

151 
M3DObjeù
 * 
§veTemp
 = 
ÿndid©eObjeù
->
	`assign
();

152 
gCÚŒŞ
->
	`ÃwMod–
(
§veTemp
);

153 
	`¥rštf
(
‹mpName
,"./™”%d_©om%d.m3d",
couÁ”AtomI‹¿tiÚs
++,
©omId
);

154 
gCÚŒŞ
->
	`wr™e
(
‹mpName
);

155 
d–‘e
 
§veTemp
;

159 
m©chV®
 = 
m©ch
->
	`compu‹AtomM©chAndP’®t›s
(
ÿndid©eObjeù
, 
figu»Id
,
©omId
, 
x
,
geomP’®ty
);

161 
d–‘e
 
ÿndid©eObjeù
;

163  
m©chV®
;

164 
	}
}

168 
	gM3DDefÜm©iÚProbËm
 ::
	$ü—‹T¬g‘Prim™ive
(cÚ¡ 
VeùÜ
 & 
x
)

171 
M3DFigu»
 * 
»ã»nûFigu»
 = 
»ã»nûObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

172 
M3DFigu»
 * 
rg‘Figu»
 = 
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

174 
M3DPrim™ive
 * 
»ã»nûPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
©omId
);

175 
M3DPrim™ive
 * 
rg‘Prim™ive
 = 
rg‘Figu»
->
	`g‘Prim™ivePŒ
(
©omId
);

177 (*
rg‘Prim™ive
èğ(*
»ã»nûPrim™ive
);

179 ià(
´imPga
 !ğ
NULL
) {

181 
	`doAµlyVeùÜPGA
(
rg‘Figu»
,
x
);

184 
	`­¶yVeùÜ
(*
rg‘Prim™ive
, 
x
);

187 
	}
}

192 
CompÚ’ts
 
	gM3DDefÜm©iÚProbËm
::
	$ev®u©eT”ms
(cÚ¡ 
VeùÜ
 & 
x
)

194 
ev®u©iÚCo¡
++;

196 if(
m©ch
 =ğ
NULL
 || 
rg‘Objeù
 =ğNULL || 
»ã»nûObjeù
 == NULL)

197  
	`CompÚ’ts
(
MAX_RETURN
);

201 
	`ü—‹T¬g‘Prim™ive
(
x
);

203 
M3DObjeù
 * 
ÿndid©eObjeù
 = 
rg‘Objeù
->
	`assign
();

206 
VeùÜ3D
 
	`z”o
(0.0, 0.0, 0.0);

208 
Sim¬™yT¿nsfÜm3D
 * 
xfÜm
 = 
rg‘Objeù
->
	`g‘T¿nsfÜm©iÚ
();

210 ià(
xfÜm
!ğ
NULL
 && 
´imPga
!= NULL )

211 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figu»Id
)->
	`­¶ySim¬™y
Ğ*
xfÜm
, 
z”o
 );

226 
CompÚ’ts
 
comp
 = 
m©ch
->
	`compu‹AtomM©chAndP’®t›sAsCompÚ’ts
(
ÿndid©eObjeù
, 
figu»Id
, 
©omId
, 
x
, 
geomP’®ty
);

228 
d–‘e
 
ÿndid©eObjeù
;

230  
comp
;

231 
	}
}

235 
	gM3DDefÜm©iÚProbËm
::
	$doAµlyVeùÜPGA
(
M3DFigu»
 * 
cu¼FigPŒ
, cÚ¡ 
VeùÜ
 & 
x
){

237 
i
,
couÁ
 = 0;

238  
i
 = 0; i < 
x
.
	`size
(); i++){

239 ià(
	`x
(
i
) == 0){

240 
couÁ
++;

244 if(
couÁ
 =ğ
x
.
	`size
())

247 
M3DPrim™ive
 * 
cu¼PrimPŒ
 = 
cu¼FigPŒ
->
	`g‘Prim™ivePŒ
(
©omId
);

248 
M3DPrim™ive
 * 
»adyToDefÜmAtom
 = (
´imPga
->
	`g‘D–M—nPrim™ivePŒ
(
figu»Id
,
©omId
))->
	`cİyPŒ
();

250 
	`­¶yVeùÜPGA
(*
»adyToDefÜmAtom
, 
x
);

252 
M3DFigu»
 * 
®ignReã»nûFigu»PŒ
 = 
´imPga
->
	`g‘AlignReã»nûObj
()->
	`g‘Figu»PŒ
(
figu»Id
);

253 
M3DDefÜm©iÚO±imiz”
::
	`addDiffToPrim™ive
(
cu¼FigPŒ
,
©omId
, 
®ignReã»nûFigu»PŒ
,
»adyToDefÜmAtom
);

258 
cu¼FigPŒ
->
	`fixGlob®CÚsi¡’cy
();

260 
d–‘e
 
»adyToDefÜmAtom
;

262 
	}
}

265 
	gM3DDefÜm©iÚProbËm
::
	$­¶yVeùÜPGA
(
M3DPrim™ive
 & 
´im
, cÚ¡ 
VeùÜ
 & 
x
)

267 
vecSize
 = 
x
.
	`size
();

268 
isZ”oVeùÜ
 = 0;

269 
j
;

270  
j
ğ0; j < 
vecSize
; j++)

271 ià(
	`x
(
j
) ==0)

272 
isZ”oVeùÜ
++;

274 ià(
isZ”oVeùÜ
 =ğ
vecSize
)

277 
M3DPrim™ive
 * 
ÃwPrim
 = 
´im
.
	`cİyPŒ
();

279 
VeùÜ
 
v®s
 = 
x
 * ((è
	`tunšgWt
(
AtomPGAFaùÜ
));

281 
´imPga
->
	`doPGADefÜm
(
ÃwPrim
, 
v®s
, 
figu»Id
, 
©omId
, &
´im
);

283 
d–‘e
 
ÃwPrim
;

284 
	}
}

286 
	gM3DDefÜm©iÚProbËm
::
	$­¶yVeùÜ
(
M3DPrim™ive
 & 
´im
, cÚ¡ 
VeùÜ
 & 
x
)

288 
VeùÜ3D
 
b
 = 
´im
.
	`g‘B
();

289 
VeùÜ3D
 
n
 = 
´im
.
	`g‘N
();

290 
VeùÜ3D
 
bP”p
 = 
´im
.
	`g‘BP”p
();

292 
VeùÜ3D
 
Œªs
;

293 
Qu©
 
fš®RÙ
;

294 
VeùÜ3D
 
axis
;

295 
ªgË
;

296 
sÿË
, 
‘a
;

298 cÚ¡ 
boŞ
 
axesAligÃd
 = (0 !ğ((
	`tunšgWt
(
AtomRe¡riùMovem’t
)) & 0x0008));

300 
Œªs
 = (
	`x
(0è* 
b
);

301 
Œªs
 +ğ(
	`x
(1è* 
n
);

302 
Œªs
 +ğ(
	`x
(2è* 
bP”p
);

303 
Œªs
 *ğ
	`tunšgWt
(
AtomT¿n¦©iÚFaùÜ
);

304 ifĞ(
	`tunšgWt
(
AtomRe¡riùMovem’t
)) & 0x0001) {

305 
boŞ
 
»pÜ‹d
 = 
çl£
;

306 ifĞ!
»pÜ‹d
 ) {

307 
cout
 << "Disabling‡tom movement‡longangent/bisector.\n";

308 
»pÜ‹d
 = 
Œue
;

310 ifĞ
axesAligÃd
) {

311 
Œªs
.
	`£tX
(0.0);

315 
Œªs
 -ğ
	`x
(0è* 
b
;

318 ifĞ(
	`tunšgWt
(
AtomRe¡riùMovem’t
)) & 0x0002) {

319 
boŞ
 
»pÜ‹d
 = 
çl£
;

320 ifĞ!
»pÜ‹d
 ) {

321 
cout
 << "Disabling‡tom movement‡long‚ormal.\n";

322 
»pÜ‹d
 = 
Œue
;

324 ifĞ
axesAligÃd
) {

325 
Œªs
.
	`£tY
(0.0);

329 
Œªs
 -ğ
	`x
(1è* 
n
;

332 ifĞ(
	`tunšgWt
(
AtomRe¡riùMovem’t
)) & 0x0004) {

333 
boŞ
 
»pÜ‹d
 = 
çl£
;

334 ifĞ!
»pÜ‹d
 ) {

335 
cout
 << "Disabling‡tom movement‡long binormal.\n";

336 
»pÜ‹d
 = 
Œue
;

338 ifĞ
axesAligÃd
) {

339 
Œªs
.
	`£tZ
(0.0);

343 
Œªs
 -ğ
	`x
(2è* 
bP”p
;

346 
´im
.
	`Œª¦©eBy
(
Œªs
);

348 
axis
.
	`£t
(
	`x
(3), x(4), x(5));

349 
ªgË
 = 
	`tunšgWt
(
AtomRÙ©iÚFaùÜ
è* 
axis
.
	`nÜm®ize
();

350 
fš®RÙ
.
	`£tAxisAngË
(
axis
, 
ªgË
);

351 
´im
.
	`rÙ©eBy
(
fš®RÙ
);

354 
sÿË
 = 
	`exp
(
	`tunšgWt
(
AtomSÿËFaùÜ
è* 
	`x
(6));

355 ifĞ(
	`tunšgWt
(
AtomRe¡riùMovem’t
)) & 0x0010) {

356 
boŞ
 
»pÜ‹d
 = 
çl£
;

357 ifĞ!
»pÜ‹d
 ) {

358 
cout
 << "Coupling„‡ndheta changes.\n";

359 
»pÜ‹d
 = 
Œue
;

362 
´im
.
	`£tR
Ğ´im.
	`g‘R
(è* 
sÿË
);

363 
´im
.
	`£tTh‘a
Ğ
	`acos
(
	`max
(
	`mš
Ğ
	`cos
Õrim.
	`g‘Th‘a
())/
sÿË
, 1.0),-1.0)) );

365 
´im
.
	`sÿËBy
(
sÿË
);

367 
´im
.
	`£tTh‘a
Õrim.
	`g‘Th‘a
(è+ 
	`tunšgWt
(
AtomTh‘aFaùÜ
è* 
	`x
(7));

370 ià((
	`tunšgWt
(
AtomEFaùÜ
è!ğ0.0è&& (
´im
.
	`ty³
(è=ğ
M3D_END_PRIMITIVE
)) {

372 
‘a
 = (
dyÇmic_ÿ¡
<
M3DEndPrim™ive
 *>(&
´im
))->
	`g‘ElÚg©iÚ
(è* 
	`exp
(
	`tunšgWt
(
AtomEFaùÜ
è* 
	`x
(8));

373 (
dyÇmic_ÿ¡
<
M3DEndPrim™ive
 *>(&
´im
))->
	`£tElÚg©iÚ
(
‘a
);

379 
M3DFigu»
* 
cu¼FigPŒ
 = 
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

380 
cu¼FigPŒ
->
	`fixGlob®CÚsi¡’cy
();

381 
	}
}

385 
	gM3DDefÜm©iÚProbËmBoundsFunùiÚ
::
	$bound
Ğ
i
 )

387 
	`as£¹
Ğ
i
 >= 0 );

388 ifĞ
´obËm
->
´imPga
 !ğ
NULL
 ) {

392 
VeùÜ
 
	`bounds
(9,

393 
	`tunšgWt
(
AtomT¿n¦©iÚBound
),uningWt(AtomTranslationBound),uningWt(AtomTranslationBound),

394 
	`tunšgWt
(
AtomRÙ©iÚBound
)*
R_PI
/180.0,uningWt(AtomRotationBound)*R_PI/180.0,uningWt(AtomRotationBound)*R_PI/180.0,

395 
	`log
(
	`tunšgWt
(
AtomSÿËBound
)),

396 
	`tunšgWt
(
AtomTh‘aBound
è* 
R_PI
/180.0,

397 
	`log
(
	`tunšgWt
(
AtomEBound
)));

398  
	`bounds
Ğ(
i
 < 
bounds
.
	`size
()) ? i : (bounds.size() - 1) );

400 
	}
}

402 
	gM3DDefÜm©iÚProbËmBoundsFunùiÚ
::
	$çùÜ
Ğ
i
 )

404 
	`as£¹
Ğ
i
 >= 0 );

405 ifĞ
´obËm
->
´imPga
 !ğ
NULL
 ) {

406  
	`tunšgWt
(
AtomPGAFaùÜ
);

409 
VeùÜ
 
	`çùÜs
(9,

410 
	`tunšgWt
(
AtomT¿n¦©iÚFaùÜ
),uningWt(AtomTranslationFactor),

411 
	`tunšgWt
(
AtomT¿n¦©iÚFaùÜ
),unšgWt(
AtomRÙ©iÚFaùÜ
),

412 
	`tunšgWt
(
AtomRÙ©iÚFaùÜ
),uningWt(AtomRotationFactor),

413 
	`tunšgWt
(
AtomSÿËFaùÜ
),unšgWt(
AtomTh‘aFaùÜ
),

414 
	`tunšgWt
(
AtomEFaùÜ
));

415  
	`çùÜs
Ğ(
i
 < 
çùÜs
.
	`size
()) ? i : (factors.size() - 1) );

417 
	}
}

	@M3DFigureElongater.cpp

1 
	~<m©h.h
>

2 
	~"M3DFigu»ElÚg©”.h
"

4 
	gM3DFigu»ElÚg©”
::
	$M3DFigu»ElÚg©”
(
M3DQuadFigu»
 * 
_figu»
) :

5 
	`–Úg©iÚM‘hod
(
M3D_ELONGATE_LONG_AXIS
), 
	$rowOr›ÁedLšks
(
çl£
)

7 
»ã»nûFigu»
 = 
NULL
;

8 
	`š™Ÿlize
(
_figu»
);

9 
	}
}

11 
	gM3DFigu»ElÚg©”
::~
	$M3DFigu»ElÚg©”
()

13 if(
»ã»nûFigu»
 !ğ
NULL
)

14 
d–‘e
 
»ã»nûFigu»
;

15 
	}
}

17 
	gM3DFigu»ElÚg©”
::
	$š™Ÿlize
(
M3DQuadFigu»
 * 
_figu»
)

19 
figu»
 = 
_figu»
;

21 ià(
»ã»nûFigu»
 !ğ
NULL
)

22 
d–‘e
 
»ã»nûFigu»
;

24 if(
figu»
 =ğ
NULL
)

26 
»ã»nûFigu»
 = 
NULL
;

32 
»ã»nûFigu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
 *>Ğ
figu»
->
	`assign
() );

34 
	`£tElÚg©iÚM‘hod
(
–Úg©iÚM‘hod
);

35 
	}
}

37 
	gM3DFigu»ElÚg©”
::
	$upd©e
()

39 *
»ã»nûFigu»
 = *
figu»
;

40 
	}
}

42 
	gM3DFigu»ElÚg©”
::
	$£tElÚg©iÚM‘hod
(
M3DElÚg©iÚM‘hod
 
m
)

44 
rowCouÁ
,

45 
cŞumnCouÁ
;

48 
–Úg©iÚM‘hod
 = 
m
;

50 if(
»ã»nûFigu»
 =ğ
NULL
)

53 
rowCouÁ
 = 
»ã»nûFigu»
->
	`g‘RowCouÁ
();

54 
cŞumnCouÁ
 = 
»ã»nûFigu»
->
	`g‘CŞumnCouÁ
();

56 if((
–Úg©iÚM‘hod
 =ğ
M3D_ELONGATE_LONG_AXIS
 && 
rowCouÁ
 >ğ
cŞumnCouÁ
) ||

57 (
–Úg©iÚM‘hod
 =ğ
M3D_ELONGATE_SHORT_AXIS
 && 
rowCouÁ
 <ğ
cŞumnCouÁ
) ||

58 (
–Úg©iÚM‘hod
 =ğ
M3D_ELONGATE_ROW
))

60 
rowOr›ÁedLšks
 = 
Œue
;

63 
rowOr›ÁedLšks
 = 
çl£
;

64 
	}
}

66 
	gM3DFigu»ElÚg©”
::
	$–Úg©e
(
v®ue
)

68 
M3DPrim™ive
 * 
´im™ive
;

70 
lškCouÁ
,

71 
rowCouÁ
, 
cŞumnCouÁ
,

72 
i
, 
j
,

73 
´im™iveId
,

74 
´im™iveIndexD–
,

75 
ÃighbÜIndexD–
,

76 
numPrim™ivesP”Lšk
;

78 
´evPrim™iveId
,

79 
ÃighbÜPrim™iveId
;

82 if(
figu»
 =ğ
NULL
 || 
»ã»nûFigu»
 == NULL)

85 (*
figu»
èğ(*
»ã»nûFigu»
);

87 
rowCouÁ
 = 
figu»
->
	`g‘RowCouÁ
();

88 
cŞumnCouÁ
 = 
figu»
->
	`g‘CŞumnCouÁ
();

90 if(
rowOr›ÁedLšks
)

92 
´im™iveIndexD–
 = 
cŞumnCouÁ
;

93 
numPrim™ivesP”Lšk
 = 
rowCouÁ
;

94 
ÃighbÜIndexD–
 = 1;

95 
lškCouÁ
 = 
cŞumnCouÁ
;

99 
´im™iveIndexD–
 = 1;

100 
numPrim™ivesP”Lšk
 = 
cŞumnCouÁ
;

101 
ÃighbÜIndexD–
 = 
cŞumnCouÁ
;

102 
lškCouÁ
 = 
rowCouÁ
;

105 
middËIndex
 = (
lškCouÁ
 / 2è* 
ÃighbÜIndexD–
;

106 
d–Index
;

110 
¡¬tIndex
 = 
middËIndex
;

111 
d–Index
 = -
ÃighbÜIndexD–
; deltaIndex <=‚eighborIndexDelta;

112 
d–Index
 +ğ(2*
ÃighbÜIndexD–
))

114 
i
 = 
¡¬tIndex
; i < 
lškCouÁ
*
ÃighbÜIndexD–
 && i >ğ0; i +ğ
d–Index
)

116 
´im™iveId
 = 
i
;

117 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

118 if(
´im™ive
 =ğ
NULL
)

121 if(
i
 =ğ
middËIndex
)

123 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

125 
´evPrim™iveId
 = 
´im™iveId
;

126 
´im™iveId
 +ğ
´im™iveIndexD–
;

128 
	`£tPrim™iveToP»viousP»diùiÚ
(
figu»
, 
´im™iveId
,

129 
´evPrim™iveId
, 
v®ue
);

135 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

137 
´evPrim™iveId
 = 
´im™iveId
;

138 
´im™iveId
 +ğ
´im™iveIndexD–
;

139 
ÃighbÜPrim™iveId
 = 
´im™iveId
 - 
d–Index
;

141 
	`£tPrim™iveToAv”ageP»diùiÚ
(
figu»
, 
´im™iveId
,

142 
´evPrim™iveId
, 
ÃighbÜPrim™iveId
,

143 1.0, 
v®ue
);

148 
¡¬tIndex
 = 
middËIndex
 + 
ÃighbÜIndexD–
;

151 
middËIndex
 = (
numPrim™ivesP”Lšk
 / 2è* 
´im™iveIndexD–
;

152 
M3DPrim™ive
 * 
ÃwPrim™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
middËIndex
);

153 
M3DPrim™ive
 * 
ŞdPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
middËIndex
);

154 
VeùÜ3D
 
Œªs
 = 
ŞdPrim™ive
->
	`g‘X
(è- 
ÃwPrim™ive
->getX();

156 
figu»
->
	`Œª¦©eBy
(
Œªs
, 
Œue
);

157 
	}
}

159 
	gM3DFigu»ElÚg©”
::
	$£tPrim™iveToP»viousP»diùiÚ
(

160 
M3DQuadFigu»
 * 
rg‘Figu»
, 
´im™iveId
, 
´evPrim™iveId
, 
sÿË
)

162 
M3DPrim™ive
 * 
´im™ive
,

163 * 
´evPrim™ive
,

164 * 
»fPrim™ive
,

165 * 
»fP»vPrim™ive
;

167 
VeùÜ3D
 
´evDiff
;

169 
Qu©
 
q
, 
dq
;

172 
´im™ive
 = 
rg‘Figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

173 
´evPrim™ive
 = 
rg‘Figu»
->
	`g‘Prim™ivePŒ
(
´evPrim™iveId
);

175 
»fPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

176 
»fP»vPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
´evPrim™iveId
);

178 if(
´im™ive
 =ğ
NULL
 || 
´evPrim™ive
 == NULL ||

179 
»fPrim™ive
 =ğ
NULL
 || 
»fP»vPrim™ive
 == NULL)

182 
´evDiff
 = 
sÿË
 * (
»fPrim™ive
->
	`g‘X
(è- 
»fP»vPrim™ive
->getX());

184 
dq
 = 
´evPrim™ive
->
	`g‘Q
(è* 
»fP»vPrim™ive
->g‘Q().
	`cÚj
();

185 
dq
.
	`rÙ©eVeùÜ
(
´evDiff
);

187 
q
 = 
»fP»vPrim™ive
->
	`g‘Q
().
	`cÚj
(è* 
»fPrim™ive
->getQ();

196 
´im™ive
->
	`£tX
(
´evPrim™ive
->
	`g‘X
(è+ 
´evDiff
);

197 
´im™ive
->
	`£tQ
(
´evPrim™ive
->
	`g‘Q
(è* 
q
);

198 
	}
}

200 
	gM3DFigu»ElÚg©”
::
	$£tPrim™iveToAv”ageP»diùiÚ
(

201 
M3DQuadFigu»
 * 
rg‘Figu»
, 
´im™iveId
, 
´evPrim™iveId
,

202 
ÃighbÜPrim™iveId
, 
sÿË
, 
–Úg©iÚ
)

204 
M3DPrim™ive
 * 
´im™ive
,

205 * 
´evPrim™ive
,

206 * 
ÃighbÜPrim™ive
,

207 * 
»fPrim™ive
,

208 * 
»fP»vPrim™ive
,

209 * 
»fNeighbÜPrim™ive
;

211 
M3DQuadPrim™ive
 
´evP»diùiÚ
,

212 
ÃighbÜP»diùiÚ
;

214 
VeùÜ3D
 
´evDiff
,

215 
ÃighbÜDiff
;

216 
´evDi¡
,

217 
ÃighbÜDi¡
,

218 
weight
;

220 
Qu©
 
q
, 
dq
;

222 
ªgË
;

224 
´im™ive
 = 
rg‘Figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

225 
´evPrim™ive
 = 
rg‘Figu»
->
	`g‘Prim™ivePŒ
(
´evPrim™iveId
);

226 
ÃighbÜPrim™ive
 = 
rg‘Figu»
->
	`g‘Prim™ivePŒ
(
ÃighbÜPrim™iveId
);

228 
»fPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

229 
»fP»vPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
´evPrim™iveId
);

230 
»fNeighbÜPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
ÃighbÜPrim™iveId
);

232 if(
´im™ive
 =ğ
NULL
 || 
´evPrim™ive
 == NULL ||

233 
ÃighbÜPrim™ive
 =ğ
NULL
 || 
»fPrim™ive
 == NULL ||

234 
»fP»vPrim™ive
 =ğ
NULL
 || 
»fNeighbÜPrim™ive
 == NULL)

238 
´evDiff
 = 
–Úg©iÚ
 * (
»fPrim™ive
->
	`g‘X
(è- 
»fP»vPrim™ive
->getX());

239 
ÃighbÜDiff
 = 
sÿË
 * (
»fPrim™ive
->
	`g‘X
(è- 
»fNeighbÜPrim™ive
->getX());

244 
dq
 = 
´evPrim™ive
->
	`g‘Q
(è* 
»fP»vPrim™ive
->g‘Q().
	`cÚj
();

247 
ªgË
 = 
dq
.
	`g‘W
();

248 if(
ªgË
 < -1.0)‡ngle = -1.0;

249 if(
ªgË
 > 1.0)‡ngle = 1.0;

250 
ªgË
 = 2.0 * 
	`acos
×ngËè* 
–Úg©iÚ
;

251 
dq
.
	`£tAxisAngË
(dq.
	`g‘VeùÜ
(), 
ªgË
);

253 
dq
.
	`rÙ©eVeùÜ
(
´evDiff
);

255 
q
 = 
»fP»vPrim™ive
->
	`g‘Q
().
	`cÚj
(è* 
»fPrim™ive
->getQ();

257 
´evP»diùiÚ
.
	`£tX
(
´evPrim™ive
->
	`g‘X
(è+ 
´evDiff
);

258 
´evP»diùiÚ
.
	`£tQ
(
´evPrim™ive
->
	`g‘Q
(è* 
q
);

259 
´evP»diùiÚ
.
	`£tR
(
´im™ive
->
	`g‘R
());

260 
´evP»diùiÚ
.
	`£tTh‘a
(
´im™ive
->
	`g‘Th‘a
());

262 
dq
 = 
ÃighbÜPrim™ive
->
	`g‘Q
(è* 
»fNeighbÜPrim™ive
->g‘Q().
	`cÚj
();

268 
dq
.
	`rÙ©eVeùÜ
(
ÃighbÜDiff
);

270 
q
 = 
»fNeighbÜPrim™ive
->
	`g‘Q
().
	`cÚj
(è* 
»fPrim™ive
->getQ();

272 
ÃighbÜP»diùiÚ
.
	`£tX
(
ÃighbÜPrim™ive
->
	`g‘X
(è+ 
ÃighbÜDiff
);

273 
ÃighbÜP»diùiÚ
.
	`£tQ
(
ÃighbÜPrim™ive
->
	`g‘Q
(è* 
q
);

274 
ÃighbÜP»diùiÚ
.
	`£tR
(
´im™ive
->
	`g‘R
());

275 
ÃighbÜP»diùiÚ
.
	`£tTh‘a
(
´im™ive
->
	`g‘Th‘a
());

277 
´evDiff
 = 
´im™ive
->
	`g‘X
(è- 
´evPrim™ive
->getX();

278 
ÃighbÜDiff
 = 
´im™ive
->
	`g‘X
(è- 
ÃighbÜPrim™ive
->getX();

279 
´evDi¡
 = 
´evDiff
.
	`nÜm
();

280 
ÃighbÜDi¡
 = 
ÃighbÜDiff
.
	`nÜm
();

281 
weight
 = 
–Úg©iÚ
 * 
ÃighbÜDi¡
 / (
sÿË
 * 
´evDi¡
 +ƒlongation *‚eighborDist);

283 
	`av”agePrim™ives
(*
´im™ive
, 
´evP»diùiÚ
, 
ÃighbÜP»diùiÚ
, 
weight
);

285 
	}
}

287 
	gM3DFigu»ElÚg©”
::
	$av”agePrim™ives
(
M3DPrim™ive
 & 
avePrim
,

288 cÚ¡ 
M3DPrim™ive
 & 
´im1
, cÚ¡ M3DPrim™iv& 
´im2
, 
weight
)

290 
Qu©
 
q
;

292 
weight2
 = 1.0 - 
weight
;

294 
avePrim
.
	`£tX
(
weight2
 * 
´im1
.
	`g‘X
(è+ 
weight
 * 
´im2
.getX());

295 
avePrim
.
	`£tQ
(
q
.
	`¦”p
(
weight
, 
´im1
.
	`g‘Q
(), 
´im2
.getQ()));

296 
avePrim
.
	`£tR
(
weight2
 * 
´im1
.
	`g‘R
(è+ 
weight
 * 
´im2
.getR());

297 
avePrim
.
	`£tTh‘a
(
weight2
 * 
´im1
.
	`g‘Th‘a
(è+ 
weight
 * 
´im2
.getTheta());

298 
	}
}

	@M3DMainFigResidueCPNSProblem.cpp

1 
	~<m©h.h
>

2 
	~<io¡»am
>

3 
	~"M3DMašFigResidueCPNSProbËm.h
"

4 
	~"Tunšg.h
"

6 
glob®V”bos™y
;

8 
usšg
 
Çme¥aû
 
	g¡d
;

10 
	gM3DMašFigResidueCPNSProbËm
::
	$M3DMašFigResidueCPNSProbËm
Ğ
M3DCPNSSts
 *
ınsPŒ
, 
_Üd”
)

12 
ıns
 = 
ınsPŒ
;

13 
Üd”
 = 
_Üd”
;

14 
	}
}

16 
	gM3DMašFigResidueCPNSProbËm
::
	$·¿m‘”CouÁ
() const

18  
ıns
->
	`g‘NEig’Modes
();

19 
	}
}

21 
	gM3DMašFigResidueCPNSProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 &
x
)

23 
geomP’®ty
;

24 
tÙ®P’®ty
;

25 
M3DObjeù
 *
rg‘Objeù
;

26 
figu»Id
;

28 
ev®u©iÚCo¡
 += 1;

30 ià(
m©ch
 =ğ
NULL
)

31  
MAIN_FIGURE_MAX_RETURN
;

33 
rg‘Objeù
 = 
	`ü—‹T¬g‘Objeù
(
x
, 
figu»Id
, 
Œue
);

35 
¡d
::
veùÜ
<> 
v®s
;

36 
i
 = 0; i !ğ
x
.
	`size
(); i++)

38 
v®s
.
	`push_back
(
	`x
(
i
)*
	`tunšgWt
(
Figu»PGAFaùÜ
));

40 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›s
(
rg‘Objeù
, 
figu»Id
, 
NULL
, 
v®s
, 
geomP’®ty
);

41 
Ï¡P’®ty
 = 
geomP’®ty
;

43 
d–‘e
 
rg‘Objeù
;

45  
tÙ®P’®ty
;

46 
	}
}

48 
M3DObjeù
 * 
	gM3DMašFigResidueCPNSProbËm
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 &
x
, &
figu»Id
, 
boŞ
 
´ediù
)

50 
M3DFigu»T»eNode
 *
Œ“Node
;

52 if(
»fObjeù
 =ğ
NULL
)

53  
NULL
;

55 
Œ“Node
 = 
»fObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“_šdex
);

56 ià(
Œ“Node
 =ğ
NULL
)

58 
¡d
::
cout
<<"»ã»nûObjeù iÀü—‹T¬g‘Objeù(èi NULL" << 
’dl
;

59  
NULL
;

62 
figu»Id
 = 
Œ“Node
->
	`g‘Figu»Id
();

64 
M3DObjeù
 *
rg‘Objeù
 = 
»fObjeù
->
	`assign
();

66 
¡d
::
veùÜ
<> 
v®s
;

70 
i
 = 0; i < 
x
.
	`size
(); i++)

71 
v®s
.
	`push_back
(
	`x
(
i
)*
	`tunšgWt
(
Figu»PGAFaùÜ
));

74 * 
x2
 = 
Ãw
 [
v®s
.
	`size
()];

76 
i
 = 0; i < 
v®s
.
	`size
(); i++)

77 
x2
[
i
] = 
v®s
[i];

80 
rg‘Objeù
 = 
ıns
->
	`eig’modeDefÜmM—n
(
x2
, 
»fObjeù
, 
v®s
.
	`size
());

82 
rg‘Objeù
->
	`£Ëù
();

84 #ifdeà
UNFLIPPED


85 
VeùÜ3D
 
	`ûÁ”
(0.0,1.0,0.0);

87 
VeùÜ3D
 
	`ûÁ”
(0.0,0.0,0.0);

90 
Qu©
 
qtmp
 = 
mašFigProbËmSimT¿nsfÜm
.
	`g‘RÙ©iÚ
();

91 
rg‘Objeù
->
	`rÙ©eBy
(
qtmp
, 
ûÁ”
);

92 
rg‘Objeù
->
	`sÿËBy
(
mašFigProbËmSimT¿nsfÜm
.
	`g‘SÿË
(), 
ûÁ”
);

93 
rg‘Objeù
->
	`Œª¦©eBy
(
mašFigProbËmSimT¿nsfÜm
.
	`g‘T¿n¦©iÚ
());

95 #ifdeà
CHECK_SIMILARITY_TRANSFORM


96 
¡d
::
cout
<<"Üd” "<<
Üd”
<<¡d::
’dl
;

98 
¡d
::
cout
<<"In™ŸlT¿nsfÜm iÀM3DMašFigResiduePGAProbËm::ü—‹T¬g‘Objeù()" <<¡d::
’dl
;

99 
š™ŸlT¿nsfÜm
.
	`g‘RÙ©iÚ
().
	`´št
();

100 
š™ŸlT¿nsfÜm
.
	`g‘T¿n¦©iÚ
().
	`´št
();

101 
¡d
::
cout
<<"sÿË "<<
š™ŸlT¿nsfÜm
.
	`g‘SÿË
()<<¡d::
’dl
;

111 #ifdeà
CHECK_SIMILARITY_TRANSFORM


112 
¡d
::
cout
<<"hªdT¿nsfÜm iÀM3DMašFigResiduePGAProbËm::ü—‹T¬g‘Objeù(è"<<¡d::
’dl
;

114 
hªdT¿nsfÜm
.
	`g‘RÙ©iÚ
().
	`´št
();

115 
hªdT¿nsfÜm
.
	`g‘T¿n¦©iÚ
().
	`´št
();

116 
¡d
::
cout
<<"sÿË "<<
hªdT¿nsfÜm
.
	`g‘SÿË
()<<¡d::
’dl
;

128 #ifdeà
CHECK_SIMILARITY_TRANSFORM


129 
¡d
::
cout
<<"be¡En£mbËT¿n š M3DMašFigResiduePGAProbËm::ü—‹T¬g‘Objeù()"<<¡d::
’dl
;

131 
be¡En£mbËT¿ns
.
	`g‘RÙ©iÚ
().
	`´št
();

132 
be¡En£mbËT¿ns
.
	`g‘T¿n¦©iÚ
().
	`´št
();

133 
¡d
::
cout
<<"sÿË "<<
be¡En£mbËT¿ns
.
	`g‘SÿË
()<<¡d::
’dl
;

140 
rg‘Objeù
->
	`de£Ëù
();

141 
M3DFigu»
 *
figu»PŒ
 = 
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

142 
figu»PŒ
->
	`£Ëù
();

144  
rg‘Objeù
;

147 
	}
}

149 
	gM3DMašFigResidueCPNSProbËmBoundsFunùiÚ
::
	$M3DMašFigResidueCPNSProbËmBoundsFunùiÚ
()

151 
bounds
 = 
	`VeùÜ
(1, 
	`tunšgWt
(
Figu»PGABound
));

152 
çùÜs
 = 
	`VeùÜ
(1,
	`tunšgWt
(
Figu»PGAFaùÜ
));

153 
	}
}

	@M3DMainFigResiduePGAOptimizer.cpp

1 
	~<f¡»am
>

2 
	~<¡dio.h
>

3 
	~<m©h.h
>

4 
	~"O±imiz”Ba£.h
"

5 
	~"M3DMašFigResiduePGAO±imiz”.h
"

9 
usšg
 
Çme¥aû
 
	g¡d
;

11 
	gM3DMašFigResiduePGAO±imiz”
::
	$M3DMašFigResiduePGAO±imiz”
(
M©ch
 * 
m
,

12 
M3DPGASts
 * 
pgaPŒ
, 
Üd”
è: 
	$M3DMašFigu»O±imiz”
(
m
)

14 
boundsFunùiÚ
 = 
Ãw
 
M3DMašFigResiduePGAProbËmBoundsFunùiÚ
;

15 
´obËm
 = 
Ãw
 
	`M3DMašFigResiduePGAProbËm
(
pgaPŒ
, 
Üd”
);

16 
numP¬am‘”s
 = ((
M3DMašFigResiduePGAProbËm
 *è
´obËm
)->
	`·¿m‘”CouÁ
();

17 
	}
}

19 
boŞ
 
	gM3DMašFigResiduePGAO±imiz”
::
	$š™Ÿlize
(
M3DObjeù
 * 
»ã»nûObjeù
,

20 
Œ“Index
)

22 
M3DPGASts
 * 
pgaPŒ
 = ((
M3DMašFigResiduePGAProbËm
 *)
´obËm
)->
	`g‘PGA
();

23 
Üd”
 = ((
M3DMašFigResiduePGAProbËm
 *)
´obËm
)->
	`g‘Ord”
();

25 
M3DObjeù
 * 
‹mpObj
 = 
»ã»nûObjeù
->
	`assign
();

26 
pgaPŒ
->
	`­¶yM—nResidue
(
‹mpObj
, 
Üd”
);

27 
d–‘e
 
‹mpObj
;

29 #ifdeà
DEBUG


30 
cout
 << "Œ“Index " << 
Œ“Index
 << 
’dl
;

33  
M3DMašFigu»O±imiz”
::
	`š™Ÿlize
(
»ã»nûObjeù
, 
Œ“Index
);

34 
	}
}

37 
M3DObjeù
 * 
	gM3DMašFigResiduePGAO±imiz”
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 & 
v
)

39 
figu»Id
;

41 ià(
´obËm
 =ğ
NULL
)

42  
NULL
;

44  
´obËm
->
	`ü—‹T¬g‘Objeù
(
v
, 
figu»Id
, 
Œue
);

45 
	}
}

	@M3DMainFigResiduePGAProblem.cpp

1 
	~<m©h.h
>

2 
	~<io¡»am
>

3 
	~"M3DMašFigResiduePGAProbËm.h
"

4 
	~"Tunšg.h
"

6 
glob®V”bos™y
;

12 
usšg
 
Çme¥aû
 
	g¡d
;

15 
	gM3DMašFigResiduePGAProbËm
::
	$M3DMašFigResiduePGAProbËm
(
M3DPGASts
 * 
pgaPŒ
, 
_Üd”
)

17 
pga
 = 
pgaPŒ
;

18 
Üd”
 = 
_Üd”
;

19 
	}
}

21 
	gM3DMašFigResiduePGAProbËm
::
	$·¿m‘”CouÁ
() const

23  
pga
->
	`g‘PGD©aPŒ
(
Üd”
)->
numPGs
;

24 
	}
}

26 
	gM3DMašFigResiduePGAProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 & 
x
)

28 
geomP’®ty
;

29 
tÙ®P’®ty
;

30 
M3DObjeù
 * 
rg‘Objeù
;

31 
figu»Id
;

33 
ev®u©iÚCo¡
 += 1;

35 ià(
m©ch
 =ğ
NULL
)

36  
MAIN_FIGURE_MAX_RETURN
;

39 
rg‘Objeù
 = 
	`ü—‹T¬g‘Objeù
(
x
, 
figu»Id
, 
Œue
);

41 
¡d
::
veùÜ
<> 
v®s
;

42 
i
 = 0; i !ğ
x
.
	`size
(); ++i ) {

43 
v®s
.
	`push_back
(
	`x
(
i
)*
	`tunšgWt
(
Figu»PGAFaùÜ
));

45 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›s
(
rg‘Objeù
,

46 
figu»Id
, 
NULL
, 
v®s
, 
geomP’®ty
);

47 
Ï¡P’®ty
 = 
geomP’®ty
;

49 
d–‘e
 
rg‘Objeù
;

51 #ifdeà
OPTIMIZATION_VISUALIZER


52 
	`cİyResuÉsToVisu®iz”
(&
x
, 
tÙ®P’®ty
);

55  
tÙ®P’®ty
;

56 
	}
}

58 
M3DObjeù
 * 
	gM3DMašFigResiduePGAProbËm
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 & 
x
, & 
figu»Id
, 
boŞ
 
´ediù
)

60 
M3DFigu»T»eNode
 * 
Œ“Node
;

62 ià(
»fObjeù
 =ğ
NULL
 || 
x
.
	`size
(è!ğ
	`·¿m‘”CouÁ
())

63  
NULL
;

65 
Œ“Node
 = 
»fObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“_šdex
);

66 if(
Œ“Node
 =ğ
NULL
){

67 
¡d
::
cout
<<"»ã»nûObjeù iÀü—‹T¬g‘Objeù(èi NULL"<<
’dl
;

68  
NULL
;

71 
figu»Id
 = 
Œ“Node
->
	`g‘Figu»Id
();

73 
M3DObjeù
 * 
rg‘Objeù
 = 
»fObjeù
->
	`assign
();

75 
¡d
::
veùÜ
<> 
v®s
;

76 
i
 = 0; i < 
x
.
	`size
(); i++)

77 
v®s
.
	`push_back
(
	`x
(
i
)*
	`tunšgWt
(
Figu»PGAFaùÜ
));

79 if(!
pga
->
	`doPGADefÜm
(
rg‘Objeù
, 
v®s
, 
Üd”
, 
´ediù
)){

80 
¡d
::
cout
<<"E¼Ü iÀpg¨defÜm©iÚ‡ˆM3DMašFigResiduePGAProbËm"<<
’dl
;

81  
NULL
;

90 
rg‘Objeù
->
	`£Ëù
();

91 #ifdeà
UNFLIPPED


92 
VeùÜ3D
 
	`ûÁ”
(0.0, 1.0, 0.0);

94 
VeùÜ3D
 
	`ûÁ”
(0.0, 0.0, 0.0);

96 
Qu©
 
qtmp
 = 
mašFigProbËmSimT¿nsfÜm
.
	`g‘RÙ©iÚ
();

97 
rg‘Objeù
->
	`rÙ©eBy
(
qtmp
, 
ûÁ”
);

98 
rg‘Objeù
->
	`sÿËBy
(
mašFigProbËmSimT¿nsfÜm
.
	`g‘SÿË
(), 
ûÁ”
);

99 
rg‘Objeù
->
	`Œª¦©eBy
(
mašFigProbËmSimT¿nsfÜm
.
	`g‘T¿n¦©iÚ
());

101 #ifdeà
CHECK_SIMILARITY_TRANSFORM


102 
¡d
::
cout
<<"Üd” "<<
Üd”
<<¡d::
’dl
;

104 
¡d
::
cout
<<"In™ŸlT¿nsfÜm iÀM3DMašFigResiduePGAProbËm::ü—‹T¬g‘Objeù()" <<¡d::
’dl
;

105 
š™ŸlT¿nsfÜm
.
	`g‘RÙ©iÚ
().
	`´št
();

106 
š™ŸlT¿nsfÜm
.
	`g‘T¿n¦©iÚ
().
	`´št
();

107 
¡d
::
cout
<<"sÿË "<<
š™ŸlT¿nsfÜm
.
	`g‘SÿË
()<<¡d::
’dl
;

111 
Sim¬™yT¿nsfÜm3D
 
hªdT¿nsfÜm
 = 
pga
->
	`g‘HªdPÏûm’tT¿nsfÜm
();

112 
qtmp
 = 
hªdT¿nsfÜm
.
	`g‘RÙ©iÚ
();

113 
rg‘Objeù
->
	`rÙ©eBy
(
qtmp
, 
ûÁ”
);

114 
rg‘Objeù
->
	`sÿËBy
(
hªdT¿nsfÜm
.
	`g‘SÿË
(), 
ûÁ”
);

115 
rg‘Objeù
->
	`Œª¦©eBy
(
hªdT¿nsfÜm
.
	`g‘T¿n¦©iÚ
());

117 #ifdeà
CHECK_SIMILARITY_TRANSFORM


118 
¡d
::
cout
<<"hªdT¿nsfÜm iÀM3DMašFigResiduePGAProbËm::ü—‹T¬g‘Objeù(è"<<¡d::
’dl
;

120 
hªdT¿nsfÜm
.
	`g‘RÙ©iÚ
().
	`´št
();

121 
hªdT¿nsfÜm
.
	`g‘T¿n¦©iÚ
().
	`´št
();

122 
¡d
::
cout
<<"sÿË "<<
hªdT¿nsfÜm
.
	`g‘SÿË
()<<¡d::
’dl
;

128 
Sim¬™yT¿nsfÜm3D
 
be¡En£mbËT¿ns
 = 
pga
->
	`g‘Be¡T¿nsfÜm
();

129 
qtmp
 = 
be¡En£mbËT¿ns
.
	`g‘RÙ©iÚ
();

130 
rg‘Objeù
->
	`rÙ©eBy
(
qtmp
, 
ûÁ”
);

131 
rg‘Objeù
->
	`sÿËBy
(
be¡En£mbËT¿ns
.
	`g‘SÿË
(), 
ûÁ”
);

132 
rg‘Objeù
->
	`Œª¦©eBy
(
be¡En£mbËT¿ns
.
	`g‘T¿n¦©iÚ
());

134 #ifdeà
CHECK_SIMILARITY_TRANSFORM


135 
¡d
::
cout
<<"be¡En£mbËT¿n š M3DMašFigResiduePGAProbËm::ü—‹T¬g‘Objeù()"<<¡d::
’dl
;

137 
be¡En£mbËT¿ns
.
	`g‘RÙ©iÚ
().
	`´št
();

138 
be¡En£mbËT¿ns
.
	`g‘T¿n¦©iÚ
().
	`´št
();

139 
¡d
::
cout
<<"sÿË "<<
be¡En£mbËT¿ns
.
	`g‘SÿË
()<<¡d::
’dl
;

146 
rg‘Objeù
->
	`de£Ëù
();

147 
M3DFigu»
 *
figu»PŒ
 = 
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

148 
figu»PŒ
->
	`£Ëù
();

155  
rg‘Objeù
;

156 
	}
}

158 
	gM3DMašFigResiduePGAProbËmBoundsFunùiÚ
::
	$M3DMašFigResiduePGAProbËmBoundsFunùiÚ
()

160 
bounds
 = 
	`VeùÜ
(1, 
	`tunšgWt
(
Figu»PGABound
));

161 
çùÜs
 = 
	`VeùÜ
(1, 
	`tunšgWt
(
Figu»PGAFaùÜ
));

162 
	}
}

	@M3DMainFigureOptimizer.cpp

1 
	~<f¡»am
>

2 
	~<iomª
>

3 
	~<m©h.h
>

4 
	~"O±imiz”Ba£.h
"

5 
	~"SurçûP©chEn£mbË.h
"

6 
	~"M3DMašFigu»O±imiz”.h
"

7 
	~"Tunšg.h
"

8 #ifdeà
OPTIMIZATION_VISUALIZER


9 
	~"LogMªag”.h
"

12 
	~<s¡»am
>

20 
usšg
 
Çme¥aû
 
	g¡d
;

22 #ifdeà
BINARY


23 
Sim¬™yT¿nsfÜm3D
 
	gGLOBALMOMT¿nsfÜm
;

26 
	gM3DMašFigu»O±imiz”
::
	$M3DMašFigu»O±imiz”
(
M©ch
 * 
m
, 
couÁ
è: 
	$•sÚ
(0)

28 
ty³
 = 
MašFigu»
;

30 
»fObjeù
 = 
NULL
;

31 
addToResidueObjeù
 = 
NULL
;

32 
m©ch
 = 
m
;

34 
´obËm
 = 
NULL
;

35 
w¿µ”ProbËm
 = 
NULL
;

37 
numP¬am‘”s
 = 
couÁ
;

38 
couÁ”
 = 0;

40 
Ï¡Be¡X
 = 
Ãw
 
VeùÜ
 *[1];

41 
Ï¡Be¡XSize
 = 1;

42 *
Ï¡Be¡X
 = 
Ãw
 
VeùÜ
;

44 #ifdeà
OPTIMIZATION_VISUALIZER


45 ià(
m©ch
) {

46 cÚ¡ 
M©ch
::
m©chResuÉ
 * 
»suÉs
 = 
m©ch
->
	`g‘Figu»SgeResuÉs
();

47 ià(
»suÉs
) {

48 
glob®LogMªag”
.
©Œibu‹Names
[0] = "Objective Function";

49 
i
 = 0; i < 
MAX_NUM_FIG_MATCH_RESULTS
; i++) {

50 
glob®LogMªag”
.
©Œibu‹Names
[1 + 
i
] = 
»suÉs
[i].
Çme
;

52 
glob®LogMªag”
.
numA‰ribu‹s
 = 
MAX_NUM_FIG_MATCH_RESULTS
+1;

56 
	}
}

58 
	gM3DMašFigu»O±imiz”
::~
	$M3DMašFigu»O±imiz”
()

60 ià(
»fObjeù
 !ğ
NULL
)

61 
d–‘e
 
»fObjeù
;

62 ià(
´obËm
 !ğ
NULL
)

63 
d–‘e
 
´obËm
;

64 ià(
w¿µ”ProbËm
 !ğ
NULL
)

65 
d–‘e
 
w¿µ”ProbËm
;

66 ià(
boundsFunùiÚ
 !ğ
NULL
)

67 
d–‘e
 
boundsFunùiÚ
;

70 #ifdeà
BINARY


71 
glob®V”bos™y
;

72 ià(
glob®V”bos™y
 > -1) {

73 cÚ¡ 
ŞdP»cisiÚ
 = 
cout
.
	`´ecisiÚ
(18);

74 
cout
 << " bestx=";

75 
i
 = 0; i < (
Ï¡Be¡X
[0])->
	`size
(); i++)

76 
cout
 << ' ' << 
	`£tw
(20è<< (*(
Ï¡Be¡X
[0]))(
i
);

77 
cout
 << '\n';

80 cÚ¡ 
VeùÜ
& 
x
 = *
Ï¡Be¡X
[0];

81 ifĞ
x
.
	`size
() == 8 || x.size() == 7 ) {

82 
VeùÜ3D
 
Œªs
;

83 
Qu©
 
fš®RÙ
;

84 
VeùÜ3D
 
axis
;

85 
ªgË
;

86 
sÿË
;

87 
tubePhi
;

88 
Œªs
.
	`£t
(
	`x
(0), x(1), x(2));

89 
Œªs
 *ğ
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
);

91 
axis
.
	`£t
(
	`x
(3), x(4), x(5));

92 
ªgË
 = 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
è* 
axis
.
	`nÜm®ize
();

93 
fš®RÙ
.
	`£tAxisAngË
(
axis
, 
ªgË
);

94 
sÿË
 = 
	`exp
(
	`tunšgWt
(
Figu»SÿËFaùÜ
è* 
	`x
(7));

95 
tubePhi
 = 
	`x
(6è* 
	`tunšgWt
(
Figu»TubePhiFaùÜ
);

96 
cout
 << "bestSim: "

97 << 
	`£tw
(20è<< 
Œªs
.
	`g‘X
() << ' '

98 << 
	`£tw
(20è<< 
Œªs
.
	`g‘Y
() << ' '

99 << 
	`£tw
(20è<< 
Œªs
.
	`g‘Z
() << ' '

100 << 
	`£tw
(20è<< 
fš®RÙ
.
	`g‘X
() << ' '

101 << 
	`£tw
(20è<< 
fš®RÙ
.
	`g‘Y
() << ' '

102 << 
	`£tw
(20è<< 
fš®RÙ
.
	`g‘Z
() << ' '

103 << 
	`£tw
(20è<< 
fš®RÙ
.
	`g‘W
() << ' '

104 << 
	`£tw
(20è<< 
sÿË
 << ' '

105 << 
	`£tw
(20è<< 
tubePhi
 << 
’dl
;

107 
cout
.
	`æush
();

108 
cout
.
	`´ecisiÚ
(
ŞdP»cisiÚ
);

111 
	}
}

113 #iâdeà
BINARY


115 
	gM3DMašFigu»O±imiz”
::
	$£tP’®tyWeightsInM©ch
(cÚ¡ * 
³ÇÉyNames
,

116 cÚ¡ * 
³ÇÉyWeights
, 
numP’®t›s
)

118 
wt
;

120 ià(
m©ch
 =ğ
NULL
) {

121 
cout
 << "Unableoransfer…enalties before Matchƒxists\n";

124 ià(
numP’®t›s
 <= 0)

127 
i
 = 0; i < 
numP’®t›s
; i++) {

128 
³ÇÉyNames
[
i
]) {

129 
GpFigu»Hi¡og¿mM©ch
:

130 
wt
 = 
³ÇÉyWeights
[
i
];

132 
GpFigu»MuÉiP©chM©ch
:

133 
wt
 = 
³ÇÉyWeights
[
i
];

135 
Figu»DQFM©ch
:

136 
wt
 = 
³ÇÉyWeights
[
i
];

138 
Figu»Mah®ªobisM©ch
:

139 
wt
 = 
M3DMašFigu»ProbËm
::
PENALTY_SCALE_FACTOR
*
³ÇÉyWeights
[
i
];

141 
GpFigu»Geom‘ryWeight
:

142 
wt
 = 
M3DMašFigu»ProbËm
::
PENALTY_SCALE_FACTOR
*
³ÇÉyWeights
[
i
];

144 
GpFigu»IÁ”ObjeùWeight
:

145 
wt
 = 
M3DMašFigu»ProbËm
::
CONSTRAINT_PENALTY_SCALE_FACTOR
*
³ÇÉyWeights
[
i
];

148 
GpFigu»ProfeM©ch
:

151 
cout
 << "UnknowÀ³ÇÉy weight: " << 
	`tunšgShÜtName
(
³ÇÉyNames
[
i
]è<< 
’dl
;

154 
m©ch
->
	`£tWeight
(
ty³
, 
³ÇÉyNames
[
i
], 
wt
);

156 
	}
}

160 
boŞ
 
	gM3DMašFigu»O±imiz”
::
	$š™Ÿlize
(
M3DObjeù
 * 
»ã»nûObjeù
,

161 
Œ“Index
)

163 
Image3D
 * 
image
;

164 
•s
;

166 #ifdeà
OPTIMIZATION_VISUALIZER


167 
glob®LogMªag”
.
	`£tO±imiz”
(
this
);

170 #ifdeà
DEBUG


171 
cout
 << "M3DMainFigureOptimizer::initialize()\n";

173 
Œ“_šdex
 = 
Œ“Index
;

175 ià(
m©ch
 =ğ
NULL
 || 
»ã»nûObjeù
 =ğNULL || 
´obËm
 == NULL) {

176 
cout
 << "E¼Ü: M©ch,„eã»nûObjeù, o¸´obËm i NULL" << 
’dl
;

177  
çl£
;

180 
»fObjeù
 = 
»ã»nûObjeù
->
	`assign
();

181 
Ï¡Be¡Objeù
 = 
»fObjeù
->
	`assign
();

183 
m©ch
->
	`»£tReã»nûObjeù
(
»fObjeù
);

185 #ifdeà
BINARY


186 ià(
	`tunšgWt
(
BpFigu»RS¿dP’®ty
) != 0.0) {

187 
m©ch
->
	`£tUpAtomP»diùÜ
(
Œ“Index
);

191 
image
 = 
m©ch
->
	`g‘T¬g‘Image
();

192 ià(
image
 =ğ
NULL
) {

193 
cout
 << "E¼Ü: UÇbËØš™Ÿlizfigu» o±imiz”;‚Øimage" << 
’dl
;

194  
çl£
;

197 
´obËm
->
	`š™Ÿlize
(
m©ch
, 
»fObjeù
, 
Œ“Index
);

198 
´obËm
->
	`£tAddToResidueObjeù
Ğ
addToResidueObjeù
 );

199 
numP¬am‘”s
 = 
´obËm
->
	`·¿m‘”CouÁ
();

201 
VeùÜ
 
	`¡¬t
(
numP¬am‘”s
);

207 cÚ¡ * 
cÛffic›ÁLi¡
 = 
	`tunšgSŒ
(
Figu»S¹šgCÛffic›Ás
);

209 ifĞ
cÛffic›ÁLi¡
 =ğ
NULL
 ) {

210 
¡¬t
.
	`£tAÎ
(0.0);

213 
cout
 << "Using starting coefficients <";

214 
i¡ršg¡»am
 
	`tok’s
(
cÛffic›ÁLi¡
);

215 * 
d¡¬t
 = 
Ãw
 [
numP¬am‘”s
];

216 
couÁ
 = 0;

217  
i
 = 0; i !ğ
numP¬am‘”s
; ++i ) {

218 
tok’s
 >> 
d¡¬t
[
i
];

219 ifĞ!
tok’s
 ) {

222 
	`¡¬t
(
i
èğ
d¡¬t
[i];

223 
cout
 << 
d¡¬t
[
i
] << ",";

224 ++
couÁ
;

226 
cout
 << "couÁ:" << 
couÁ
 << "Ò“ded:" << 
numP¬am‘”s
 << ")>" << 
’dl
 << 
æush
;

227 ifĞ
couÁ
 !ğ
numP¬am‘”s
 ) {

228 
cout
 << "ERROR: Numb” oà·¿m‘” dØnÙ m©ch" << 
’dl
 << 
æush
;

229 
	`ex™
(-1);

237 
o¡ršg¡»am
 
»mašs
;

239 
‹mp
;

241 
tok’s
)

243 
tok’s
 >> 
‹mp
;

244 
»mašs
 << 
‹mp
 << " ";

247 (è
tuÃV®s
.
	`£tSŒšg
(
Figu»S¹šgCÛffic›Ás
, 
»mašs
.
	`¡r
().
	`c_¡r
());

249 
d–‘e
[] 
d¡¬t
;

252 
•sÚ
.
	`£tSize
(
numP¬am‘”s
);

253 
•s
 = 
	`tunšgWt
(
Figu»EpsÚ
);

254 #ifdeà
BINARY


255 
•sÚ
.
	`£tAÎ
(
•s
);

257 ià(
•s
 < 0.0)

258 
•s
 = 
	`g‘Num”iÿlD”iv©iveEpsÚ
();

259 
•sÚ
.
	`£tAÎ
(
•s
);

263 ià(
w¿µ”ProbËm
 !ğ
NULL
)

264 
d–‘e
 
w¿µ”ProbËm
;

266 
w¿µ”ProbËm
 = 
Ãw
 
	`Num”iÿlFunùiÚ
(*
´obËm
, 
•sÚ
);

268 
	`£tO±imiz”Pos™iÚ
(
¡¬t
);

271 
Ï¡Be¡V®
 = 
´obËm
->
	`ev®u©e
(
¡¬t
);

272 *(
Ï¡Be¡X
[0]èğ
¡¬t
;

273 
Ï¡P’®ty
 = 
´obËm
->
	`g‘La¡P’®ty
();

274 (
dyÇmic_ÿ¡
<
CÚjug©eG¿d›ÁM‘hod
 *>(
m‘hod
))->
	`g‘FunùiÚ
().
	`£tEv®u©iÚCo¡
(0);

275 ifĞ
Ï¡Be¡Objeù
 ) {

276 
d–‘e
 
Ï¡Be¡Objeù
;

278 
Ï¡Be¡Objeù
 = 
	`ü—‹T¬g‘Objeù
(*(
Ï¡Be¡X
[0]));

280  
Œue
;

281 
	}
}

283 
	gM3DMašFigu»O±imiz”
::
	$»š™Ÿlize
()

285 #ifdeà
DEBUG


286 
cout
 << "M3DMainFigureOptimizer::reinitialize()\n";

288 if(
w¿µ”ProbËm
 !ğ
NULL
)

289 
d–‘e
 
w¿µ”ProbËm
;

291 
•sÚ
 *= 0.5;

292 
w¿µ”ProbËm
 = 
Ãw
 
	`Num”iÿlFunùiÚ
(*
´obËm
, 
•sÚ
);

294 
	`£tO±imiz”Pos™iÚ
(*(
Ï¡Be¡X
[0]));

295 
	}
}

297 
boŞ
 
	gM3DMašFigu»O±imiz”
::
	$³rfÜmI‹¿tiÚs
(
nI‹¿tiÚs
)

299 
i
;

301 #ifdeà
DEBUG


302 
cout
 << "M3DMainFigureOptimizer::performIterations() called for "

303 << 
nI‹¿tiÚs
 << " i‹¿tiÚs" << 
’dl
;

306 ià(
m‘hod
 =ğ
NULL
)

307  
çl£
;

309 
i
 = 0;

310 
i
 < 
nI‹¿tiÚs
 && ! 
	`isFšished
()) {

311 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`³rfÜmI‹¿tiÚ
();

312 
i
++;

315 ià(
m‘hod
->
	`g‘Be¡Ev”V®ue
(è< 
Ï¡Be¡V®
) {

316 
Ï¡Be¡V®
 = ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`g‘Be¡Ev”V®ue
();

317 *(
Ï¡Be¡X
[0]èğ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`g‘Be¡Ev”X
();

318 
Ï¡P’®ty
 = 
´obËm
->
	`g‘La¡P’®ty
();

319 #ifdeà
DEBUG


320 
cout
 << "Ï¡P’®ty = " << 
Ï¡P’®ty
 << 
’dl
;

323 ià(
Ï¡Be¡Objeù
 !ğ
NULL
)

324 
d–‘e
 
Ï¡Be¡Objeù
;

325 
Ï¡Be¡Objeù
 = 
	`ü—‹T¬g‘Objeù
(*(
Ï¡Be¡X
[0]));

326 #ifdeà
BINARY


327 
glob®V”bos™y
;

328 ià(
glob®V”bos™y
 > -1) {

329 cÚ¡ 
ŞdP»cisiÚ
 = 
cout
.
	`´ecisiÚ
(18);

330 
cout
 << " bestx=";

331 
i
 = 0; i < (
Ï¡Be¡X
[0])->
	`size
(); i++)

332 
cout
 << ' ' << 
	`£tw
(20è<< (*(
Ï¡Be¡X
[0]))(
i
);

333 
cout
 << '\n';

334 
cout
.
	`æush
();

335 
cout
.
	`´ecisiÚ
(
ŞdP»cisiÚ
);

340 #ifdeà
BINARY


341 ià(
	`isFšished
()) {

342 if(
couÁ”
 < 2)

343 
	`»š™Ÿlize
();

344 
couÁ”
++;

347  
Œue
;

348 
	}
}

350 
M3DObjeù
 * 
	gM3DMašFigu»O±imiz”
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 & 
v
)

352 
figu»Id
;

354 ià(
´obËm
 =ğ
NULL
)

355  
NULL
;

357  
´obËm
->
	`ü—‹T¬g‘Objeù
(
v
, 
figu»Id
, 
çl£
);

358 
	}
}

360 
	gM3DMašFigu»O±imiz”
::
	$£tO±imiz”Pos™iÚ
(cÚ¡ 
VeùÜ
 & 
¡¬t
)

362 ià(
m‘hod
 !ğ
NULL
)

363 
d–‘e
 
m‘hod
;

365 
m‘hod
 = 
Ãw
 
	`CÚjug©eG¿d›ÁM‘hod
(*
w¿µ”ProbËm
, 
¡¬t
);

366 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`£tB»ÁLš—rS—rchBoundFaùÜ
(
	`tunšgWt
(
B»ÁLš—rS—rchBoundFaùÜ
));

367 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`£tBoundsFunùiÚ
(
boundsFunùiÚ
);

368 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`£tP¬am‘”TŞ”ªû
(
•sÚ
);

369 #iâdeà
BINARY


370 
Ï¡Be¡V®
 = 
´obËm
->
	`ev®u©e
(
¡¬t
);

371 *(
Ï¡Be¡X
[0]èğ
¡¬t
;

372 
Ï¡P’®ty
 = 
´obËm
->
	`g‘La¡P’®ty
();

373 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`g‘FunùiÚ
().
	`£tEv®u©iÚCo¡
(0);

375 
	}
}

	@M3DMainFigureProblem.cpp

1 
	~"M3DMašFigu»ProbËm.h
"

2 
	~"M3DFigu»ElÚg©”.h
"

3 
	~"Tunšg.h
"

8 cÚ¡ 
	gM3DMašFigu»ProbËm
::
MAIN_FIGURE_MAX_RETURN
 = 1.7e308;

9 cÚ¡ 
	gM3DMašFigu»ProbËm
::
PENALTY_SCALE_FACTOR
 = 1.0;

10 cÚ¡ 
	gM3DMašFigu»ProbËm
::
CONSTRAINT_PENALTY_SCALE_FACTOR
 = 0.02;

13 
	gM3DMašFigu»ProbËm
::
	$M3DMašFigu»ProbËm
()

15 
m©ch
 = 
NULL
;

16 
»fObjeù
 = 
NULL
;

17 
addToResidueObjeù
 = 
NULL
;

18 
Œ“_šdex
 = 0;

19 
Ï¡P’®ty
 = 0.0;

20 
mašFigProbËmSimT¿nsfÜm
.
	`£tToId’t™y
();

21 
	}
}

23 
	gM3DMašFigu»ProbËm
::
	$š™Ÿlize
(
M©ch
 * 
m
, 
M3DObjeù
 * 
»ã»nûObjeù
,

24 
Œ“Index
)

26 
m©ch
 = 
m
;

27 
»fObjeù
 = 
»ã»nûObjeù
;

28 
Œ“_šdex
 = 
Œ“Index
;

29 #iâdeà
BINARY


30 
mašFigProbËmSimT¿nsfÜm
 = 
m©ch
->
	`g‘In™ŸlT¿nsfÜm
();

33 #ifdeà
DISPLAY_PENALTIES


34 
¡d
::
cout
 << "Main figure…enalties: \n";

36 
	}
}

38 #ifdeà
OPTIMIZATION_VISUALIZER


40 
	gM3DMašFigu»ProbËm
::
	$cİyResuÉsToVisu®iz”
(cÚ¡ 
VeùÜ
 * 
x
, 
tÙ®P’®ty
) {

41 ià(
x
 && 
m©ch
) {

42 
glob®LogMªag”
.
	`begšEv’t
(
x
);

43 cÚ¡ 
M©ch
::
m©chResuÉ
 * 
»suÉs
 = 
m©ch
->
	`g‘Figu»SgeResuÉs
();

44 ià(
»suÉs
) {

45 
wtM©ch
;

46 
i
 = 0; i < 
MAX_NUM_FIG_MATCH_RESULTS
; i++) {

47 ià(
»suÉs
[
i
].
u£It
)

48 
wtM©ch
 = 
	`tunšgWt
(
»suÉs
[
i
].
tunšgP¬m
)*»suÉs[i].
v®ue
;

50 
wtM©ch
 = 0.0;

51 
glob®LogMªag”
.
	`£tV®ue
(1 + 
i
, 
wtM©ch
);

53 
glob®LogMªag”
.
	`£tV®ue
(0, 
tÙ®P’®ty
);

56 
	}
}

	@M3DPrimitiveCorrector.cpp

1 
	~"M3DPrim™iveCÜ»ùÜ.h
"

11 
	gM3DPrim™iveCÜ»ùÜ
::
	$´ediùPrim™ive
(
M3DPrim™ive
 & 
ÃwP»diù“
,

12 cÚ¡ 
M3DPrim™ive
 & 
»ã»nûP»diùÜ
,

13 cÚ¡ 
M3DPrim™ive
 & 
»ã»nûP»diù“
,

14 cÚ¡ 
M3DPrim™ive
 & 
ÃwP»diùÜ
)

16 
VeùÜ3D
 
lškVeùÜ
;

17 
Qu©
 
šv”£P»diùÜQ
,

18 
ÃwQ
,

19 
lškRÙ©iÚ
;

20 
sÿË
;

22 
lškVeùÜ
 = 
»ã»nûP»diù“
.
	`g‘X
(è- 
»ã»nûP»diùÜ
.getX();

24 
šv”£P»diùÜQ
 = 
»ã»nûP»diùÜ
.
	`g‘Q
().
	`cÚj
();

25 
ÃwQ
 = 
ÃwP»diùÜ
.
	`g‘Q
(è* 
šv”£P»diùÜQ
 * 
»ã»nûP»diù“
.getQ();

26 
lškRÙ©iÚ
 = 
ÃwP»diùÜ
.
	`g‘Q
(è* 
šv”£P»diùÜQ
;

28 
lškRÙ©iÚ
.
	`rÙ©eVeùÜ
(
lškVeùÜ
);

30 
sÿË
 = 
ÃwP»diùÜ
.
	`g‘R
(è/ 
»ã»nûP»diùÜ
.getR();

32 
ÃwP»diù“
.
	`£tX
(
ÃwP»diùÜ
.
	`g‘X
(è+ 
lškVeùÜ
);

33 
ÃwP»diù“
.
	`£tQ
(
ÃwQ
);

34 
ÃwP»diù“
.
	`£tR
(
sÿË
 * 
»ã»nûP»diù“
.
	`g‘R
());

35 
ÃwP»diù“
.
	`£tTh‘a
(
»ã»nûP»diù“
.
	`g‘Th‘a
());

36 
	}
}

44 
	gM3DPrim™iveCÜ»ùÜ
::
	$av”agePrim™ives
(
M3DPrim™ive
 & 
avePrim
,

45 cÚ¡ 
M3DPrim™ive
 & 
´im1
,

46 cÚ¡ 
M3DPrim™ive
 & 
´im2
, 
weight
)

48 
Qu©
 
q
;

50 if(
weight
 == 0.0)

51 
avePrim
 = 
´im2
;

52 if(
weight
 == 1.0)

53 
avePrim
 = 
´im1
;

56 
avePrim
.
	`£tX
(
weight
 * 
´im1
.
	`g‘X
(è+ (1.0 - weightè* 
´im2
.getX());

57 
avePrim
.
	`£tQ
(
q
.
	`¦”p
(
weight
, 
´im1
.
	`g‘Q
(), 
´im2
.getQ()));

58 
avePrim
.
	`£tR
(
weight
 * 
´im1
.
	`g‘R
(è+ (1.0 - weightè* 
´im2
.getR());

59 
avePrim
.
	`£tTh‘a
(
weight
 * 
´im1
.
	`g‘Th‘a
() +

60 (1.0 - 
weight
è* 
´im2
.
	`g‘Th‘a
());

62 
	}
}

	@M3DRegistrationOptimizer.cpp

1 
	~<f¡»am
>

2 
	~<m©h.h
>

3 
	~"O±imiz”Ba£.h
"

4 
	~"M3DRegi¡¿tiÚO±imiz”.h
"

5 
	~"Tunšg.h
"

10 cÚ¡ 
	gMIN_PENALTY_WEIGHT
 = -1.0;

11 cÚ¡ 
	gMIN_PENALTY_WEIGHT_EXP
 = 0.0;

12 cÚ¡ 
	gMAX_PENALTY_WEIGHT_EXP
 = 10.0;

13 cÚ¡ 
	gPENALTY_WEIGHT_SCALE_FACTOR
 = 80.0;

15 
usšg
 
Çme¥aû
 
	g¡d
;

17 
	gM3DRegi¡¿tiÚO±imiz”
::
	$M3DRegi¡¿tiÚO±imiz”
(
boŞ
 
ad­tive
)

19 
ty³
 = 
Regi¡¿tiÚ
;

20 
ad­t
 = 
ad­tive
;

22 
´obËm
 = 
NULL
;

23 
w¿µ”ProbËm
 = 
NULL
;

24 
boundsFunùiÚ
 = 
NULL
;

25 
couÁ”
 = 0;

26 
numP¬am‘”s
 = 7;

29 
	`£tP’®tyWeight
(0.5);

31 
Ï¡P’®ty
 = 0.0;

32 
Ï¡Be¡T¿nsfÜm©iÚ
.
	`£tToId’t™y
();

34 
Ï¡Be¡X
 = 
Ãw
 
VeùÜ
 *[1];

35 
Ï¡Be¡XSize
 = 1;

36 *
Ï¡Be¡X
 = 
Ãw
 
VeùÜ
;

37 
	}
}

39 
	gM3DRegi¡¿tiÚO±imiz”
::~
	$M3DRegi¡¿tiÚO±imiz”
()

41 if(
´obËm
 !ğ
NULL
)

42 
d–‘e
 
´obËm
;

43 if(
w¿µ”ProbËm
 !ğ
NULL
)

44 
d–‘e
 
w¿µ”ProbËm
;

45 if(
boundsFunùiÚ
 !ğ
NULL
)

46 
d–‘e
 
boundsFunùiÚ
;

48 
	}
}

50 
	gM3DRegi¡¿tiÚO±imiz”
::
	$£tP’®tyWeight
(
w
)

56 
³ÇÉyWeight
 = 
w
 * 
PENALTY_WEIGHT_SCALE_FACTOR
;

58 if(
´obËm
 !ğ
NULL
)

59 
´obËm
->
	`£tP’®tyWeight
(
³ÇÉyWeight
);

60 
	}
}

62 
	gM3DRegi¡¿tiÚO±imiz”
::
	$š™Ÿlize
(
M©ch
 * 
m©ch
)

64 
Image3D
 * 
image
;

66 #ifdeà
DEBUG


67 
cout
 << "M3DRegistrationOptimizer::initialize()\n";

69 if(
m©ch
 =ğ
NULL
 || m©ch->
	`g‘Reã»nûObjeù
() == NULL)

72 ià(
	`isAd­tive
()) {

73 if(
´obËm
 =ğ
NULL
)

76 
´obËm
->
	`š™Ÿlize
(
m©ch
, 
³ÇÉyWeight
, 0.0);

79 if(
´obËm
 !ğ
NULL
)

80 
d–‘e
 
´obËm
;

82 
´obËm
 = 
Ãw
 
	`M3DRegi¡¿tiÚProbËm
(
m©ch
, 0.0);

83 if(
´obËm
 =ğ
NULL
)

86 
´obËm
->
	`£tP’®tyWeight
(
³ÇÉyWeight
);

89 
image
 = 
m©ch
->
	`g‘T¬g‘Image
();

90 if(
image
 =ğ
NULL
)

93 
VeùÜ
 
	`¡¬t
(
numP¬am‘”s
);

94 
•sÚ
.
	`£tSize
(
numP¬am‘”s
);

96 ià(
	`isAd­tive
()) {

97 
¡¬t
.
	`£tAÎ
(0.0);

98 
•sÚ
.
	`£tAÎ
(1.0 / (64.0 * 
M3DRegi¡¿tiÚProbËm
::
ENSEMBLE_PGA_SCALE_FACTOR
));

101 
•sÚ
 = 
	`VeùÜ
(7, 0.001, 0.001, 0.001, 0.001, 0.001, 0.001, 0.003);

103 if(
w¿µ”ProbËm
 !ğ
NULL
)

104 
d–‘e
 
w¿µ”ProbËm
;

106 
w¿µ”ProbËm
 = 
Ãw
 
	`Num”iÿlFunùiÚ
(*
´obËm
, 
•sÚ
);

108 
	`£tO±imiz”Pos™iÚ
(
¡¬t
);

109 
	}
}

111 
	gM3DRegi¡¿tiÚO±imiz”
::
	$»š™Ÿlize
()

113 if(
m‘hod
 !ğ
NULL
)

114 
d–‘e
 
m‘hod
;

115 ià(
w¿µ”ProbËm
 !ğ
NULL
)

116 
d–‘e
 
w¿µ”ProbËm
;

118 
•sÚ
 *= 0.5;

119 
w¿µ”ProbËm
 = 
Ãw
 
	`Num”iÿlFunùiÚ
(*
´obËm
, 
•sÚ
);

121 
	`£tO±imiz”Pos™iÚ
(*(
Ï¡Be¡X
[0]));

122 
	}
}

124 
boŞ
 
	gM3DRegi¡¿tiÚO±imiz”
::
	$³rfÜmI‹¿tiÚs
(
nI‹¿tiÚs
)

126 #ifdeà
DEBUG


127 
cout
 << "M3DRegistrationOptimizer::performIterations()\n";

129 if(
m‘hod
 =ğ
NULL
)

130  
çl£
;

132 
i
 = 0;

133 
i
 < 
nI‹¿tiÚs
 && ! 
	`isFšished
())

135 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`³rfÜmI‹¿tiÚ
();

136 
i
++;

139 if(
m‘hod
->
	`g‘Be¡Ev”V®ue
(è< 
Ï¡Be¡V®
)

141 
Ï¡Be¡V®
 = 
m‘hod
->
	`g‘Be¡Ev”V®ue
();

142 *(
Ï¡Be¡X
[0]èğ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`g‘Be¡Ev”X
();

143 ià(
	`isAd­tive
()) {

144 
Ï¡P’®ty
 = 
´obËm
->
	`g‘P’®ty
();

146 ià(
Ï¡Be¡Objeù
 !ğ
NULL
)

147 
d–‘e
 
Ï¡Be¡Objeù
;

148 
Ï¡Be¡Objeù
 = 
	`ü—‹T¬g‘Objeù
(*(
Ï¡Be¡X
[0]));

150 #ifdeà
DEBUG


151 
sumX
 = 0.0;

152 
i
 = 0; i < (
Ï¡Be¡X
[0])->
	`size
(); i++)

153 
¡d
::
cout
 << (*(
Ï¡Be¡X
[0]))(
i
)*
M3DRegi¡¿tiÚProbËm
::
ENSEMBLE_PGA_SCALE_FACTOR
 << ' ';

154 
¡d
::
cout
<<
’dl
;

159 
Ï¡P’®ty
 = 
´obËm
->
	`compu‹P’®ty
(*(
Ï¡Be¡X
[0]));

160 
´obËm
->
	`compu‹T¿nsfÜm©iÚ
(
Ï¡Be¡T¿nsfÜm©iÚ
, *(
Ï¡Be¡X
[0]));

164 ià(
	`isAd­tive
()) {

165 #ifdeà
DEBUG


166 if(
m‘hod
->
	`isFšished
())

168 
cout
 << "m‘hod->isFšished =ğŒue. couÁ” =ğ" << 
couÁ”
 << 
’dl
;

169 if(
couÁ”
 < 4)

170 
couÁ”
++;

175  
Œue
;

176 
	}
}

178 
M3DObjeù
 * 
	gM3DRegi¡¿tiÚO±imiz”
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 & 
v
)

180 ià(
´obËm
 =ğ
NULL
)

181  
NULL
;

183  
´obËm
->
	`ü—‹T¬g‘Objeù
(
v
);

184 
	}
}

186 
	gM3DRegi¡¿tiÚO±imiz”
::
	$£tO±imiz”Pos™iÚ
(cÚ¡ 
VeùÜ
 & 
¡¬t
)

188 ià(
m‘hod
 !ğ
NULL
)

189 
d–‘e
 
m‘hod
;

191 
m‘hod
 = 
Ãw
 
	`CÚjug©eG¿d›ÁM‘hod
(*
w¿µ”ProbËm
, 
¡¬t
);

193 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`£tB»ÁLš—rS—rchBoundFaùÜ
(
	`tunšgWt
(
B»ÁLš—rS—rchBoundFaùÜ
));

194 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`£tBoundsFunùiÚ
(
boundsFunùiÚ
);

195 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`£tP¬am‘”TŞ”ªû
(
•sÚ
);

197 
Ï¡Be¡V®
 = 
´obËm
->
	`ev®u©e
(
¡¬t
);

198 *(
Ï¡Be¡X
[0]èğ
¡¬t
;

200 ià(
	`isAd­tive
()) {

201 
Ï¡P’®ty
 = 
´obËm
->
	`g‘P’®ty
();

203 ià(
Ï¡Be¡Objeù
 !ğ
NULL
)

204 
d–‘e
 
Ï¡Be¡Objeù
;

205 
Ï¡Be¡Objeù
 = 
´obËm
->
	`ü—‹T¬g‘Objeù
(*(
Ï¡Be¡X
[0]));

208 
Ï¡P’®ty
 = 
´obËm
->
	`compu‹P’®ty
(
¡¬t
);

209 
´obËm
->
	`compu‹T¿nsfÜm©iÚ
(
Ï¡Be¡T¿nsfÜm©iÚ
, *(
Ï¡Be¡X
[0]));

213 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`g‘FunùiÚ
().
	`£tEv®u©iÚCo¡
(0);

215 
	}
}

	@M3DRegistrationPGAOptimizer.cpp

1 
	~<f¡»am
>

2 
	~<¡dio.h
>

3 
	~<m©h.h
>

4 
	~"O±imiz”Ba£.h
"

5 
	~"M3DRegi¡¿tiÚPGAO±imiz”.h
"

7 
usšg
 
Çme¥aû
 
	g¡d
;

9 
	gM3DRegi¡¿tiÚPGAO±imiz”
::
	$M3DRegi¡¿tiÚPGAO±imiz”
(
M3DPGASts
 * 
pgaPŒ
, 
Üd”
)

10 : 
	$M3DRegi¡¿tiÚO±imiz”
()

12 
boundsFunùiÚ
 = 
Ãw
 
M3DRegi¡¿tiÚPGAProbËmBoundsFunùiÚ
;

13 
´obËm
 = 
Ãw
 
	`M3DRegi¡¿tiÚPGAProbËm
();

14 ((
M3DRegi¡¿tiÚPGAProbËm
 *è
´obËm
è-> 
	`£tPGA
(
pgaPŒ
, 
Üd”
);

15 
numP¬am‘”s
 = ((
M3DRegi¡¿tiÚPGAProbËm
 *è
´obËm
)->
	`·¿m‘”CouÁ
();

16 
	}
}

	@M3DRegistrationPGAProblem.cpp

1 
	~<m©h.h
>

2 
	~<io¡»am
>

3 
	~"M3DRegi¡¿tiÚPGAProbËm.h
"

13 
	#USE_MAHALANOBIS_PENALTY


	)

16 
usšg
 
Çme¥aû
 
	g¡d
;

19 
	gM3DRegi¡¿tiÚPGAProbËm
::
	$M3DRegi¡¿tiÚPGAProbËm
() :

20 
	$M3DRegi¡¿tiÚProbËm
()

22 
	}
}

24 
M3DRegi¡¿tiÚPGAProbËm
::
	$·¿m‘”CouÁ
() const

26  
pga
->
	`g‘PGD©aPŒ
(
Üd”
)->
numPGs
 + 7;

27 
	}
}

29 
	gM3DRegi¡¿tiÚPGAProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 &
x
)

31 
m©chV®
;

32 
³ÇÉyV®
;

33 
cÚ¡¿štP’®ty
;

34 
tÙ®P’®ty
;

36 
M3DObjeù
 * 
rg‘Objeù
;

37 
i
;

39 
ev®u©iÚCo¡
 += 1;

41 ià(
m©ch
 =ğ
NULL
)

42  
ENSEMBLE_MAX_RETURN
;

44 
rg‘Objeù
 = 
	`ü—‹T¬g‘Objeù
(
x
);

47 
boŞ
 
cÚ¡¿štOÆy
 = 
Œue
;

48 ià(
cÚ¡¿štsP’®tyWeight
 =ğ
ENSEMBLE_CONSTRAINT_PENALTY_SCALE_FACTOR
) {

49 
m©chV®
 = 0.0;

50 
³ÇÉyV®
 = 0.0;

51 
cÚ¡¿štOÆy
 = 
çl£
;

54 #ifdeà
NO_MATCH_PENALTY


55 
m©chV®
 = 0.0;

57 
m©chV®
 = 
m©ch
->
	`compu‹Mod–M©ch
(
rg‘Objeù
);

60 #ifdeà
USE_MAHALANOBIS_PENALTY


61 ià(
³ÇÉyWeight
 > 0.0) {

62 
³ÇÉyV®
 = 0.0;

64 
i
 = 7; i < 
x
.
	`size
(); i++)

65 
³ÇÉyV®
 +ğ
	`x
(
i
) * x(i);

66 
³ÇÉyV®
 *ğ
³ÇÉyWeight
;

72 ià(
³ÇÉyWeight
 > 0.0)

73 
³ÇÉyV®
 = 
m©ch
->
	`compu‹Mod–P’®ty
(
rg‘Objeù
è* 
³ÇÉyWeight
;

76 
³ÇÉyV®
 = 0.0;

86 
cÚ¡¿štP’®ty
 = 0.0;

88 
Ï¡P’®ty
 = 
cÚ¡¿štP’®ty
 + 
³ÇÉyV®
;

89 
tÙ®P’®ty
 = (
Ï¡P’®ty
 - 
m©chV®
)*
ENSEMBLE_OBJECTIVE_SCALE_FACTOR
;

90 #ifdeà
DISPLAY_PENALTIES


91 
¡d
::
cout
 << " " << 
³ÇÉyV®
 << "Õ’W :" <<
³ÇÉyWeight
<<"èmod– + " << 
cÚ¡¿štP’®ty


92 << " cÚ¡¿šˆ- " << 
m©chV®
 << " m©ch = " << 
tÙ®P’®ty


93 << 
¡d
::
’dl
;

96 ià(
rg‘Objeù
 !ğ
NULL
)

97 
d–‘e
 
rg‘Objeù
;

99  
tÙ®P’®ty
;

100 
	}
}

103 
M3DObjeù
 * 
	gM3DRegi¡¿tiÚPGAProbËm
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 & 
x
)

108 
M3DObjeù
 * 
rg‘Objeù
 = 
pga
->
	`g‘M—nObjPŒ
()->
	`assign
();

110 if(
rg‘Objeù
 =ğ
NULL
 || 
x
.
	`size
(è!ğ
	`·¿m‘”CouÁ
())

111  
NULL
;

114 
¡d
::
veùÜ
<> 
v®s
;

115 
i
 = 7; i < 
x
.
	`size
(); i++)

116 
v®s
.
	`push_back
(
	`x
(
i
è* 
ENSEMBLE_PGA_SCALE_FACTOR
);

120 ià(! 
pga
->
	`doPGADefÜm
(
rg‘Objeù
, 
v®s
, 
Üd”
)) {

121 
¡d
::
cout
 << "E¼Ü iÀPGA defÜm©iÚ‡ˆM3DRegi¡¿tiÚPGAProbËm" << 
’dl
;

122  
NULL
;

126 
Sim¬™yT¿nsfÜm3D
 
š™ŸlT¿nsfÜm
 = *
rg‘Objeù
->
	`g‘T¿nsfÜm©iÚ
();

127 
rg‘Objeù
->
	`£Ëù
();

129 #ifdeà
UNFLIPPED


130 
VeùÜ3D
 
	`ûÁ”
(0.0, 1.0, 0.0);

132 
VeùÜ3D
 
	`ûÁ”
(0.0, 0.0, 0.0);

134 
Qu©
 
q
 = 
š™ŸlT¿nsfÜm
.
	`g‘RÙ©iÚ
();

135 
rg‘Objeù
->
	`rÙ©eBy
(
q
, 
ûÁ”
);

136 
rg‘Objeù
->
	`sÿËBy
(
š™ŸlT¿nsfÜm
.
	`g‘SÿË
(), 
ûÁ”
);

137 
rg‘Objeù
->
	`Œª¦©eBy
(
š™ŸlT¿nsfÜm
.
	`g‘T¿n¦©iÚ
());

140 
Sim¬™yT¿nsfÜm3D
 
hªdT¿nsfÜm
 = 
pga
->
	`g‘HªdPÏûm’tT¿nsfÜm
();

141 
q
 = 
hªdT¿nsfÜm
.
	`g‘RÙ©iÚ
();

142 
rg‘Objeù
->
	`rÙ©eBy
(
q
, 
ûÁ”
);

143 
rg‘Objeù
->
	`sÿËBy
(
hªdT¿nsfÜm
.
	`g‘SÿË
(), 
ûÁ”
);

144 
rg‘Objeù
->
	`Œª¦©eBy
(
hªdT¿nsfÜm
.
	`g‘T¿n¦©iÚ
());

147 #ifdeà
CHECK_SIMILARITY_TRANSFORM


148 
cout
<<"In™ŸlT¿nsfÜm iÀM3DRegi¡¿tiÚPGAProbËm::ü—‹T¬g‘Objeù()"<<
’dl
;

150 
š™ŸlT¿nsfÜm
.
	`g‘T¿n¦©iÚ
().
	`´št
();

151 
š™ŸlT¿nsfÜm
.
	`g‘RÙ©iÚ
().
	`´št
();

152 
cout
<<"sÿË "<<
š™ŸlT¿nsfÜm
.
	`g‘SÿË
()<<
’dl
;

154 
cout
<<"hªdT¿nsfÜm©iÚ iÀ M3DRegi¡¿tiÚPGAProbËm::ü—‹T¬g‘Objeù()"<<
’dl
;

156 
hªdT¿nsfÜm
.
	`g‘T¿n¦©iÚ
().
	`´št
();

157 
hªdT¿nsfÜm
.
	`g‘RÙ©iÚ
().
	`´št
();

158 
cout
<<"sÿË "<<
hªdT¿nsfÜm
.
	`g‘SÿË
()<<
’dl
;

162 
VeùÜ3D
 
Œªs
;

163 
ªgË
;

164 
VeùÜ3D
 
axis
;

165 
Qu©
 
fš®RÙ
;

166 
sÿË
;

168 
Œªs
.
	`£t
(
	`x
(0), x(1), x(2));

169 
Œªs
 *ğ
ENSEMBLE_TRANSLATION_FACTOR
;

171 
axis
.
	`£t
(
	`x
(3), x(4), x(5));

172 
ªgË
 = 
ENSEMBLE_ROTATION_FACTOR
 * 
axis
.
	`nÜm®ize
();

173 
fš®RÙ
.
	`£tAxisAngË
(
axis
, 
ªgË
);

177 
sÿË
 = 
	`exp
(
ENSEMBLE_SCALE_FACTOR
 * 
	`x
(6));

179 
rg‘Objeù
->
	`rÙ©eBy
(
fš®RÙ
, 
ûÁ”
);

180 
rg‘Objeù
->
	`sÿËBy
(
sÿË
, 
ûÁ”
);

181 
rg‘Objeù
->
	`Œª¦©eBy
(
Œªs
);

184 
pga
->
	`£tBe¡T¿nsfÜm
(
	`Sim¬™yT¿nsfÜm3D
(
Œªs
, 
fš®RÙ
, 
sÿË
));

186  
rg‘Objeù
;

187 
	}
}

190 
	gM3DRegi¡¿tiÚPGAProbËmBoundsFunùiÚ
::
	$M3DRegi¡¿tiÚPGAProbËmBoundsFunùiÚ
()

192 
bounds
 = 
	`VeùÜ
(8, 1.0, 1.0, 1.0, 
R_PI
, R_PI, R_PI, 1.0, 3.0);

193 
çùÜs
 = 
	`VeùÜ
(8, 
M3DRegi¡¿tiÚPGAProbËm
::
ENSEMBLE_TRANSLATION_FACTOR
,

194 
M3DRegi¡¿tiÚPGAProbËm
::
ENSEMBLE_TRANSLATION_FACTOR
,

195 
M3DRegi¡¿tiÚPGAProbËm
::
ENSEMBLE_TRANSLATION_FACTOR
,

196 
M3DRegi¡¿tiÚPGAProbËm
::
ENSEMBLE_ROTATION_FACTOR
,

197 
M3DRegi¡¿tiÚPGAProbËm
::
ENSEMBLE_ROTATION_FACTOR
,

198 
M3DRegi¡¿tiÚPGAProbËm
::
ENSEMBLE_ROTATION_FACTOR
,

199 
M3DRegi¡¿tiÚPGAProbËm
::
ENSEMBLE_SCALE_FACTOR
,

200 
M3DRegi¡¿tiÚPGAProbËm
::
ENSEMBLE_PGA_SCALE_FACTOR
);

201 
	}
}

	@M3DRegistrationProblem.cpp

1 
	~<m©h.h
>

2 
	~"M3DRegi¡¿tiÚProbËm.h
"

7 cÚ¡ 
	gM3DRegi¡¿tiÚProbËm
::
ENSEMBLE_OBJECTIVE_SCALE_FACTOR
 = 1.0;

8 cÚ¡ 
	gM3DRegi¡¿tiÚProbËm
::
ENSEMBLE_CONSTRAINT_PENALTY_SCALE_FACTOR
 = 0.02;

9 cÚ¡ 
	gM3DRegi¡¿tiÚProbËm
::
ENSEMBLE_MAX_RETURN
 = 1.7e308;

11 cÚ¡ 
	gM3DRegi¡¿tiÚProbËm
::
ENSEMBLE_PGA_SCALE_FACTOR
 = 200.0;

12 cÚ¡ 
	gM3DRegi¡¿tiÚProbËm
::
ENSEMBLE_TRANSLATION_FACTOR
 = 1.0;

13 cÚ¡ 
	gM3DRegi¡¿tiÚProbËm
::
ENSEMBLE_ROTATION_FACTOR
 = 8.0;

14 cÚ¡ 
	gM3DRegi¡¿tiÚProbËm
::
ENSEMBLE_SCALE_FACTOR
 = 12.0;

16 cÚ¡ 
	gOBJECTIVE_SCALE_FACTOR
 = 1.0;

20 
usšg
 
Çme¥aû
 
	g¡d
;

23 
	gM3DRegi¡¿tiÚProbËm
::
	$M3DRegi¡¿tiÚProbËm
()

25 
m©ch
 = 
NULL
;

26 
³ÇÉyWeight
 = 0.0;

27 
cÚ¡¿štsP’®tyWeight
 = 0.0;

28 
Ï¡P’®ty
 = 0.0;

29 
	}
}

31 
	gM3DRegi¡¿tiÚProbËm
::
	$š™Ÿlize
(
M©ch
 * 
_m©ch
, 
_³ÇÉyWeight
,

32 
_cÚ¡¿štP’®tyWeight
)

34 
m©ch
 = 
_m©ch
;

35 
³ÇÉyWeight
 = 
_³ÇÉyWeight
;

36 
cÚ¡¿štsP’®tyWeight
 = 
_cÚ¡¿štP’®tyWeight
;

37 #ifdeà
DISPLAY_PENALTIES


38 
¡d
::
cout
 << "Regi¡¿tiÚ…’®t›s: \n"<<¡d::
’dl
;

40 
	}
}

42 
	gM3DRegi¡¿tiÚProbËm
::
	$M3DRegi¡¿tiÚProbËm
(
M©ch
 * 
_m©ch
,

43 
_³ÇÉyWeight
)

45 
m©ch
 = 
_m©ch
;

46 
³ÇÉyWeight
 = 
_³ÇÉyWeight
;

47 #ifdeà
DISPLAY_PENALTIES


48 
¡d
::
cout
 << "Registration (simularity)…enalties: \n";

50 
	}
}

52 
	gM3DRegi¡¿tiÚProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 &
x
)

54 
m©chV®
;

55 
³ÇÉyV®
;

56 
tÙ®P’®ty
;

57 
Sim¬™yT¿nsfÜm3D
 
ŒªsfÜm
;

59 
ev®u©iÚCo¡
 += 1;

61 if(
m©ch
 =ğ
NULL
)

62  
MAX_RETURN
;

64 if(
x
.
	`size
(è!ğ
PARAMETER_SIZE
)

65  
MAX_RETURN
;

71 
	`compu‹T¿nsfÜm©iÚ
(
ŒªsfÜm
, 
x
);

72 #iâdeà
BINARY


73 
m©chV®
 = 
m©ch
->
	`compu‹Mod–M©ch
(
ŒªsfÜm
);

75 
m©chV®
 = 0.0;

77 
³ÇÉyV®
 = 0.0;

79 if(
³ÇÉyWeight
 > 0.0)

80 
³ÇÉyV®
 = 
m©ch
->
	`compu‹Mod–P’®ty
(
ŒªsfÜm
è* 
³ÇÉyWeight
;

82 
tÙ®P’®ty
 = 
OBJECTIVE_SCALE_FACTOR
*(
³ÇÉyV®
 - 
m©chV®
);

83 #ifdeà
DISPLAY_PENALTIES


84 
¡d
::
cout
 << " (" << 
³ÇÉyV®
 << " mod– - " << 
m©chV®
 << " match)*"

85 << 
OBJECTIVE_SCALE_FACTOR
 << " = " << 
tÙ®P’®ty
 << 
¡d
::
’dl
;

87  
tÙ®P’®ty
;

88 
	}
}

90 
	gM3DRegi¡¿tiÚProbËm
::
	$compu‹P’®ty
(cÚ¡ 
VeùÜ
 &
x
)

92 
Sim¬™yT¿nsfÜm3D
 
ŒªsfÜm
;

94 if(
m©ch
 =ğ
NULL
)

95  
MAX_RETURN
;

97 
	`compu‹T¿nsfÜm©iÚ
(
ŒªsfÜm
, 
x
);

98 if(
³ÇÉyWeight
 > 0.0)

99  
m©ch
->
	`compu‹Mod–P’®ty
(
ŒªsfÜm
è* 
³ÇÉyWeight
 *

100 
OBJECTIVE_SCALE_FACTOR
;

103 
	}
}

105 
	gM3DRegi¡¿tiÚProbËm
::
	$compu‹T¿nsfÜm©iÚ
(

106 
Sim¬™yT¿nsfÜm3D
 & 
ŒªsfÜm
, cÚ¡ 
VeùÜ
 &
x
)

108 
ŒªsfÜm
.
	`£tToId’t™y
();

110 if(
m©ch
 =ğ
NULL
)

112 if(
x
.
	`size
(è!ğ
PARAMETER_SIZE
)

115 
M3DObjeù
 * 
objeù
 = 
m©ch
->
	`g‘Reã»nûObjeù
();

116 if(
objeù
 =ğ
NULL
)

120 
Qu©
 
xRÙ
, 
yRÙ
, 
zRÙ
, 
fš®RÙ
;

121 
xRÙ
.
	`£tAxisAngË
(
	`VeùÜ3D
(1.0, 0.0, 0.0), 
ENSEMBLE_ROTATION_FACTOR
 * 
	`x
(3));

122 
yRÙ
.
	`£tAxisAngË
(
	`VeùÜ3D
(0.0, 1.0, 0.0), 
ENSEMBLE_ROTATION_FACTOR
 * 
	`x
(4));

123 
zRÙ
.
	`£tAxisAngË
(
	`VeùÜ3D
(0.0, 0.0, 1.0), 
ENSEMBLE_ROTATION_FACTOR
 * 
	`x
(5));

126 
fš®RÙ
 = 
zRÙ
 * 
yRÙ
 * 
xRÙ
;

127 
fš®RÙ
.
	`nÜm®ize
();

130 
sÿË
;

138 #ifdeà
EUCLIDEAN_ONLY


139 
sÿË
 = 1.0;

141 
sÿË
 = 
	`exp
(
ENSEMBLE_SCALE_FACTOR
 * 
	`x
(6));

145 
VeùÜ3D
 
	`Œªs
(
	`x
(0), x(1), x(2));

146 
Œªs
*=
ENSEMBLE_TRANSLATION_FACTOR
;

148 
ŒªsfÜm
.
	`sÿËBy
(
sÿË
);

149 
ŒªsfÜm
.
	`rÙ©eBy
(
fš®RÙ
);

150 
ŒªsfÜm
.
	`Œª¦©eBy
(
Œªs
);

151 
	}
}

	@M3DRegistrationSimilarityOptimizer.cpp

1 
	~<f¡»am
>

2 
	~<m©h.h
>

3 
	~"O±imiz”Ba£.h
"

4 
	~"M3DRegi¡¿tiÚSim¬™yO±imiz”.h
"

7 
	gM3DRegi¡¿tiÚSim¬™yO±imiz”
::
	$M3DRegi¡¿tiÚSim¬™yO±imiz”
()

8 : 
	$M3DRegi¡¿tiÚO±imiz”
()

10 
numP¬am‘”s
 = 7;

11 
´obËm
 = 
Ãw
 
	`M3DRegi¡¿tiÚSim¬™yProbËm
();

12 
boundsFunùiÚ
 = 
Ãw
 
M3DRegi¡¿tiÚSim¬™yProbËmBoundsFunùiÚ
;

13 
	}
}

	@M3DRegistrationSimilarityProblem.cpp

1 
	~<m©h.h
>

2 
	~"M3DRegi¡¿tiÚSim¬™yProbËm.h
"

10 
	gM3DRegi¡¿tiÚSim¬™yProbËm
::
	$M3DRegi¡¿tiÚSim¬™yProbËm
() :

11 
	$M3DRegi¡¿tiÚProbËm
()

13 
	}
}

15 
M3DRegi¡¿tiÚSim¬™yProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 &
x
)

17 
m©chV®
;

19 
tÙ®P’®ty
;

20 
Sim¬™yT¿nsfÜm3D
 
ŒªsfÜm
;

22 
ev®u©iÚCo¡
 += 1;

24 if(
m©ch
 =ğ
NULL
)

25  
ENSEMBLE_MAX_RETURN
;

30 
	`compu‹T¿nsfÜm©iÚ
(
ŒªsfÜm
, 
x
);

31 #ifdeà
NO_MATCH_PENALTY


32 
m©chV®
 = 0.0;

34 
m©chV®
 = 
m©ch
->
	`compu‹Mod–M©ch
(
rg‘Objeù
);

37 
Ï¡P’®ty
 = 0.0;

40 if(
³ÇÉyWeight
 > 0.0)

41 
Ï¡P’®ty
 = 
m©ch
->
	`compu‹Mod–P’®ty
(
ŒªsfÜm
è* 
³ÇÉyWeight
 * 
ENSEMBLE_OBJECTIVE_SCALE_FACTOR
;

43 
tÙ®P’®ty
 = 
Ï¡P’®ty
 - 
ENSEMBLE_OBJECTIVE_SCALE_FACTOR
*
m©chV®
;

45 #ifdeà
DISPLAY_PENALTIES


46 
¡d
::
cout
 << " (" << 
Ï¡P’®ty
 << " mod– - " << 
m©chV®
 << " match)*"

47 << 
OBJECTIVE_SCALE_FACTOR
 << " = " << 
tÙ®P’®ty
 << 
¡d
::
’dl
;

49  
tÙ®P’®ty
;

50 
	}
}

67 
	gM3DRegi¡¿tiÚSim¬™yProbËm
::
	$compu‹T¿nsfÜm©iÚ
(

68 
Sim¬™yT¿nsfÜm3D
 & 
ŒªsfÜm
, cÚ¡ 
VeùÜ
 &
x
)

70 
ŒªsfÜm
.
	`£tToId’t™y
();

72 if(
m©ch
 =ğ
NULL
)

77 
M3DObjeù
 * 
objeù
 = 
m©ch
->
	`g‘Reã»nûObjeù
();

78 if(
objeù
 =ğ
NULL
)

82 
Qu©
 
xRÙ
, 
yRÙ
, 
zRÙ
, 
fš®RÙ
;

83 
xRÙ
.
	`£tAxisAngË
(
	`VeùÜ3D
(1.0, 0.0, 0.0), 
ENSEMBLE_ROTATION_FACTOR
 * 
	`x
(3));

84 
yRÙ
.
	`£tAxisAngË
(
	`VeùÜ3D
(0.0, 1.0, 0.0), 
ENSEMBLE_ROTATION_FACTOR
 * 
	`x
(4));

85 
zRÙ
.
	`£tAxisAngË
(
	`VeùÜ3D
(0.0, 0.0, 1.0), 
ENSEMBLE_ROTATION_FACTOR
 * 
	`x
(5));

88 
fš®RÙ
 = 
zRÙ
 * 
yRÙ
 * 
xRÙ
;

89 
fš®RÙ
.
	`nÜm®ize
();

92 
sÿË
;

100 #ifdeà
EUCLIDEAN_ONLY


101 
sÿË
 = 1.0;

103 
sÿË
 = 
	`exp
(
ENSEMBLE_SCALE_FACTOR
 * 
	`x
(6));

107 
VeùÜ3D
 
	`Œªs
(
	`x
(0), x(1), x(2));

108 
Œªs
*=
ENSEMBLE_TRANSLATION_FACTOR
;

110 
ŒªsfÜm
.
	`sÿËBy
(
sÿË
);

111 
ŒªsfÜm
.
	`rÙ©eBy
(
fš®RÙ
);

112 
ŒªsfÜm
.
	`Œª¦©eBy
(
Œªs
);

113 
	}
}

115 
M3DObjeù
 * 
	gM3DRegi¡¿tiÚSim¬™yProbËm
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 &
x
)

117 
Sim¬™yT¿nsfÜm3D
 
ÃwT¿nsfÜm
;

118 
	`compu‹T¿nsfÜm©iÚ
(
ÃwT¿nsfÜm
, 
x
);

120 
M3DObjeù
 * 
rg‘Objeù
 = 
m©ch
->
	`g‘Reã»nûObjeù
()->
	`assign
();

122 
Sim¬™yT¿nsfÜm3D
 
ŒªsfÜm
 = *
rg‘Objeù
->
	`g‘T¿nsfÜm©iÚ
();

123 
ŒªsfÜm
.
	`muÉlyBy
(
ÃwT¿nsfÜm
);

125 
rg‘Objeù
->
	`£Ëù
();

126 #ifdeà
UNFLIPPED


127 
rg‘Objeù
->
	`­¶ySim¬™y
(
ŒªsfÜm
, 
	`VeùÜ3D
(0.0, 1.0, 0.0));

129 
rg‘Objeù
->
	`­¶ySim¬™y
(
ŒªsfÜm
, 
	`VeùÜ3D
(0.0, 0.0, 0.0));

132  
rg‘Objeù
;

133 
	}
}

136 
	gM3DRegi¡¿tiÚSim¬™yProbËmBoundsFunùiÚ
::
	$M3DRegi¡¿tiÚSim¬™yProbËmBoundsFunùiÚ
()

138 
bounds
 = 
	`VeùÜ
(7, 1.0, 1.0, 1.0, 
R_PI
, R_PI, R_PI, 1.0);

140 
çùÜs
 = 
	`VeùÜ
(8, 
M3DRegi¡¿tiÚSim¬™yProbËm
::
ENSEMBLE_TRANSLATION_FACTOR
,

141 
M3DRegi¡¿tiÚSim¬™yProbËm
::
ENSEMBLE_TRANSLATION_FACTOR
,

142 
M3DRegi¡¿tiÚSim¬™yProbËm
::
ENSEMBLE_TRANSLATION_FACTOR
,

143 
M3DRegi¡¿tiÚSim¬™yProbËm
::
ENSEMBLE_ROTATION_FACTOR
,

144 
M3DRegi¡¿tiÚSim¬™yProbËm
::
ENSEMBLE_ROTATION_FACTOR
,

145 
M3DRegi¡¿tiÚSim¬™yProbËm
::
ENSEMBLE_ROTATION_FACTOR
,

146 
M3DRegi¡¿tiÚSim¬™yProbËm
::
ENSEMBLE_SCALE_FACTOR
);

147 
	}
}

	@M3DSRepOptimizer.cpp

3 
	~<m©h.h
>

4 
	~"O±imiz”Ba£.h
"

5 
	~"M3DSR•O±imiz”.h
"

6 
	~"M3DSR•ProbËm.h
"

7 
	~"M3DPGAPrim™iveSts.h
"

8 
	~"M3DAtomP»diùÜQuad.h
"

9 
	~"M3DQuadPrim™ive.h
"

10 
	~"Tunšg.h
"

11 
	~"P3DCÚŒŞ.h
"

13 
	~"MakeO±imiz©iÚVideo.h
"

19 
	#VERBOSE1


	)

20 
	#VERBOSE2


	)

31 #iâdeà
BINARY


32 
	#RANDOMIZE


	)

38 cÚ¡ 
	gMIN_PENALTY_WEIGHT
 = -1;

39 cÚ¡ 
	gMIN_PENALTY_WEIGHT_EXP
 = 0.0;

40 cÚ¡ 
	gMAX_PENALTY_WEIGHT_EXP
 = 10.0;

41 cÚ¡ 
	gPENALTY_WEIGHT_SCALE_FACTOR
 = 10.0;

42 cÚ¡ 
	gPENALTY_SCALE_FACTOR
 =200;

43 cÚ¡ 
	gCONSTRAINT_PENALTY_SCALE_FACTOR
 = 0.02;

45 #iâdeà
BINARY


46 cÚ¡ 
	gSKIPPED_PASSES
 = 1;

47 cÚ¡ 
	gDEFAULT_THRESHOLD
 = 1.0e-3;

48 cÚ¡ 
	gDEFAULT_NUM_CONJGRAD_ITERATIONS
 = 2;

49 cÚ¡ 
	gDEFAULT_SCHEDULE_MULTIPLIER
 = 1;

52 #ifdeà
SREP_OUTPUT_TEST


53 
	~<f¡»am
>

57 
usšg
 
Çme¥aû
 
	g¡d
;

60 
glob®V”bos™y
;

63 
	gM3DSR•O±imiz”
::
	$M3DSR•O±imiz”
(
­pID
)

65 #ifdeà
DEBUG


66 
cout
 << "M3DSRepOptimizer::M3DSRepOptimizer()\n";

68 
ty³
 = 
SR•
;

69 
m‘hod
 = 
NULL
;

71 
»ã»nûObjeù
 = 
NULL
;

72 
ÿndid©eObjeù
 = 
NULL
;

74 
Ï¡P’®ty
 = 0.0;

78 
­¶iÿtiÚID
 = 
­pID
;

80 
couÁ”
 = 
NULL
;

81 
sk
 = 
NULL
;

82 
Ï¡ResuÉ
 = 
NULL
;

83 
Ï¡ResuÉSize
 = 0;

84 #ifdeà
BINARY


85 ià(
	`tunšgWt
(
BpSR•RªdomOrd”
) == 1)

86 
³rm
 = 
NULL
;

88 #ifdeà
RANDOMIZE


89 
³rm
 = 
NULL
;

92 
ÃxtAtom
 = 0;

93 
Ï¡Figu»Id
 = -1;

95 #iâdeà
BINARY


96 
numCÚjG¿d›ÁI‹¿tiÚs
 = 
DEFAULT_NUM_CONJGRAD_ITERATIONS
;

97 
scheduËMuÉl›r
 = 
DEFAULT_SCHEDULE_MULTIPLIER
;

98 
th»shŞd
 = 
DEFAULT_THRESHOLD
;

101 
tÙ®Ev®u©iÚCo¡
 = 0;

102 
	}
}

104 #iâdeà
BINARY


106 
	gM3DSR•O±imiz”
::
	$£tP’®tyWeightsInM©ch
(cÚ¡ * 
³ÇÉyNames
,

107 cÚ¡ * 
³ÇÉyWeights
, 
numP’®t›s
)

109 
wt
;

111 ià(
m©ch
 =ğ
NULL
) {

112 
cout
 << "Unableoransfer…enalties before Matchƒxists\n";

115 ià(
numP’®t›s
 <= 0)

118 
i
 = 0; i < 
numP’®t›s
; i++) {

119 
³ÇÉyNames
[
i
]) {

120 
GpAtomHi¡og¿mM©ch
:

121 
wt
 = 
³ÇÉyWeights
[
i
];

123 
GpAtomMuÉiP©chM©ch
:

124 
wt
 = 
³ÇÉyWeights
[
i
];

126 
AtomMah®ªobisM©ch
:

127 
wt
 = 
PENALTY_SCALE_FACTOR
*
³ÇÉyWeights
[
i
];

129 
GpAtomGeom‘ryWeight
:

130 
wt
 = 
PENALTY_WEIGHT_SCALE_FACTOR
*
³ÇÉyWeights
[
i
];

132 
GpAtomNeighbÜWeight
:

133 
wt
 = 
³ÇÉyWeights
[
i
];

135 
GpAtomIÁ”Weight
:

136 
wt
 = 
CONSTRAINT_PENALTY_SCALE_FACTOR
*
³ÇÉyWeights
[
i
];

139 
GpAtomProfeM©ch
:

142 
cout
 << "UnknowÀ³ÇÉy weight: " << 
	`tunšgShÜtName
(
³ÇÉyNames
[
i
]è<< 
’dl
;

145 
m©ch
->
	`£tWeight
(
ty³
, 
³ÇÉyNames
[
i
], 
wt
);

147 
	}
}

151 
	gM3DSR•O±imiz”
::~
	$M3DSR•O±imiz”
()

153 #ifdeà
DEBUG


154 
cout
 << "M3DSR•O±imiz”::~M3DSR•O±imiz”()" << 
’dl
;

156 
	`d–‘e_š‹º®
();

157 
	}
}

159 
	gM3DSR•O±imiz”
::
	$d–‘e_š‹º®
()

161 if(
»ã»nûObjeù
 !ğ
NULL
)

162 
d–‘e
 
»ã»nûObjeù
;

163 
»ã»nûObjeù
 = 
NULL
;

165 if(
ÿndid©eObjeù
 !ğ
NULL
)

166 
d–‘e
 
ÿndid©eObjeù
;

167 
ÿndid©eObjeù
 = 
NULL
;

169 if(
Ï¡Be¡X
)

171 
i
 = 0; i < 
Ï¡Be¡XSize
; i++)

173 ià(
Ï¡Be¡X
[
i
] !ğ
NULL
)

174 
d–‘e
 
Ï¡Be¡X
[
i
];

176 
d–‘e
 [] 
Ï¡Be¡X
;

177 
Ï¡Be¡X
 = 
NULL
;

180 if(
couÁ”
 !ğ
NULL
)

182 
d–‘e
 [] 
couÁ”
;

183 
couÁ”
 = 
NULL
;

185 if(
sk
 !ğ
NULL
)

187 
d–‘e
 [] 
sk
;

188 
sk
 = 
NULL
;

190 if(
Ï¡ResuÉ
 !ğ
NULL
)

192 
d–‘e
 [] 
Ï¡ResuÉ
;

193 
Ï¡ResuÉ
 = 
NULL
;

194 
Ï¡ResuÉSize
 = 0;

197 #ifdeà
BINARY


198 ià(
	`tunšgWt
(
BpSR•RªdomOrd”
) == 1) {

199 if(
³rm
 !ğ
NULL
) {

200 
d–‘e
 [] 
³rm
;

201 
³rm
 = 
NULL
;

205 #ifdeà
RANDOMIZE


206 if(
³rm
 !ğ
NULL
)

208 
d–‘e
 [] 
³rm
;

209 
³rm
 = 
NULL
;

213 
	}
}

215 
boŞ
 
	gM3DSR•O±imiz”
::
	$š™Ÿlize
(
M©ch
 * 
_m©ch
, 
M3DObjeù
 * 
_»ã»nûObjeù
)

220 
Image3D
 * 
image
;

223 #ifdeà
DEBUG


224 
cout
 << "M3DSRepOptimizer::initialize()\n";

226 if(
_m©ch
 =ğ
NULL
 || 
_»ã»nûObjeù
 == NULL)

227  
çl£
;

229 
	`d–‘e_š‹º®
();

231 
»ã»nûObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

233 
ÿndid©eObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

235 
m©ch
 = 
_m©ch
;

237 
m©ch
->
	`»£tReã»nûObjeù
(
»ã»nûObjeù
);

239 
image
 = 
m©ch
->
	`g‘T¬g‘Image
();

240 if(
image
 =ğ
NULL
)

241  
çl£
;

259 
Ï¡Figu»Id
 = -1;

260 
ÃxtAtom
 = 0;

262 #ifdeà
SREP_OUTPUT_TEST


263 cÚ¡ 
NUM_TICKS
 = 100;

264 
START_TICK
 = -0.25;

265 
END_TICK
 = 0.25;

266 
TICK_SIZE
 = (
END_TICK
 - 
START_TICK
è/ ((è
NUM_TICKS
);

268 
of¡»am
 
outFe
;

269 
row
, 
cŞ
;

270 
x
, 
v®
;

271 
j
;

273 
M3DFigu»
 * 
rg‘Figu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(0);

274 if(
rg‘Figu»
 =ğ
NULL
)

276 
numPrim™ives
 = 
rg‘Figu»
->
	`g‘Prim™iveCouÁ
();

278 
i
 = 0; i < 
numPrim™ives
; i++)

280 
´imPŒ
 = 
rg‘Figu»
->
	`g‘Prim™ivePŒ
(
i
);

281 if(
´imPŒ
 =ğ
NULL
 || !ÕrimPŒ->
	`isS–eùed
()))

284 
M3DSR•ProbËm
 
	`´obËm
 (
m©ch
, 
»ã»nûObjeù
, 
ÿndid©eObjeù
, 0, 
i
, 
­¶iÿtiÚID
);

286 
vecsize
 = 8;

287 ià(
´imPŒ
->
	`ty³
(è=ğ
M3D_END_PRIMITIVE
)

288 
vecsize
 = 9;

289 
VeùÜ
 
	`zv
(
vecsize
);

290 
k
 = 0; k < 
vecsize
; k++)

291 
	`zv
(
k
) = 0.0;

293 
outFe
.
	`İ’
("xtrans.dat");

294 
j
 = 0; j < 
NUM_TICKS
; j++)

296 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

298 
VeùÜ
 
	`v
(
zv
);

299 
	`v
(0èğ
x
;

300 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

302 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

304 
outFe
.
	`şo£
();

306 
outFe
.
	`İ’
("ytrans.dat");

307 
j
 = 0; j < 
NUM_TICKS
; j++)

309 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

311 
VeùÜ
 
	`v
(
zv
);

312 
	`v
(1èğ
x
;

313 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

315 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

317 
outFe
.
	`şo£
();

319 
outFe
.
	`İ’
("ztrans.dat");

320 
j
 = 0; j < 
NUM_TICKS
; j++)

322 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

324 
VeùÜ
 
	`v
(
zv
);

325 
	`v
(2èğ
x
;

326 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

328 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

330 
outFe
.
	`şo£
();

332 
outFe
.
	`İ’
("xrot.dat");

333 
j
 = 0; j < 
NUM_TICKS
; j++)

335 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

337 
VeùÜ
 
	`v
(
zv
);

338 
	`v
(3èğ
x
;

339 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

341 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

343 
outFe
.
	`şo£
();

345 
outFe
.
	`İ’
("yrot.dat");

346 
j
 = 0; j < 
NUM_TICKS
; j++)

348 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

350 
VeùÜ
 
	`v
(
zv
);

351 
	`v
(4èğ
x
;

352 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

354 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

356 
outFe
.
	`şo£
();

358 
outFe
.
	`İ’
("zrot.dat");

359 
j
 = 0; j < 
NUM_TICKS
; j++)

361 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

363 
VeùÜ
 
	`v
(
zv
);

364 
	`v
(5èğ
x
;

365 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

367 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

369 
outFe
.
	`şo£
();

371 
outFe
.
	`İ’
("scale.dat");

372 
j
 = 0; j < 
NUM_TICKS
; j++)

374 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

376 
VeùÜ
 
	`v
(
zv
);

377 
	`v
(6èğ
x
;

378 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

380 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

382 
outFe
.
	`şo£
();

384 
outFe
.
	`İ’
("theta.dat");

385 
j
 = 0; j < 
NUM_TICKS
; j++)

387 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

389 
VeùÜ
 
	`v
(
zv
);

390 
	`v
(7èğ
x
;

391 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

393 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

395 
outFe
.
	`şo£
();

397 ià(
vecsize
 == 9)

399 
outFe
.
	`İ’
("eta.dat");

400 
j
 = 0; j < 
NUM_TICKS
; j++)

402 
x
 = 
START_TICK
 + ((è
j
è* 
TICK_SIZE
;

404 
VeùÜ
 
	`v
(
zv
);

405 
	`v
(8èğ
x
;

406 
v®
 = 
´obËm
.
	`ev®u©e
(
v
);

408 
outFe
 << 
x
 << "\t\t" << 
v®
 << 
’dl
;

410 
outFe
.
	`şo£
();

414  
Œue
;

415 
	}
}

417 
	gM3DSR•O±imiz”
::
	$»£t
(
M©ch
 * 
_m©ch
, 
M3DObjeù
 * 
_»ã»nûObjeù
)

419 if(
_m©ch
 =ğ
NULL
 || 
_»ã»nûObjeù
 == NULL)

422 
	`d–‘e_š‹º®
();

424 
»ã»nûObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

425 
ÿndid©eObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

427 
m©ch
 = 
_m©ch
;

429 
m©ch
->
	`»£tReã»nûObjeù
(
»ã»nûObjeù
);

431 
Ï¡Figu»Id
 = -1;

432 
ÃxtAtom
 = 0;

433 
	}
}

437 
boŞ
 
	gM3DSR•O±imiz”
::
	$³rfÜmI‹¿tiÚs
(
figu»Id
)

439 
cout
 << "Error: wrong version of M3DSRepOptimizer::performIterations() called\n";

440  
çl£
;

441 
	}
}

456 
boŞ
 
	gM3DSR•O±imiz”
::
	$³rfÜmI‹¿tiÚs
(
figu»Id
, 
boŞ
 
´ev›w
,

457 
boŞ
 
v”bos™y
)

459 
numFigs
;

461 if(
m©ch
 =ğ
NULL
 || 
»ã»nûObjeù
 =ğNULL || 
ÿndid©eObjeù
 == NULL)

462  
çl£
;

464 
numFigs
 = 
ÿndid©eObjeù
->
	`g‘Figu»CouÁ
();

466 #ifdeà
BINARY


467 ià(
	`tunšgWt
(
BpSR•RS¿dP’®ty
è!ğ0.0 ||unšgWt(
BpSR•D–NeighbÜM©ch
) != 0.0)

468 
m©ch
->
	`£tUpAtomP»diùÜ
(
figu»Id
);

470 ià(
	`tunšgWt
(
BpAtomRªdomOrd”
) == 1)

472 
i
;

473 
M3DFigu»
 * 
cu¼Figu»
;

476 
numPrims
 = 0;

477 ià(
³rm
 =ğ
NULL
) {

478 
cu¼Figu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

479 if(
cu¼Figu»
 =ğ
NULL
)

480  
çl£
;

481 
numPrims
 = 
cu¼Figu»
->
	`g‘Prim™iveCouÁ
();

482 
³rm
 = 
Ãw
 [
numPrims
];

483 
i
 = 0; i < 
numPrims
; i++)

484 
³rm
[
i
] = -1;

488 #ifdeà
RANDOMIZE


489 
i
;

490 
M3DFigu»
 * 
cu¼Figu»
;

493 
numPrims
 = 0;

494 ià(
³rm
 =ğ
NULL
) {

495 
cu¼Figu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

496 if(
cu¼Figu»
 =ğ
NULL
)

497  
çl£
;

498 
numPrims
 = 
cu¼Figu»
->
	`g‘Prim™iveCouÁ
();

499 
³rm
 = 
Ãw
 [
numPrims
];

500 
i
 = 0; i < 
numPrims
; i++)

501 
³rm
[
i
] = -1;

506 #ifdeà
BINARY


507  
	`İtimizeFigu»
(
figu»Id
, 
´ev›w
, (
glob®V”bos™y
 > -1));

509  
	`İtimizeFigu»
(
figu»Id
, 
´ev›w
, 
v”bos™y
);

511 
	}
}

513 
šlše
 
	gM3DSR•O±imiz”
::
	$£ËùRªdomAtom
(
numPrims
)

515 
skCouÁ”
;

516 
i
;

517 
´imId
;

520 ià(
ÃxtAtom
 == 0) {

522 
šdex
, 
‹mp
;

523 
Ï¡Atom
;

525 
Ï¡Atom
 = 
³rm
[
numPrims
 - 1];

527 
i
 = 0; i < 
numPrims
; i++)

528 
³rm
[
i
] = i;

529 
i
 = 0; i < 
numPrims
; i++) {

530 
šdex
 = 
i
 + (
	`¿nd
(è% (
numPrims
 - i));

531 
‹mp
 = 
³rm
[
i
];

532 
³rm
[
i
] =…”m[
šdex
];

533 
³rm
[
šdex
] = 
‹mp
;

536 ià(
Ï¡Atom
 >= 0) {

538 ià(
³rm
[0] =ğ
Ï¡Atom
) {

539 
‹mp
 = 
³rm
[0];

540 
³rm
[0] =…”m[
numPrims
 - 1];

541 
³rm
[
numPrims
 - 1] = 
‹mp
;

545 #ifdeà
DEBUG


546 
cout
 << "Allocated…erm[]: ";

547 
i
 = 0; i < 
numPrims
; i++)

548 
cout
 << 
³rm
[
i
] << ' ';

549 
cout
 << 
’dl
;

554 
skCouÁ”
 = 0;

555 ià(
ÃxtAtom
 == 0) {

556 
i
 = 0; i < 
numPrims
; i++) {

557 ià(
couÁ”
[
i
] < 0)

558 
skCouÁ”
++;

561 #ifdeà
VERBOSE2


562 if(
ÃxtAtom
 == 0)

563 
cout
 << "skCouÁ” = " << 
skCouÁ”
 << '\n';

565 ià(
skCouÁ”
 =ğ
numPrims
) {

566 
®lSk³d
++;

567 #ifdeà
VERBOSE


568 
cout
 << "AÎ sk³d = " << 
®lSk³d
 << '\n';

573 
´imId
 = 
³rm
[
ÃxtAtom
];

574 
ÃxtAtom
++;

575 ià(
ÃxtAtom
 =ğ
numPrims
)

576 
ÃxtAtom
 = 0;

578 #iâdeà
DISPLAY_PENALTIES


579 #ifdeà
VERBOSE


580 ià(
ÃxtAtom
 == 1)

581 
cout
 << "==================\n";

583 
cout
 << "------------------\n";

587 #ifdeà
VERBOSE


588 
cout
 << "counter: ";

589 
i
 = 0; i < 
numPrims
; i++)

590 
cout
 << 
couÁ”
[
i
] << ' ';

591 
cout
 << '\n';

592 
cout
 << "skip: ";

593 
i
 = 0; i < 
numPrims
; i++)

594 
cout
 << 
sk
[
i
] << ' ';

595 
cout
 << '\n';

598  
´imId
;

599 
	}
}

601 
šlše
 
	gM3DSR•O±imiz”
::
	$£ËùAtom
(
numPrims
)

603 
skCouÁ”
;

604 
i
;

605 
´imId
;

608 
skCouÁ”
 = 0;

609 ià(
ÃxtAtom
 == 0) {

610 
i
 = 0; i < 
numPrims
; i++) {

611 ià(
couÁ”
[
i
] < 0)

612 
skCouÁ”
++;

615 #ifdeà
VERBOSE


616 if(
ÃxtAtom
 == 0)

617 
cout
 << "skCouÁ” = " << 
skCouÁ”
 << '\n';

619 ià(
skCouÁ”
 =ğ
numPrims
) {

620 
®lSk³d
++;

621 #ifdeà
VERBOSE


622 
cout
 << "AÎ sk³d = " << 
®lSk³d
 << '\n';

627 
´imId
 = 
ÃxtAtom
;

628 
ÃxtAtom
++;

629 ià(
ÃxtAtom
 =ğ
numPrims
)

630 
ÃxtAtom
 = 0;

632 #iâdeà
DISPLAY_PENALTIES


633 #ifdeà
VERBOSE


634 ià(
ÃxtAtom
 == 1)

635 
cout
 << "==================\n";

637 
cout
 << "------------------\n";

641 #ifdeà
VERBOSE


642 
cout
 << "counter: ";

643 
i
 = 0; i < 
numPrims
; i++)

644 
cout
 << 
couÁ”
[
i
] << ' ';

645 
cout
 << '\n';

646 
cout
 << "skip: ";

647 
i
 = 0; i < 
numPrims
; i++)

648 
cout
 << 
sk
[
i
] << ' ';

649 
cout
 << '\n';

652  
´imId
;

653 
	}
}

655 
	gM3DSR•O±imiz”
::
	$»adyNextRun
()

657 
i
 = 0; i < 
Ï¡ResuÉSize
; i++) {

658 
couÁ”
[
i
] = 0;

659 
sk
[
i
] = 0;

660 
Ï¡ResuÉ
[
i
] = 0.0;

663 
®lSk³d
 = 0;

664 
	}
}

688 
boŞ
 
	gM3DSR•O±imiz”
::
	$İtimizeFigu»
(
figId
, 
boŞ
 
´ev›w
, boŞ 
v”bos™y
,

689 
boŞ
 
®lAtomMoveTog©h”
)

692 
i
;

693 
cum_chªge
;

694 
´imId
;

695 
numPrims
;

698 
M3DFigu»
 * 
»ã»nûFigu»
 = 
»ã»nûObjeù
->
	`g‘Figu»PŒ
(
figId
);

699 
M3DFigu»
 * 
ÿndid©eFigu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figId
);

702 ià(
»ã»nûFigu»
 =ğ
NULL
 || 
ÿndid©eFigu»
 == NULL )

703  
çl£
;

705 
numPrims
 = 
ÿndid©eFigu»
->
	`g‘Prim™iveCouÁ
();

708 ià(! 
Ï¡Be¡X
)

711 #ifdeà
VERBOSE


712 
cout
 << "initializing internal optimization structures\n";

723 
Ï¡Be¡X
 = 
Ãw
 
VeùÜ
 *[
numPrims
];

724 
Ï¡Be¡XSize
 = 
numPrims
;

726 
´imId
 = 0;…rimId < 
numPrims
;…rimId++)

729 
M3DPrim™ive
 * 
cu¼Prim™ive
 = 
ÿndid©eFigu»
->
	`g‘Prim™ivePŒ
(
´imId
);

730 
VeùÜ
 * 
š™
;

732 ià((
	`tunšgWt
(
SR•EFaùÜ
è=ğ0.0)|| 
cu¼Prim™ive
->
	`ty³
(è=ğ
M3D_STANDARD_PRIMITIVE
)

734 
š™
 = 
Ãw
 
	`VeùÜ
(9, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);

738 
š™
 = 
Ãw
 
	`VeùÜ
(12, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);

740 
Ï¡Be¡X
[
´imId
] = 
š™
;

744 ià(
Ï¡Figu»Id
 !ğ
figId
) {

745 ià(
couÁ”
 !ğ
NULL
) {

746 
d–‘e
 [] 
couÁ”
;

747 
d–‘e
 [] 
sk
;

748 
d–‘e
 [] 
Ï¡ResuÉ
;

751 
couÁ”
 = 
Ãw
 [
numPrims
];

752 
sk
 = 
Ãw
 [
numPrims
];

753 
Ï¡ResuÉ
 = 
Ãw
 [
numPrims
];

754 
Ï¡ResuÉSize
 = 
numPrims
;

756 
i
 = 0; i < 
numPrims
; i++) {

757 
couÁ”
[
i
] = 0;

758 
sk
[
i
] = 0;

759 
Ï¡ResuÉ
[
i
] = 0.0;

762 
®lSk³d
 = 0;

763 
Ï¡Figu»Id
 = 
figId
;

766 
´imId
 = -1;

769 
´imId
 < 0) {

770 ià(
´ev›w
)

771 
´imId
 = 
	`£ËùAtom
(
numPrims
);

773 #ifdeà
BINARY


774 ià(
	`tunšgWt
(
BpAtomRªdomOrd”
) == 1.0)

775 
´imId
 = 
	`£ËùRªdomAtom
(
numPrims
);

777 
´imId
 = 
	`£ËùAtom
(
numPrims
);

779 #ifdeà
RANDOMIZE


780 
´imId
 = 
	`£ËùRªdomAtom
(
numPrims
);

782 
´imId
 = 
	`£ËùAtom
(
numPrims
);

787 
ÿndid©ePrim™ive
 = 
ÿndid©eFigu»
->
	`g‘Prim™ivePŒ
(
´imId
);

788 ià(
ÿndid©ePrim™ive
 =ğ
NULL
){

791 
couÁ”
[
´imId
] = -1;

792 
´imId
 = -1;

797 #ifdeà
BINARY


798 ià(
®lSk³d
 >ğ
	`tunšgWt
(
BpSR•Sk³dPas£s
))

800 ià(
®lSk³d
 >ğ
SKIPPED_PASSES
)

802  
Œue
;

804 ià(
sk
[
´imId
] > 0) {

806 
sk
[
´imId
]--;

808 
cout
 << "Skpšg‡tom " << 
´imId
 << '\n';

810  
çl£
;

813 
»ã»nûPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
´imId
);

815 ià(
»ã»nûPrim™ive
 =ğ
NULL
)

816  
çl£
;

820 
cum_chªge
 = 
	`İtimizeAtom
(
figId
, 
´imId
, 
ÿndid©eFigu»
, 
´ev›w
,

821 
®lAtomMoveTog©h”
);

824 #ifdeà
DISPLAY_PENALTIES


825 
cout
 << "Aá” o±imizšg‡tom " << 
´imId
 << ", cumulative change for figure "

826 << 
figId
 << " = " << 
cum_chªge
 << 
’dl
;

829 
d_abs
 = 
	`çbs
(
cum_chªge
 - 
Ï¡ResuÉ
[
´imId
]);

830 #ifdeà
VERBOSE2


831 
cout
 << "d_ab ğ" << 
d_abs
;

833 #ifdeà
BINARY


834 ià(
d_abs
 < 
	`tunšgWt
(
BpSR•SkTh»shŞd
)) {

835 
couÁ”
[
´imId
]--;

836 
sk
[
´imId
] = -((è
	`tunšgWt
(
BpSR•SkMuÉl›r
))*
couÁ”
[primId];

838 ià(
d_abs
 < 
th»shŞd
) {

839 
couÁ”
[
´imId
]--;

840 
sk
[
´imId
] = -
scheduËMuÉl›r
 * 
couÁ”
[primId];

842 #ifdeà
VERBOSE


843 #ifdeà
BINARY


844 
cout
 << " < " << 
	`tunšgWt
(
BpSR•SkTh»shŞd
);

846 
cout
 << " < " << 
th»shŞd
;

851 
couÁ”
[
´imId
] = 0;

852 #ifdeà
VERBOSE2


853 
cout
 << '\n';

856 
Ï¡ResuÉ
[
´imId
] = 
cum_chªge
;

859  
çl£
;

860 
	}
}

862 
	gM3DSR•O±imiz”
::
	$g‘La¡Be¡V®
(
boŞ
 
´ev›w
)

864 ià(
´ev›w
) {

865 ià(
Ï¡Figu»Id
 < 0)

867 
M3DFigu»
 * 
ÿndid©eFigu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
Ï¡Figu»Id
);

868 
numPrims
 = 
ÿndid©eFigu»
->
	`g‘Prim™iveCouÁ
();

869 
numPrimsS–eùed
 = 
ÿndid©eFigu»
->
	`numb”S–eùed
();

871 
Ï¡Be¡V®
 = 0.0;

872 
i
 = 0; i < 
numPrims
; i++) {

873 
Ï¡Be¡V®
 +ğ
Ï¡ResuÉ
[
i
];

875 
Ï¡Be¡V®
 /ğ
numPrimsS–eùed
;

877  
Ï¡Be¡V®
;

878 
	}
}

880 
	gM3DSR•O±imiz”
::
	$İtimizeAtom
(
figId
, 
©omId
, 
M3DFigu»
 * 
ÿndid©eFigu»
,

881 
boŞ
 
´ev›w
, boŞ 
®lAtomMoveTog©h”
)

883 
vecsize
;

884 
š™V®
, 
v®
;

885 
cum_chªge
 = 0.0 ;

886 
VeùÜ
 * 
¡¬t
;

888 
numSpokes
 ;

890  
ÿndid©eFigu»
->
	`g‘Prim™ivePŒ
(
©omId
)->
	`ty³
() ) {

892 
M3D_STANDARD_PRIMITIVE
: 
numSpokes
 = 2 ;

894 
M3D_END_PRIMITIVE
: 
numSpokes
 = 3 ;

898 
VeùÜ
 
	`Ï¡Be¡XSpoke
( 3, 0.0, 0.0, 0.0 ) ;

900  
¥okeId
 = 0 ; spokeId < 
numSpokes
 ; spokeId ++ ) {

902 
	`Ï¡Be¡XSpoke
(0èğ(*
Ï¡Be¡X
[
©omId
])Ğ3*(
¥okeId
+1)+0 ) ;

903 
	`Ï¡Be¡XSpoke
(1èğ(*
Ï¡Be¡X
[
©omId
])Ğ3*(
¥okeId
+1)+1 ) ;

904 
	`Ï¡Be¡XSpoke
(2èğ(*
Ï¡Be¡X
[
©omId
])Ğ3*(
¥okeId
+1)+2 ) ;

906 
¡¬t
 = &
Ï¡Be¡XSpoke
 ;

907 
vecsize
 = 
¡¬t
->
	`size
();

909 
VeùÜ
 
	`•sÚ
(
vecsize
);

910 
•sÚ
.
	`£tAÎ
(
	`tunšgWt
(
SR•EpsÚ
));

912 
M3DSR•ProbËm
 * 
´obËm
 = 
Ãw
 
	`M3DSR•ProbËm
(
m©ch
, 
»ã»nûObjeù
, 
ÿndid©eObjeù
, 
figId
, 
©omId
, 
¥okeId
, 
­¶iÿtiÚID
);

914 
Num”iÿlFunùiÚ
 
	`funùiÚ
(* 
´obËm
, 
•sÚ
);

916 
CÚjug©eG¿d›ÁM‘hod
 
	`cGM‘hod
(
funùiÚ
, *
¡¬t
);

917 
cGM‘hod
.
	`£tB»ÁLš—rS—rchBoundFaùÜ
Ğ
	`tunšgWt
(
B»ÁLš—rS—rchBoundFaùÜ
) );

919 
M3DSR•ProbËmBoundsFunùiÚ
 
	`boundsFunùiÚ
(
´obËm
);

920 
cGM‘hod
.
	`£tBoundsFunùiÚ
(&
boundsFunùiÚ
);

922 
š™V®
 = 
cGM‘hod
.
	`g‘Be¡Ev”V®ue
();

924 #ifdeà
VERBOSE1


925 
cout
 << "\ÀAtomId = " << 
©omId
 << " in™V® = " << 
š™V®
 << 
’dl
;

928 
k
 = 0; (k < 
	`tunšgWt
(
BpSR•CÚjug©eG¿d›ÁI‹¿tiÚs
)è&& ! 
cGM‘hod
.
	`isFšished
(); k++)

929 
cGM‘hod
.
	`³rfÜmI‹¿tiÚ
();

931 
tÙ®Ev®u©iÚCo¡
 +ğ
´obËm
->
	`g‘Ev®u©iÚCo¡
();

933 
v®
 = 
cGM‘hod
.
	`g‘Be¡Ev”V®ue
();

935 ià(
v®
 < 
š™V®
)

937 
VeùÜ
 
»suÉ
 = 
cGM‘hod
.
	`g‘Be¡Ev”X
();

939 
k
 = 0; k < 
vecsize
; k++) {

940 
	`Ï¡Be¡XSpoke
(
k
èğ
	`»suÉ
(k) ;

941 (*
Ï¡Be¡X
[
©omId
])(3*(
¥okeId
+1è+ 
k
èğ
	`»suÉ
(k) ;

944 #ifdeà
VERBOSE2


945 
cout
 << " bestx = ";

946  
i
 = 0; i < 
vecsize
; i++)

947 
cout
 << ' ' << 
	`»suÉ
(
i
);

949 
cout
 << '\n';

950 
cout
 << " v® = " << 
v®
 << '\n';

952 
cum_chªge
 +ğ
	`çbs
(
š™V®
 - 
v®
);

954 
Ï¡Be¡V®
 = 
v®
;

957 
cum_chªge
 += 0.0;

959 ifĞ
MakeO±imiz©iÚVideo
::
makeVideoOn
 ) {

962 
´obËm
->
	`upd©eT¬g‘Prim™ive
Ğ*(
Ï¡Be¡X
[
©omId
]) ) ;

968 
MakeO±imiz©iÚVideo
::
	`wr™eCu¼’tMod–
Ğ
ÿndid©eObjeù
 ) ;

971 
d–‘e
 
´obËm
 ;

977 
M3DSR•ProbËm
 * 
´obËm
 = 
Ãw
 
	`M3DSR•ProbËm
(
m©ch
, 
»ã»nûObjeù
, 
ÿndid©eObjeù
, 
figId
, 
©omId
, 
­¶iÿtiÚID
);

979 
´obËm
->
	`upd©eT¬g‘Prim™ive
Ğ*(
Ï¡Be¡X
[
©omId
]) ) ;

981 
d–‘e
 
´obËm
 ;

983 
Ï¡P’®ty
 = 0 ;

985  
cum_chªge
 ;

986 
	}
}

	@M3DSRepProblem.cpp

3 
	~"M3DSR•ProbËm.h
"

4 
	~"M3DRegi¡¿tiÚProbËm.h
"

5 
	~"Tunšg.h
"

6 
	~"M3DAtomP»diùÜQuad.h
"

7 
	~"P3DCÚŒŞ.h
"

8 
usšg
 
Çme¥aû
 
	g¡d
;

11 #ifdeà
BINARY


12 
glob®V”bos™y
;

15 
	gM3DSR•ProbËm
::
	$M3DSR•ProbËm
(
­pID
)

17 
»ã»nûObjeù
 = 
NULL
;

18 
m©ch
 = 
NULL
;

19 
rg‘Objeù
 = 
NULL
;

21 
figu»Id
 = -1 ;

22 
©omId
 = -1 ;

23 
¥okeId
 = -1 ;

25 
ev®u©iÚCo¡
 = 0;

27 
­¶iÿtiÚID
 = 
­pID
;

28 
	}
}

30 
	gM3DSR•ProbËm
::
	$M3DSR•ProbËm
(
M©ch
 * 
_m©ch
,

31 
M3DObjeù
 * 
_»ã»nûObjeù
, M3DObjeù * 
_rg‘Objeù
,

32 
_figu»Id
, 
_©omId
, 
_¥okeId
, 
­pID
)

35 
»ã»nûObjeù
 = 
_»ã»nûObjeù
;

36 
m©ch
 = 
_m©ch
;

37 
rg‘Objeù
 = 
_rg‘Objeù
;

39 
figu»Id
 = 
_figu»Id
 ;

40 
©omId
 = 
_©omId
 ;

41 
¥okeId
 = 
_¥okeId
 ;

43 
ev®u©iÚCo¡
 = 0;

44 
­¶iÿtiÚID
 = 
­pID
;

45 
figu»P»diùÜ
 = 
NULL
;

47 
	}
}

49 
	gM3DSR•ProbËm
::
	$M3DSR•ProbËm
(
M©ch
 * 
_m©ch
,

50 
M3DObjeù
 * 
_»ã»nûObjeù
, M3DObjeù * 
_rg‘Objeù
,

51 
_figu»Id
, 
_©omId
, 
­pID
)

54 
»ã»nûObjeù
 = 
_»ã»nûObjeù
;

55 
m©ch
 = 
_m©ch
;

56 
rg‘Objeù
 = 
_rg‘Objeù
;

58 
figu»Id
 = 
_figu»Id
 ;

59 
©omId
 = 
_©omId
 ;

60 
¥okeId
 = -1 ;

62 
ev®u©iÚCo¡
 = 0;

63 
­¶iÿtiÚID
 = 
­pID
;

64 
figu»P»diùÜ
 = 
NULL
;

66 
	}
}

69 
	gM3DSR•ProbËm
::~
	$M3DSR•ProbËm
()

71 ià(
figu»P»diùÜ
 !=
NULL
)

72 
d–‘e
 
figu»P»diùÜ
 ;

73 
	}
}

77 
	gM3DSR•ProbËm
::
	$ev®u©eImageM©ch
(cÚ¡ 
VeùÜ
 & 
x
, 
M3DObjeù
 * 
_»ã»nûObjeù
)

79 
ev®u©iÚCo¡
++;

81 ià(
m©ch
 =ğ
NULL
 || 
rg‘Objeù
 =ğNULL || 
»ã»nûObjeù
 == NULL)

82  
MAX_RETURN
;

85 ià(
_»ã»nûObjeù
 !=
NULL
)

86 
»ã»nûObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

89 
M3DObjeù
 * 
ÿndid©eObjeù
 = 
»ã»nûObjeù
->
	`assign
();

93 #ifdeà
BINARY


94 
geomP’®ty
;

95  
m©ch
->
	`compu‹SR•M©chAndP’®t›s
(
ÿndid©eObjeù
, 
figu»Id
, 
©omId
, 
¥okeId
, 
x
, 
geomP’®ty
);

97  
m©ch
->
	`compu‹AtomM©chAndP’®t›s
(
ÿndid©eObjeù
, 
figu»Id
,
©omId
, 
x
,
geomP’®ty
);

100 
	}
}

102 
	gM3DSR•ProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 & 
x
)

104 
ev®u©iÚCo¡
++;

106 if(
m©ch
 =ğ
NULL
 || 
rg‘Objeù
 =ğNULL || 
»ã»nûObjeù
 == NULL)

107  
MAX_RETURN
;

111 
	`ü—‹T¬g‘Prim™ive
(
x
);

113 
M3DObjeù
 * 
ÿndid©eObjeù
 = 
rg‘Objeù
->
	`assign
();

115 
m©chV®
 = 
m©ch
->
	`compu‹SR•M©chAndP’®t›s
(
ÿndid©eObjeù
, 
figu»Id
, 
©omId
, 
¥okeId
, 
x
, 
geomP’®ty
);

117 
d–‘e
 
ÿndid©eObjeù
;

119  
m©chV®
;

120 
	}
}

124 
CompÚ’ts
 
	gM3DSR•ProbËm
::
	$ev®u©eT”ms
(cÚ¡ 
VeùÜ
 & 
x
)

126 
ev®u©iÚCo¡
++;

128 if(
m©ch
 =ğ
NULL
 || 
rg‘Objeù
 =ğNULL || 
»ã»nûObjeù
 == NULL)

129  
	`CompÚ’ts
(
MAX_RETURN
);

133 
	`ü—‹T¬g‘Prim™ive
(
x
);

135 
M3DObjeù
 * 
ÿndid©eObjeù
 = 
rg‘Objeù
->
	`assign
();

137 
CompÚ’ts
 
comp
 = 
m©ch
->
	`compu‹SR•M©chAndP’®t›sAsCompÚ’ts
(
ÿndid©eObjeù
, 
figu»Id
, 
©omId
, 
¥okeId
, 
x
, 
geomP’®ty
);

139  
comp
;

140 
	}
}

142 
	gM3DSR•ProbËm
 ::
	$ü—‹T¬g‘Prim™ive
(cÚ¡ 
VeùÜ
 & 
x
)

150 
M3DFigu»
 * 
»ã»nûFigu»
 = 
»ã»nûObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

151 
M3DFigu»
 * 
rg‘Figu»
 = 
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

153 
M3DPrim™ive
 * 
»ã»nûPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
©omId
);

154 
M3DPrim™ive
 * 
rg‘Prim™ive
 = 
rg‘Figu»
->
	`g‘Prim™ivePŒ
(
©omId
);

156 (*
rg‘Prim™ive
èğ(*
»ã»nûPrim™ive
);

158 
	`­¶yVeùÜ
(*
rg‘Prim™ive
, 
x
);

160 
	}
}

163 
	gM3DSR•ProbËm
::
	$­¶yVeùÜ
(
M3DPrim™ive
 & 
´im
, cÚ¡ 
VeùÜ
 & 
x
)

173 
sÿË
 = 
	`exp
(
	`tunšgWt
(
SR•SÿËFaùÜ
è* 
	`x
(0));

174 
d–Th‘a
 = 
	`tunšgWt
(
SR•Th‘aFaùÜ
è* 
	`x
(1) ;

175 
d–Phi
 = 
	`tunšgWt
(
SR•Th‘aFaùÜ
è* 
	`x
(2) ;

179 
´im
.
	`sÿËSpokeBy
Ğ
¥okeId
, 
sÿË
 ) ;

180 
´im
.
	`rÙ©eSpokeBy
Ğ
¥okeId
, 
d–Th‘a
, 
d–Phi
 ) ;

186 
	}
}

189 #undeà
DEBUG_DIBYENDU2


191 #iâdeà
DEBUG_DIBYENDU_2


193 
	gM3DSR•ProbËm
 ::
	$upd©eT¬g‘Prim™ive
(cÚ¡ 
VeùÜ
 & 
x
)

199 
M3DFigu»
 * 
»ã»nûFigu»
 = 
»ã»nûObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

200 
M3DFigu»
 * 
rg‘Figu»
 = 
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

202 
M3DPrim™ive
 * 
»ã»nûPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
©omId
);

203 
M3DPrim™ive
 * 
rg‘Prim™ive
 = 
rg‘Figu»
->
	`g‘Prim™ivePŒ
(
©omId
);

205 (*
rg‘Prim™ive
èğ(*
»ã»nûPrim™ive
);

207 
	`­¶yVeùÜAtom
(*
rg‘Prim™ive
, 
x
);

209 
	}
}

212 
	gM3DSR•ProbËm
::
	$­¶yVeùÜAtom
(
M3DPrim™ive
 & 
´im
, cÚ¡ 
VeùÜ
 & 
x
)

227 
VeùÜ3D
 
Œªs
 ;

229 
sÿË0
, 
sÿË1
, 
sÿËEnd
 ;

230 
d–Th‘a0
, 
d–Th‘a1
, 
d–Th‘aEnd
 ;

231 
d–Phi0
, 
d–Phi1
, 
d–PhiEnd
 ;

234 
Œªs
 = ( 
	`x
(0è* 
	`VeùÜ3D
(1.0, 0.0, 0.0) ) ;

235 
Œªs
 +ğĞ
	`x
(1è* 
	`VeùÜ3D
(0.0, 1.0, 0.0) ) ;

236 
Œªs
 +ğĞ
	`x
(2è* 
	`VeùÜ3D
(0.0, 0.0, 1.0) ) ;

238 
Œªs
 *ğ
	`tunšgWt
(
AtomT¿n¦©iÚFaùÜ
);

241 ifĞ(
	`tunšgWt
(
SR•AtomRe¡riùMovem’t
)) ) {

243 
boŞ
 
»pÜ‹d
 = 
çl£
;

245 ifĞ!
»pÜ‹d
 ) {

246 
cout
 << "Di§blšg‡tom hub movem’ˆš s-»°¡age" << 
’dl
 ;

247 
»pÜ‹d
 = 1 ;

250 
Œªs
.
	`£tX
Ğ0.0 ) ;¿ns.
	`£tY
Ğ0.0 ) ;¿ns.
	`£tZ
( 0.0 ) ;

253 
´im
.
	`Œª¦©eBy
(
Œªs
);

255 
sÿË0
 = 
	`exp
(
	`tunšgWt
(
SR•SÿËFaùÜ
è* 
	`x
(3));

256 
d–Th‘a0
 = 
	`tunšgWt
(
SR•Th‘aFaùÜ
è* 
	`x
(4) ;

257 
d–Phi0
 = 
	`tunšgWt
(
SR•Th‘aFaùÜ
è* 
	`x
(5) ;

259 
sÿË1
 = 
	`exp
(
	`tunšgWt
(
SR•SÿËFaùÜ
è* 
	`x
(6));

260 
d–Th‘a1
 = 
	`tunšgWt
(
SR•Th‘aFaùÜ
è* 
	`x
(7) ;

261 
d–Phi1
 = 
	`tunšgWt
(
SR•Th‘aFaùÜ
è* 
	`x
(8) ;

265 
´im
.
	`sÿËSpokeBy
Ğ0, 
sÿË0
 ) ;

266 
´im
.
	`rÙ©eSpokeBy
Ğ0, 
d–Th‘a0
, 
d–Phi0
 ) ;

268 
´im
.
	`sÿËSpokeBy
Ğ1, 
sÿË1
 ) ;

269 
´im
.
	`rÙ©eSpokeBy
Ğ1, 
d–Th‘a1
, 
d–Phi1
 ) ;

273 ifĞ
´im
.
	`ty³
(è=ğ
M3D_END_PRIMITIVE
 ) {

275 
sÿËEnd
 = 
	`exp
(
	`tunšgWt
(
SR•SÿËFaùÜ
è* 
	`x
(9));

276 
d–Th‘aEnd
 = 
	`tunšgWt
(
SR•Th‘aFaùÜ
è* 
	`x
(10) ;

277 
d–PhiEnd
 = 
	`tunšgWt
(
SR•Th‘aFaùÜ
è* 
	`x
(11) ;

279 
´im
.
	`sÿËSpokeBy
Ğ2, 
sÿËEnd
 ) ;

280 
´im
.
	`rÙ©eSpokeBy
Ğ2, 
d–Th‘aEnd
, 
d–PhiEnd
 ) ;

289 
	}
}

293 #ifdeà
DEBUG_DIBYENDU_2


295 
	gM3DSR•ProbËm
 ::
	$upd©eT¬g‘Prim™ive
(cÚ¡ 
VeùÜ
 & 
x
)

301 
M3DFigu»
 * 
»ã»nûFigu»
 = 
»ã»nûObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

302 
M3DFigu»
 * 
rg‘Figu»
 = 
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

304 
M3DPrim™ive
 * 
»ã»nûPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
©omId
);

305 
M3DPrim™ive
 * 
rg‘Prim™ive
 = 
rg‘Figu»
->
	`g‘Prim™ivePŒ
(
©omId
);

307 (*
rg‘Prim™ive
èğ(*
»ã»nûPrim™ive
);

309 
	`­¶yVeùÜAtom
(*
rg‘Prim™ive
, 
x
);

311 
cout
 << "Atom ID = " << 
©omId
 << 
’dl
 ;

313 
cout
 << 
’dl
 << "Reference…rimitive was: " <<ƒndl <<ƒndl ;

314 
»ã»nûPrim™ive
->
	`´št
() ;

316 
cout
 << 
’dl
 << "Target…rimitive is: " <<ƒndl <<ƒndl ;

317 
rg‘Prim™ive
->
	`´št
() ;

319 
	}
}

321 
	gM3DSR•ProbËm
::
	$­¶yVeùÜAtom
(
M3DPrim™ive
 & 
´im
, cÚ¡ 
VeùÜ
 & 
x
)

336 
VeùÜ3D
 
Œªs
 ;

338 
sÿË0
, 
sÿË1
, 
sÿËEnd
 ;

339 
d–Th‘a0
, 
d–Th‘a1
, 
d–Th‘aEnd
 ;

340 
d–Phi0
, 
d–Phi1
, 
d–PhiEnd
 ;

343 
Œªs
 = ( 
	`x
(0è* 
	`VeùÜ3D
(1.0, 0.0, 0.0) ) ;

344 
Œªs
 +ğĞ
	`x
(1è* 
	`VeùÜ3D
(0.0, 1.0, 0.0) ) ;

345 
Œªs
 +ğĞ
	`x
(2è* 
	`VeùÜ3D
(0.0, 0.0, 1.0) ) ;

347 
Œªs
 *ğ
	`tunšgWt
(
AtomT¿n¦©iÚFaùÜ
);

350 ifĞ(
	`tunšgWt
(
SR•AtomRe¡riùMovem’t
)) ) {

352 
boŞ
 
»pÜ‹d
 = 
çl£
;

354 ifĞ!
»pÜ‹d
 ) {

355 
cout
 << "Di§blšg‡tom hub movem’ˆš s-»°¡age" << 
’dl
 ;

356 
»pÜ‹d
 = 1 ;

359 
Œªs
.
	`£tX
Ğ0.0 ) ;¿ns.
	`£tY
Ğ0.0 ) ;¿ns.
	`£tZ
( 0.0 ) ;

362 
´im
.
	`Œª¦©eBy
(
Œªs
);

364 
sÿË0
 = 
	`exp
(
	`tunšgWt
(
AtomSÿËFaùÜ
è* 
	`x
(3));

365 
d–Th‘a0
 = 
	`tunšgWt
(
AtomTh‘aFaùÜ
è* 
	`x
(4) ;

366 
d–Phi0
 = 
	`tunšgWt
(
AtomTh‘aFaùÜ
è* 
	`x
(5) ;

368 
sÿË1
 = 
	`exp
(
	`tunšgWt
(
AtomSÿËFaùÜ
è* 
	`x
(6));

369 
d–Th‘a1
 = 
	`tunšgWt
(
AtomTh‘aFaùÜ
è* 
	`x
(7) ;

370 
d–Phi1
 = 
	`tunšgWt
(
AtomTh‘aFaùÜ
è* 
	`x
(8) ;

374 
cout
 << "Sÿlšg spok0 by " << 
sÿË0
 << 
’dl
 ;

375 
´im
.
	`sÿËSpokeBy
Ğ0, 
sÿË0
 ) ;

377 
cout
 << "RÙ©šg spok0 by ( " << 
d–Th‘a0
 * 180 / 3.1416 << ", " << 
d–Phi0
 * 180 / 3.1416 << " ) deg»es" << 
’dl
 ;

378 
´im
.
	`rÙ©eSpokeBy
Ğ0, 
d–Th‘a0
, 
d–Phi0
 ) ;

380 
cout
 << "Sÿlšg spok1 by " << 
sÿË1
 << 
’dl
 ;

381 
´im
.
	`sÿËSpokeBy
Ğ1, 
sÿË1
 ) ;

383 
cout
 << "RÙ©šg spok1 by ( " << 
d–Th‘a1
 * 180 / 3.1416 << ", " << 
d–Phi1
 * 180 / 3.1416 << " ) deg»es" << 
’dl
 ;

384 
´im
.
	`rÙ©eSpokeBy
Ğ1, 
d–Th‘a1
, 
d–Phi1
 ) ;

388 ifĞ
´im
.
	`ty³
(è=ğ
M3D_END_PRIMITIVE
 ) {

390 
sÿËEnd
 = 
	`exp
(
	`tunšgWt
(
AtomSÿËFaùÜ
è* 
	`x
(9));

391 
d–Th‘aEnd
 = 
	`tunšgWt
(
AtomTh‘aFaùÜ
è* 
	`x
(10) ;

392 
d–PhiEnd
 = 
	`tunšgWt
(
AtomTh‘aFaùÜ
è* 
	`x
(11) ;

394 
cout
 << "Sÿlšg spokEnd by " << 
sÿËEnd
 << 
’dl
 ;

395 
´im
.
	`sÿËSpokeBy
Ğ2, 
sÿËEnd
 ) ;

397 
cout
 << "RÙ©šg spokEnd by ( " << 
d–Th‘aEnd
 * 180 / 3.1416 << ", " << 
d–PhiEnd
 * 180 / 3.1416 << " ) deg»es" << 
’dl
 ;

398 
´im
.
	`rÙ©eSpokeBy
Ğ2, 
d–Th‘aEnd
, 
d–PhiEnd
 ) ;

406 
	}
}

410 
	gM3DSR•ProbËmBoundsFunùiÚ
::
	$bound
Ğ
i
 )

412 
	`as£¹
Ğ
i
 >= 0 );

414 
VeùÜ
 
	`bounds
(3, 
	`log
(
	`tunšgWt
(
SR•SÿËBound
)),

415 
	`tunšgWt
(
SR•Th‘aBound
è* 
R_PI
/180.0,

416 
	`tunšgWt
(
SR•Th‘aBound
è* 
R_PI
/180.0) ;

418  
	`bounds
Ğ(
i
 < 
bounds
.
	`size
()) ? i : (bounds.size() - 1) );

420 
	}
}

422 
	gM3DSR•ProbËmBoundsFunùiÚ
::
	$çùÜ
Ğ
i
 )

424 
	`as£¹
Ğ
i
 >= 0 );

426 
VeùÜ
 
	`çùÜs
(3, 
	`tunšgWt
(
SR•SÿËFaùÜ
),

427 
	`tunšgWt
(
SR•Th‘aFaùÜ
),

428 
	`tunšgWt
(
SR•Th‘aFaùÜ
) );

430  
	`çùÜs
Ğ(
i
 < 
çùÜs
.
	`size
()) ? i : (factors.size() - 1) );

432 
	}
}

	@M3DSimilarityCPNSOptimizer.cpp

1 
	~<f¡»am
>

2 
	~<¡dio.h
>

3 
	~<m©h.h
>

4 
	~"O±imiz”Ba£.h
"

5 
	~"M3DSim¬™yCPNSO±imiz”.h
"

7 
usšg
 
Çme¥aû
 
	g¡d
;

9 
	gM3DSim¬™yCPNSO±imiz”
::
	$M3DSim¬™yCPNSO±imiz”
(
M©ch
 *
m
, 
M3DCPNSSts
 *
ıns
)

10 : 
	$M3DMašFigu»O±imiz”
(
m
)

13 
boundsFunùiÚ
 = 
Ãw
 
	`M3DSim¬™yCPNSProbËmBoundsFunùiÚ
();

14 
´obËm
 = 
Ãw
 
	`M3DSim¬™yCPNSProbËm
();

15 
¡©ic_ÿ¡
<
M3DSim¬™yCPNSProbËm
 *>(
´obËm
)->
	`£tCPNS
(
ıns
);

16 
	}
}

	@M3DSimilarityCPNSProblem.cpp

1 
	~<m©h.h
>

2 
	~<io¡»am
>

3 
	~"M3DSim¬™yCPNSProbËm.h
"

4 
	~"Tunšg.h
"

6 #ifdeà
USE_KNOWN_QUADRATIC


8 
DEBUG_ev®u©e
(cÚ¡ 
VeùÜ
 & 
x
);

12 
glob®V”bos™y
;

14 
usšg
 
Çme¥aû
 
	g¡d
;

16 
	gM3DSim¬™yCPNSProbËm
::
	$M3DSim¬™yCPNSProbËm
(è: 
	$M3DMašFigu»ProbËm
()

18 #ifdeà
BINARY


19 
sim¬™yObjeù
 = 
NULL
;

22 
cout
 << "ProbËm" << 
’dl
;

23 
	}
}

25 
	gM3DSim¬™yCPNSProbËm
::~
	$M3DSim¬™yCPNSProbËm
()

27 #ifdeà
BINARY


28 
d–‘e
 
sim¬™yObjeù
;

30 
	}
}

32 
	gM3DSim¬™yCPNSProbËm
::
	$š™Ÿlize
(
M©ch
 *
m
, 
M3DObjeù
 * 
»ã»nûObjeù
, 
Œ“Index
)

34 
M3DMašFigu»ProbËm
::
	`š™Ÿlize
(
m
, 
»ã»nûObjeù
, 
Œ“Index
);

35 #ifdeà
BINARY


36 
	`š™ŸlizeCPNS
();

38 ià(
sim¬™yObjeù
 !ğ
NULL
)

40 
d–‘e
 
sim¬™yObjeù
;

41 
sim¬™yObjeù
 = 
NULL
;

45 
	}
}

47 
	gM3DSim¬™yCPNSProbËm
::
	$£tCPNS
(
M3DCPNSSts
 * 
ınsSt
)

49 
cout
 << "£tCPNS" << 
’dl
;

50 ià(
ınsSt
 =ğ
NULL
)

53 
ıns
 = 
ınsSt
;

54 
	}
}

56 
	gM3DSim¬™yCPNSProbËm
::
	$·¿m‘”CouÁ
() const

58 
maxModes
, 
numModes
;

60 ià(
»fObjeù
 =ğ
NULL
)

63 
M3DFigu»T»eNode
* 
Œ“Node
 = 
»fObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“_šdex
);

64 ià(
Œ“Node
 =ğ
NULL
)

67 
figu»Id
 = 
Œ“Node
->
	`g‘Figu»Id
();

69 
maxModes
 = (è
	`tunšgWt
(
Figu»MaxPGAModes
);

70 
numModes
 = 
ıns
->
	`g‘NEig’Modes
();

72 ià(
maxModes
 < 
numModes
)

73 
numModes
 = 
maxModes
;

75 ià(0 =ğ(è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
))

76 
numModes
 += 7;

78  
numModes
;

80 
	}
}

82 
	gM3DSim¬™yCPNSProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 & 
x
)

84 
geomP’®ty
;

85 
tÙ®P’®ty
;

87 
M3DObjeù
 * 
rg‘Objeù
;

88 
figu»Id
;

90 
ev®u©iÚCo¡
 += 1;

92 ià(
m©ch
 =ğ
NULL
)

93  
MAIN_FIGURE_MAX_RETURN
;

95 ià(
glob®V”bos™y
 > 1)

97 
cout
 << " x:";

98 
i
 = 0; i < 
x
.
	`size
(); i++)

99 
cout
 << ' ' << 
	`x
(
i
);

100 
cout
 << '\n';

103 
rg‘Objeù
 = 
	`ü—‹T¬g‘Objeù
(
x
, 
figu»Id
);

104 
¡d
::
veùÜ
<> 
ıns
 = 
	`ınsCÛffic›Ás
(
x
);

106 #ifdeà
BINARY


107 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›s
(
rg‘Objeù
, 
figu»Id
, 
sim¬™yObjeù
, 
ıns
, 
geomP’®ty
);

108 
Ï¡P’®ty
 = 
tÙ®P’®ty
;

110 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›s
(
rg‘Objeù
, 
figu»Id
, 
NULL
, 
ıns
, 
geomP’®ty
);

111 
Ï¡P’®ty
 = 
geomP’®ty
;

114 
d–‘e
 
rg‘Objeù
;

116  
tÙ®P’®ty
;

118 
	}
}

120 
CompÚ’ts
 
	gM3DSim¬™yCPNSProbËm
::
	$ev®u©eT”ms
(cÚ¡ 
VeùÜ
 &
x
)

122 
geomP’®ty
;

123 
CompÚ’ts
 
tÙ®P’®ty
;

124 
M3DObjeù
 * 
rg‘Objeù
;

125 
figu»Id
;

127 
ev®u©iÚCo¡
 += 1;

129 ià(
m©ch
 =ğ
NULL
)

130  
	`CompÚ’ts
(
MAIN_FIGURE_MAX_RETURN
);

132 ià(
glob®V”bos™y
 > 1)

134 
cout
 << " x:";

135 
i
 = 0; i < 
x
.
	`size
(); i++)

136 
cout
 << ' ' << 
	`x
(
i
);

137 
cout
 << '\n';

141 
rg‘Objeù
 = 
	`ü—‹T¬g‘Objeù
(
x
, 
figu»Id
);

142 
¡d
::
veùÜ
<> 
cÛffs
 = 
	`ınsCÛffic›Ás
(
x
);

144 #ifdeà
BINARY


145 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›sAsCompÚ’ts
(
rg‘Objeù
, 
figu»Id
, 
sim¬™yObjeù
, 
cÛffs
, 
geomP’®ty
);

146 
Ï¡P’®ty
 = 
tÙ®P’®ty
.
rough
 +Ù®P’®ty.
smoÙh
;

148 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›sAsCompÚ’ts
(
rg‘Objeù
, 
figu»Id
, 
NULL
, 
ıns
, 
geomP’®ty
);

149 
Ï¡P’®ty
 = 
geomP’®ty
;

152 
d–‘e
 
rg‘Objeù
;

153  
tÙ®P’®ty
;

154 
	}
}

156 
M3DObjeù
 * 
	gM3DSim¬™yCPNSProbËm
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 &
x
, & 
figu»Id
, 
boŞ
 
´ediù
)

158 
´im™iveCouÁ
;

159 
M3DObjeù
 *
rg‘Objeù
;

160 
M3DFigu»T»eNode
 *
Œ“Node
;

161 
M3DFigu»
 *
figu»
;

163 ià(
»fObjeù
 =ğ
NULL
)

164  
NULL
;

166 
Œ“Node
 = 
»fObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“_šdex
);

167 ià(
Œ“Node
 =ğ
NULL
)

168  
NULL
;

170 #ifdeà
BINARY


171 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

173 
figu»Id
 = 
Œ“Node
->
	`g‘Figu»Id
();

176 
rg‘Objeù
 = 
»fObjeù
->
	`assign
();

178 
figu»
 = 
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

179 ià(
figu»
 =ğ
NULL
)

181 
d–‘e
 
rg‘Objeù
;

182  
NULL
;

184 
figu»
->
	`£Ëù
();

186 
´im™iveCouÁ
 = 
figu»
->
	`g‘Prim™iveCouÁ
();

188 
veùÜ
<> 
v®s
 = 
	`ınsCÛffic›Ás
(
x
);

189 * 
cÛffs
 = 
Ãw
 [
v®s
.
	`size
()];

191 
i
 = 0; i < 
v®s
.
	`size
(); i++)

192 
cÛffs
[
i
]=
v®s
[i];

194 
rg‘Objeù
 = 
ıns
->
	`eig’modeDefÜmM—n
(
cÛffs
, 
»fObjeù
, 
v®s
.
	`size
());

196 #ifdeà
UNFLIPPED


197 
VeùÜ3D
 
	`ûÁ”
(0.0, 1.0, 0.0);

199 
VeùÜ3D
 
	`ûÁ”
(0.0, 0.0, 0.0);

201 #ifdeà
BINARY


202 
u£MOM
 = (
	`tunšgWt
(
BpDoM‘hodOfMom’ts
) &&

203 ! 
	`tunšgWt
(
BpFigu»Re£tMod–BefÜe
));

204 
Sim¬™yT¿nsfÜm3D
 * 
xfÜm
 = 
u£MOM
 ? &
GLOBALMOMT¿nsfÜm


205 : 
rg‘Objeù
->
	`g‘T¿nsfÜm©iÚ
();

206 
figu»
->
	`­¶ySim¬™y
(*
xfÜm
, 
ûÁ”
);

208 
sim¬™yObjeù
 = 
rg‘Objeù
->
	`assign
();

211 ià((è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
) == 0)

213 
Qu©
 
fš®RÙ
;

214 
VeùÜ3D
 
axis
;

215 
axis
.
	`£t
(
	`x
(3), x(4), x(5));

216 
ªgË
 = 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
è* 
axis
.
	`nÜm®ize
();

217 
fš®RÙ
.
	`£tAxisAngË
(
axis
, 
ªgË
);

220 
Sim¬™yT¿nsfÜm3D
 
Œf
;

221 
Œf
.
	`£tT¿n¦©iÚ
Ğ
	`VeùÜ3D
(
	`x
(0), x(1), x(2))

222 * 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
) );

223 
Œf
.
	`£tRÙ©iÚ
Ğ
fš®RÙ
 );

224 
Œf
.
	`£tSÿË
Ğ
	`exp
(
	`tunšgWt
(
Figu»SÿËFaùÜ
è* 
	`x
(6)) );

226 
figu»
->
	`­¶ySim¬™yAboutCOG
Ğ&
Œf
 );

231  
rg‘Objeù
;

233 
	}
}

235 
	g¡d
::
veùÜ
<> 
M3DSim¬™yCPNSProbËm
::
	$ınsCÛffic›Ás
ĞcÚ¡ 
VeùÜ
 &
x
 )

237 
veùÜ
<> 
cÛffs
;

239 
¡¬t
;

241 ià(0 !ğ(è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
))

242 
¡¬t
 = 0;

244 
¡¬t
 = 7;

245 
i
 = 
¡¬t
; i < 
x
.
	`size
(); i++)

247 
cÛffs
.
	`push_back
(
	`x
(
i
)*
	`tunšgWt
(
Figu»PGAFaùÜ
));

250  
cÛffs
;

251 
	}
}

254 
	gM3DSim¬™yCPNSProbËm
::
	$š™ŸlizeCPNS
()

257 
	}
}

259 
	gM3DSim¬™yCPNSProbËmBoundsFunùiÚ
::
	$M3DSim¬™yCPNSProbËmBoundsFunùiÚ
()

261 ià((è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
) == 0) {

262 
bounds
 = 
	`VeùÜ
(8,

263 
	`tunšgWt
(
Figu»T¿n¦©iÚBound
),uningWt(FigureTranslationBound),uningWt(FigureTranslationBound),

264 
	`tunšgWt
(
Figu»RÙ©iÚBound
)*
R_PI
/180.0,uningWt(FigureRotationBound)*R_PI/180.0,uningWt(FigureRotationBound)*R_PI/180.0,

265 
	`log
(
	`tunšgWt
(
Figu»SÿËBound
)),

266 
	`tunšgWt
(
Figu»PGABound
));

267 
çùÜs
 = 
	`VeùÜ
(8,

268 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
),

269 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
),

270 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
),

271 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
),

272 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
),

273 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
),

274 
	`tunšgWt
(
Figu»SÿËFaùÜ
),

275 
	`tunšgWt
(
Figu»PGAFaùÜ
));

278 
bounds
 = 
	`VeùÜ
(1, 3.0);

279 
çùÜs
 = 
	`VeùÜ
(1,

280 
	`tunšgWt
(
Figu»PGAFaùÜ
));

282 
	}
}

	@M3DSimilarityElongationOptimizer.cpp

1 
	~<f¡»am
>

2 
	~<m©h.h
>

3 
	~"O±imiz”Ba£.h
"

4 
	~"M3DSim¬™yElÚg©iÚO±imiz”.h
"

7 
	gM3DSim¬™yElÚg©iÚO±imiz”
::
	$M3DSim¬™yElÚg©iÚO±imiz”
(
M©ch
 * 
m
,

8 
couÁ
è: 
	$M3DMašFigu»O±imiz”
(
m
, 
couÁ
)

10 
´obËm
 = 
Ãw
 
M3DSim¬™yElÚg©iÚProbËm
;

12 
´obËm
->
	`£tP¬am‘”CouÁ
(
	`·¿m‘”CouÁ
());

13 
boundsFunùiÚ
 = 
Ãw
 
	`M3DSim¬™yElÚg©iÚProbËmBoundsFunùiÚ
(
¡©ic_ÿ¡
<
M3DSim¬™yElÚg©iÚProbËm
*>(
´obËm
));

14 
	}
}

	@M3DSimilarityElongationProblem.cpp

1 
	~<m©h.h
>

2 
	~<io¡»am
>

3 
	~"M3DSim¬™yElÚg©iÚProbËm.h
"

4 
	~"M3DFigu»ElÚg©”.h
"

5 
	~"LogMªag”.h
"

6 
	~"Tunšg.h
"

12 
glob®V”bos™y
;

14 
usšg
 
Çme¥aû
 
	g¡d
;

17 #ifdeà
BINARY


18 
compu‹Lªdm¬kP’®ty
(
M3DObjeù
 * 
rg‘Objeù
, 
figu»Id
,

19 
M3DObjeù
 * 
liObjeù
);

23 
	gM3DSim¬™yElÚg©iÚProbËm
::
	$M3DSim¬™yElÚg©iÚProbËm
()

24 : 
	$M3DMašFigu»ProbËm
()

26 
tubePhiMode
 = 
Œue
;

27 
	}
}

30 
	gM3DSim¬™yElÚg©iÚProbËm
::
	$š™Ÿlize
(
M©ch
 * 
m
, 
M3DObjeù
 * 
»ã»nûObjeù
,

31 
Œ“Index
)

33 
M3DMašFigu»ProbËm
::
	`š™Ÿlize
(
m
, 
»ã»nûObjeù
, 
Œ“Index
 );

34 
M3DFigu»T»eNode
* 
Œ“Node
 = 
»fObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“Index
);

35 
figu»Id
 = 
Œ“Node
->
	`g‘Figu»Id
();

36 ifĞ
dyÇmic_ÿ¡
<
M3DTubeFigu»
*>(
»fObjeù
->
	`g‘Figu»PŒ
(
figu»Id
)è!ğ
NULL
 ) {

37 
tubePhiMode
 = 
Œue
;

38 
	`£tP¬am‘”CouÁ
(
	`·¿m‘”CouÁ
()+1);

41 
tubePhiMode
 = 
çl£
;

44 
	}
}

47 
	gM3DSim¬™yElÚg©iÚProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 & 
x
)

49 
tÙ®P’®ty
;

50 
Sim¬™yT¿nsfÜm3D
 
ŒªsfÜmM©rix
;

51 
M3DObjeù
 * 
rg‘Objeù
;

52 
geomP’®ty
;

53 
figu»Id
;

55 
ev®u©iÚCo¡
 += 1;

57 ià(
m©ch
 =ğ
NULL
)

58  
MAIN_FIGURE_MAX_RETURN
;

60 #ifdeà
BINARY


61 ià(
glob®V”bos™y
 > 0) {

62 
cout
 << " x:";

63 
i
 = 0; i < 
x
.
	`size
(); i++)

64 
cout
 << ' ' << 
	`x
(
i
);

65 
cout
 << '\n';

69 
rg‘Objeù
 = 
	`ü—‹T¬g‘Objeù
(
x
, 
figu»Id
);

72 #ifdeà
BINARY


74 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›s
(
rg‘Objeù
,

75 
figu»Id
, 
»fObjeù
, 
¡d
::
veùÜ
<>(), 
geomP’®ty
);

76 
Ï¡P’®ty
 = 
tÙ®P’®ty
;

78 ià(
m©ch
->
	`g‘Ty³
(è=ğ
BINARY_IMAGE_MATCH
)

81 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›s
(
rg‘Objeù
,

82 
figu»Id
, 
NULL
, 
¡d
::
veùÜ
<>(), 
geomP’®ty
);

83 
Ï¡P’®ty
 = 
geomP’®ty
;

86 
d–‘e
 
rg‘Objeù
;

88 #ifdeà
OPTIMIZATION_VISUALIZER


89 
	`cİyResuÉsToVisu®iz”
(&
x
, 
tÙ®P’®ty
);

92  
tÙ®P’®ty
;

93 
	}
}

95 
CompÚ’ts
 
	gM3DSim¬™yElÚg©iÚProbËm
::
	$ev®u©eT”ms
(cÚ¡ 
VeùÜ
 & 
x
)

97 
CompÚ’ts
 
tÙ®P’®ty
;

98 
Sim¬™yT¿nsfÜm3D
 
ŒªsfÜmM©rix
;

99 
M3DObjeù
 * 
rg‘Objeù
;

100 
geomP’®ty
;

101 
figu»Id
;

103 
ev®u©iÚCo¡
 += 1;

105 ià(
m©ch
 =ğ
NULL
)

106  
	`CompÚ’ts
(
MAIN_FIGURE_MAX_RETURN
);

108 #ifdeà
BINARY


109 ià(
glob®V”bos™y
 > 0) {

110 
cout
 << " x:";

111 
i
 = 0; i < 
x
.
	`size
(); i++)

112 
cout
 << ' ' << 
	`x
(
i
);

113 
cout
 << '\n';

117 
rg‘Objeù
 = 
	`ü—‹T¬g‘Objeù
(
x
, 
figu»Id
);

121 #ifdeà
BINARY


123 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›sAsCompÚ’ts
(
rg‘Objeù
,

124 
figu»Id
, 
»fObjeù
, 
¡d
::
veùÜ
<>(), 
geomP’®ty
);

125 
Ï¡P’®ty
 = 
tÙ®P’®ty
.
rough
 +Ù®P’®ty.
smoÙh
;

127 ià(
m©ch
->
	`g‘Ty³
(è=ğ
BINARY_IMAGE_MATCH
)

128  
	`CompÚ’ts
(0.0);

130 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›sAsCompÚ’ts
(
rg‘Objeù
,

131 
figu»Id
, 
NULL
, 
¡d
::
veùÜ
<>(), 
geomP’®ty
);

132 
Ï¡P’®ty
 = 
geomP’®ty
;

135 
d–‘e
 
rg‘Objeù
;

137 #ifdeà
OPTIMIZATION_VISUALIZER


138 
	`cİyResuÉsToVisu®iz”
(&
x
, 
tÙ®P’®ty
.
rough
 +Ù®P’®ty.
smoÙh
);

141  
tÙ®P’®ty
;

142 
	}
}

148 
M3DObjeù
 * 
	gM3DSim¬™yElÚg©iÚProbËm
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 & 
x
,

149 & 
figu»Id
, 
boŞ
 
´ediù
)

151 
VeùÜ3D
 
Œªs
;

152 
Qu©
 
fš®RÙ
;

153 
VeùÜ3D
 
axis
;

154 
ªgË
;

155 
–Úg©iÚ
 = 0.0;

156 
M3DFigu»ElÚg©”
 
–Úg©”
;

157 
M3DFigu»
 * 
figu»
;

158 
M3DObjeù
 * 
rg‘Objeù
;

159 #iâdeà
BINARY


160 
M3DFigu»T»eNode
 * 
Œ“Node
;

163 ià(
»fObjeù
 =ğ
NULL
)

164  
NULL
;

166 #iâdeà
BINARY


167 
Œ“Node
 = 
»fObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“_šdex
);

168 ià(
Œ“Node
 =ğ
NULL
)

169  
NULL
;

171 
figu»Id
 = 
Œ“Node
->
	`g‘Figu»Id
();

173 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

176 
rg‘Objeù
 = 
»fObjeù
->
	`assign
();

178 
figu»
 = 
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

179 ià(
figu»
 =ğ
NULL
) {

180 
d–‘e
 
rg‘Objeù
;

181  
NULL
;

183 
figu»
->
	`£Ëù
();

186 #ifdeà
UNFLIPPED


187 
VeùÜ3D
 
	`ûÁ”
(0.0, 1.0, 0.0);

189 
VeùÜ3D
 
	`ûÁ”
(0.0, 0.0, 0.0);

191 #iâdeà
BINARY


192 
figu»
->
	`­¶ySim¬™y
(
mašFigProbËmSimT¿nsfÜm
, 
ûÁ”
);

194 
figu»
->
	`­¶ySim¬™y
(
GLOBALMOMT¿nsfÜm
, 
	`VeùÜ3D
(0.0, 0.0, 0.0));

198 
Sim¬™yT¿nsfÜm3D
 
Œf
;

199 
Œf
.
	`£tT¿n¦©iÚ
Ğ
	`VeùÜ3D
(
	`x
(0), x(1), x(2))

200 * 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
) );

202 
axis
.
	`£t
(
	`x
(3), x(4), x(5));

203 
ªgË
 = 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
è* 
axis
.
	`nÜm®ize
();

204 
fš®RÙ
.
	`£tAxisAngË
(
axis
, 
ªgË
);

205 
Œf
.
	`£tRÙ©iÚ
Ğ
fš®RÙ
 );

207 ifĞ
tubePhiMode
 ) {

208 
Œf
.
	`£tTubePhi
Ğ
	`x
(6è* 
	`tunšgWt
(
Figu»TubePhiFaùÜ
) );

209 ià(
	`·¿m‘”CouÁ
() > 7) {

210 
Œf
.
	`£tSÿË
Ğ
	`exp
(
	`tunšgWt
(
Figu»SÿËFaùÜ
è* 
	`x
(7)) );

214 ià(
	`·¿m‘”CouÁ
() > 6) {

215 
Œf
.
	`£tSÿË
Ğ
	`exp
(
	`tunšgWt
(
Figu»SÿËFaùÜ
è* 
	`x
(6)) );

219 
figu»
->
	`­¶ySim¬™yAboutCOG
Ğ&
Œf
 );

221 ià(
	`·¿m‘”CouÁ
(è> 7 && !
tubePhiMode
) {

223 
–Úg©iÚ
 = 
	`exp
(
	`tunšgWt
(
Figu»ElÚg©iÚFaùÜ
è* 
	`x
(7));

224 
–Úg©”
.
	`š™Ÿlize
(
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
figu»
));

225 
–Úg©”
.
	`–Úg©e
(
–Úg©iÚ
);

228 ifĞ
glob®V”bos™y
 >= 1 ) {

229 
™”©iÚCouÁ”
 = 0;

230 
¡d
::
cout
 << 
™”©iÚCouÁ”
++ << ": T:";

231 
Œf
.
	`g‘T¿n¦©iÚ
().
	`´št
();

232 
cout
 << " R:";

233 
Œf
.
	`g‘RÙ©iÚ
().
	`´št
();

234 
cout
 << " S: " << 
Œf
.
	`g‘SÿË
(è<< " Phi: " <<rf.
	`g‘TubePhi
(è<< " E: " << 
–Úg©iÚ
 << 
’dl
;

237 #ifdeà
DEBUG_SAVE_INTERMEDIATE_MODELS


238 
‹mpName
[50];

239 
couÁ”AtomI‹¿tiÚs
=0;

240 
P3DCÚŒŞ
 * 
gCÚŒŞ
 = 
NULL
;

241 ifĞ
gCÚŒŞ
 =ğ
NULL
 ) {

242 
gCÚŒŞ
ğ
Ãw
 
	`P3DCÚŒŞ
(0);

245 
M3DObjeù
 * 
‹mp
 = 
rg‘Objeù
->
	`assign
();

246 
gCÚŒŞ
->
	`ÃwMod–
(
‹mp
);

247 
	`¥rštf
(
‹mpName
,"figu»_™”%03d.m3d",
couÁ”AtomI‹¿tiÚs
++);

248 
gCÚŒŞ
->
	`wr™e
(
‹mpName
);

252  
rg‘Objeù
;

253 
	}
}

255 
	gM3DSim¬™yElÚg©iÚProbËmBoundsFunùiÚ
::
	$bound
Ğ
i
 )

257 
	`as£¹
(
i
 >= 0);

258 
VeùÜ
 
bounds
;

260 ifĞ
´obËm
->
tubePhiMode
 ) {

261 
bounds
 = 
	`VeùÜ
(8,

262 
	`tunšgWt
(
Figu»T¿n¦©iÚBound
),uningWt(FigureTranslationBound),uningWt(FigureTranslationBound),

263 
	`tunšgWt
(
Figu»RÙ©iÚBound
)*
R_PI
/180.0,uningWt(FigureRotationBound)*R_PI/180.0,uningWt(FigureRotationBound)*R_PI/180.0,

264 
	`tunšgWt
(
Figu»TubePhiBound
)*
R_PI
/180.0,

265 
	`log
(
	`tunšgWt
(
Figu»SÿËBound
)));

268 
bounds
 = 
	`VeùÜ
(8,

269 
	`tunšgWt
(
Figu»T¿n¦©iÚBound
),uningWt(FigureTranslationBound),uningWt(FigureTranslationBound),

270 
	`tunšgWt
(
Figu»RÙ©iÚBound
)*
R_PI
/180.0,uningWt(FigureRotationBound)*R_PI/180.0,uningWt(FigureRotationBound)*R_PI/180.0,

271 
	`log
(
	`tunšgWt
(
Figu»SÿËBound
)),

272 
	`log
(
	`tunšgWt
(
Figu»ElÚg©iÚBound
)));

274  
	`bounds
Ğ(
i
 < 
bounds
.
	`size
()) ? i : (bounds.size() - 1) );

275 
	}
}

277 
	gM3DSim¬™yElÚg©iÚProbËmBoundsFunùiÚ
::
	$çùÜ
(
i
 )

279 
	`as£¹
(
i
 >= 0);

280 
VeùÜ
 
çùÜs
;

282 ifĞ
´obËm
->
tubePhiMode
 ) {

283 
çùÜs
 = 
	`VeùÜ
(8,

284 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
),uningWt(FigureTranslationFactor),uningWt(FigureTranslationFactor),

285 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
),uningWt(FigureRotationFactor),uningWt(FigureRotationFactor),

286 
	`tunšgWt
(
Figu»TubePhiFaùÜ
),

287 
	`tunšgWt
(
Figu»SÿËFaùÜ
));

290 
çùÜs
 = 
	`VeùÜ
(8,

291 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
),uningWt(FigureTranslationFactor),uningWt(FigureTranslationFactor),

292 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
),uningWt(FigureRotationFactor),uningWt(FigureRotationFactor),

293 
	`tunšgWt
(
Figu»SÿËFaùÜ
),

294 
	`tunšgWt
(
Figu»ElÚg©iÚFaùÜ
));

296  
	`çùÜs
Ğ(
i
 < 
çùÜs
.
	`size
()) ? i : (factors.size() - 1) );

297 
	}
}

	@M3DSimilarityPGAOptimizer.cpp

1 
	~<f¡»am
>

2 
	~<¡dio.h
>

3 
	~<m©h.h
>

4 
	~"O±imiz”Ba£.h
"

5 
	~"M3DSim¬™yPGAO±imiz”.h
"

6 
	~"M3DTubeSim¬™yPGAProbËm.h
"

9 
usšg
 
Çme¥aû
 
	g¡d
;

11 
	gM3DSim¬™yPGAO±imiz”
::
	$M3DSim¬™yPGAO±imiz”
(
M©ch
 * 
m
, 
M3DPGASts
 * 
pga
)

12 : 
	$M3DMašFigu»O±imiz”
(
m
)

16 
´obËm
 = 
Ãw
 
M3DTubeSim¬™yPGAProbËm
;

17 
boundsFunùiÚ
 = 
Ãw
 
	`M3DTubeSim¬™yPGAProbËmBoundsFunùiÚ
(
¡©ic_ÿ¡
<
M3DTubeSim¬™yPGAProbËm
*>(
´obËm
));

18 
¡©ic_ÿ¡
<
M3DSim¬™yPGAProbËm
 *>(
´obËm
)->
	`£tPGA
(
pga
);

21 
	}
}

	@M3DSimilarityPGAProblem.cpp

1 
	~<m©h.h
>

2 
	~<io¡»am
>

3 
	~"M3DSim¬™yPGAProbËm.h
"

4 
	~"Tunšg.h
"

12 #ifdeà
USE_KNOWN_QUADRATIC


17 
DEBUG_ev®u©e
(cÚ¡ 
VeùÜ
 & 
x
);

22 
glob®V”bos™y
;

25 
usšg
 
Çme¥aû
 
	g¡d
;

28 
	gM3DSim¬™yPGAProbËm
::
	$M3DSim¬™yPGAProbËm
(è: 
	$M3DMašFigu»ProbËm
()

30 #ifdeà
BINARY


31 
sim¬™yObjeù
 = 
NULL
;

33 
	}
}

35 
	gM3DSim¬™yPGAProbËm
::~
	$M3DSim¬™yPGAProbËm
()

37 #ifdeà
BINARY


38 
d–‘e
 
sim¬™yObjeù
;

40 
	}
}

42 
	gM3DSim¬™yPGAProbËm
::
	$š™Ÿlize
(
M©ch
 * 
m
, 
M3DObjeù
 * 
»ã»nûObjeù
,

43 
Œ“Index
)

45 
M3DMašFigu»ProbËm
::
	`š™Ÿlize
(
m
, 
»ã»nûObjeù
, 
Œ“Index
);

46 #ifdeà
BINARY


47 
	`š™ŸlizePGA
();

49 ià(
sim¬™yObjeù
 !ğ
NULL
) {

50 
d–‘e
 
sim¬™yObjeù
;

51 
sim¬™yObjeù
 = 
NULL
;

54 
	}
}

56 
	gM3DSim¬™yPGAProbËm
::
	$£tPGA
(
M3DPGASts
 * 
pgaSt
)

58 ià(
pgaSt
 =ğ
NULL
)

61 
pga
 = 
pgaSt
;

62 
	}
}

67 
	gM3DSim¬™yPGAProbËm
::
	$·¿m‘”CouÁ
() const

69 
maxModes
, 
numModes
;

71 ià(
»fObjeù
 =ğ
NULL
)

74 
M3DFigu»T»eNode
* 
Œ“Node
 = 
»fObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“_šdex
);

75 ià(
Œ“Node
 =ğ
NULL
)

79 
figu»Id
 = 
Œ“Node
->
	`g‘Figu»Id
();

80 
Üd”
 = 
pga
->
	`fšdPGS‘Id
(
figu»Id
);

82 
PGD©a
 * 
pgPŒ
 = 
pga
->
	`g‘PGD©aPŒ
(
Üd”
);

84 
maxModes
 = (è
	`tunšgWt
(
Figu»MaxPGAModes
);

85 
numModes
 = 
pgPŒ
->
numPGs
;

87 ià(
maxModes
 < 
numModes
)

88 
numModes
 = 
maxModes
;

90 ià(0 =ğ(è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
))

91 
numModes
 += 7;

93  
numModes
;

94 
	}
}

96 
	gM3DSim¬™yPGAProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 & 
x
)

99 #ifdeà
USE_KNOWN_QUADRATIC


100  
	`DEBUG_ev®u©e
(
x
);

103 
geomP’®ty
;

104 
tÙ®P’®ty
;

105 
M3DObjeù
 * 
rg‘Objeù
;

106 
figu»Id
;

108 
ev®u©iÚCo¡
 += 1;

110 ià(
m©ch
 =ğ
NULL
)

111  
MAIN_FIGURE_MAX_RETURN
;

113 ià(
glob®V”bos™y
 > 1) {

114 
cout
 << " x:";

115 
i
 = 0; i < 
x
.
	`size
(); i++)

116 
cout
 << ' ' << 
	`x
(
i
);

117 
cout
 << '\n';

121 
rg‘Objeù
 = 
	`ü—‹T¬g‘Objeù
(
x
, 
figu»Id
);

122 
¡d
::
veùÜ
<> 
pga
 = 
	`pgaCÛffic›Ás
(
x
);

124 #ifdeà
BINARY


125 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›s
(
rg‘Objeù
, 
figu»Id
,

126 
sim¬™yObjeù
, 
pga
, 
geomP’®ty
);

127 
Ï¡P’®ty
 = 
tÙ®P’®ty
;

129 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›s
(
rg‘Objeù
, 
figu»Id
,

130 
NULL
, 
pga
, 
geomP’®ty
);

131 
Ï¡P’®ty
 = 
geomP’®ty
;

134 
d–‘e
 
rg‘Objeù
;

136 #ifdeà
OPTIMIZATION_VISUALIZER


137 
	`cİyResuÉsToVisu®iz”
(&
x
, 
tÙ®P’®ty
);

140  
tÙ®P’®ty
;

141 
	}
}

143 
CompÚ’ts
 
	gM3DSim¬™yPGAProbËm
::
	$ev®u©eT”ms
(cÚ¡ 
VeùÜ
 & 
x
)

146 
geomP’®ty
;

147 
CompÚ’ts
 
tÙ®P’®ty
;

148 
M3DObjeù
 * 
rg‘Objeù
;

149 
figu»Id
;

151 
ev®u©iÚCo¡
 += 1;

153 ià(
m©ch
 =ğ
NULL
)

154  
	`CompÚ’ts
(
MAIN_FIGURE_MAX_RETURN
);

156 ià(
glob®V”bos™y
 > 1) {

157 
cout
 << " x:";

158 
i
 = 0; i < 
x
.
	`size
(); i++)

159 
cout
 << ' ' << 
	`x
(
i
);

160 
cout
 << '\n';

164 
rg‘Objeù
 = 
	`ü—‹T¬g‘Objeù
(
x
, 
figu»Id
);

165 
¡d
::
veùÜ
<> 
pga
 = 
	`pgaCÛffic›Ás
(
x
);

167 #ifdeà
BINARY


168 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›sAsCompÚ’ts
(
rg‘Objeù
, 
figu»Id
,

169 
sim¬™yObjeù
, 
pga
, 
geomP’®ty
);

170 
Ï¡P’®ty
 = 
tÙ®P’®ty
.
rough
 +Ù®P’®ty.
smoÙh
;

172 
tÙ®P’®ty
 = 
m©ch
->
	`compu‹Figu»M©chAndP’®t›sAsCompÚ’ts
(
rg‘Objeù
, 
figu»Id
,

173 
NULL
, 
pga
, 
geomP’®ty
);

174 
Ï¡P’®ty
 = 
geomP’®ty
;

177 #ifdeà
DEBUG_SAVE_INTERMEDIATE_MODELS


178 
‹mpName
[50];

179 
couÁ”AtomI‹¿tiÚs
=0;

180 
P3DCÚŒŞ
 * 
gCÚŒŞ
 = 
NULL
;

181 ifĞ
gCÚŒŞ
 =ğ
NULL
 ) {

182 
gCÚŒŞ
ğ
Ãw
 
	`P3DCÚŒŞ
(0);

185 
M3DObjeù
 * 
‹mp
 = 
rg‘Objeù
->
	`assign
();

186 
gCÚŒŞ
->
	`ÃwMod–
(
‹mp
);

187 
	`¥rštf
(
‹mpName
,"./figu»_™”%03d.m3d",
couÁ”AtomI‹¿tiÚs
++);

188 
gCÚŒŞ
->
	`wr™e
(
‹mpName
);

191 
d–‘e
 
rg‘Objeù
;

193 #ifdeà
OPTIMIZATION_VISUALIZER


194 
	`cİyResuÉsToVisu®iz”
(&
x
, 
tÙ®P’®ty
.
rough
 +Ù®P’®ty.
smoÙh
);

197  
tÙ®P’®ty
;

198 
	}
}

206 
M3DObjeù
 * 
	gM3DSim¬™yPGAProbËm
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 & 
x
,

207 & 
figu»Id
, 
boŞ
 
´ediù
 )

209 
´im™iveCouÁ
;

210 
M3DObjeù
 * 
rg‘Objeù
;

211 
M3DFigu»T»eNode
 * 
Œ“Node
;

212 
M3DFigu»
 * 
figu»
;

214 ià(
»fObjeù
 =ğ
NULL
 || 
x
.
	`size
(è!ğ
	`·¿m‘”CouÁ
())

215  
NULL
;

217 
Œ“Node
 = 
»fObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“_šdex
);

218 ià(
Œ“Node
 =ğ
NULL
)

219  
NULL
;

221 #ifdeà
BINARY


222 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

224 
figu»Id
 = 
Œ“Node
->
	`g‘Figu»Id
();

229 
rg‘Objeù
 = 
»fObjeù
->
	`assign
();

231 
figu»
 = 
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

232 ià(
figu»
 =ğ
NULL
) {

233 
d–‘e
 
rg‘Objeù
;

234  
NULL
;

236 
figu»
->
	`£Ëù
();

238 
´im™iveCouÁ
 = 
figu»
->
	`g‘Prim™iveCouÁ
();

240 
veùÜ
<> 
v®s
 = 
	`pgaCÛffic›Ás
(
x
);

243 
Üd”
 = 
pga
->
	`fšdPGS‘Id
(
figu»Id
);

244 
pga
->
	`doPGADefÜm
(
rg‘Objeù
, 
v®s
, 
Üd”
, 
çl£
);

247 #ifdeà
UNFLIPPED


248 
VeùÜ3D
 
	`ûÁ”
(0.0, 1.0, 0.0);

250 
VeùÜ3D
 
	`ûÁ”
(0.0, 0.0, 0.0);

252 #ifdeà
BINARY


253 
u£MOM
 = (
	`tunšgWt
(
BpDoM‘hodOfMom’ts
) &&

254 ! 
	`tunšgWt
(
BpFigu»Re£tMod–BefÜe
));

255 
Sim¬™yT¿nsfÜm3D
 * 
xfÜm
 = 
u£MOM
 ? &
GLOBALMOMT¿nsfÜm


256 : 
rg‘Objeù
->
	`g‘T¿nsfÜm©iÚ
();

257 
figu»
->
	`­¶ySim¬™y
(*
xfÜm
, 
ûÁ”
);

259 
sim¬™yObjeù
 = 
rg‘Objeù
->
	`assign
();

261 
figu»
->
	`­¶ySim¬™y
(
mašFigProbËmSimT¿nsfÜm
, 
ûÁ”
);

264 
Sim¬™yT¿nsfÜm3D
 
hªdT¿nsfÜm
 = 
pga
->
	`g‘HªdPÏûm’tT¿nsfÜm
();

265 
figu»
->
	`­¶ySim¬™y
(
hªdT¿nsfÜm
, 
ûÁ”
);

268 ià((è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
) == 0) {

269 
Qu©
 
fš®RÙ
;

270 
VeùÜ3D
 
axis
;

271 
axis
.
	`£t
(
	`x
(3), x(4), x(5));

272 
ªgË
 = 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
è* 
axis
.
	`nÜm®ize
();

273 
fš®RÙ
.
	`£tAxisAngË
(
axis
, 
ªgË
);

276 
Sim¬™yT¿nsfÜm3D
 
Œf
;

277 
Œf
.
	`£tT¿n¦©iÚ
Ğ
	`VeùÜ3D
(
	`x
(0), x(1), x(2))

278 * 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
) );

279 
Œf
.
	`£tRÙ©iÚ
Ğ
fš®RÙ
 );

280 
Œf
.
	`£tSÿË
Ğ
	`exp
(
	`tunšgWt
(
Figu»SÿËFaùÜ
è* 
	`x
(6)) );

282 
figu»
->
	`­¶ySim¬™yAboutCOG
Ğ&
Œf
 );

285  
rg‘Objeù
;

286 
	}
}

288 
	g¡d
::
veùÜ
<> 
M3DSim¬™yPGAProbËm
::
	$pgaCÛffic›Ás
ĞcÚ¡ 
VeùÜ
&
x
 )

290 
veùÜ
<> 
cÛffs
;

291 
¡¬t
;

292 ià(0 !ğ(è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
))

293 
¡¬t
 = 0;

295 
¡¬t
 = 7;

296 
i
 = 
¡¬t
; i < 
x
.
	`size
(); i++) {

297 
cÛffs
.
	`push_back
(
	`x
(
i
)*
	`tunšgWt
(
Figu»PGAFaùÜ
));

299  
cÛffs
;

300 
	}
}

303 
	gM3DSim¬™yPGAProbËmBoundsFunùiÚ
::
	$M3DSim¬™yPGAProbËmBoundsFunùiÚ
()

305 ià((è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
) == 0) {

306 
bounds
 = 
	`VeùÜ
(8,

307 
	`tunšgWt
(
Figu»T¿n¦©iÚBound
),uningWt(FigureTranslationBound),uningWt(FigureTranslationBound),

308 
	`tunšgWt
(
Figu»RÙ©iÚBound
)*
R_PI
/180.0,uningWt(FigureRotationBound)*R_PI/180.0,uningWt(FigureRotationBound)*R_PI/180.0,

309 
	`log
(
	`tunšgWt
(
Figu»SÿËBound
)),

310 
	`tunšgWt
(
Figu»PGABound
));

311 
çùÜs
 = 
	`VeùÜ
(8,

312 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
),

313 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
),

314 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
),

315 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
),

316 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
),

317 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
),

318 
	`tunšgWt
(
Figu»SÿËFaùÜ
),

319 
	`tunšgWt
(
Figu»PGAFaùÜ
));

322 
bounds
 = 
	`VeùÜ
(1, 3.0);

323 
çùÜs
 = 
	`VeùÜ
(1,

324 
	`tunšgWt
(
Figu»PGAFaùÜ
));

326 
	}
}

329 #ifdeà
USE_KNOWN_QUADRATIC


366 
	$DEBUG_ev®u©e
(cÚ¡ 
VeùÜ
& 
x
) {

368 ià(
x
.
	`size
() < 5) {

374 
A
[] = {55, 62, 50, 41, 34,

381 
´od
[5] = {0, 0, 0, 0, 0};

382 
»suÉ
 = 0;

383 
i
;

384 
i
=0; i<5; i++) {

385 
j
=0; j<5; j++) {

386 
´od
[
i
] +ğ
	`x
(
j
è* 
A
[(5 * j) + i];

388 
»suÉ
 +ğ0.5 * (
´od
[
i
] * 
	`x
(i)) - (x(i) * 0.125);

391  
»suÉ
;

392 
	}
}

396 #ifdeà
BINARY


398 
	gM3DSim¬™yPGAProbËm
::
	$š™ŸlizePGA
()

400 
pga
->
	`š™ŸlizeM—n
(
»fObjeù
);

401 
	}
}

	@M3DSpokeOptimizer.cpp

1 
	~<m©h.h
>

2 
	~"O±imiz”Ba£.h
"

3 
	~"M3DSpokeO±imiz”.h
"

4 
	~"M3DSpokeProbËm.h
"

5 
	~"M3DPGAPrim™iveSts.h
"

6 
	~"GeodesicSym.h
"

7 
	~"Tunšg.h
"

8 
	~"B»ÁLš—rM‘hod.h
"

13 #ifdeà
DEBUG_SAVE_INTERMEDIATE_MODELS


25 #iâdeà
BINARY


26 
	#RANDOMIZE


	)

29 cÚ¡ 
	gMIN_PENALTY_WEIGHT
 = -1;

30 cÚ¡ 
	gMIN_PENALTY_WEIGHT_EXP
 = 0.0;

31 cÚ¡ 
	gMAX_PENALTY_WEIGHT_EXP
 = 10.0;

32 cÚ¡ 
	gPENALTY_WEIGHT_SCALE_FACTOR
 = 10.0;

33 cÚ¡ 
	gCONSTRAINT_PENALTY_SCALE_FACTOR
 = 0.02;

35 #iâdeà
BINARY


36 cÚ¡ 
	gSKIPPED_PASSES
 = 1;

43 
usšg
 
Çme¥aû
 
	g¡d
;

46 
glob®V”bos™y
;

49 
	gM3DSpokeO±imiz”
::
	$M3DSpokeO±imiz”
(
­pID
)

51 
ty³
 = 
Spoke
;

52 
m‘hod
 = 
NULL
;

54 
»ã»nûObjeù
 = 
NULL
;

55 
ÿndid©eObjeù
 = 
NULL
;

57 
Ï¡P’®ty
 = 0.0;

61 
­¶iÿtiÚID
 = 
­pID
;

63 
couÁ”
 = 
NULL
;

64 
sk
 = 
NULL
;

65 
Ï¡ResuÉ
 = 
NULL
;

66 
Ï¡ResuÉSize
 = 0;

67 #ifdeà
BINARY


68 ià(
	`tunšgWt
(
BpSpokeRªdomOrd”
) == 1)

69 
³rm
 = 
NULL
;

71 #ifdeà
RANDOMIZE


72 
³rm
 = 
NULL
;

75 
ÃxtAtom
 = 0;

76 
Ï¡Figu»Id
 = -1;

78 #iâdeà
BINARY


79 
numCÚjG¿d›ÁI‹¿tiÚs
 = 
DEFAULT_NUM_CONJGRAD_ITERATIONS
;

80 
scheduËMuÉl›r
 = 
DEFAULT_SCHEDULE_MULTIPLIER
;

81 
th»shŞd
 = 
DEFAULT_THRESHOLD
;

84 
tÙ®Ev®u©iÚCo¡
 = 0;

85 
	}
}

87 #iâdeà
BINARY


89 
	gM3DSpokeO±imiz”
::
	$£tP’®tyWeightsInM©ch
(cÚ¡ * 
³ÇÉyNames
,

90 cÚ¡ * 
³ÇÉyWeights
, 
numP’®t›s
)

92 
wt
;

94 ià(
m©ch
 =ğ
NULL
) {

95 
cout
 << "Unableoransfer…enalties before Matchƒxists\n";

98 ià(
numP’®t›s
 <= 0)

101 
i
 = 0; i < 
numP’®t›s
; i++) {

102 
³ÇÉyNames
[
i
]) {

103 
GpSpokeHi¡og¿mM©ch
:

104 
wt
 = 
³ÇÉyWeights
[
i
];

106 
SpokeMah®ªobisM©ch
:

107 
wt
 = 
³ÇÉyWeights
[
i
];

109 
GpSpokeGeom‘ryWeight
:

110 
wt
 = 
PENALTY_WEIGHT_SCALE_FACTOR
*
³ÇÉyWeights
[
i
];

112 
GpSpokeNeighbÜWeight
:

113 
wt
 = 
³ÇÉyWeights
[
i
];

115 
GpSpokeIÁ”Weight
:

116 
wt
 = 
CONSTRAINT_PENALTY_SCALE_FACTOR
*
³ÇÉyWeights
[
i
];

119 
GpSpokeProfeM©ch
:

122 
cout
 << "UnknowÀ³ÇÉy weight: " << 
	`tunšgShÜtName
(
³ÇÉyNames
[
i
]è<< 
’dl
;

125 
m©ch
->
	`£tWeight
(
ty³
, 
³ÇÉyNames
[
i
], 
wt
);

127 
	}
}

131 
	gM3DSpokeO±imiz”
::~
	$M3DSpokeO±imiz”
()

133 
	`d–‘e_š‹º®
();

134 
	}
}

136 
	gM3DSpokeO±imiz”
::
	$d–‘e_š‹º®
()

138 
i
;

139 if(
»ã»nûObjeù
 !ğ
NULL
)

140 
d–‘e
 
»ã»nûObjeù
;

141 
»ã»nûObjeù
 = 
NULL
;

143 if(
ÿndid©eObjeù
 !ğ
NULL
)

144 
d–‘e
 
ÿndid©eObjeù
;

145 
ÿndid©eObjeù
 = 
NULL
;

147 if(
Ï¡Be¡X
)

149 
i
 = 0; i < 
Ï¡Be¡XSize
; i++)

151 ià(
Ï¡Be¡X
[
i
] !ğ
NULL
)

152 
d–‘e
 
Ï¡Be¡X
[
i
];

154 
d–‘e
 [] 
Ï¡Be¡X
;

155 
Ï¡Be¡X
 = 
NULL
;

158 if(
couÁ”
 !ğ
NULL
)

160 
d–‘e
 [] 
couÁ”
;

161 
couÁ”
 = 
NULL
;

163 if(
sk
 !ğ
NULL
)

165 
d–‘e
 [] 
sk
;

166 
sk
 = 
NULL
;

168 if(
Ï¡ResuÉ
 !ğ
NULL
)

170 
d–‘e
 [] 
Ï¡ResuÉ
;

171 
Ï¡ResuÉ
 = 
NULL
;

172 
Ï¡ResuÉSize
 = 0;

175 #ifdeà
BINARY


176 ià(
	`tunšgWt
(
BpSpokeRªdomOrd”
) == 1) {

177 if(
³rm
 !ğ
NULL
) {

178 
d–‘e
 [] 
³rm
;

179 
³rm
 = 
NULL
;

183 #ifdeà
RANDOMIZE


184 if(
³rm
 !ğ
NULL
)

186 
d–‘e
 [] 
³rm
;

187 
³rm
 = 
NULL
;

191 
	}
}

193 
boŞ
 
	gM3DSpokeO±imiz”
::
	$š™Ÿlize
(
M©ch
 * 
_m©ch
, 
M3DObjeù
 * 
_»ã»nûObjeù
)

196 
Image3D
 * 
image
;

198 if(
_m©ch
 =ğ
NULL
 || 
_»ã»nûObjeù
 == NULL)

199  
çl£
;

201 
	`d–‘e_š‹º®
();

203 
»ã»nûObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

205 
ÿndid©eObjeù
 = 
»ã»nûObjeù
->
	`assign
();

206 
m©ch
 = 
_m©ch
;

208 
m©ch
->
	`»£tReã»nûObjeù
(
»ã»nûObjeù
);

210 
image
 = 
m©ch
->
	`g‘T¬g‘Image
();

211 if(
image
 =ğ
NULL
)

212  
çl£
;

214 
Ï¡Figu»Id
 = -1;

215 
ÃxtAtom
 = 0;

217  
Œue
;

218 
	}
}

220 
	gM3DSpokeO±imiz”
::
	$»£t
(
M©ch
 * 
_m©ch
, 
M3DObjeù
 * 
_»ã»nûObjeù
)

222 if(
_m©ch
 =ğ
NULL
 || 
_»ã»nûObjeù
 == NULL)

225 
	`d–‘e_š‹º®
();

227 
»ã»nûObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

228 
ÿndid©eObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

230 
m©ch
 = 
_m©ch
;

232 
m©ch
->
	`»£tReã»nûObjeù
(
»ã»nûObjeù
);

234 
Ï¡Figu»Id
 = -1;

235 
ÃxtAtom
 = 0;

236 
	}
}

240 
boŞ
 
	gM3DSpokeO±imiz”
::
	$³rfÜmI‹¿tiÚs
(
figu»Id
)

242 
	`as£¹
(
çl£
);

243 
cout
 << "Error: wrong version of M3DSpokeOptimizer::performIterations() called\n";

244  
çl£
;

245 
	}
}

260 
boŞ
 
	gM3DSpokeO±imiz”
::
	$³rfÜmI‹¿tiÚs
(
figu»Id
, 
boŞ
 
´ev›w
,

261 
boŞ
 
v”bos™y
)

263 
numFigs
;

265 if(
m©ch
 =ğ
NULL
 || 
»ã»nûObjeù
 =ğNULL || 
ÿndid©eObjeù
 == NULL )

266  
çl£
;

268 
numFigs
 = 
ÿndid©eObjeù
->
	`g‘Figu»CouÁ
();

270 #ifdeà
BINARY


271 ià(
	`tunšgWt
(
BpSpokeRS¿dP’®ty
) != 0.0 )

272 
m©ch
->
	`£tUpAtomP»diùÜ
(
figu»Id
);

274 ià(
	`tunšgWt
(
BpSpokeRªdomOrd”
) == 1)

276 
i
;

277 
M3DFigu»
 * 
cu¼Figu»
;

280 
numPrims
 = 0;

281 ià(
³rm
 =ğ
NULL
) {

282 
cu¼Figu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

283 if(
cu¼Figu»
 =ğ
NULL
)

284  
çl£
;

285 
numPrims
 = 
cu¼Figu»
->
	`g‘Prim™iveCouÁ
();

286 
³rm
 = 
Ãw
 [
numPrims
];

287 
i
 = 0; i < 
numPrims
; i++)

288 
³rm
[
i
] = -1;

292 #ifdeà
RANDOMIZE


293 
i
;

294 
M3DFigu»
 * 
cu¼Figu»
;

297 
numPrims
 = 0;

298 ià(
³rm
 =ğ
NULL
) {

299 
cu¼Figu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

300 if(
cu¼Figu»
 =ğ
NULL
)

301  
çl£
;

302 
numPrims
 = 
cu¼Figu»
->
	`g‘Prim™iveCouÁ
();

303 
³rm
 = 
Ãw
 [
numPrims
];

304 
i
 = 0; i < 
numPrims
; i++)

305 
³rm
[
i
] = -1;

310 #ifdeà
BINARY


311  
	`İtimizeFigu»
(
figu»Id
, 
´ev›w
, (
glob®V”bos™y
 > -1));

313  
	`İtimizeFigu»
(
figu»Id
, 
´ev›w
, 
v”bos™y
);

315 
	}
}

317 
šlše
 
	gM3DSpokeO±imiz”
::
	$£ËùRªdomAtom
(
numPrims
)

319 
skCouÁ”
;

320 
i
;

321 
´imId
;

324 ià(
ÃxtAtom
 == 0) {

326 
šdex
, 
‹mp
;

327 
Ï¡Atom
;

329 
Ï¡Atom
 = 
³rm
[
numPrims
 - 1];

331 
i
 = 0; i < 
numPrims
; i++)

332 
³rm
[
i
] = i;

333 
i
 = 0; i < 
numPrims
; i++) {

334 
šdex
 = 
i
 + (
	`¿nd
(è% (
numPrims
 - i));

335 
‹mp
 = 
³rm
[
i
];

336 
³rm
[
i
] =…”m[
šdex
];

337 
³rm
[
šdex
] = 
‹mp
;

340 ià(
Ï¡Atom
 >= 0) {

342 ià(
³rm
[0] =ğ
Ï¡Atom
) {

343 
‹mp
 = 
³rm
[0];

344 
³rm
[0] =…”m[
numPrims
 - 1];

345 
³rm
[
numPrims
 - 1] = 
‹mp
;

351 
skCouÁ”
 = 0;

352 ià(
ÃxtAtom
 == 0) {

353 
i
 = 0; i < 
numPrims
; i++) {

354 ià(
couÁ”
[
i
] < 0)

355 
skCouÁ”
++;

358 ià(
skCouÁ”
 =ğ
numPrims
) {

359 
®lSk³d
++;

363 
´imId
 = 
³rm
[
ÃxtAtom
];

364 
ÃxtAtom
++;

365 ià(
ÃxtAtom
 =ğ
numPrims
)

366 
ÃxtAtom
 = 0;

368  
´imId
;

369 
	}
}

371 
šlše
 
	gM3DSpokeO±imiz”
::
	$£ËùAtom
(
numPrims
)

373 
skCouÁ”
;

374 
i
;

375 
´imId
;

378 
skCouÁ”
 = 0;

379 ià(
ÃxtAtom
 == 0) {

380 
i
 = 0; i < 
numPrims
; i++) {

381 ià(
couÁ”
[
i
] < 0)

382 
skCouÁ”
++;

385 ià(
skCouÁ”
 =ğ
numPrims
) {

386 
®lSk³d
++;

390 
´imId
 = 
ÃxtAtom
;

391 
ÃxtAtom
++;

392 ià(
ÃxtAtom
 =ğ
numPrims
)

393 
ÃxtAtom
 = 0;

395  
´imId
;

396 
	}
}

398 
	gM3DSpokeO±imiz”
::
	$»adyNextRun
()

400 
i
 = 0; i < 
Ï¡ResuÉSize
; i++) {

401 
couÁ”
[
i
] = 0;

402 
sk
[
i
] = 0;

403 
Ï¡ResuÉ
[
i
] = 0.0;

406 
®lSk³d
 = 0;

407 
	}
}

431 
boŞ
 
	gM3DSpokeO±imiz”
::
	$İtimizeFigu»
(
figId
, 
boŞ
 
´ev›w
, boŞ 
v”bos™y
)

433 
i
;

434 
cum_chªge
;

435 
´imId
;

436 
numPrims
;

438 
M3DFigu»
 * 
»ã»nûFigu»
 = 
»ã»nûObjeù
->
	`g‘Figu»PŒ
(
figId
);

439 
M3DFigu»
 * 
ÿndid©eFigu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figId
);

441 ià(
»ã»nûFigu»
 =ğ
NULL
 || 
ÿndid©eFigu»
 == NULL )

442  
çl£
;

444 
numPrims
 = 
ÿndid©eFigu»
->
	`g‘Prim™iveCouÁ
();

446 ià(! 
Ï¡Be¡X
)

449 
Ï¡Be¡X
 = 
Ãw
 
VeùÜ
 *[
numPrims
];

450 
Ï¡Be¡XSize
 = 
numPrims
;

452 
´imId
 = 0;…rimId < 
numPrims
;…rimId++)

454 
VeùÜ
 *
š™
 = 
Ãw
 
	`VeùÜ
(
»ã»nûFigu»
->
	`g‘Numb”OfSpokes
());

455 
Ï¡Be¡X
[
´imId
] = 
š™
;

459 ià(
Ï¡Figu»Id
 !ğ
figId
) {

460 ià(
couÁ”
 !ğ
NULL
) {

461 
d–‘e
 [] 
couÁ”
;

462 
d–‘e
 [] 
sk
;

463 
d–‘e
 [] 
Ï¡ResuÉ
;

466 
couÁ”
 = 
Ãw
 [
numPrims
];

467 
sk
 = 
Ãw
 [
numPrims
];

468 
Ï¡ResuÉ
 = 
Ãw
 [
numPrims
];

469 
Ï¡ResuÉSize
 = 
numPrims
;

471 
i
 = 0; i < 
numPrims
; i++) {

472 
couÁ”
[
i
] = 0;

473 
sk
[
i
] = 0;

474 
Ï¡ResuÉ
[
i
] = 0.0;

477 
®lSk³d
 = 0;

478 
Ï¡Figu»Id
 = 
figId
;

481 
´imId
 = -1;

483 
´imId
 < 0) {

484 ià(
´ev›w
)

485 
´imId
 = 
	`£ËùAtom
(
numPrims
);

487 #ifdeà
BINARY


488 ià(
	`tunšgWt
(
BpSpokeRªdomOrd”
) == 1.0)

489 
´imId
 = 
	`£ËùRªdomAtom
(
numPrims
);

491 
´imId
 = 
	`£ËùAtom
(
numPrims
);

493 #ifdeà
RANDOMIZE


494 
´imId
 = 
	`£ËùRªdomAtom
(
numPrims
);

496 
´imId
 = 
	`£ËùAtom
(
numPrims
);

501 
ÿndid©ePrim™ive
 = 
ÿndid©eFigu»
->
	`g‘Prim™ivePŒ
(
´imId
);

502 ià(
ÿndid©ePrim™ive
 =ğ
NULL
 || ! cªdid©ePrim™ive->
	`isS–eùed
()) {

504 
couÁ”
[
´imId
] = -1;

505 
´imId
 = -1;

509 #ifdeà
BINARY


510 ià(
®lSk³d
 >ğ
	`tunšgWt
(
BpSpokeSk³dPas£s
))

512 ià(
®lSk³d
 >ğ
SKIPPED_PASSES
)

514  
Œue
;

516 ià(
sk
[
´imId
] > 0) {

518 
sk
[
´imId
]--;

519  
çl£
;

522 
»ã»nûPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
´imId
);

524 ià(
»ã»nûPrim™ive
 =ğ
NULL
)

525  
çl£
;

528 ià(
v”bos™y
)

529 
cout
 << '.';

531 
cum_chªge
 = 
	`İtimizeAtom
(
figId
, 
´imId
, 
ÿndid©eFigu»
, 
´ev›w
);

533 
d_abs
 = 
	`çbs
(
cum_chªge
 - 
Ï¡ResuÉ
[
´imId
]);

534 #ifdeà
BINARY


535 ià(
d_abs
 < 
	`tunšgWt
(
BpSpokeSkTh»shŞd
)) {

536 
couÁ”
[
´imId
]--;

537 
sk
[
´imId
] = -((è
	`tunšgWt
(
BpSpokeSkMuÉl›r
))*
couÁ”
[primId];

539 ià(
d_abs
 < 
th»shŞd
) {

540 
couÁ”
[
´imId
]--;

541 
sk
[
´imId
] = -
scheduËMuÉl›r
 * 
couÁ”
[primId];

545 
couÁ”
[
´imId
] = 0;

547 
Ï¡ResuÉ
[
´imId
] = 
cum_chªge
;

550  
çl£
;

551 
	}
}

553 
	gM3DSpokeO±imiz”
::
	$g‘La¡Be¡V®
(
boŞ
 
´ev›w
)

555 ià(
´ev›w
) {

556 ià(
Ï¡Figu»Id
 < 0)

558 
M3DFigu»
 * 
ÿndid©eFigu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
Ï¡Figu»Id
);

559 
numPrims
 = 
ÿndid©eFigu»
->
	`g‘Prim™iveCouÁ
();

560 
numPrimsS–eùed
 = 
ÿndid©eFigu»
->
	`numb”S–eùed
();

562 
Ï¡Be¡V®
 = 0.0;

563 
i
 = 0; i < 
numPrims
; i++) {

564 
Ï¡Be¡V®
 +ğ
Ï¡ResuÉ
[
i
];

566 
Ï¡Be¡V®
 /ğ
numPrimsS–eùed
;

568  
Ï¡Be¡V®
;

569 
	}
}

571 
	gM3DSpokeO±imiz”
::
	$İtimizeAtom
(
figId
, 
©omId
,

572 
M3DFigu»
 * 
ÿndid©eFigu»
, 
boŞ
 
´ev›w
)

574 
¥oke
;

575 
š™V®
;

576 
cum_chªge
 = 0.0;

578 
M3DTubePrim™ive
* 
tCªdid©ePrim™ive
 = 
dyÇmic_ÿ¡
<M3DTubePrim™ive*>(
ÿndid©ePrim™ive
);

579 
M3DTubePrim™ive
* 
tReã»nûPrim™ive
 = 
dyÇmic_ÿ¡
<M3DTubePrim™ive*>(
»ã»nûPrim™ive
);

581 cÚ¡ 
numb”OfSpokes
 = 
tReã»nûPrim™ive
->
	`g‘Numb”OfSpokes
();

584 
cout
 << 
æush
;

585 if(
glob®V”bos™y
 >= 2 ) {

586 
cout
 << "M3DSpokeO±imiz”::İtimizeAtom×tomId = " << 
©omId
 << " ) called.\n";

590 cÚ¡ 
VeùÜ
& 
¡¬t
 = *(
Ï¡Be¡X
[
©omId
]);

591 
vecsize
 = 
¡¬t
.
	`size
();

593 
VeùÜ
 
	`•sÚ
(
vecsize
);

594 
•sÚ
.
	`£tAÎ
(
	`tunšgWt
(
SpokeEpsÚ
));

595 
M3DSpokeProbËm
 
	`´obËm
(
m©ch
, 
»ã»nûObjeù
, 
ÿndid©eObjeù
,

596 
figId
, 
©omId
, -1, 
­¶iÿtiÚID
);

598 ià(
´ev›w
) {

599 
image_m©ch
 = 
´obËm
.
	`ev®u©eImageM©ch
(
¡¬t
);

600 
Ï¡Be¡V®
 = 
image_m©ch
;

601 
Ï¡P’®ty
 = 0.0;

602  
image_m©ch
;

605  
¥oke
 = 0; spok!ğ
numb”OfSpokes
; ++spoke ) {

606 
VeùÜ
 
	`¥okeS¹
(1);

607 
	`¥okeS¹
(0èğ
	`¡¬t
(
¥oke
);

608 
´obËm
.
¥okeId
 = 
¥oke
;

614 
tCªdid©ePrim™ive
->
	`£tRN
(
¥oke
, 
tReã»nûPrim™ive
->
	`g‘RN
(spoke) );

616 #ifdeà
COMPUTE_PROFILES


618 
dr
 = -0.1; dr < +0.1; dr += 0.001 ) {

619 
	`¥okeS¹
(0èğ
dr
;

620 cÚ¡ 
v®
 = 
´obËm
.
	`ev®u©e
(
¥okeS¹
);

621 
cout
 << "PROFILE: " << 
©omId
 << "\t" << 
¥oke
 << "\t" << 
dr
 << "\t" << 
v®
 << 
’dl
;

624 
Num”iÿlFunùiÚ
 
	`funùiÚ
(
´obËm
, 
•sÚ
);

625 
VeùÜ
 
g¿d›Á
;

626 
š™V®
 = 
funùiÚ
.
	`compu‹OÃJ‘
Ğ
¥okeS¹
, 
g¿d›Á
);

627 
B»ÁLš—rM‘hod
 
	`İt
(
funùiÚ
, 
¥okeS¹
, 
g¿d›Á
);

628 
İt
.
	`£tB»ÁLš—rS—rchBoundFaùÜ
Ğ
	`tunšgWt
(
B»ÁLš—rS—rchBoundFaùÜ
) );

629 
M3DSpokeProbËmBoundsFunùiÚ
 
boundsFunùiÚ
;

630 
İt
.
	`£tXIn™ŸlLim™
(
boundsFunùiÚ
.
	`ev®u©e
(
g¿d›Á
));

631 
İt
.
	`£tBoundsFunùiÚ
(&
boundsFunùiÚ
);

632 
İt
.
	`run
();

634 
tÙ®Ev®u©iÚCo¡
 +ğ
´obËm
.
	`g‘Ev®u©iÚCo¡
();

636 ià(
İt
.
v®ue
 < 
š™V®
) {

637 (*
Ï¡Be¡X
[
©omId
])(
¥oke
èğ
İt
.
	`x
(0);

638 
cum_chªge
 +ğ
	`çbs
(
š™V®
 - 
İt
.
v®ue
);

639 if(
glob®V”bos™y
 >= 2) {

640 
cout
 << "OPTIMAL: " << 
©omId
 << "\t" << 
¥oke
 << "\t" << 
İt
.
	`x
(0è<< "\t" << o±.
v®ue
 << 
’dl
;

642 
Ï¡Be¡V®
 = 
İt
.
v®ue
;

643 #iâdeà
BINARY


644 
Ï¡P’®ty
 = 
´obËm
.
	`g‘Geom‘ricP’®ty
();

646 
Ï¡P’®ty
 = 0;

657 
tCªdid©ePrim™ive
->
	`£tRN
(
¥oke
, 
tReã»nûPrim™ive
->
	`g‘RN
(spoke) );

658 
´obËm
.
	`­¶yT¿nsfÜm
(*
ÿndid©ePrim™ive
, (*
Ï¡Be¡X
[
©omId
])(
¥oke
) );

667 
´obËm
.
¥okeId
 = -1;

668 
´obËm
.
	`ev®u©e
(
¡¬t
);

670 #ifdeà
DEBUG_SAVE_INTERMEDIATE_MODELS


671 
‹mpName
[50];

672 
couÁ”AtomI‹¿tiÚs
=0;

673 
P3DCÚŒŞ
 * 
gCÚŒŞ
 = 
NULL
;

674 ifĞ
gCÚŒŞ
 =ğ
NULL
 ) {

675 
gCÚŒŞ
ğ
Ãw
 
	`P3DCÚŒŞ
(0);

678 
M3DObjeù
 * 
‹mp
 = 
ÿndid©eObjeù
->
	`assign
();

679 
gCÚŒŞ
->
	`ÃwMod–
(
‹mp
);

680 
	`¥rštf
(
‹mpName
,"./¥oke_™”%03d_©om%03d.m3d",
couÁ”AtomI‹¿tiÚs
++, 
©omId
);

681 
gCÚŒŞ
->
	`wr™e
(
‹mpName
);

685 
cout
 << 
æush
;

687  
cum_chªge
;

688 
	}
}

	@M3DSpokeProblem.cpp

1 
	~"M3DSpokeProbËm.h
"

2 
	~"M3DRegi¡¿tiÚProbËm.h
"

3 
	~"Tunšg.h
"

4 
	~<iomª
>

10 #ifdeà
DEBUG_SAVE_INTERMEDIATE_MODELS


11 
	~"P3DCÚŒŞ.h
"

14 
usšg
 
Çme¥aû
 
	g¡d
;

44 #ifdeà
BINARY


45 
glob®V”bos™y
;

49 
	gM3DSpokeProbËm
::
	$M3DSpokeProbËm
(
­pID
)

51 
»ã»nûObjeù
 = 
NULL
;

52 
m©ch
 = 
NULL
;

53 
rg‘Objeù
 = 
NULL
;

55 
figu»Id
 = -1;

56 
©omId
 = -1;

58 
ev®u©iÚCo¡
 = 0;

60 
­¶iÿtiÚID
 = 
­pID
;

61 
	}
}

63 
	gM3DSpokeProbËm
::
	$M3DSpokeProbËm
(
M©ch
 * 
_m©ch
,

64 
M3DObjeù
 * 
_»ã»nûObjeù
, M3DObjeù * 
_rg‘Objeù
,

65 
_figu»Id
, 
_©omId
, 
_¥okeId
, 
­pID
)

67 
»ã»nûObjeù
 = 
_»ã»nûObjeù
;

68 
m©ch
 = 
_m©ch
;

69 
rg‘Objeù
 = 
_rg‘Objeù
;

71 
figu»Id
 = 
_figu»Id
;

72 
©omId
 = 
_©omId
;

73 
¥okeId
 = 
_¥okeId
;

75 
ev®u©iÚCo¡
 = 0;

76 
­¶iÿtiÚID
 = 
­pID
;

77 
	}
}

79 
	gM3DSpokeProbËm
::~
	$M3DSpokeProbËm
()

81 
	}
}

85 
M3DSpokeProbËm
::
	$ev®u©eImageM©ch
(cÚ¡ 
VeùÜ
 & 
x
)

87 
ev®u©iÚCo¡
++;

89 ià(
m©ch
 =ğ
NULL
 || 
rg‘Objeù
 =ğNULL || 
»ã»nûObjeù
 == NULL)

90  
MAX_RETURN
;

96 ifĞ
¥okeId
 != -1 ) {

97 
M3DTubePrim™ive
* 
cu¼PrimPŒ
 =

98 
dyÇmic_ÿ¡
<
M3DTubePrim™ive
*>(
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
)->
	`g‘Prim™ivePŒ
(
©omId
));

99 
cu¼PrimPŒ
->
	`£tRN
Ğ
¥okeId
,

100 
dyÇmic_ÿ¡
<cÚ¡ 
M3DTubePrim™ive
*>(
»ã»nûObjeù
->
	`g‘Figu»PŒ
(
figu»Id
)->
	`g‘Prim™ivePŒ
(
©omId
))->
	`g‘RN
(
¥okeId
)

104 #ifdeà
BINARY


105 
geomP’®ty
;

106  
m©ch
->
	`compu‹SpokeM©chAndP’®t›s
(
rg‘Objeù
, 
figu»Id
, -1, 
x
, 
geomP’®ty
);

108  
m©ch
->
	`compu‹MašFigu»M©ch
(
rg‘Objeù
, 
figu»Id
);

110 
	}
}

112 
	gM3DSpokeProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 & 
x
)

114 
ev®u©iÚCo¡
++;

116 if(
m©ch
 =ğ
NULL
 || 
rg‘Objeù
 =ğNULL || 
»ã»nûObjeù
 == NULL)

117  
MAX_RETURN
;

123 ifĞ
¥okeId
 != -1 ) {

124 
M3DTubePrim™ive
* 
cu¼PrimPŒ
 =

125 
dyÇmic_ÿ¡
<
M3DTubePrim™ive
*>(
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
)->
	`g‘Prim™ivePŒ
(
©omId
));

126 
cu¼PrimPŒ
->
	`£tRN
Ğ
¥okeId
,

127 
dyÇmic_ÿ¡
<cÚ¡ 
M3DTubePrim™ive
*>(
»ã»nûObjeù
->
	`g‘Figu»PŒ
(
figu»Id
)->
	`g‘Prim™ivePŒ
(
©omId
))->
	`g‘RN
(
¥okeId
)

129 
	`­¶yT¿nsfÜm
(*
cu¼PrimPŒ
, 
	`x
(0));

132 #ifdeà
DEBUG_SAVE_INTERMEDIATE_MODELS


133 
‹mpName
[50];

134 
couÁ”AtomI‹¿tiÚs
=0;

135 
P3DCÚŒŞ
 * 
gCÚŒŞ
 = 
NULL
;

136 ifĞ
gCÚŒŞ
 =ğ
NULL
 ) {

137 
gCÚŒŞ
 = 
Ãw
 
	`P3DCÚŒŞ
(0);

140 
M3DObjeù
 * 
‹mp
 = 
rg‘Objeù
->
	`assign
();

141 
gCÚŒŞ
->
	`ÃwMod–
(
‹mp
);

142 
	`¥rštf
(
‹mpName
,"./cg_©om%03d_¥oke%02d_™”%05d.m3d", 
©omId
, 
¥okeId
, 
couÁ”AtomI‹¿tiÚs
++);

143 
	`´štf
("SAVE: %s\n", 
‹mpName
 );

144 
gCÚŒŞ
->
	`wr™e
(
‹mpName
);

147  
m©ch
->
	`compu‹SpokeM©chAndP’®t›s
(
rg‘Objeù
, 
figu»Id
, 
©omId
, 
x
,

148 
geomP’®ty
);

149 
	}
}

151 
	gM3DSpokeProbËm
::
	$­¶yT¿nsfÜm
(
M3DPrim™ive
 & 
´im
, cÚ¡ 
x
)

153 
M3DTubePrim™ive
& 
tubePrim
 = 
dyÇmic_ÿ¡
<M3DTubePrim™ive&>(
´im
);

154 
	`as£¹
Ğ
¥okeId
 >ğ0 && spokeId < 
tubePrim
.
	`g‘Numb”OfSpokes
() );

155 cÚ¡ 
ÃwR
 =

156 (
tubePrim
.
	`g‘RN
(
¥okeId
è- 
	`çbs
ÑubePrim.
	`g‘D
())è* 
	`exp
(
	`tunšgWt
(
SpokeSÿËFaùÜ
è* 
x
)

157 + 
	`çbs
(
tubePrim
.
	`g‘D
());

158 ifĞ
glob®V”bos™y
 >= 2 ) {

159 
cout
 << 
	`£»cisiÚ
(4)

160 << "¥okeĞ" << 
	`£tw
(2è<< 
¥okeId
 << "): "

161 << 
	`£tw
(6è<< 
tubePrim
.
	`g‘RN
(
¥okeId
)

163 << 
	`£tw
(6è<< 
ÃwR


164 << ", x = " << 
x
 << 
’dl
;

166 
tubePrim
.
	`£tRN
(
¥okeId
, 
ÃwR
 );

167 
	}
}

170 
	gM3DSpokeProbËmBoundsFunùiÚ
::
	$M3DSpokeProbËmBoundsFunùiÚ
()

172 
bounds
 = 
	`VeùÜ
(1, 
	`log
(
	`tunšgWt
(
SpokeSÿËBound
)));

173 
çùÜs
 = 
	`VeùÜ
(1, 
	`tunšgWt
(
SpokeSÿËFaùÜ
) );

174 
	}
}

	@M3DSubfigureOptimizer.cpp

1 
	~<m©h.h
>

2 
	~<f¡»am
>

3 
	~"O±imiz”Ba£.h
"

4 
	~"M3DSubfigu»O±imiz”.h
"

5 
	~"Tunšg.h
"

7 cÚ¡ 
	gMIN_PENALTY_WEIGHT
 = -1.0;

8 cÚ¡ 
	gMIN_PENALTY_WEIGHT_EXP
 = 0.0;

9 cÚ¡ 
	gMAX_PENALTY_WEIGHT_EXP
 = 10.0;

11 
usšg
 
Çme¥aû
 
	g¡d
;

13 
	gM3DSubfigu»O±imiz”
::
	$M3DSubfigu»O±imiz”
()

15 
ty³
 = 
Subfigu»
;

17 
w¿µ”ProbËm
 = 
NULL
;

18 
´obËm
 = 
NULL
;

19 
ss
 = 
NULL
;

20 
Ï¡P’®ty
 = 0.0;

23 
	`£tP’®tyWeight
(0.5);

25 
Ï¡Be¡X
 = 
Ãw
 
VeùÜ
 *[1];

26 
Ï¡Be¡XSize
 = 1;

27 *
Ï¡Be¡X
 = 
Ãw
 
VeùÜ
;

28 
	}
}

30 
	gM3DSubfigu»O±imiz”
::~
	$M3DSubfigu»O±imiz”
()

32 if(
w¿µ”ProbËm
 !ğ
NULL
)

33 
d–‘e
 
w¿µ”ProbËm
;

34 if(
´obËm
 !ğ
NULL
)

35 
d–‘e
 
´obËm
;

36 if(
ss
 !ğ
NULL
)

37 
d–‘e
 
ss
;

39 
	}
}

41 
	gM3DSubfigu»O±imiz”
::
	$£tP’®tyWeight
(
w
)

43 
³ÇÉyExp
 = 
MIN_PENALTY_WEIGHT_EXP
 + (
MAX_PENALTY_WEIGHT_EXP
 - MIN_PENALTY_WEIGHT_EXPè* 
w
;

44 
³ÇÉyWeight
 = 
MIN_PENALTY_WEIGHT
 + 
	`pow
(10.0, 
³ÇÉyExp
);

47 if(
m‘hod
 !ğ
NULL
)

48 #ifdeà
CONJ_GRADIENT


49 ((
M3DSubfigu»ProbËm
 &è((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)

50 ->
	`g‘FunùiÚ
()).
	`£tP’®tyWeight
(
³ÇÉyWeight
);

52 ((
M3DSubfigu»ProbËm
 &è((
EvŞutiÚ¬ySŒ©egy
 *è
m‘hod
)

53 ->
	`g‘FunùiÚ
()).
	`£tP’®tyWeight
(
³ÇÉyWeight
);

55 
	}
}

57 
	gM3DSubfigu»O±imiz”
::
	$š™Ÿlize
(
M©ch
 * 
m©ch
, 
M3DObjeù
 * 
»ã»nûObjeù
,

58 
figu»Id
)

60 if(
m‘hod
 !ğ
NULL
)

63 if(
m©ch
 =ğ
NULL
 || m©ch->
	`g‘Reã»nûObjeù
() == NULL)

66 #ifdeà
CONJ_GRADIENT


67 
VeùÜ
 
	`¡¬t
(5, 0.0, 0.0, 0.0, 0.0, 0.0);

68 
VeùÜ
 
	`m‘ric
(5, 0.01, 0.01, 0.01, 0.02, 0.02);

70 
VeùÜ
 
	`¡¬t
(5, 0.0, 0.0, 0.0, 0.0, 0.0);

71 
VeùÜ
 
	`m‘ric
(5, 0.01, 0.01, 0.01, 0.02, 0.02);

74 if(
´obËm
 !ğ
NULL
)

75 
d–‘e
 
´obËm
;

77 
´obËm
 = 
Ãw
 
	`M3DSubfigu»ProbËm
(
m©ch
, 
»ã»nûObjeù
, 
figu»Id
);

78 if(
´obËm
 =ğ
NULL
)

81 #ifdeà
CONJ_GRADIENT


82 if(
w¿µ”ProbËm
 !ğ
NULL
)

83 
d–‘e
 
w¿µ”ProbËm
;

85 
w¿µ”ProbËm
 = 
Ãw
 
	`Num”iÿlFunùiÚ
(*
´obËm
, 
m‘ric
);

87 if(
ss
 !ğ
NULL
)

88 
d–‘e
 
ss
;

90 
ss
 = 
Ãw
 
	`GaussŸnSS
(
¡¬t
, 
m‘ric
);

91 if(
ss
 =ğ
NULL
)

95 
´obËm
->
	`£tP’®tyWeight
(
³ÇÉyWeight
);

97 if(
m‘hod
 !ğ
NULL
)

98 
d–‘e
 
m‘hod
;

100 #ifdeà
CONJ_GRADIENT


101 
m‘hod
 = 
Ãw
 
	`CÚjug©eG¿d›ÁM‘hod
(*
w¿µ”ProbËm
, 
¡¬t
);

103 
m‘hod
 = 
Ãw
 
	`EvŞutiÚ¬ySŒ©egy
(*
´obËm
, *
ss
, 4, 6, 
SELECTION_MuPlusLambda
);

104 
m‘hod
->
	`£tSigmaFaùÜ
(1.0);

107 
Ï¡Be¡V®
 = 
´obËm
->
	`ev®u©e
(
¡¬t
);

108 *(
Ï¡Be¡X
[0]èğ
¡¬t
;

109 
Ï¡P’®ty
 = 
´obËm
->
	`compu‹P’®ty
(
¡¬t
);

111 #ifdeà
CONJ_GRADIENT


112 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`g‘FunùiÚ
().
	`£tEv®u©iÚCo¡
(0);

113 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`£tB»ÁLš—rS—rchBoundFaùÜ
(
	`tunšgWt
(
B»ÁLš—rS—rchBoundFaùÜ
));

115 ((
EvŞutiÚ¬ySŒ©egy
 *è
m‘hod
)->
	`g‘FunùiÚ
().
	`£tEv®u©iÚCo¡
(0);

117 
	}
}

119 
boŞ
 
	gM3DSubfigu»O±imiz”
::
	$³rfÜmI‹¿tiÚs
(
nI‹¿tiÚs
)

121 if(
m‘hod
 =ğ
NULL
)

122  
çl£
;

124 
i
 = 0;

125 
i
 < 
nI‹¿tiÚs
)

127 #ifdeà
CONJ_GRADIENT


128 ià(((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`isFšished
())

132 #ifdeà
CONJ_GRADIENT


133 ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`³rfÜmI‹¿tiÚ
();

135 ((
EvŞutiÚ¬ySŒ©egy
 *è
m‘hod
)->
	`³rfÜmI‹¿tiÚ
();

137 
i
++;

140 if(
m‘hod
->
	`g‘Be¡Ev”V®ue
(è< 
Ï¡Be¡V®
)

142 #ifdeà
CONJ_GRADIENT


143 
Ï¡Be¡V®
 = ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`g‘Be¡Ev”V®ue
();

144 *(
Ï¡Be¡X
[0]èğ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`g‘Be¡Ev”X
();

146 
Ï¡Be¡V®
 = ((
EvŞutiÚ¬ySŒ©egy
 *è
m‘hod
)->
	`g‘Be¡Ev”V®ue
();

147 *(
Ï¡Be¡X
[0]èğ((
EvŞutiÚ¬ySŒ©egy
 *è
m‘hod
)->
	`g‘Be¡Ev”X
();

149 
Ï¡P’®ty
 = 
´obËm
->
	`compu‹P’®ty
(*(
Ï¡Be¡X
[0]));

153  
Œue
;

154 
	}
}

	@M3DSubfigureProblem.cpp

1 
	~<m©h.h
>

2 
	~"M3DSubfigu»ProbËm.h
"

3 
	~"M3DSubfigu»T¿nsfÜm©iÚ.h
"

4 
	~"T¿ckb®l.h
"

6 cÚ¡ 
	gSUBFIGURE_MAX_RETURN
 = 1.7e308;

7 cÚ¡ 
	gSUBFIGURE_PARAMETER_SIZE
 = 5;

9 cÚ¡ 
	gM3DSubfigu»ProbËm
::
SUB_TRANSLATION_FACTOR
 = 1.0;

10 cÚ¡ 
	gM3DSubfigu»ProbËm
::
SUB_ROTATION_FACTOR
 = 2.0;

11 cÚ¡ 
	gM3DSubfigu»ProbËm
::
SUB_WIDEN_FACTOR
 = 4.0;

12 cÚ¡ 
	gM3DSubfigu»ProbËm
::
SUB_ELONGATE_FACTOR
 = 4.0;

13 cÚ¡ 
	gM3DSubfigu»ProbËm
::
SUB_HINGE_FACTOR
 = 8.0;

17 
usšg
 
Çme¥aû
 
	g¡d
;

19 
	gM3DSubfigu»ProbËm
::
	$M3DSubfigu»ProbËm
(
M©ch
 * 
_m©ch
,

20 
M3DObjeù
 * 
_»ã»nûObjeù
,

21 
_figu»Id
, 
_³ÇÉyWeight
,

22 
_cÚ¡¿štsP’®tyWeight
)

24 
m©ch
 = 
_m©ch
;

25 
figu»Id
 = 
_figu»Id
;

27 if(
_»ã»nûObjeù
 !ğ
NULL
)

28 
»ã»nûObjeù
 = 
_»ã»nûObjeù
->
	`assign
();

30 
»ã»nûObjeù
 = 
NULL
;

32 
³ÇÉyWeight
 = 
_³ÇÉyWeight
;

33 
cÚ¡¿štsP’®tyWeight
 = 
_cÚ¡¿štsP’®tyWeight
;

35 
figu»T»eNode
 = 
NULL
;

36 
rg‘Objeù
 = 
NULL
;

38 
numSurçûPošts
 = 0;

39 
surçûPošts
 = 
NULL
;

41 
	`š™Ÿlize
();

42 #ifdeà
DISPLAY_PENALTIES


43 
¡d
::
cout
 << "Subfigure…enalties: \n";

45 
	}
}

47 
	gM3DSubfigu»ProbËm
::~
	$M3DSubfigu»ProbËm
()

49 if(
rg‘Objeù
 !ğ
NULL
)

50 
d–‘e
 
rg‘Objeù
;

51 
	}
}

53 
	gM3DSubfigu»ProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
 &
x
)

55 
m©chV®
;

56 
³ÇÉyV®
;

57 
tÙ®P’®ty
;

60 
ev®u©iÚCo¡
 += 1;

62 if(
m©ch
 =ğ
NULL
)

63  
SUBFIGURE_MAX_RETURN
;

65 if(
x
.
	`size
(è!ğ
SUBFIGURE_PARAMETER_SIZE
)

66  
SUBFIGURE_MAX_RETURN
;

68 
	`­¶yVeùÜ
(
x
);

69 #ifdeà
NO_MATCH_PENALTY


70 
m©chV®
 = 0.0;

72 
m©chV®
 = -
m©ch
->
	`compu‹Subfigu»M©ch
(
rg‘Objeù
, 
figu»Id
);

75 
³ÇÉyV®
 = 
	`compu‹P’®ty
(
x
);

77 
tÙ®P’®ty
 = 
³ÇÉyV®
 - 
m©chV®
;

78 #ifdeà
DISPLAY_PENALTIES


79 
¡d
::
cout
 << " " << 
³ÇÉyV®
 << " mod– - " << 
m©chV®
 << " match = "

80 << 
tÙ®P’®ty
 << 
¡d
::
’dl
;

82  
tÙ®P’®ty
;

83 
	}
}

85 
	gM3DSubfigu»ProbËm
::
	$compu‹P’®ty
(cÚ¡ 
VeùÜ
 &
x
)

87 if(
x
.
	`size
(è!ğ
SUBFIGURE_PARAMETER_SIZE
)

88  
SUBFIGURE_MAX_RETURN
;

91 
	}
}

93 
	gM3DSubfigu»ProbËm
::
	$š™Ÿlize
()

95 
M3DObjeù
 * 
objeù
;

96 
M3DQuadFigu»
 * 
figu»
;

98 if(
m©ch
 =ğ
NULL
)

101 
objeù
 = 
m©ch
->
	`g‘Reã»nûObjeù
();

102 if(
objeù
 =ğ
NULL
)

105 
figu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ(
objeù
->
	`g‘Figu»PŒ
(
figu»Id
)));

107 if(
figu»
 =ğ
NULL
)

109 
	}
}

111 
	gM3DSubfigu»ProbËm
::
	$­¶yVeùÜ
(cÚ¡ 
VeùÜ
 &
x
)

113 
M3DSubfigu»T¿nsfÜm©iÚ
 
ŒªsfÜm
;

115 if(
»ã»nûObjeù
 =ğ
NULL
)

118 if(
rg‘Objeù
 !ğ
NULL
)

119 
d–‘e
 
rg‘Objeù
;

121 
rg‘Objeù
 = 
»ã»nûObjeù
->
	`assign
();

122 
figu»T»eNode
 = 
rg‘Objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

123 
ŒªsfÜm
.
	`š™
(
rg‘Objeù
, 
figu»T»eNode
);

125 
ŒªsfÜm
.
	`Œª¦©e
(
SUB_TRANSLATION_FACTOR
*
	`x
(0), SUB_TRANSLATION_FACTOR*x(1));

126 
ŒªsfÜm
.
	`rÙ©e
(
SUB_ROTATION_FACTOR
*
	`x
(2));

127 
ŒªsfÜm
.
	`wid’
(
	`pow
(
LOG_BASE
, 
SUB_WIDEN_FACTOR
*
	`x
(3)));

128 
ŒªsfÜm
.
	`–Úg©e
(
	`pow
(
LOG_BASE
, 
SUB_ELONGATE_FACTOR
*
	`x
(4)));

129 
	}
}

	@M3DSubfigureTransformation.cpp

1 
	~<m©h.h
>

2 
	~<¡dio.h
>

4 
	#D_XFERLIST


	)

5 
	#D_POINTLIST_SERVER2


	)

6 
	~"Sh­ed•’d.h
"

8 
	~"m©rix.h
"

9 
	~"M3DSubfigu»T¿nsfÜm©iÚ.h
"

10 
	~"M3DQuadFigu».h
"

22 cÚ¡ 
	gMAX_CREST_T
 = 1.0 - 
R_SMALL_TOLERANCE
;

23 cÚ¡ 
	gMIN_CREST_T
 = -1.0 + 
R_SMALL_TOLERANCE
;

25 cÚ¡ 
	gLOG_BASE
 = 1.2;

26 cÚ¡ 
	gINVERSED_LOG_BASE
 = 1.0/
LOG_BASE
;

28 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$M3DSubfigu»T¿nsfÜm©iÚ
(
M3DObjeù
 * 
_objeù
,

29 
M3DFigu»T»eNode
 * 
_figu»T»eNode
)

31 
»ã»nûFigu»
 = 
NULL
;

33 
	`š™
(
_objeù
, 
_figu»T»eNode
);

34 
	}
}

36 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$š™
(
M3DObjeù
 * 
_objeù
, 
M3DFigu»T»eNode
 * 
_figu»T»eNode
)

38 
figu»Id
;

39 
M3DFigu»
 * 
figu»
;

41 
objeù
ğ
_objeù
;

42 
figu»T»eNode
 = 
_figu»T»eNode
;

44 if(
figu»T»eNode
 !ğ
NULL
 && 
objeù
 != NULL)

46 
M3DFigu»T»eNode
 *
·»ÁNode
=
figu»T»eNode
->
	`g‘P¬’t
();

47 
M3DQuadFigu»
 *
·»ÁFigu»
=
dyÇmic_ÿ¡
<M3DQuadFigu»*>((
objeù
->
	`g‘Figu»PŒ
(
·»ÁNode
->
	`g‘Figu»Id
())));

48 
maxP¬’tU
=
·»ÁFigu»
->
	`g‘RowCouÁ
()-1;

49 
maxP¬’tV
=
·»ÁFigu»
->
	`g‘CŞumnCouÁ
()-1;

50 
çùÜT2U
=1.0;

51 
çùÜT2V
=1.0;

53 
figu»Id
 = 
figu»T»eNode
->
	`g‘Figu»Id
();

54 
figu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
figu»Id
));

55 if(
figu»
 !ğ
NULL
)

56 
»ã»nûFigu»
 = 
figu»
->
	`assign
();

57 
»ã»nûFigu»Old
 = 
»ã»nûFigu»
->
	`assign
();

60 
šv®idLšks
 = 
çl£
;

61 
	`checkFÜV®idLšks
();

63 
Ï¡SÿËV®ue
 = 1.0;

64 
Ï¡ElÚg©eV®ue
 = 1.0;

65 
	}
}

67 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$š™S‹p
()

69 
figu»Id
;

70 
M3DFigu»
 * 
figu»
;

72 if(
figu»T»eNode
 !ğ
NULL
 && 
objeù
 != NULL)

74 
figu»Id
 = 
figu»T»eNode
->
	`g‘Figu»Id
();

75 
figu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
figu»Id
));

80 if(
figu»
 !ğ
NULL
)

81 (* 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>(
»ã»nûFigu»
)èğ(* dyÇmic_ÿ¡<M3DQuadFigu»*>(
figu»
));

88 
	}
}

90 
	$AngËB‘w“nVeùÜs
(
VeùÜ3D
 
v1
, VeùÜ3D 
v2
)

92 
dÙP
=
v1
*
v2
;

93 if(
dÙP
>1||dotP<-1)

95 #ifdeà
QIONG_DEBUG_LINALG


96 
	`´štf
("Error: M3DSubfigureTransformation.cpp/AngelBetweenVectors, v1*v2 is out of„ange [-1, 1]!\n");

98 if(
dÙP
>1)

101  
M_PI
;

105  
	`acos
(
dÙP
);

107 
	}
}

109 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$»In™
()

111 
figu»Id
;

112 
M3DFigu»
 * 
figu»
;

114 if(
figu»T»eNode
 !ğ
NULL
 && 
objeù
 != NULL)

116 
figu»Id
 = 
figu»T»eNode
->
	`g‘Figu»Id
();

117 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

118 if(
figu»
 !ğ
NULL
)

119 (* 
»ã»nûFigu»
èğ(* 
»ã»nûFigu»Old
);

124 
Ï¡SÿËV®ue
 = 1.0;

125 
Ï¡ElÚg©eV®ue
 = 1.0;

126 
	}
}

128 
	gM3DSubfigu»T¿nsfÜm©iÚ
::~
	$M3DSubfigu»T¿nsfÜm©iÚ
()

130 if(
»ã»nûFigu»
 !ğ
NULL
)

131 
d–‘e
 
»ã»nûFigu»
;

132 
	}
}

135 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$upd©eSubfigu»
(
M3DQuadFigu»
 * 
ŞdP¬’tFigu»
)

137 
M3DFigu»T»eNode
 * 
·»ÁNode
;

138 
M3DQuadFigu»
 * 
figu»
;

139 
M3DQuadFigu»
 * 
·»ÁFigu»
;

140 
M3DPrim™ive
 * 
´im™ive
;

141 
M3DQuadPrim™ive
 
¡¬tPrim™ive
;

142 
M3DQuadPrim™ive
 
fšishPrim™ive
;

143 
VeùÜ3D
 
ŞdNÜm®
, 
ÃwNÜm®
;

144 
VeùÜ3D
 
¡¬tPos™iÚ
, 
’dPos™iÚ
;

145 
VeùÜ3D
 
d–X
;

146 
VeùÜ3D
 
axis
;

147 
Qu©
 
d–Q
;

148 
boŞ
 
doRÙ©iÚs
;

149 
R—l
 
nÜm
;

150 
ªgË
;

151 
M3DPrim™iveLškInfo
 * 
lšk
;

152 
d–Index
, 
¡¬tIndex
, 
middËIndex
;

154 
maxU
, 
maxV
;

155 
theFÏg
=0;

157 
lškCouÁ
,

158 
rowCouÁ
, 
cŞumnCouÁ
,

159 
i
, 
j
,

160 
´im™iveId
,

161 
´im™iveIndexD–
,

162 
ÃighbÜIndexD–
,

163 
numPrim™ivesP”Lšk
;

165 
´evPrim™iveId
,

166 
ÃighbÜPrim™iveId
;

171 if(
figu»T»eNode
 =ğ
NULL
 || 
objeù
 =ğNULL || 
»ã»nûFigu»
 == NULL)

174 
figu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
figu»T»eNode
->
	`g‘Figu»Id
()));

175 if(
figu»
 =ğ
NULL
)

178 
·»ÁNode
 = 
figu»T»eNode
->
	`g‘P¬’t
();

179 if(
·»ÁNode
 =ğ
NULL
)

182 
·»ÁFigu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
·»ÁNode
->
	`g‘Figu»Id
()));

184 
rowCouÁ
 = 
figu»
->
	`g‘RowCouÁ
();

185 
cŞumnCouÁ
 = 
figu»
->
	`g‘CŞumnCouÁ
();

187 
maxU
 = (è(
·»ÁFigu»
->
	`g‘CŞumnCouÁ
() - 1);

188 
maxV
 = (è(
·»ÁFigu»
->
	`g‘RowCouÁ
() - 1);

190 if(
rowOr›ÁedLšks
)

192 
´im™iveIndexD–
 = 
cŞumnCouÁ
;

193 
numPrim™ivesP”Lšk
 = 
rowCouÁ
;

194 
ÃighbÜIndexD–
 = 1;

198 
´im™iveIndexD–
 = 1;

199 
numPrim™ivesP”Lšk
 = 
cŞumnCouÁ
;

200 
ÃighbÜIndexD–
 = 
cŞumnCouÁ
;

204 
Th®lCode
::
Poši¡_£rv”2
 *
pLi¡1
=
Ãw
 Th®lCode::
	`Poši¡_£rv”2
();

205 
Xã¾i¡
 *
xãrLi¡
 = 
	`cÚv”tM3DtoXãr
(
ŞdP¬’tFigu»
);

206 
pLi¡1
->
	`In™ŸlizeSubdivSurf
(
xãrLi¡
);

207 
d–‘e
 []
xãrLi¡
->
©omli¡
;

208 
d–‘e
 
xãrLi¡
;

210 
Th®lCode
::
Poši¡_£rv”2
 *
pLi¡2
=
Ãw
 Th®lCode::
	`Poši¡_£rv”2
();

211 
xãrLi¡
 = 
	`cÚv”tM3DtoXãr
(
·»ÁFigu»
);

212 
pLi¡2
->
	`In™ŸlizeSubdivSurf
(
xãrLi¡
);

213 
d–‘e
 []
xãrLi¡
->
©omli¡
;

214 
d–‘e
 
xãrLi¡
;

216 
lškCouÁ
 = 
figu»T»eNode
->
	`g‘LškCouÁ
();

217 
middËIndex
 = 
lškCouÁ
 / 2;

218 
¡¬tIndex
 = 
middËIndex
;

220 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(
middËIndex
);

222 
d–Index
 = -1; deltaIndex <= 1; deltaIndex += 2)

224 
i
 = 
¡¬tIndex
; i < 
lškCouÁ
 && i >ğ0; i +ğ
d–Index
)

226 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(
i
);

228 
	`g‘SurçûPoštAndNÜm®
(
pLi¡1
, 
¡¬tPos™iÚ
, 
ŞdNÜm®
,

229 
lšk
->
u
,†šk->
v
,†šk->
t
);

230 
	`g‘SurçûPoštAndNÜm®
(
pLi¡2
, 
’dPos™iÚ
, 
ÃwNÜm®
,

231 
lšk
->
u
,†šk->
v
,†šk->
t
);

233 
´im™iveId
 = 
lšk
->primitiveId;

234 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

235 if(
´im™ive
 =ğ
NULL
)

238 
d–X
 = 
’dPos™iÚ
 - 
¡¬tPos™iÚ
;

239 
axis
 = 
ŞdNÜm®
.
	`üoss
(
ÃwNÜm®
);

241 
ªgË
=
	`AngËB‘w“nVeùÜs
(
ŞdNÜm®
, 
ÃwNÜm®
);

244 
d–Q
.
	`£tAxisAngË
(
axis
, 
ªgË
);

247 
nÜm
 = 
d–Q
.
	`nÜm
();

248 if(
nÜm
 > 1.0 - 
R_SMALL_TOLERANCE
 &&

249 
nÜm
 < 1.0 + 
R_SMALL_TOLERANCE
)

250 
doRÙ©iÚs
 = 
Œue
;

252 
doRÙ©iÚs
 = 
çl£
;

254 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

255 if(
´im™ive
 =ğ
NULL
)

258 if(
doRÙ©iÚs
)

260 
´im™ive
->
	`rÙ©eBy
(
d–Q
);

262 
axis
 = 
´im™ive
->
	`g‘X
(è- 
¡¬tPos™iÚ
;

263 
d–Q
.
	`rÙ©eVeùÜ
(
axis
);

264 
´im™ive
->
	`£tX
(
axis
 + 
¡¬tPos™iÚ
);

267 
´im™ive
->
	`Œª¦©eBy
(
d–X
);

270 if(
i
 =ğ
middËIndex
)

272 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

274 
´evPrim™iveId
 = 
´im™iveId
;

275 
´im™iveId
 +ğ
´im™iveIndexD–
;

277 
	`£tPrim™iveToP»viousP»diùiÚ
(
figu»
, 
´im™iveId
,

278 
´evPrim™iveId
, 
Ï¡ElÚg©eV®ue
);

284 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

286 
´evPrim™iveId
 = 
´im™iveId
;

287 
´im™iveId
 +ğ
´im™iveIndexD–
;

288 
ÃighbÜPrim™iveId
 = 
´im™iveId
 -

289 
d–Index
 * 
ÃighbÜIndexD–
;

291 
	`£tPrim™iveToAv”ageP»diùiÚ
(
figu»
, 
´im™iveId
,

292 
´evPrim™iveId
, 
ÃighbÜPrim™iveId
, 
Ï¡SÿËV®ue
,

293 
Ï¡ElÚg©eV®ue
);

296 
theFÏg
 = 0;

299 
¡¬tIndex
 = 
middËIndex
 + 1;

302 
d–‘e
 
pLi¡1
;

303 
d–‘e
 
pLi¡2
;

304 
	}
}

309 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$Œª¦©eS‹p
(
theD–U
, 
theD–V
)

311 
M3DFigu»T»eNode
 * 
·»ÁNode
;

312 
M3DQuadFigu»
 * 
figu»
;

313 
M3DQuadFigu»
 * 
·»ÁFigu»
;

314 
M3DPrim™ive
 * 
´im™ive
;

315 
M3DQuadPrim™ive
 
¡¬tPrim™ive
;

316 
M3DQuadPrim™ive
 
fšishPrim™ive
;

317 
VeùÜ3D
 
ŞdNÜm®
, 
ÃwNÜm®
;

318 
VeùÜ3D
 
¡¬tPos™iÚ
, 
’dPos™iÚ
;

319 
VeùÜ3D
 
d–X
;

320 
VeùÜ3D
 
axis
;

321 
ªgË
, 
d–U
, 
d–V
, 
d–U1
, 
d–U2
, 
d–V1
, 
d–V2
, 
d–T
;

322 
ûÁ”U
, 
ûÁ”V
, 
ûÁ”T
;

323 
®phaU
=
çùÜT2U
;

324 
®phaV
=
çùÜT2V
;

325 
Qu©
 
d–Q
;

326 
M3DPrim™iveLškInfo
 * 
lšk
;

327 
d–Index
, 
¡¬tIndex
, 
middËIndex
;

329 
maxU
, 
maxV
;

330 
u
, 
v
, 
t
;

331 
æag
, 
theFÏg
=0;

332 
boŞ
 
doRÙ©iÚs
;

333 
R—l
 
nÜm
;

335 
lškCouÁ
,

336 
rowCouÁ
, 
cŞumnCouÁ
,

337 
i
, 
j
,

338 
´im™iveId
,

339 
´im™iveIndexD–
,

340 
ÃighbÜIndexD–
,

341 
numPrim™ivesP”Lšk
;

343 
´evPrim™iveId
,

344 
ÃighbÜPrim™iveId
;

349 if(
figu»T»eNode
 =ğ
NULL
 || 
objeù
 =ğNULL || 
»ã»nûFigu»
 == NULL)

352 
figu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
figu»T»eNode
->
	`g‘Figu»Id
()));

353 if(
figu»
 =ğ
NULL
)

356 
·»ÁNode
 = 
figu»T»eNode
->
	`g‘P¬’t
();

357 if(
·»ÁNode
 =ğ
NULL
)

360 
·»ÁFigu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
·»ÁNode
->
	`g‘Figu»Id
()));

362 
rowCouÁ
 = 
figu»
->
	`g‘RowCouÁ
();

363 
cŞumnCouÁ
 = 
figu»
->
	`g‘CŞumnCouÁ
();

367 
maxU
 = (è(
·»ÁFigu»
->
	`g‘CŞumnCouÁ
() - 1);

368 
maxV
 = (è(
·»ÁFigu»
->
	`g‘RowCouÁ
() - 1);

370 if(
rowOr›ÁedLšks
)

372 
´im™iveIndexD–
 = 
cŞumnCouÁ
;

373 
numPrim™ivesP”Lšk
 = 
rowCouÁ
;

374 
ÃighbÜIndexD–
 = 1;

378 
´im™iveIndexD–
 = 1;

379 
numPrim™ivesP”Lšk
 = 
cŞumnCouÁ
;

380 
ÃighbÜIndexD–
 = 
cŞumnCouÁ
;

384 
Th®lCode
::
Poši¡_£rv”2
 *
pLi¡2
=
Ãw
 Th®lCode::
	`Poši¡_£rv”2
();

385 
Xã¾i¡
 *
xãrLi¡
 = 
	`cÚv”tM3DtoXãr
(
·»ÁFigu»
);

386 
pLi¡2
->
	`In™ŸlizeSubdivSurf
(
xãrLi¡
);

387 
d–‘e
 []
xãrLi¡
->
©omli¡
;

388 
d–‘e
 
xãrLi¡
;

390 
lškCouÁ
 = 
figu»T»eNode
->
	`g‘LškCouÁ
();

391 
middËIndex
 = 
lškCouÁ
 / 2;

392 
¡¬tIndex
 = 
middËIndex
;

395 
i
 = 0; i < 
lškCouÁ
; i++)

397 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(
i
);

398 ià(
lšk
->
t
 > -1)

399 ià(
lšk
->
u
 =ğ0 ||†šk->u =ğ
maxU
)

400 
æag
 = 1;

401 ià(
lšk
->
v
 =ğ0 ||†šk->v =ğ
maxU
)

402 
æag
 = 2;

404 
æag
 = 0;

408 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(
middËIndex
);

409 
ûÁ”U
 = 
lšk
->
u
;

410 
ûÁ”V
 = 
lšk
->
v
;

411 
ûÁ”T
 = 
lšk
->
t
;

413 
d–Index
 = -1; deltaIndex <= 1; deltaIndex += 2)

415 
i
 = 
¡¬tIndex
; i < 
lškCouÁ
 && i >ğ0; i +ğ
d–Index
)

417 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(
i
);

418 ià((
lšk
->
u
 =ğ0 ||†šk->u =ğ
maxU
è&& (
ûÁ”V
 =ğ0 || c’‹rV =ğ
maxV
))

419 
theFÏg
 = 1;

420 ià((
lšk
->
v
 =ğ0 ||†šk->v =ğ
maxU
è&& (
ûÁ”U
 =ğ0 || c’‹rU =ğ
maxV
))

421 
theFÏg
 = 1;

423 if(
lšk
 =ğ
NULL
)

426 ià(
lšk
->
t
 >-1 ){

427 
d–U
=
theD–U
;

428 
d–V
=
theD–V
;

431 ià(
æag
 == 1)

433 
d–U
=-
theD–U
;

434 
d–V
=
theD–V
;

436 ià(
æag
 == 2)

438 
d–U
=
theD–U
;

439 
d–V
=-
theD–V
;

443 
d–U
=-
theD–U
;

444 
d–V
=-
theD–V
;

449 
u
=
lšk
->u; 
v
öšk->v; 
t
=link->t;

451 ià(
lšk
->
t
 == -1 ||†ink->t == 1){

453 ià(
lšk
->
u
 + 
d–U
 <ğ
maxU
 && 
v
 + 
d–V
 <ğ
maxV
 &&

454 
lšk
->
u
 + 
d–U
 >ğ0 && 
v
 + 
d–V
 >= 0){

456 
u
=
lšk
->u+
d–U
; 
v
öšk->v+
d–V
;

459 ià(
lšk
->
u
 + 
d–U
 > 
maxU
){

461 
d–U1
=
maxU
-
lšk
->
u
;

462 
d–U2
=
d–U
-
d–U1
;

463 
u
=
lšk
->u+
d–U1
;

464 
d–T
=
d–U2
*
®phaU
;

467 ià(
lšk
->
t
 == 1)

468 
t
=
lšk
->t-
	`çbs
(
d–T
);

470 
t
=
lšk
->t+
	`çbs
(
d–T
);

472 ià(
lšk
->
u
 + 
d–U
 < 0){

474 
d–U1
=0-
lšk
->
u
;

475 
d–U2
=
d–U
-
d–U1
;

476 
u
=
lšk
->u+
d–U1
;

477 
d–T
=
d–U2
*
®phaU
;

480 ià(
lšk
->
t
 == 1)

481 
t
=
lšk
->t-
	`çbs
(
d–T
);

483 
t
=
lšk
->t+
	`çbs
(
d–T
);

486 
u
=
lšk
->u+
d–U
;

488 iàĞ
lšk
->
v
 + 
d–V
 > 
maxV
){

490 
d–V1
=
maxV
-
lšk
->
v
;

491 
d–V2
=
d–V
-
d–V1
;

492 
v
=
lšk
->v+
d–V1
;

493 
d–T
=
d–V2
*
®phaV
;

496 ià(
lšk
->
t
 == 1)

497 
t
=
lšk
->t-
	`çbs
(
d–T
);

499 
t
=
lšk
->t+
	`çbs
(
d–T
);

501 ià(
lšk
->
v
 + 
d–V
 < 0){

504 
d–V1
=0-
lšk
->
v
;

505 
d–V2
=
d–V
-
d–V1
;

506 
v
=
lšk
->v+
d–V1
;

507 
d–T
=
d–V2
*
®phaV
;

510 ià(
lšk
->
t
 == 1)

511 
t
=
lšk
->t-
	`çbs
(
d–T
);

513 
t
=
lšk
->t+
	`çbs
(
d–T
);

516 
v
=
lšk
->v+
d–V
;

519 ià((
lšk
->
u
 =ğ0è|| (lšk->u =ğ
maxU
)){

521 ià(
d–U
 != 0){

522 ià(
theFÏg
 == 1){

524 iàĞ
lšk
->
v
 == 0)

525 
v
=
	`çbs
(
d–U
);

527 
v
=
lšk
->v-
	`çbs
(
d–U
);

532 ià(
lšk
->
u
 =ğ
maxU
)

533 
d–T
=-
d–U
*
®phaU
;

536 
d–T
=
d–U
*
®phaU
;

538 ià(
lšk
->
t
+
d–T
 >= -1 &&†ink->t+deltaT <= 1){

540 
t
=
lšk
->t+
d–T
;

544 ià(
lšk
->
t
+
d–T
 < -1){

545 
d–T
=-1-
lšk
->
t
;

546 
t
=-1;

547 
d–U1
=
d–T
/
®phaU
;

549 
d–U2
=
d–U
-
d–U1
;

550 ià(
lšk
->
u
 == 0)

551 
u
=
lšk
->u+
	`çbs
(
d–U
-
d–U1
);

553 
u
=
lšk
->u-
	`çbs
(
d–U
+
d–U1
);

556 
d–T
=1-
lšk
->
t
;

557 
t
=1;

558 
d–U1
=
d–T
/
®phaU
;

561 ià(
lšk
->
u
 == 0)

562 
u
=
lšk
->u+
	`çbs
(
d–U
-
d–U1
);

564 
u
=
lšk
->u-
	`çbs
(
d–U
+
d–U1
);

570 ià(
lšk
->
v
+
d–V
 >ğ0 &&†šk->v+d–V <ğ
maxV
){

572 
v
=
lšk
->v+
d–V
;

575 ià(
lšk
->
v
+
d–V
 < 0){

576 
d–V1
=0-
lšk
->
v
;

577 
v
=0;

578 
d–U2
=
d–V
-
d–V1
;

579 iàĞ
lšk
->
u
 == 0)

580 
u
=
	`çbs
(
d–U2
);

582 
u
=
lšk
->u-
	`çbs
(
d–U2
);

585 
d–V1
=
maxV
-
lšk
->
v
;

586 
v
=
maxV
;

587 
d–U2
=
d–V
-
d–V1
;

588 iàĞ
lšk
->
u
 == 0)

589 
u
=
	`çbs
(
d–U2
);

591 
u
=
lšk
->u-
	`çbs
(
d–U2
);

598 ià(
d–V
 != 0){

599 ià(
theFÏg
 == 1){

601 iàĞ
lšk
->
u
 == 0)

602 
u
=
	`çbs
(
d–V
);

604 
u
=
lšk
->u-
	`çbs
(
d–V
);

607 
d–T
=
d–V
*
®phaV
;

611 ià(
lšk
->
v
 =ğ
maxV
)

612 
d–T
=-
d–V
*
®phaV
;

615 
d–T
=
d–V
*
®phaV
;

617 ià(
lšk
->
t
+
d–T
 >= -1 &&†ink->t+deltaT <= 1){

619 
t
=
lšk
->t+
d–T
;

623 ià(
lšk
->
t
+
d–T
 < -1){

624 
d–T
=-1-
lšk
->
t
;

625 
t
=-1;

626 
d–V1
=
d–T
/
®phaV
;

629 ià(
lšk
->
v
 == 0)

630 
v
=
lšk
->v+
	`çbs
(
d–V
-
d–V1
);

632 
v
=
lšk
->v-
	`çbs
(
d–V
+
d–V1
);

635 
d–T
=1-
lšk
->
t
;

636 
t
=1;

637 
d–V1
=
d–T
/
®phaV
;

640 ià(
lšk
->
v
 == 0)

641 
v
=
lšk
->v+
	`çbs
(
d–V
-
d–V1
);

643 
v
=
lšk
->v-
	`çbs
(
d–V
+
d–V1
);

649 ià(
lšk
->
u
+
d–U
 <ğ
maxU
 &&†ink->u+deltaU >= 0){

651 
u
=
lšk
->u+
d–U
;

654 ià(
lšk
->
u
+
d–U
 < 0){

655 
d–U1
=0-
lšk
->
u
;

656 
u
=0;

657 
d–V2
=
d–U
-
d–U1
;

658 iàĞ
lšk
->
v
 == 0)

659 
v
=
	`çbs
(
d–V2
);

661 
v
=
lšk
->v-
	`çbs
(
d–V2
);

664 
d–U1
=
maxU
-
lšk
->
u
;

665 
u
=
maxU
;

666 
d–V2
=
d–U
-
d–U1
;

667 iàĞ
lšk
->
v
 == 0)

668 
v
=
	`çbs
(
d–U2
);

670 
v
=
lšk
->v-
	`çbs
(
d–V2
);

677 
	`g‘SurçûPoštAndNÜm®
(
pLi¡2
, 
¡¬tPos™iÚ
, 
ŞdNÜm®
,

678 
lšk
->
u
,†šk->
v
,†šk->
t
);

680 
	`g‘SurçûPoštAndNÜm®
(
pLi¡2
, 
’dPos™iÚ
, 
ÃwNÜm®
,

681 
u
, 
v
, 
t
);

690 
lšk
->
u
 = u;

691 
lšk
->
v
 = v;

692 
lšk
->
t
 =;

695 
´im™iveId
 = 
lšk
->primitiveId;

696 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

697 if(
´im™ive
 =ğ
NULL
)

700 
d–X
 = 
’dPos™iÚ
 - 
¡¬tPos™iÚ
;

701 
axis
 = 
ŞdNÜm®
.
	`üoss
(
ÃwNÜm®
);

703 
ªgË
=
	`AngËB‘w“nVeùÜs
(
ŞdNÜm®
, 
ÃwNÜm®
);

706 
d–Q
.
	`£tAxisAngË
(
axis
, 
ªgË
);

709 
nÜm
 = 
d–Q
.
	`nÜm
();

710 if(
nÜm
 > 1.0 - 
R_SMALL_TOLERANCE
 &&

711 
nÜm
 < 1.0 + 
R_SMALL_TOLERANCE
)

712 
doRÙ©iÚs
 = 
Œue
;

714 
doRÙ©iÚs
 = 
çl£
;

716 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

717 if(
´im™ive
 =ğ
NULL
)

720 if(
doRÙ©iÚs
)

722 
´im™ive
->
	`rÙ©eBy
(
d–Q
);

724 
axis
 = 
´im™ive
->
	`g‘X
(è- 
¡¬tPos™iÚ
;

725 
d–Q
.
	`rÙ©eVeùÜ
(
axis
);

726 
´im™ive
->
	`£tX
(
axis
 + 
¡¬tPos™iÚ
);

729 
´im™ive
->
	`Œª¦©eBy
(
d–X
);

731 if(
i
 =ğ
middËIndex
)

733 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

735 
´evPrim™iveId
 = 
´im™iveId
;

736 
´im™iveId
 +ğ
´im™iveIndexD–
;

738 
	`£tPrim™iveToP»viousP»diùiÚ
(
figu»
, 
´im™iveId
,

739 
´evPrim™iveId
, 
Ï¡ElÚg©eV®ue
);

745 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

747 
´evPrim™iveId
 = 
´im™iveId
;

748 
´im™iveId
 +ğ
´im™iveIndexD–
;

749 
ÃighbÜPrim™iveId
 = 
´im™iveId
 -

750 
d–Index
 * 
ÃighbÜIndexD–
;

752 
	`£tPrim™iveToAv”ageP»diùiÚ
(
figu»
, 
´im™iveId
,

753 
´evPrim™iveId
, 
ÃighbÜPrim™iveId
, 
Ï¡SÿËV®ue
,

754 
Ï¡ElÚg©eV®ue
);

757 
theFÏg
 = 0;

760 
¡¬tIndex
 = 
middËIndex
 + 1;

763 
d–‘e
 
pLi¡2
;

764 
	}
}

767 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$Œª¦©e
(
d–U
, 
d–V
)

769 
i
;

770 
uI‹¿tiÚs
, 
vI‹¿tiÚs
;

771 
d–
, 
Ï¡D–U
, 
Ï¡D–V
;

773 
d–
 = .25;

776 
d–U
>=2*(
maxP¬’tU
+2*
çùÜT2U
))

777 
d–U
-=2*(
maxP¬’tU
+2*
çùÜT2U
);

778 
d–U
<=-2*(
maxP¬’tU
+2*
çùÜT2U
))

779 
d–U
+=2*(
maxP¬’tU
+2*
çùÜT2U
);

780 if(
d–U
>
maxP¬’tU
+2*
çùÜT2U
)

782 
d–U
=-(2*(
maxP¬’tU
+2*
çùÜT2U
)-deltaU);

785 if(
d–U
<-
maxP¬’tU
-2*
çùÜT2U
)

787 
d–U
=2*(
maxP¬’tU
+2*
çùÜT2U
)+deltaU;

791 
d–V
>=2*(
maxP¬’tV
+2*
çùÜT2V
))

792 
d–V
-=2*(
maxP¬’tV
+2*
çùÜT2V
);

793 
d–V
<=-2*(
maxP¬’tV
+2*
çùÜT2V
))

794 
d–V
+=2*(
maxP¬’tV
+2*
çùÜT2V
);

795 if(
d–V
>
maxP¬’tV
+2*
çùÜT2V
)

797 
d–V
=-(2*(
maxP¬’tV
+2*
çùÜT2V
)-deltaV);

800 if(
d–V
<-
maxP¬’tV
-2*
çùÜT2V
)

802 
d–V
=2*(
maxP¬’tV
+2*
çùÜT2V
)+deltaV;

805 #ifdeà
DEBUG


806 
	`årštf
(
¡d”r
, "dU: %f, dV: %àš ACTUAL¿n¦©iÚ.\n", 
d–U
, 
d–V
);

809 
uI‹¿tiÚs
 = (è
	`çbs
(
d–U
 / 
d–
);

810 ià(
d–U
 > 0.0)

811 
Ï¡D–U
 = 
d–U
 - 
d–
 * 
uI‹¿tiÚs
;

813 
Ï¡D–U
 = 
d–U
 + 
d–
 * 
uI‹¿tiÚs
;

815  
i
=0; i < 
uI‹¿tiÚs
; i++)

817 ià(
d–U
 > 0.0)

818 
	`Œª¦©eS‹p
(
d–
, 0);

820 
	`Œª¦©eS‹p
(-
d–
, 0);

822 
	`Œª¦©eS‹p
(
Ï¡D–U
, 0);

824 
vI‹¿tiÚs
 = (è
	`çbs
(
d–V
 / 
d–
);

825 ià(
d–V
 > 0.0)

826 
Ï¡D–V
 = 
d–V
 - 
d–
 * 
vI‹¿tiÚs
;

828 
Ï¡D–V
 = 
d–V
 + 
d–
 * 
vI‹¿tiÚs
;

830  
i
=0; i < 
vI‹¿tiÚs
; i++)

832 ià(
d–V
 > 0.0)

833 
	`Œª¦©eS‹p
(0, 
d–
);

835 
	`Œª¦©eS‹p
(0, -
d–
);

836 
	`š™S‹p
();

838 
	`Œª¦©eS‹p
(0, 
Ï¡D–V
);

840 
	`»In™
();

841 
	}
}

1203 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$rÙ©eS‹p
(
th‘a
)

1205 
M3DFigu»T»eNode
 * 
·»ÁNode
;

1206 
M3DQuadFigu»
 * 
figu»
;

1207 
M3DQuadFigu»
 * 
·»ÁFigu»
;

1208 
M3DPrim™ive
 * 
´im™ive
;

1209 
M3DQuadPrim™ive
 
¡¬tPrim™ive
;

1210 
M3DQuadPrim™ive
 
fšishPrim™ive
;

1211 
M3DQuadPrim™ive
 
ûÁ”Prim™ive
;

1212 
VeùÜ3D
 
ŞdNÜm®
, 
ÃwNÜm®
;

1213 
VeùÜ3D
 
¡¬tPos™iÚ
, 
’dPos™iÚ
;

1214 
VeùÜ3D
 
d–X
;

1215 
VeùÜ3D
 
axis
;

1216 
Qu©
 
d–Q
;

1217 
M3DPrim™iveLškInfo
 * 
lšk
;

1219 
maxU
, 
maxV
;

1220 
ûÁ”U
, 
ûÁ”V
, 
ûÁ”T
, 
‹mpU
, 
‹mpV
, 
‹mpUV
, 
‹mpT1
, 
‹mpT2
;

1221 
cosTh‘a
,

1222 
sšTh‘a
;

1223 
ªgË
;

1224 
u
, 
v
, 
t
,

1225 
uDiff
, 
vDiff
,

1226 
uRÙ
, 
vRÙ
;

1228 
d–U
, 
d–V
, 
d–U1
, 
d–U2
, 
d–V1
, 
d–V2
, 
d–T
;

1229 
®pha
=1.0;

1231 
lškCouÁ
,

1232 
rowCouÁ
, 
cŞumnCouÁ
,

1233 
i
, 
j
,

1234 
´im™iveId
,

1235 
´im™iveIndexD–
,

1236 
ÃighbÜIndexD–
,

1237 
numPrim™ivesP”Lšk
;

1239 
´evPrim™iveId
,

1240 
ÃighbÜPrim™iveId
;

1243 if(
figu»T»eNode
 =ğ
NULL
 || 
objeù
 == NULL)

1246 
figu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
figu»T»eNode
->
	`g‘Figu»Id
()));

1247 if(
figu»
 =ğ
NULL
)

1250 
·»ÁNode
 = 
figu»T»eNode
->
	`g‘P¬’t
();

1251 if(
·»ÁNode
 =ğ
NULL
)

1254 
·»ÁFigu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
·»ÁNode
->
	`g‘Figu»Id
()));

1256 
rowCouÁ
 = 
figu»
->
	`g‘RowCouÁ
();

1257 
cŞumnCouÁ
 = 
figu»
->
	`g‘CŞumnCouÁ
();

1259 
maxU
 = (è(
·»ÁFigu»
->
	`g‘CŞumnCouÁ
() - 1);

1260 
maxV
 = (è(
·»ÁFigu»
->
	`g‘RowCouÁ
() - 1);

1262 if(
rowOr›ÁedLšks
)

1264 
´im™iveIndexD–
 = 
cŞumnCouÁ
;

1265 
numPrim™ivesP”Lšk
 = 
rowCouÁ
;

1266 
ÃighbÜIndexD–
 = 1;

1270 
´im™iveIndexD–
 = 1;

1271 
numPrim™ivesP”Lšk
 = 
cŞumnCouÁ
;

1272 
ÃighbÜIndexD–
 = 
cŞumnCouÁ
;

1276 
Th®lCode
::
Poši¡_£rv”2
 *
pLi¡2
=
Ãw
 Th®lCode::
	`Poši¡_£rv”2
();

1277 
Xã¾i¡
 *
xãrLi¡
 = 
	`cÚv”tM3DtoXãr
(
·»ÁFigu»
);

1278 
pLi¡2
->
	`In™ŸlizeSubdivSurf
(
xãrLi¡
);

1279 
d–‘e
 []
xãrLi¡
->
©omli¡
;

1280 
d–‘e
 
xãrLi¡
;

1282 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(0);

1283 
ûÁ”U
 = 
lšk
->
u
;

1284 
ûÁ”V
 = 
lšk
->
v
;

1285 
ûÁ”T
 = 
lšk
->
t
;

1287 
lškCouÁ
 = 
figu»T»eNode
->
	`g‘LškCouÁ
();

1288 
i
 = 1; i < 
lškCouÁ
; i++)

1290 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(
i
);

1291 if(
lšk
 =ğ
NULL
)

1295 ià(
ûÁ”T
 <= -1 || centerT >= 1)

1297 ià(
lšk
->
t
 =ğ-1 && 
ûÁ”T
 <= -1 ||†ink->t == 1 && centerT >= 1)

1300 
ûÁ”U
 = (ûÁ”U * 
i
 / (i+1)è+ 
lšk
->
u
 * 1 / (i + 1);

1301 
ûÁ”V
 = (ûÁ”V * 
i
 / (i+1)è+ 
lšk
->
v
 * 1 / (i + 1);

1306 ià(
lšk
->
u
 < 
maxU
 &&†ink->u > 0)

1307 
ûÁ”U
 = (ûÁ”U * 
i
 / (i+1)è+ 
lšk
->
u
 * 1 / (i + 1);

1310 ià(
ûÁ”T
 == 1)

1312 ià(
lšk
->
u
 == 0)

1314 
‹mpU
 = 
ûÁ”U
 * 
i
 / (i+1è+ (
lšk
->
t
 - 1) * 1 / (i + 1);

1315 ià(
‹mpU
 < 0){

1316 
ûÁ”U
 = 0;

1317 
‹mpT1
 = 
‹mpU
 + 1;

1320 
ûÁ”U
 = 
‹mpU
;

1324 
‹mpU
 = 
ûÁ”U
 * 
i
 / (i+1è+ (
maxU
 + 1 - 
lšk
->
t
) * 1 / (i + 1);

1325 ià(
‹mpU
 > 
maxU
){

1326 
ûÁ”U
 = 
maxU
;

1327 
‹mpT1
 = 
maxU
 - 
‹mpU
 + 1;

1330 
ûÁ”U
 = 
‹mpU
;

1335 ià(
lšk
->
u
 == 0)

1337 
‹mpU
 = 
ûÁ”U
 * 
i
 / (i+1è- (
lšk
->
t
 + 1) * 1 / (i + 1);

1338 ià(
‹mpU
 < 0){

1339 
ûÁ”U
 = 0;

1340 
‹mpT2
 = -
‹mpU
 - 1;

1343 
ûÁ”U
 = 
‹mpU
;

1347 
‹mpU
 = 
ûÁ”U
 * 
i
 / (i+1è+ ( 
maxU
 + 
lšk
->
t
 + 1) * 1 / (i + 1);

1348 ià(
‹mpU
 > 
maxU
){

1349 
ûÁ”U
 = 
maxU
;

1350 
‹mpT1
 = -
maxU
 + 
‹mpU
 - 1;

1353 
ûÁ”U
 = 
‹mpU
;

1357 ià(
lšk
->
v
 < 
maxV
 &&†ink->v > 0)

1358 
ûÁ”V
 = (ûÁ”V * 
i
 / (˜+ 1)è+ 
lšk
->
v
 * 1 / (i + 1);

1361 ià(
ûÁ”T
 == 1)

1363 ià(
lšk
->
v
 == 0)

1365 
‹mpV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è+ (
lšk
->
t
 - 1) * 1 / (i + 1);

1366 ià(
‹mpV
 < 0){

1367 
ûÁ”V
 = 0;

1368 
‹mpT2
 = 
‹mpV
 + 1;

1371 
ûÁ”V
 = 
‹mpV
;

1375 
‹mpV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è+ (
maxV
 + 1 - 
lšk
->
t
) * 1 / (i + 1);

1376 ià(
‹mpV
 > 
maxV
){

1377 
ûÁ”V
 = 
maxV
;

1378 
‹mpT1
 = 
maxV
 - 
‹mpV
 + 1;

1381 
ûÁ”V
 = 
‹mpV
;

1386 ià(
lšk
->
v
 == 0)

1388 
‹mpV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è- (
lšk
->
t
 + 1) * 1 / (i + 1);

1389 ià(
‹mpV
 < 0){

1390 
ûÁ”V
 = 0;

1391 
‹mpT2
 = -
‹mpV
 - 1;

1394 
ûÁ”V
 = 
‹mpV
;

1398 
‹mpV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è+ ( 
maxV
 + 
lšk
->
t
 + 1) * 1 / (i + 1);

1399 ià(
‹mpV
 > 
maxV
){

1400 
ûÁ”V
 = 
maxV
;

1401 
‹mpT1
 = -
maxV
 + 
‹mpV
 - 1;

1404 
ûÁ”V
 = 
‹mpV
;

1408 ià((
lšk
->
u
 >ğ
maxU
 ||†šk->u <ğ0è&& (lšk->
v
 >ğ
maxV
 ||†ink->v <= 0))

1409 
ûÁ”T
 = (
‹mpT1
 + 
‹mpT2
)/2;

1414 ià(
	`çbs
(
lšk
->
t
) >= 1)

1416 ià(
ûÁ”U
 < 
maxU
 && centerU > 0)

1417 
ûÁ”U
 = (ûÁ”U * 
i
 / (˜+ 1)è+ 
lšk
->
u
 * 1 / (i + 1);

1420 ià(
lšk
->
t
 == 1)

1422 ià(
ûÁ”U
 == 0)

1424 
‹mpU
 = (
ûÁ”T
 - 1è* 
i
 / (˜+ 1è+ (
lšk
->
u
 +†šk->
t
 - 1) * 1 / (i + 1);

1425 ià(
‹mpU
 < 0){

1426 
ûÁ”U
 = 0;

1427 
‹mpT1
 = 
‹mpU
 + 1;

1430 
ûÁ”U
 = 
‹mpU
;

1434 
‹mpU
 = (
ûÁ”U
 + 1 - 
ûÁ”T
è* 
i
 / (˜+ 1è+ (
lšk
->
u
 + 1 -†šk->
t
) * 1 / (i + 1);

1435 ià(
‹mpU
 > 
maxU
){

1436 
ûÁ”U
 = 
maxU
;

1437 
‹mpT1
 = 
maxU
 - 
‹mpU
 + 1;

1440 
ûÁ”U
 = 
‹mpU
;

1445 ià(
ûÁ”U
 == 0)

1447 
‹mpU
 = -(
ûÁ”T
 + 1è* 
i
 / (˜+ 1è+ (
lšk
->
u
 -†šk->
t
 - 1) * 1 / (i + 1);

1448 ià(
‹mpU
 < 0){

1449 
ûÁ”U
 = 0;

1450 
‹mpT1
 = -
‹mpU
 - 1;

1453 
ûÁ”U
 = 
‹mpU
;

1457 
‹mpU
 = (
ûÁ”U
 + 
ûÁ”T
 + 1è* 
i
 / (˜+ 1è+ ( 
lšk
->
u
 +†šk->
t
 + 1) * 1 / (i + 1);

1458 ià(
‹mpU
 > 
maxU
){

1459 
ûÁ”U
 = 
maxU
;

1460 
‹mpT1
 = -
maxU
 + 
‹mpU
 - 1;

1463 
ûÁ”U
 = 
‹mpU
;

1467 ià(
ûÁ”V
 < 
maxV
 && centerV > 0)

1468 
ûÁ”V
 = (ûÁ”V * 
i
 / (˜+ 1)è+ 
lšk
->
v
 * 1 / (i + 1);

1471 ià(
lšk
->
t
 == 1)

1473 ià(
ûÁ”V
 == 0)

1475 
‹mpV
 = (
ûÁ”T
 - 1è* 
i
 / (˜+ 1è+ (
lšk
->
v
 +†šk->
t
 - 1) * 1 / (i + 1);

1476 ià(
‹mpV
 < 0){

1477 
ûÁ”V
 = 0;

1478 
‹mpT2
 = 
‹mpV
 + 1;

1481 
ûÁ”V
 = 
‹mpV
;

1485 
‹mpV
 = (
ûÁ”V
 + 1 - 
ûÁ”T
è* 
i
 / (˜+ 1è+ (
lšk
->
v
 + 1 -†šk->
t
) * 1 / (i + 1);

1486 ià(
‹mpV
 > 
maxV
){

1487 
ûÁ”V
 = 
maxV
;

1488 
‹mpT2
 = 
maxV
 - 
‹mpV
 + 1;

1491 
ûÁ”V
 = 
‹mpV
;

1496 ià(
ûÁ”V
 == 0)

1498 
‹mpV
 = -(
ûÁ”T
 + 1è* 
i
 / (˜+ 1è+ (
lšk
->
v
 -†šk->
t
 - 1) * 1 / (i + 1);

1499 ià(
‹mpV
 < 0){

1500 
ûÁ”V
 = 0;

1501 
‹mpT2
 = -
‹mpV
 - 1;

1504 
ûÁ”V
 = 
‹mpV
;

1508 
‹mpV
 = (
ûÁ”V
 + 
ûÁ”T
 + 1è* 
i
 / (˜+ 1è+ ( 
lšk
->
v
 +†šk->
t
 + 1) * 1 / (i + 1);

1509 ià(
‹mpV
 > 
maxV
){

1510 
ûÁ”V
 = 
maxV
;

1511 
‹mpT2
 = -
maxV
 + 
‹mpV
 - 1;

1514 
ûÁ”V
 = 
‹mpV
;

1518 ià((
ûÁ”U
 >ğ
maxU
 || c’‹rU <ğ0è&& (
ûÁ”V
 >ğ
maxV
 || centerV <= 0))

1519 
ûÁ”T
 = (
‹mpT1
 + 
‹mpT2
)/2;

1525 ià(
	`çbs
(
lšk
->
t
) < 1)

1527 ià((
ûÁ”U
 > 0 && c’‹rU < 
maxU
è&& (
lšk
->
v
 > 0 &&†šk->v < 
maxV
))

1530 ià(
ûÁ”V
 == 0)

1532 ià(
lšk
->
u
 == 0)

1534 
‹mpUV
 = 
ûÁ”U
 * 
i
 / (˜+ 1è- 
lšk
->
v
 * 1 / (i + 1);

1535 ià(
‹mpUV
 > 0)

1536 
ûÁ”U
 = 
‹mpUV
;

1539 
ûÁ”U
 = 
lšk
->
u
;

1540 
ûÁ”V
 = -
‹mpUV
;

1545 
‹mpUV
 = 
ûÁ”U
 * 
i
 / (˜+ 1è+ (
maxV
+
lšk
->
v
) * 1 / (i + 1);

1546 ià(
‹mpUV
 < 
maxU
)

1547 
ûÁ”U
 = 
‹mpUV
;

1550 
ûÁ”U
 = 
lšk
->
u
;

1551 
ûÁ”V
 = -
‹mpUV
;

1557 ià(
lšk
->
u
 == 0)

1559 
‹mpUV
 = 
ûÁ”U
 * 
i
 / (˜+ 1è- (
maxV
 -
lšk
->
v
) * 1 / (i + 1);

1560 ià(
‹mpUV
 > 0)

1561 
ûÁ”U
 = 
‹mpUV
;

1564 
ûÁ”U
 = 
lšk
->
u
;

1565 
ûÁ”V
 = 
maxV
 + 
‹mpUV
;

1570 
‹mpUV
 = 
ûÁ”U
 * 
i
 / (˜+ 1è+ (
maxU
+
maxV
-
lšk
->
v
) * 1 / (i + 1);

1571 ià(
‹mpUV
 < 
maxU
)

1572 
ûÁ”U
 = 
‹mpUV
;

1575 
ûÁ”U
 = 
lšk
->
u
;

1576 
ûÁ”V
 = 
maxU
 + 
maxV
 - 
‹mpUV
;

1582 ià((
ûÁ”V
 > 0 && c’‹rV < 
maxV
è&& (
lšk
->
u
 > 0 &&†šk->u < 
maxU
))

1585 ià(
ûÁ”U
 == 0)

1587 ià(
lšk
->
v
 == 0)

1589 
‹mpUV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è- 
lšk
->
u
 * 1 / (i + 1);

1590 ià(
‹mpUV
 > 0)

1591 
ûÁ”V
 = 
‹mpUV
;

1594 
ûÁ”U
 = -
‹mpUV
;

1595 
ûÁ”V
 = 
lšk
->
v
;

1600 
‹mpUV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è+ (
maxV
+
lšk
->
u
) * 1 / (i + 1);

1601 ià(
‹mpUV
 < 
maxV
)

1602 
ûÁ”V
 = 
‹mpUV
;

1605 
ûÁ”U
 = 
maxV
-
‹mpUV
;

1606 
ûÁ”V
 = 
lšk
->
v
;

1612 ià(
lšk
->
v
 == 0)

1614 
‹mpUV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è- (
maxU
-
lšk
->
u
) * 1 / (i + 1);

1615 ià(
‹mpUV
 > 0)

1616 
ûÁ”V
 = 
‹mpUV
;

1619 
ûÁ”U
 = -
‹mpUV
;

1620 
ûÁ”V
 = 
lšk
->
v
;

1625 
‹mpUV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è+ (
maxV
+
maxU
-
lšk
->
u
) * 1 / (i + 1);

1626 ià(
‹mpUV
 < 
maxV
)

1627 
ûÁ”V
 = 
‹mpUV
;

1630 
ûÁ”U
 = 
maxU
 - 
‹mpUV
 + 
maxV
;

1631 
ûÁ”V
 = 
lšk
->
v
;

1635 
ûÁ”T
 = c’‹rT * 
i
 / (˜+ 1è+ 
lšk
->
t
 * 1 / (i + 1);

1640 
ûÁ”U
 = (ûÁ”U * 
i
 / (i+1)è+ 
lšk
->
u
 * 1 / (i + 1);

1641 
ûÁ”V
 = (ûÁ”V * 
i
 / (i+1)è+ 
lšk
->
v
 * 1 / (i + 1);

1642 
ûÁ”T
 = c’‹rT * 
i
 / (˜+ 1è+ 
lšk
->
t
 * 1 / (i + 1);

1650 
cosTh‘a
 = 
	`cos
(
th‘a
);

1651 
sšTh‘a
 = 
	`sš
(
th‘a
);

1655 
middËIndex
 = 
lškCouÁ
 / 2;

1656 
d–Index
;

1658 
¡¬tIndex
 = 
middËIndex
;

1659 
d–Index
 = -1; deltaIndex <= 1; deltaIndex += 2)

1661 
i
 = 
¡¬tIndex
; i < 
lškCouÁ
 && i >ğ0; i +ğ
d–Index
)

1663 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(
i
);

1664 if(
lšk
 =ğ
NULL
)

1666 ià(
ûÁ”T
 <= -1 || centerT >= 1)

1668 ià(
lšk
->
t
 =ğ-1 && 
ûÁ”T
 <= -1 ||†ink->t == 1 && centerT >= 1)

1671 
uDiff
 = 
lšk
->
u
 - 
ûÁ”U
;

1672 
vDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

1676 ià(
lšk
->
u
 < 
maxU
 &&†ink->u > 0)

1677 
uDiff
 = 
lšk
->
u
 - 
ûÁ”U
;

1680 ià(
ûÁ”T
 == 1)

1682 ià(
lšk
->
u
 == 0)

1683 
uDiff
 = -
ûÁ”U
+
lšk
->
t
-1;

1685 
uDiff
 = 
maxU
-
ûÁ”U
+1-
lšk
->
t
;

1689 ià(
lšk
->
u
 == 0)

1690 
uDiff
 = -
ûÁ”U
-
lšk
->
t
-1;

1692 
uDiff
 = 
maxU
-
ûÁ”U
+1+
lšk
->
t
;

1695 ià(
lšk
->
v
 < 
maxV
 &&†ink->v > 0)

1696 
vDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

1699 ià(
ûÁ”T
 == 1)

1701 ià(
lšk
->
v
 == 0)

1702 
vDiff
 = -
ûÁ”V
+
lšk
->
t
-1;

1704 
vDiff
 = 
maxV
-
ûÁ”V
+1-
lšk
->
t
;

1708 ià(
lšk
->
v
 == 0)

1709 
vDiff
 = -
ûÁ”V
-
lšk
->
t
-1;

1711 
vDiff
 = 
maxV
-
ûÁ”V
+1+
lšk
->
t
;

1718 ià(
lšk
->
t
 == -1 ||†ink->t == 1)

1721 ià(
ûÁ”U
 < 
maxU
 && centerU > 0)

1722 
uDiff
 = 
lšk
->
u
 - 
ûÁ”U
;

1725 ià(
lšk
->
t
 == 1)

1727 ià(
ûÁ”U
 == 0)

1728 
uDiff
 = 
ûÁ”U
-
lšk
->
t
+1;

1730 
uDiff
 = -
maxU
+
ûÁ”U
-1+
lšk
->
t
;

1734 ià(
ûÁ”U
 == 0)

1735 
uDiff
 = 
ûÁ”U
+
lšk
->
t
+1;

1737 
uDiff
 = -
maxU
+
ûÁ”U
-1-
lšk
->
t
;

1740 ià(
lšk
->
v
 < 
maxV
 &&†ink->v > 0)

1741 
vDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

1744 ià(
lšk
->
t
 == 1)

1746 ià(
ûÁ”V
 == 0)

1747 
vDiff
 = 
ûÁ”V
-
lšk
->
t
+1;

1749 
vDiff
 = -
maxV
+
ûÁ”V
-1+
lšk
->
t
;

1753 ià(
ûÁ”V
 == 0)

1754 
vDiff
 = 
ûÁ”V
+
lšk
->
t
+1;

1756 
vDiff
 = -
maxV
+
ûÁ”V
-1-
lšk
->
t
;

1763 ià(
ûÁ”U
 =ğ0 && 
lšk
->
u
 == 0)

1765 
uDiff
 = (
lšk
->
t
 - 
ûÁ”T
è* 
®pha
;

1770 
vDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

1772 ià(
ûÁ”U
 =ğ
maxU
 && 
lšk
->
u
 == maxU)

1774 
uDiff
 = (
ûÁ”T
 - 
lšk
->
t
è* 
®pha
;

1779 
vDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

1781 ià(
ûÁ”V
 =ğ0 && 
lšk
->
v
 == 0)

1783 
vDiff
 = (
lšk
->
t
 - 
ûÁ”T
è* 
®pha
;

1788 
uDiff
 = 
lšk
->
u
 - 
ûÁ”U
;

1792 
vDiff
 = (
ûÁ”T
 - 
lšk
->
t
è* 
®pha
;

1797 
uDiff
 = 
lšk
->
u
 - 
ûÁ”U
;

1802 
uRÙ
 = 
cosTh‘a
 * 
uDiff
 - 
sšTh‘a
 * 
vDiff
;

1803 
vRÙ
 = 
sšTh‘a
 * 
uDiff
 + 
cosTh‘a
 * 
vDiff
;

1805 ià(
lšk
->
t
 >-1 ){

1806 
d–U
=
uRÙ
-
uDiff
;

1807 
d–V
=
vRÙ
-
vDiff
;

1810 
d–U
=
uDiff
-
uRÙ
;

1811 
d–V
=
vDiff
-
vRÙ
;

1813 
u
=
lšk
->u; 
v
öšk->v; 
t
=link->t;

1814 ià(
lšk
->
t
 == -1 ||†ink->t == 1){

1816 ià(
lšk
->
u
 + 
d–U
 <ğ
maxU
 && 
v
 + 
d–V
 <ğ
maxV
 &&

1817 
lšk
->
u
 + 
d–U
 >ğ0 && 
v
 + 
d–V
 >= 0){

1819 
u
=
lšk
->u+
d–U
; 
v
öšk->v+
d–V
;

1821 ià(
lšk
->
u
 + 
d–U
 > 
maxU
){

1823 
d–U1
=
maxU
-
lšk
->
u
;

1824 
d–U2
=
d–U
-
d–U1
;

1825 
u
=
maxU
;

1827 
v
=
lšk
->v+
d–V
;

1828 
d–T
=
d–U2
/
®pha
;

1831 ià(
lšk
->
t
 == 1)

1832 
t
=
lšk
->t-
	`çbs
(
d–T
);

1834 
t
=
lšk
->t+
	`çbs
(
d–T
);

1836 ià(
lšk
->
u
 + 
d–U
 < 0){

1838 
d–U1
=0-
lšk
->
u
;

1839 
d–U2
=
d–U
-
d–U1
;

1840 
u
=0;

1842 
v
=
lšk
->v+
d–V
;

1843 
d–T
=
d–U2
/
®pha
;

1846 ià(
lšk
->
t
 == 1)

1847 
t
=
lšk
->t-
	`çbs
(
d–T
);

1849 
t
=
lšk
->t+
	`çbs
(
d–T
);

1851 iàĞ
lšk
->
v
 + 
d–V
 > 
maxV
){

1853 
d–V1
=
maxV
-
lšk
->
v
;

1854 
d–V2
=
d–V
-
d–V1
;

1855 
u
=
lšk
->u+
d–U
;

1856 
v
=
maxV
;

1858 
d–T
=
d–V2
/
®pha
;

1861 ià(
lšk
->
t
 == 1)

1862 
t
=
lšk
->t-
	`çbs
(
d–T
);

1864 
t
=
lšk
->t+
	`çbs
(
d–T
);

1869 
d–V1
=0-
lšk
->
v
;

1870 
d–V2
=
d–V
-
d–V1
;

1871 
u
=
lšk
->u+
d–U
;

1872 
v
=0;

1874 
d–T
=
d–V2
/
®pha
;

1877 ià(
lšk
->
t
 == 1)

1878 
t
=
lšk
->t-
	`çbs
(
d–T
);

1880 
t
=
lšk
->t+
	`çbs
(
d–T
);

1883 ià((
lšk
->
u
 =ğ0è|| (lšk->u =ğ
maxU
)){

1885 ià(
d–U
 != 0){

1886 ià(
lšk
->
u
 =ğ
maxU
)

1887 
d–T
=-
d–U
/
®pha
;

1890 
d–T
=
d–U
/
®pha
;

1892 ià(
lšk
->
t
+
d–T
 >= -1 &&†ink->t+deltaT <= 1){

1894 
t
=
lšk
->t+
d–T
;

1898 ià(
lšk
->
t
+
d–T
 < -1){

1899 
d–T
=-1-
lšk
->
t
;

1900 
t
=-1;

1901 
d–U1
=
d–T
*
®pha
;

1903 
d–U2
=
d–U
-
d–U1
;

1904 ià(
lšk
->
u
 == 0)

1905 
u
=
lšk
->u+
	`çbs
(
d–U2
);

1907 
u
=
lšk
->u-
	`çbs
(
d–U2
);

1910 
d–T
=1-
lšk
->
t
;

1911 
t
=1;

1912 
d–U1
=
d–T
*
®pha
;

1914 
d–U2
=
d–U
-
d–U1
;

1915 ià(
lšk
->
u
 == 0)

1916 
u
=
lšk
->u+
	`çbs
(
d–U2
);

1918 
u
=
lšk
->u-
	`çbs
(
d–U2
);

1922 ià(
d–V
 != 0) {

1923 ià(
lšk
->
v
+
d–V
 >ğ0 &&†šk->v+d–V <ğ
maxV
){

1925 
v
=
lšk
->v+
d–V
;

1928 ià(
lšk
->
v
+
d–V
 < 0){

1929 
d–V1
=0-
lšk
->
v
;

1930 
v
=0;

1931 
d–U2
=
d–V
-
d–V1
;

1932 iàĞ
lšk
->
u
 == 0)

1933 
u
=
	`çbs
(
d–U2
);

1935 
u
=
lšk
->u-
	`çbs
(
d–U2
);

1938 
d–V1
=
maxV
-
lšk
->
v
;

1939 
v
=
maxV
;

1940 
d–U2
=
d–V
-
d–V1
;

1941 iàĞ
lšk
->
u
 == 0)

1942 
u
=
	`çbs
(
d–U2
);

1944 
u
=
lšk
->u-
	`çbs
(
d–U2
);

1951 ià(
d–V
 != 0){

1955 ià(
lšk
->
v
 =ğ
maxV
)

1956 
d–T
=-
d–V
/
®pha
;

1959 
d–T
=
d–V
/
®pha
;

1961 ià(
lšk
->
t
+
d–T
 >= -1 &&†ink->t+deltaT <= 1){

1963 
t
=
lšk
->t+
d–T
;

1967 ià(
lšk
->
t
+
d–T
 < -1){

1968 
d–T
=-1-
lšk
->
t
;

1969 
t
=-1;

1970 
d–V1
=
d–T
*
®pha
;

1972 
d–V2
=
d–V
-
d–V1
;

1973 ià(
lšk
->
v
 == 0)

1974 
v
=
lšk
->v+
	`çbs
(
d–V2
);

1976 
v
=
lšk
->v-
	`çbs
(
d–V2
);

1979 
d–T
=1-
lšk
->
t
;

1980 
t
=1;

1981 
d–V1
=
d–T
*
®pha
;

1983 
d–V2
=
d–V
-
d–V1
;

1984 ià(
lšk
->
v
 == 0)

1985 
v
=
lšk
->v+
	`çbs
(
d–V2
);

1987 
v
=
lšk
->v-
	`çbs
(
d–V2
);

1991 ià(
d–U
 != 0) {

1992 ià(
	`çbs
(
lšk
->
u
+
d–U
è<ğ
maxU
){

1994 
u
=
lšk
->u+
d–U
;

1997 ià(
lšk
->
u
+
d–U
 < 0){

1998 
d–U1
=0-
lšk
->
u
;

1999 
u
=0;

2000 
d–V2
=
d–U
-
d–U1
;

2001 iàĞ
lšk
->
v
 == 0)

2002 
v
=
	`çbs
(
d–V2
);

2004 
v
=
lšk
->v-
	`çbs
(
d–V2
);

2007 
d–U1
=
maxU
-
lšk
->
u
;

2008 
u
=
maxU
;

2009 
d–V2
=
d–U
-
d–U1
;

2010 iàĞ
lšk
->
v
 == 0)

2011 
v
=
	`çbs
(
d–U2
);

2013 
v
=
lšk
->v-
	`çbs
(
d–V2
);

2021 
	`g‘SurçûPoštAndNÜm®
(
pLi¡2
, 
¡¬tPos™iÚ
, 
ŞdNÜm®
,

2022 
lšk
->
u
,†šk->
v
,†šk->
t
);

2023 
	`g‘SurçûPoštAndNÜm®
(
pLi¡2
, 
’dPos™iÚ
, 
ÃwNÜm®
,

2024 
u
, 
v
, 
t
);

2032 
lšk
->
u
 = u;

2033 
lšk
->
v
 = v;

2034 
lšk
->
t
 =;

2036 
´im™iveId
 = 
lšk
->primitiveId;

2037 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

2038 if(
´im™ive
 =ğ
NULL
)

2041 
d–X
 = 
’dPos™iÚ
 - 
¡¬tPos™iÚ
;

2042 
axis
 = 
ŞdNÜm®
.
	`üoss
(
ÃwNÜm®
);

2044 
ªgË
=
	`AngËB‘w“nVeùÜs
(
ŞdNÜm®
, 
ÃwNÜm®
);

2047 
d–Q
.
	`£tAxisAngË
(
axis
, 
ªgË
);

2050 
VeùÜ3D
 
š™Diff
;

2051 
VeùÜ3D
 
fš®Diff
;

2052 
VeùÜ3D
 
ûÁ”Pos
;

2053 
Qu©
 
´imQ
;

2055 
´imQ
.
	`£tAxisAngË
(
ÃwNÜm®
, -
th‘a
);

2058 
boŞ
 
doRÙ©iÚs
;

2059 
boŞ
 
doPrimRÙ©iÚs
;

2060 
R—l
 
nÜm
 = 
d–Q
.
	`nÜm
();

2061 if(
nÜm
 > 1.0 - 
R_SMALL_TOLERANCE
 &&

2062 
nÜm
 < 1.0 + 
R_SMALL_TOLERANCE
)

2063 
doRÙ©iÚs
 = 
Œue
;

2065 
doRÙ©iÚs
 = 
çl£
;

2067 
nÜm
 = 
´imQ
.
	`nÜm
();

2068 if(
nÜm
 > 1.0 - 
R_SMALL_TOLERANCE
 &&

2069 
nÜm
 < 1.0 + 
R_SMALL_TOLERANCE
)

2070 
doPrimRÙ©iÚs
 = 
Œue
;

2072 
doPrimRÙ©iÚs
 = 
çl£
;

2074 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

2075 if(
´im™ive
 =ğ
NULL
)

2078 if(
doRÙ©iÚs
)

2080 
´im™ive
->
	`rÙ©eBy
(
d–Q
);

2082 
axis
 = 
´im™ive
->
	`g‘X
(è- 
¡¬tPos™iÚ
;

2083 
d–Q
.
	`rÙ©eVeùÜ
(
axis
);

2084 
´im™ive
->
	`£tX
(
axis
 + 
¡¬tPos™iÚ
);

2087 if(
doPrimRÙ©iÚs
)

2088 
´im™ive
->
	`rÙ©eBy
(
´imQ
);

2090 
´im™ive
->
	`Œª¦©eBy
(
d–X
);

2092 if(
i
 =ğ
middËIndex
)

2094 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

2096 
´evPrim™iveId
 = 
´im™iveId
;

2097 
´im™iveId
 +ğ
´im™iveIndexD–
;

2099 
	`£tPrim™iveToP»viousP»diùiÚ
(
figu»
, 
´im™iveId
,

2100 
´evPrim™iveId
, 
Ï¡ElÚg©eV®ue
);

2106 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

2108 
´evPrim™iveId
 = 
´im™iveId
;

2109 
´im™iveId
 +ğ
´im™iveIndexD–
;

2110 
ÃighbÜPrim™iveId
 = 
´im™iveId
 -

2111 
d–Index
 * 
ÃighbÜIndexD–
;

2113 
	`£tPrim™iveToAv”ageP»diùiÚ
(
figu»
, 
´im™iveId
,

2114 
´evPrim™iveId
, 
ÃighbÜPrim™iveId
, 
Ï¡SÿËV®ue
,

2115 
Ï¡ElÚg©eV®ue
);

2120 
¡¬tIndex
 = 
middËIndex
 + 1;

2123 
d–‘e
 
pLi¡2
;

2124 
	}
}

2126 
	#TWO_PI
 2*
M_PI


	)

2127 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$rÙ©e
(
th‘a
)

2129 
i
;

2130 
d–
;

2131 
Ï¡Th‘a
;

2133 
d–
=.5;

2135 
th‘a
>
TWO_PI
)

2136 
th‘a
-=
TWO_PI
;

2137 
th‘a
<-
TWO_PI
)

2138 
th‘a
+=
TWO_PI
;

2140 #ifdeà
DEBUG


2141 
	`årštf
(
¡d”r
, "dTh‘a: %àdeg»e(sèš ACTUAL„Ù©iÚ.\n", 
th‘a
/
M_PI
*180);

2144 
th‘aI‹¿tiÚs
 = (è
	`çbs
(
th‘a
 / 
d–
);

2145 ià(
th‘a
 > 0.0)

2146 
Ï¡Th‘a
 = 
th‘a
 - 
d–
 * 
th‘aI‹¿tiÚs
;

2148 
Ï¡Th‘a
 = 
th‘a
 + 
d–
 * 
th‘aI‹¿tiÚs
;

2150  
i
=0; i < 
th‘aI‹¿tiÚs
; i++)

2153 ià(
th‘a
 > 0.0)

2154 
	`rÙ©eS‹p
(
d–
);

2156 
	`rÙ©eS‹p
(-
d–
);

2157 
	`š™S‹p
();

2159 
	`rÙ©eS‹p
(
Ï¡Th‘a
);

2161 
	`»In™
();

2162 
	}
}

2164 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$wid’S‹p
(
v®ue
)

2166 
M3DFigu»T»eNode
 * 
·»ÁNode
;

2167 
M3DQuadFigu»
 * 
figu»
;

2168 
M3DQuadFigu»
 * 
·»ÁFigu»
;

2169 
M3DPrim™ive
 * 
´im™ive
;

2170 
M3DQuadPrim™ive
 
¡¬tPrim™ive
;

2171 
M3DQuadPrim™ive
 
fšishPrim™ive
;

2172 
M3DQuadPrim™ive
 
ûÁ”Prim™ive
;

2173 
VeùÜ3D
 
¡¬tPos™iÚ
, 
’dPos™iÚ
;

2174 
VeùÜ3D
 
ŞdNÜm®
, 
ÃwNÜm®
;

2175 
VeùÜ3D
 
d–X
;

2176 
VeùÜ3D
 
axis
;

2177 
Qu©
 
d–Q
;

2178 
M3DPrim™iveLškInfo
 * 
lšk
;

2181 
maxU
, 
maxV
, 
ªgË
;

2182 
ûÁ”U
, 
ûÁ”V
, 
ûÁ”T
, 
‹mpU
, 
‹mpV
, 
‹mpUV
, 
‹mpT1
, 
‹mpT2
;

2183 
u
, 
v
, 
t
, 
uDiff
, 
vDiff
;

2185 
d–U
, 
d–V
, 
d–U1
, 
d–U2
, 
d–V1
, 
d–V2
, 
d–T
;

2186 
®pha
=1.0;

2188 
lškCouÁ
,

2189 
rowCouÁ
, 
cŞumnCouÁ
,

2190 
i
, 
j
,

2191 
´im™iveId
,

2192 
´im™iveIndexD–
,

2193 
ÃighbÜIndexD–
,

2194 
numPrim™ivesP”Lšk
;

2196 
´evPrim™iveId
,

2197 
ÃighbÜPrim™iveId
;

2200 if(
figu»T»eNode
 =ğ
NULL
 || 
objeù
 == NULL)

2203 
figu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
figu»T»eNode
->
	`g‘Figu»Id
()));

2204 if(
figu»
 =ğ
NULL
)

2207 
·»ÁNode
 = 
figu»T»eNode
->
	`g‘P¬’t
();

2208 if(
·»ÁNode
 =ğ
NULL
)

2211 
·»ÁFigu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
·»ÁNode
->
	`g‘Figu»Id
()));

2213 
rowCouÁ
 = 
figu»
->
	`g‘RowCouÁ
();

2214 
cŞumnCouÁ
 = 
figu»
->
	`g‘CŞumnCouÁ
();

2216 
maxU
 = (è(
·»ÁFigu»
->
	`g‘CŞumnCouÁ
() - 1);

2217 
maxV
 = (è(
·»ÁFigu»
->
	`g‘RowCouÁ
() - 1);

2222 if(
rowOr›ÁedLšks
)

2224 
´im™iveIndexD–
 = 
cŞumnCouÁ
;

2225 
numPrim™ivesP”Lšk
 = 
rowCouÁ
;

2226 
ÃighbÜIndexD–
 = 1;

2230 
´im™iveIndexD–
 = 1;

2231 
numPrim™ivesP”Lšk
 = 
cŞumnCouÁ
;

2232 
ÃighbÜIndexD–
 = 
cŞumnCouÁ
;

2236 
Th®lCode
::
Poši¡_£rv”2
 *
pLi¡2
=
Ãw
 Th®lCode::
	`Poši¡_£rv”2
();

2237 
Xã¾i¡
 *
xãrLi¡
 = 
	`cÚv”tM3DtoXãr
(
·»ÁFigu»
);

2238 
pLi¡2
->
	`In™ŸlizeSubdivSurf
(
xãrLi¡
);

2239 
d–‘e
 []
xãrLi¡
->
©omli¡
;

2240 
d–‘e
 
xãrLi¡
;

2242 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(0);

2243 
ûÁ”U
 = 
lšk
->
u
;

2244 
ûÁ”V
 = 
lšk
->
v
;

2245 
ûÁ”T
 = 
lšk
->
t
;

2247 
lškCouÁ
 = 
figu»T»eNode
->
	`g‘LškCouÁ
();

2248 
i
 = 1; i < 
lškCouÁ
; i++)

2250 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(
i
);

2251 if(
lšk
 =ğ
NULL
)

2255 ià(
ûÁ”T
 <= -1 || centerT >= 1)

2257 ià(
lšk
->
t
 =ğ-1 && 
ûÁ”T
 <= -1 ||†ink->t == 1 && centerT >= 1)

2260 
ûÁ”U
 = (ûÁ”U * 
i
 / (i+1)è+ 
lšk
->
u
 * 1 / (i + 1);

2261 
ûÁ”V
 = (ûÁ”V * 
i
 / (i+1)è+ 
lšk
->
v
 * 1 / (i + 1);

2266 ià(
lšk
->
u
 < 
maxU
 &&†ink->u > 0)

2267 
ûÁ”U
 = (ûÁ”U * 
i
 / (i+1)è+ 
lšk
->
u
 * 1 / (i + 1);

2270 ià(
ûÁ”T
 == 1)

2272 ià(
lšk
->
u
 == 0)

2274 
‹mpU
 = 
ûÁ”U
 * 
i
 / (i+1è+ (
lšk
->
t
 - 1) * 1 / (i + 1);

2275 ià(
‹mpU
 < 0){

2276 
ûÁ”U
 = 0;

2277 
‹mpT1
 = 
‹mpU
 + 1;

2280 
ûÁ”U
 = 
‹mpU
;

2284 
‹mpU
 = 
ûÁ”U
 * 
i
 / (i+1è+ (
maxU
 + 1 - 
lšk
->
t
) * 1 / (i + 1);

2285 ià(
‹mpU
 > 
maxU
){

2286 
ûÁ”U
 = 
maxU
;

2287 
‹mpT1
 = 
maxU
 - 
‹mpU
 + 1;

2290 
ûÁ”U
 = 
‹mpU
;

2295 ià(
lšk
->
u
 == 0)

2297 
‹mpU
 = 
ûÁ”U
 * 
i
 / (i+1è- (
lšk
->
t
 + 1) * 1 / (i + 1);

2298 ià(
‹mpU
 < 0){

2299 
ûÁ”U
 = 0;

2300 
‹mpT2
 = -
‹mpU
 - 1;

2303 
ûÁ”U
 = 
‹mpU
;

2307 
‹mpU
 = 
ûÁ”U
 * 
i
 / (i+1è+ ( 
maxU
 + 
lšk
->
t
 + 1) * 1 / (i + 1);

2308 ià(
‹mpU
 > 
maxU
){

2309 
ûÁ”U
 = 
maxU
;

2310 
‹mpT1
 = -
maxU
 + 
‹mpU
 - 1;

2313 
ûÁ”U
 = 
‹mpU
;

2317 ià(
lšk
->
v
 < 
maxV
 &&†ink->v > 0)

2318 
ûÁ”V
 = (ûÁ”V * 
i
 / (˜+ 1)è+ 
lšk
->
v
 * 1 / (i + 1);

2321 ià(
ûÁ”T
 == 1)

2323 ià(
lšk
->
v
 == 0)

2325 
‹mpV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è+ (
lšk
->
t
 - 1) * 1 / (i + 1);

2326 ià(
‹mpV
 < 0){

2327 
ûÁ”V
 = 0;

2328 
‹mpT2
 = 
‹mpV
 + 1;

2331 
ûÁ”V
 = 
‹mpV
;

2335 
‹mpV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è+ (
maxV
 + 1 - 
lšk
->
t
) * 1 / (i + 1);

2336 ià(
‹mpV
 > 
maxV
){

2337 
ûÁ”V
 = 
maxV
;

2338 
‹mpT1
 = 
maxV
 - 
‹mpV
 + 1;

2341 
ûÁ”V
 = 
‹mpV
;

2346 ià(
lšk
->
v
 == 0)

2348 
‹mpV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è- (
lšk
->
t
 + 1) * 1 / (i + 1);

2349 ià(
‹mpV
 < 0){

2350 
ûÁ”V
 = 0;

2351 
‹mpT2
 = -
‹mpV
 - 1;

2354 
ûÁ”V
 = 
‹mpV
;

2358 
‹mpV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è+ ( 
maxV
 + 
lšk
->
t
 + 1) * 1 / (i + 1);

2359 ià(
‹mpV
 > 
maxV
){

2360 
ûÁ”V
 = 
maxV
;

2361 
‹mpT1
 = -
maxV
 + 
‹mpV
 - 1;

2364 
ûÁ”V
 = 
‹mpV
;

2368 ià((
lšk
->
u
 >ğ
maxU
 ||†šk->u <ğ0è&& (lšk->
v
 >ğ
maxV
 ||†ink->v <= 0))

2369 
ûÁ”T
 = (
‹mpT1
 + 
‹mpT2
)/2;

2374 ià(
	`çbs
(
lšk
->
t
) >= 1)

2376 ià(
ûÁ”U
 < 
maxU
 && centerU > 0)

2377 
ûÁ”U
 = (ûÁ”U * 
i
 / (˜+ 1)è+ 
lšk
->
u
 * 1 / (i + 1);

2380 ià(
lšk
->
t
 == 1)

2382 ià(
ûÁ”U
 == 0)

2384 
‹mpU
 = (
ûÁ”T
 - 1è* 
i
 / (˜+ 1è+ (
lšk
->
u
 +†šk->
t
 - 1) * 1 / (i + 1);

2385 ià(
‹mpU
 < 0){

2386 
ûÁ”U
 = 0;

2387 
‹mpT1
 = 
‹mpU
 + 1;

2390 
ûÁ”U
 = 
‹mpU
;

2394 
‹mpU
 = (
ûÁ”U
 + 1 - 
ûÁ”T
è* 
i
 / (˜+ 1è+ (
lšk
->
u
 + 1 -†šk->
t
) * 1 / (i + 1);

2395 ià(
‹mpU
 > 
maxU
){

2396 
ûÁ”U
 = 
maxU
;

2397 
‹mpT1
 = 
maxU
 - 
‹mpU
 + 1;

2400 
ûÁ”U
 = 
‹mpU
;

2405 ià(
ûÁ”U
 == 0)

2407 
‹mpU
 = -(
ûÁ”T
 + 1è* 
i
 / (˜+ 1è+ (
lšk
->
u
 -†šk->
t
 - 1) * 1 / (i + 1);

2408 ià(
‹mpU
 < 0){

2409 
ûÁ”U
 = 0;

2410 
‹mpT1
 = -
‹mpU
 - 1;

2413 
ûÁ”U
 = 
‹mpU
;

2417 
‹mpU
 = (
ûÁ”U
 + 
ûÁ”T
 + 1è* 
i
 / (˜+ 1è+ ( 
lšk
->
u
 +†šk->
t
 + 1) * 1 / (i + 1);

2418 ià(
‹mpU
 > 
maxU
){

2419 
ûÁ”U
 = 
maxU
;

2420 
‹mpT1
 = -
maxU
 + 
‹mpU
 - 1;

2423 
ûÁ”U
 = 
‹mpU
;

2427 ià(
ûÁ”V
 < 
maxV
 && centerV > 0)

2428 
ûÁ”V
 = (ûÁ”V * 
i
 / (˜+ 1)è+ 
lšk
->
v
 * 1 / (i + 1);

2431 ià(
lšk
->
t
 == 1)

2433 ià(
ûÁ”V
 == 0)

2435 
‹mpV
 = (
ûÁ”T
 - 1è* 
i
 / (˜+ 1è+ (
lšk
->
v
 +†šk->
t
 - 1) * 1 / (i + 1);

2436 ià(
‹mpV
 < 0){

2437 
ûÁ”V
 = 0;

2438 
‹mpT2
 = 
‹mpV
 + 1;

2441 
ûÁ”V
 = 
‹mpV
;

2445 
‹mpV
 = (
ûÁ”V
 + 1 - 
ûÁ”T
è* 
i
 / (˜+ 1è+ (
lšk
->
v
 + 1 -†šk->
t
) * 1 / (i + 1);

2446 ià(
‹mpV
 > 
maxV
){

2447 
ûÁ”V
 = 
maxV
;

2448 
‹mpT2
 = 
maxV
 - 
‹mpV
 + 1;

2451 
ûÁ”V
 = 
‹mpV
;

2456 ià(
ûÁ”V
 == 0)

2458 
‹mpV
 = -(
ûÁ”T
 + 1è* 
i
 / (˜+ 1è+ (
lšk
->
v
 -†šk->
t
 - 1) * 1 / (i + 1);

2459 ià(
‹mpV
 < 0){

2460 
ûÁ”V
 = 0;

2461 
‹mpT2
 = -
‹mpV
 - 1;

2464 
ûÁ”V
 = 
‹mpV
;

2468 
‹mpV
 = (
ûÁ”V
 + 
ûÁ”T
 + 1è* 
i
 / (˜+ 1è+ ( 
lšk
->
v
 +†šk->
t
 + 1) * 1 / (i + 1);

2469 ià(
‹mpV
 > 
maxV
){

2470 
ûÁ”V
 = 
maxV
;

2471 
‹mpT2
 = -
maxV
 + 
‹mpV
 - 1;

2474 
ûÁ”V
 = 
‹mpV
;

2478 ià((
ûÁ”U
 >ğ
maxU
 || c’‹rU <ğ0è&& (
ûÁ”V
 >ğ
maxV
 || centerV <= 0))

2479 
ûÁ”T
 = (
‹mpT1
 + 
‹mpT2
)/2;

2485 ià(
	`çbs
(
lšk
->
t
) < 1)

2487 ià((
ûÁ”U
 > 0 && c’‹rU < 
maxU
è&& (
lšk
->
v
 > 0 &&†šk->v < 
maxV
))

2490 ià(
ûÁ”V
 == 0)

2492 ià(
lšk
->
u
 == 0)

2494 
‹mpUV
 = 
ûÁ”U
 * 
i
 / (˜+ 1è- 
lšk
->
v
 * 1 / (i + 1);

2495 ià(
‹mpUV
 > 0)

2496 
ûÁ”U
 = 
‹mpUV
;

2499 
ûÁ”U
 = 
lšk
->
u
;

2500 
ûÁ”V
 = -
‹mpUV
;

2505 
‹mpUV
 = 
ûÁ”U
 * 
i
 / (˜+ 1è+ (
maxV
+
lšk
->
v
) * 1 / (i + 1);

2506 ià(
‹mpUV
 < 
maxU
)

2507 
ûÁ”U
 = 
‹mpUV
;

2510 
ûÁ”U
 = 
lšk
->
u
;

2511 
ûÁ”V
 = -
‹mpUV
;

2517 ià(
lšk
->
u
 == 0)

2519 
‹mpUV
 = 
ûÁ”U
 * 
i
 / (˜+ 1è- (
maxV
 -
lšk
->
v
) * 1 / (i + 1);

2520 ià(
‹mpUV
 > 0)

2521 
ûÁ”U
 = 
‹mpUV
;

2524 
ûÁ”U
 = 
lšk
->
u
;

2525 
ûÁ”V
 = 
maxV
 + 
‹mpUV
;

2530 
‹mpUV
 = 
ûÁ”U
 * 
i
 / (˜+ 1è+ (
maxU
+
maxV
-
lšk
->
v
) * 1 / (i + 1);

2531 ià(
‹mpUV
 < 
maxU
)

2532 
ûÁ”U
 = 
‹mpUV
;

2535 
ûÁ”U
 = 
lšk
->
u
;

2536 
ûÁ”V
 = 
maxU
 + 
maxV
 - 
‹mpUV
;

2542 ià((
ûÁ”V
 > 0 && c’‹rV < 
maxV
è&& (
lšk
->
u
 > 0 &&†šk->u < 
maxU
))

2545 ià(
ûÁ”U
 == 0)

2547 ià(
lšk
->
v
 == 0)

2549 
‹mpUV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è- 
lšk
->
u
 * 1 / (i + 1);

2550 ià(
‹mpUV
 > 0)

2551 
ûÁ”V
 = 
‹mpUV
;

2554 
ûÁ”U
 = -
‹mpUV
;

2555 
ûÁ”V
 = 
lšk
->
v
;

2560 
‹mpUV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è+ (
maxV
+
lšk
->
u
) * 1 / (i + 1);

2561 ià(
‹mpUV
 < 
maxV
)

2562 
ûÁ”V
 = 
‹mpUV
;

2565 
ûÁ”U
 = 
maxV
-
‹mpUV
;

2566 
ûÁ”V
 = 
lšk
->
v
;

2572 ià(
lšk
->
v
 == 0)

2574 
‹mpUV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è- (
maxU
-
lšk
->
u
) * 1 / (i + 1);

2575 ià(
‹mpUV
 > 0)

2576 
ûÁ”V
 = 
‹mpUV
;

2579 
ûÁ”U
 = -
‹mpUV
;

2580 
ûÁ”V
 = 
lšk
->
v
;

2585 
‹mpUV
 = 
ûÁ”V
 * 
i
 / (˜+ 1è+ (
maxV
+
maxU
-
lšk
->
u
) * 1 / (i + 1);

2586 ià(
‹mpUV
 < 
maxV
)

2587 
ûÁ”V
 = 
‹mpUV
;

2590 
ûÁ”U
 = 
maxU
 - 
‹mpUV
 + 
maxV
;

2591 
ûÁ”V
 = 
lšk
->
v
;

2595 
ûÁ”T
 = c’‹rT * 
i
 / (˜+ 1è+ 
lšk
->
t
 * 1 / (i + 1);

2600 
ûÁ”U
 = (ûÁ”U * 
i
 / (i+1)è+ 
lšk
->
u
 * 1 / (i + 1);

2601 
ûÁ”V
 = (ûÁ”V * 
i
 / (i+1)è+ 
lšk
->
v
 * 1 / (i + 1);

2602 
ûÁ”T
 = c’‹rT * 
i
 / (˜+ 1è+ 
lšk
->
t
 * 1 / (i + 1);

2609 
middËIndex
 = 
lškCouÁ
 / 2;

2610 
d–Index
;

2612 
¡¬tIndex
 = 
middËIndex
;

2613 
d–Index
 = -1; deltaIndex <= 1; deltaIndex += 2)

2615 
i
 = 
¡¬tIndex
; i < 
lškCouÁ
 && i >ğ0; i +ğ
d–Index
)

2617 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(
i
);

2618 if(
lšk
 =ğ
NULL
)

2620 ià(
ûÁ”T
 <= -1 || centerT >= 1)

2622 ià(
lšk
->
t
 =ğ-1 && 
ûÁ”T
 <= -1 ||†ink->t == 1 && centerT >= 1)

2625 
uDiff
 = 
lšk
->
u
 - 
ûÁ”U
;

2626 
vDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

2630 ià(
lšk
->
u
 < 
maxU
 &&†ink->u > 0)

2631 
uDiff
 = 
lšk
->
u
 - 
ûÁ”U
;

2634 ià(
ûÁ”T
 == 1)

2636 ià(
lšk
->
u
 == 0)

2637 
uDiff
 = -
ûÁ”U
+
lšk
->
t
-1;

2639 
uDiff
 = 
maxU
-
ûÁ”U
+1-
lšk
->
t
;

2643 ià(
lšk
->
u
 == 0)

2644 
uDiff
 = -
ûÁ”U
-
lšk
->
t
-1;

2646 
uDiff
 = 
maxU
-
ûÁ”U
+1+
lšk
->
t
;

2649 ià(
lšk
->
v
 < 
maxV
 &&†ink->v > 0)

2650 
vDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

2653 ià(
ûÁ”T
 == 1)

2655 ià(
lšk
->
v
 == 0)

2656 
vDiff
 = -
ûÁ”V
+
lšk
->
t
-1;

2658 
vDiff
 = 
maxV
-
ûÁ”V
+1-
lšk
->
t
;

2662 ià(
lšk
->
v
 == 0)

2663 
vDiff
 = -
ûÁ”V
-
lšk
->
t
-1;

2665 
vDiff
 = 
maxV
-
ûÁ”V
+1+
lšk
->
t
;

2672 ià(
lšk
->
t
 == -1 ||†ink->t == 1)

2675 ià(
ûÁ”U
 < 
maxU
 && centerU > 0)

2676 
uDiff
 = 
lšk
->
u
 - 
ûÁ”U
;

2679 ià(
lšk
->
t
 == 1)

2681 ià(
ûÁ”U
 == 0)

2682 
uDiff
 = 
ûÁ”U
-
lšk
->
t
+1;

2684 
uDiff
 = -
maxU
+
ûÁ”U
-1+
lšk
->
t
;

2688 ià(
ûÁ”U
 == 0)

2689 
uDiff
 = 
ûÁ”U
+
lšk
->
t
+1;

2691 
uDiff
 = -
maxU
+
ûÁ”U
-1-
lšk
->
t
;

2694 ià(
lšk
->
v
 < 
maxV
 &&†ink->v > 0)

2695 
vDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

2698 ià(
lšk
->
t
 == 1)

2700 ià(
ûÁ”V
 == 0)

2701 
vDiff
 = 
ûÁ”V
-
lšk
->
t
+1;

2703 
vDiff
 = -
maxV
+
ûÁ”V
-1+
lšk
->
t
;

2707 ià(
ûÁ”V
 == 0)

2708 
vDiff
 = 
ûÁ”V
+
lšk
->
t
+1;

2710 
vDiff
 = -
maxV
+
ûÁ”V
-1-
lšk
->
t
;

2717 ià(
ûÁ”U
 =ğ0 && 
lšk
->
u
 == 0)

2719 
uDiff
 = (
lšk
->
t
 - 
ûÁ”T
è* 
®pha
;

2724 
vDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

2726 ià(
ûÁ”U
 =ğ
maxU
 && 
lšk
->
u
 == maxU)

2728 
uDiff
 = (
ûÁ”T
 - 
lšk
->
t
è* 
®pha
;

2733 
vDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

2735 ià(
ûÁ”V
 =ğ0 && 
lšk
->
v
 == 0)

2737 
vDiff
 = (
lšk
->
t
 - 
ûÁ”T
è* 
®pha
;

2742 
uDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

2746 
vDiff
 = (
ûÁ”T
 - 
lšk
->
t
è* 
®pha
;

2751 
uDiff
 = 
lšk
->
v
 - 
ûÁ”V
;

2756 ià(
ûÁ”T
 >-1 ){

2757 
d–U
 = 
uDiff
 * 
v®ue
;

2758 
d–V
 = 
vDiff
 * 
v®ue
;

2761 
d–U
ğ-
uDiff
 * 
v®ue
;

2762 
d–V
ğ
vDiff
 * 
v®ue
;;

2764 
u
=
ûÁ”U
; 
v
=
ûÁ”V
; 
t
=
ûÁ”T
;

2765 ià(
ûÁ”T
 == -1 || centerT == 1){

2767 ià(
ûÁ”U
 + 
d–U
 <ğ
maxU
 && 
v
 + 
d–V
 <ğ
maxV
 &&

2768 
ûÁ”U
 + 
d–U
 >ğ0 && 
v
 + 
d–V
 >= 0){

2770 
u
=
ûÁ”U
+
d–U
; 
v
=
ûÁ”V
+
d–V
;

2772 ià(
ûÁ”U
 + 
d–U
 > 
maxU
){

2774 
d–U1
=
maxU
-
ûÁ”U
;

2775 
d–U2
=
d–U
-
d–U1
;

2776 
u
=
ûÁ”U
+
d–U1
; 
v
=
ûÁ”V
+
d–V
;

2777 
d–T
=
d–U2
/
®pha
;

2780 ià(
ûÁ”T
 == 1)

2781 
t
=
ûÁ”T
-
	`çbs
(
d–T
);

2783 
t
=
ûÁ”T
+
	`çbs
(
d–T
);

2785 ià(
ûÁ”U
 + 
d–U
 < 0){

2787 
d–U1
=0-
ûÁ”U
;

2788 
d–U2
=
d–U
-
d–U1
;

2789 
u
=
ûÁ”U
+
d–U1
; 
v
=
ûÁ”V
+
d–V
;

2790 
d–T
=
d–U2
/
®pha
;

2793 ià(
ûÁ”T
 == 1)

2794 
t
=
ûÁ”T
-
	`çbs
(
d–T
);

2796 
t
=
ûÁ”T
+
	`çbs
(
d–T
);

2798 iàĞ
ûÁ”V
 + 
d–V
 > 
maxV
){

2800 
d–V1
=
maxV
-
ûÁ”V
;

2801 
d–V2
=
d–V
-
d–V1
;

2802 
u
=
ûÁ”U
+
d–U
; 
v
=
ûÁ”V
+
d–V1
;

2803 
d–T
=
d–V2
/
®pha
;

2806 ià(
ûÁ”T
 == 1)

2807 
t
=
ûÁ”T
-
	`çbs
(
d–T
);

2809 
t
=
ûÁ”T
+
	`çbs
(
d–T
);

2814 
d–V1
=0-
ûÁ”V
;

2815 
d–V2
=
d–V
-
d–V1
;

2816 
u
=
ûÁ”U
+
d–U
; 
v
=
ûÁ”V
+
d–V1
;

2817 
d–T
=
d–V2
/
®pha
;

2820 ià(
ûÁ”T
 == 1)

2821 
t
=
ûÁ”T
-
	`çbs
(
d–T
);

2823 
t
=
ûÁ”T
+
	`çbs
(
d–T
);

2826 ià((
ûÁ”U
 =ğ0è|| (ûÁ”U =ğ
maxU
)){

2828 ià(
d–U
 != 0){

2829 ià(
ûÁ”U
 =ğ
maxU
)

2830 
d–T
=-
d–U
/
®pha
;

2833 
d–T
=
d–U
/
®pha
;

2835 ià(
ûÁ”T
+
d–T
 >= -1 && centerT+deltaT <= 1){

2837 
t
=
ûÁ”T
+
d–T
;

2841 ià(
ûÁ”T
+
d–T
 < -1){

2842 
d–T
=-1-
ûÁ”T
;

2843 
t
=-1;

2844 
d–U1
=
d–T
*
®pha
;

2846 
d–U2
=
d–U
-
d–U1
;

2847 ià(
ûÁ”U
 == 0)

2848 
u
=
ûÁ”U
+
	`çbs
(
d–U2
);

2850 
u
=
ûÁ”U
-
	`çbs
(
d–U2
);

2853 
d–T
=1-
ûÁ”T
;

2854 
t
=1;

2855 
d–U1
=
d–T
*
®pha
;

2857 
d–U2
=
d–U
-
d–U1
;

2858 ià(
ûÁ”U
 == 0)

2859 
u
=
ûÁ”U
+
	`çbs
(
d–U2
);

2861 
u
=
ûÁ”U
-
	`çbs
(
d–U2
);

2865 ià(
d–V
 != 0) {

2866 ià(
ûÁ”V
+
d–V
 >ğ0 && c’‹rV+d–V <ğ
maxV
){

2868 
v
=
ûÁ”V
+
d–V
;

2871 ià(
ûÁ”V
+
d–V
 < 0){

2872 
d–V1
=0-
ûÁ”V
;

2873 
v
=0;

2874 
d–U2
=
d–V
-
d–V1
;

2875 iàĞ
ûÁ”U
 == 0)

2876 
u
=
	`çbs
(
d–U2
);

2878 
u
=
ûÁ”U
-
	`çbs
(
d–U2
);

2881 
d–V1
=
maxV
-
ûÁ”V
;

2882 
v
=
maxV
;

2883 
d–U2
=
d–V
-
d–V1
;

2884 iàĞ
ûÁ”U
 == 0)

2885 
u
=
	`çbs
(
d–U2
);

2887 
u
=
ûÁ”U
-
	`çbs
(
d–U2
);

2894 ià(
d–V
 != 0){

2895 ià(
ûÁ”V
 =ğ
maxV
)

2896 
d–T
=-
d–V
/
®pha
;

2899 
d–T
=
d–V
/
®pha
;

2901 ià(
ûÁ”T
+
d–T
 >= -1 && centerT+deltaT <= 1){

2903 
t
=
ûÁ”T
+
d–T
;

2907 ià(
ûÁ”T
+
d–T
 < -1){

2908 
d–T
=-1-
ûÁ”T
;

2909 
t
=-1;

2910 
d–V1
=
d–T
*
®pha
;

2912 
d–V2
=
d–V
-
d–V1
;

2913 ià(
ûÁ”V
 == 0)

2914 
v
=
ûÁ”V
+
	`çbs
(
d–V2
);

2916 
v
=
ûÁ”V
-
	`çbs
(
d–V2
);

2919 
d–T
=1-
ûÁ”T
;

2920 
t
=1;

2921 
d–V1
=
d–T
*
®pha
;

2923 
d–V2
=
d–V
-
d–V1
;

2924 ià(
ûÁ”V
 == 0)

2925 
v
=
ûÁ”V
+
	`çbs
(
d–V2
);

2927 
v
=
ûÁ”V
-
	`çbs
(
d–V2
);

2931 ià(
d–U
 != 0) {

2932 ià(
	`çbs
(
ûÁ”U
+
d–U
è<ğ
maxU
){

2934 
u
=
ûÁ”U
+
d–U
;

2937 ià(
ûÁ”U
+
d–U
 < 0){

2938 
d–U1
=0-
ûÁ”U
;

2939 
u
=0;

2940 
d–V2
=
d–U
-
d–U1
;

2941 iàĞ
ûÁ”V
 == 0)

2942 
v
=
	`çbs
(
d–V2
);

2944 
v
=
ûÁ”V
-
	`çbs
(
d–V2
);

2947 
d–U1
=
maxU
-
ûÁ”U
;

2948 
u
=
maxU
;

2949 
d–V2
=
d–U
-
d–U1
;

2950 iàĞ
ûÁ”V
 == 0)

2951 
v
=
	`çbs
(
d–U2
);

2953 
v
=
ûÁ”V
-
	`çbs
(
d–V2
);

2959 
Ï¡SÿËV®ue
 = 
v®ue
;

2961 
	`g‘SurçûPoštAndNÜm®
(
pLi¡2
, 
¡¬tPos™iÚ
, 
ŞdNÜm®
,

2962 
lšk
->
u
,†šk->
v
,†šk->
t
);

2964 
	`g‘SurçûPoštAndNÜm®
(
pLi¡2
, 
’dPos™iÚ
, 
ÃwNÜm®
,

2965 
u
, 
v
, 
t
);

2974 
lšk
->
u
 = u;

2975 
lšk
->
v
 = v;

2976 
lšk
->
t
 =;

2978 
´im™iveId
 = 
lšk
->primitiveId;

2979 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

2980 if(
´im™ive
 =ğ
NULL
)

2983 
d–X
 = 
’dPos™iÚ
 - 
¡¬tPos™iÚ
;

2984 
axis
 = 
ŞdNÜm®
.
	`üoss
(
ÃwNÜm®
);

2986 
ªgË
=
	`AngËB‘w“nVeùÜs
(
ŞdNÜm®
, 
ÃwNÜm®
);

2989 
d–Q
.
	`£tAxisAngË
(
axis
, 
ªgË
);

2992 
boŞ
 
doRÙ©iÚs
;

2993 
R—l
 
nÜm
 = 
d–Q
.
	`nÜm
();

2994 if(
nÜm
 > 1.0 - 
R_SMALL_TOLERANCE
 &&

2995 
nÜm
 < 1.0 + 
R_SMALL_TOLERANCE
)

2996 
doRÙ©iÚs
 = 
Œue
;

2998 
doRÙ©iÚs
 = 
çl£
;

3000 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

3001 if(
´im™ive
 =ğ
NULL
)

3004 if(
doRÙ©iÚs
)

3006 
´im™ive
->
	`rÙ©eBy
(
d–Q
);

3008 
axis
 = 
´im™ive
->
	`g‘X
(è- 
¡¬tPos™iÚ
;

3009 
d–Q
.
	`rÙ©eVeùÜ
(
axis
);

3010 
´im™ive
->
	`£tX
(
axis
 + 
¡¬tPos™iÚ
);

3013 
´im™ive
->
	`Œª¦©eBy
(
d–X
);

3014 
´im™ive
->
	`sÿËBy
(
Ï¡SÿËV®ue
);

3016 if(
i
 =ğ
middËIndex
)

3018 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

3020 
´evPrim™iveId
 = 
´im™iveId
;

3021 
´im™iveId
 +ğ
´im™iveIndexD–
;

3023 
	`£tPrim™iveToP»viousP»diùiÚ
(
figu»
, 
´im™iveId
,

3024 
´evPrim™iveId
, 
Ï¡ElÚg©eV®ue
);

3026 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
)->
	`sÿËBy
(
Ï¡SÿËV®ue
);

3032 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

3034 
´evPrim™iveId
 = 
´im™iveId
;

3035 
´im™iveId
 +ğ
´im™iveIndexD–
;

3036 
ÃighbÜPrim™iveId
 = 
´im™iveId
 -

3037 
d–Index
 * 
ÃighbÜIndexD–
;

3039 
	`£tPrim™iveToAv”ageP»diùiÚ
(
figu»
, 
´im™iveId
,

3040 
´evPrim™iveId
, 
ÃighbÜPrim™iveId
,

3041 
Ï¡SÿËV®ue
, 
Ï¡ElÚg©eV®ue
);

3043 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
)->
	`sÿËBy
(
Ï¡SÿËV®ue
);

3048 
¡¬tIndex
 = 
middËIndex
 + 1;

3050 
d–‘e
 
pLi¡2
;

3051 
	}
}

3054 
	#WIDEN_UPPER_LIMIT
 10

	)

3055 
	#WIDEN_LOWER_LIMIT
 .1

	)

3056 
	#ELONGATE_UPPER_LIMIT
 10

	)

3057 
	#ELONGATE_LOWER_LIMIT
 .1

	)

3059 
	#EPSILON
 1E-4

	)

3060 
boŞ
 
	$IsNum”iÿÎyEqu®
(
v1
, 
v2
)

3062 if(
	`çbs
(
v1
-
v2
)<
EPSILON
)

3063  
Œue
;

3065  
çl£
;

3066 
	}
}

3068 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$wid’
(
v®ue
)

3070 
i
;

3072 if(
v®ue
>
WIDEN_UPPER_LIMIT
)

3073 
v®ue
=
WIDEN_UPPER_LIMIT
;

3074 if(
v®ue
<
WIDEN_LOWER_LIMIT
)

3075 
v®ue
=
WIDEN_LOWER_LIMIT
;

3077 #ifdeà
DEBUG


3078 
	`årštf
(
¡d”r
, "dWid’: %àtime š ACTUAL wid’šg.\n", 
v®ue
);

3081 
loggedV®ue
=
	`log
(
v®ue
)/log(
LOG_BASE
);

3082 
Ï¡V®ue
;

3083 
wid’I‹¿tiÚs
=()
loggedV®ue
;

3084 if(
loggedV®ue
>0)

3085 
Ï¡V®ue
=
	`pow
(
LOG_BASE
, 
loggedV®ue
-
wid’I‹¿tiÚs
);

3087 
Ï¡V®ue
=
	`pow
(
LOG_BASE
, 
loggedV®ue
-
wid’I‹¿tiÚs
);

3089 if(
loggedV®ue
>0)

3091  
i
=0; i < 
wid’I‹¿tiÚs
; i++)

3093 
	`wid’S‹p
(
LOG_BASE
);

3094 
	`š™S‹p
();

3099  
i
=0; i < -
wid’I‹¿tiÚs
; i++)

3101 
	`wid’S‹p
(
INVERSED_LOG_BASE
);

3102 
	`š™S‹p
();

3106 if(!
	`IsNum”iÿÎyEqu®
(
Ï¡V®ue
, 1.0))

3107 
	`wid’S‹p
(
Ï¡V®ue
);

3108 
	`»In™
();

3109 
	}
}

3146 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$–Úg©eS‹p
(
v®ue
)

3149 
M3DQuadFigu»
 * 
figu»
;

3151 
M3DPrim™ive
 * 
´im™ive
;

3160 
M3DPrim™iveLškInfo
 * 
lšk
;

3162 
lškCouÁ
,

3163 
rowCouÁ
, 
cŞumnCouÁ
,

3164 
i
, 
j
,

3165 
´im™iveId
,

3166 
´im™iveIndexD–
,

3167 
ÃighbÜIndexD–
,

3168 
numPrim™ivesP”Lšk
;

3170 
´evPrim™iveId
,

3171 
ÃighbÜPrim™iveId
;

3174 if(
figu»T»eNode
 =ğ
NULL
 || 
objeù
 == NULL)

3177 
figu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
figu»T»eNode
->
	`g‘Figu»Id
()));

3178 if(
figu»
 =ğ
NULL
)

3189 
rowCouÁ
 = 
figu»
->
	`g‘RowCouÁ
();

3190 
cŞumnCouÁ
 = 
figu»
->
	`g‘CŞumnCouÁ
();

3192 if(
rowOr›ÁedLšks
)

3194 
´im™iveIndexD–
 = 
cŞumnCouÁ
;

3195 
numPrim™ivesP”Lšk
 = 
rowCouÁ
;

3196 
ÃighbÜIndexD–
 = 1;

3200 
´im™iveIndexD–
 = 1;

3201 
numPrim™ivesP”Lšk
 = 
cŞumnCouÁ
;

3202 
ÃighbÜIndexD–
 = 
cŞumnCouÁ
;

3205 
lškCouÁ
 = 
figu»T»eNode
->
	`g‘LškCouÁ
();

3207 
middËIndex
 = 
lškCouÁ
 / 2;

3208 
d–Index
;

3210 
Ï¡ElÚg©eV®ue
 = 
v®ue
;

3212 
¡¬tIndex
 = 
middËIndex
;

3213 
d–Index
 = -1; deltaIndex <= 1; deltaIndex += 2)

3215 
i
 = 
¡¬tIndex
; i < 
lškCouÁ
 && i >ğ0; i +ğ
d–Index
)

3217 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(
i
);

3218 if(
lšk
 =ğ
NULL
)

3221 
´im™iveId
 = 
lšk
->primitiveId;

3222 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

3223 if(
´im™ive
 =ğ
NULL
)

3226 if(
i
 =ğ
middËIndex
)

3228 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

3230 
´evPrim™iveId
 = 
´im™iveId
;

3231 
´im™iveId
 +ğ
´im™iveIndexD–
;

3233 
	`£tPrim™iveToP»viousP»diùiÚ
(
figu»
, 
´im™iveId
,

3234 
´evPrim™iveId
, 
Ï¡ElÚg©eV®ue
);

3243 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

3245 
´evPrim™iveId
 = 
´im™iveId
;

3246 
´im™iveId
 +ğ
´im™iveIndexD–
;

3247 
ÃighbÜPrim™iveId
 = 
´im™iveId
 -

3248 
d–Index
 * 
ÃighbÜIndexD–
;

3250 
	`£tPrim™iveToAv”ageP»diùiÚ
(
figu»
, 
´im™iveId
,

3251 
´evPrim™iveId
, 
ÃighbÜPrim™iveId
,

3252 
Ï¡SÿËV®ue
, 
Ï¡ElÚg©eV®ue
);

3264 
¡¬tIndex
 = 
middËIndex
 + 1;

3266 
	}
}

3268 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$–Úg©e
(
v®ue
)

3270 
i
;

3272 if(
v®ue
>
ELONGATE_UPPER_LIMIT
)

3273 
v®ue
=
ELONGATE_UPPER_LIMIT
;

3274 if(
v®ue
<
ELONGATE_LOWER_LIMIT
)

3275 
v®ue
=
ELONGATE_LOWER_LIMIT
;

3277 #ifdeà
DEBUG


3278 
	`årštf
(
¡d”r
, "dElÚg©e: %àtime š ACTUALƒlÚg©iÚ.\n", 
v®ue
);

3281 
loggedV®ue
=
	`log
(
v®ue
)/log(
LOG_BASE
);

3282 
Ï¡V®ue
;

3283 
–Úg©eI‹¿tiÚs
=()
loggedV®ue
;

3284 if(
loggedV®ue
>0)

3285 
Ï¡V®ue
=
	`pow
(
LOG_BASE
, 
loggedV®ue
-
–Úg©eI‹¿tiÚs
);

3287 
Ï¡V®ue
=
	`pow
(
LOG_BASE
, 
loggedV®ue
-
–Úg©eI‹¿tiÚs
);

3289 if(
loggedV®ue
>0)

3291  
i
=0; i < 
–Úg©eI‹¿tiÚs
; i++)

3293 
	`–Úg©eS‹p
(
LOG_BASE
);

3294 
	`š™S‹p
();

3299  
i
=0; i < -
–Úg©eI‹¿tiÚs
; i++)

3301 
	`–Úg©eS‹p
(
INVERSED_LOG_BASE
);

3302 
	`š™S‹p
();

3306 if(!
	`IsNum”iÿÎyEqu®
(
Ï¡V®ue
, 1.0))

3307 
	`–Úg©eS‹p
(
Ï¡V®ue
);

3308 
	`»In™
();

3309 
	}
}

3344 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$hšgeS‹p
(
ªgË
)

3346 
M3DFigu»T»eNode
 * 
·»ÁNode
;

3347 
M3DQuadFigu»
 * 
figu»
;

3348 
M3DQuadFigu»
 * 
·»ÁFigu»
;

3349 
M3DPrim™ive
 * 
´im™ive
, * 
´im™ivePo¡
, * 
´im™iveP»
;

3350 
M3DQuadPrim™ive
 
¡¬tPrim™ive
;

3351 
M3DQuadPrim™ive
 
fšishPrim™ive
;

3352 
VeùÜ3D
 
ŞdNÜm®
, 
ÃwNÜm®
;

3353 
VeùÜ3D
 
¡¬tPos™iÚ
, 
’dPos™iÚ
;

3354 
VeùÜ3D
 
d–X
;

3355 
VeùÜ3D
 
axis
, 
veùÜ1
, 
veùÜ2
;

3356 
Qu©
 
d–Q
;

3357 
M3DPrim™iveLškInfo
 * 
lšk
, * 
lškPo¡
, * 
lškP»
;

3359 
boŞ
 
doRÙ©iÚs
;

3360 
R—l
 
nÜm
;

3362 
lškCouÁ
,

3363 
rowCouÁ
, 
cŞumnCouÁ
,

3364 
i
, 
j
,

3365 
´im™iveId
,

3366 
´im™ivePo¡Id
,

3367 
´im™iveP»Id
,

3368 
´im™iveIndexD–
,

3369 
ÃighbÜIndexD–
,

3370 
numPrim™ivesP”Lšk
;

3372 
´evPrim™iveId
,

3373 
ÃighbÜPrim™iveId
;

3376 if(
figu»T»eNode
 =ğ
NULL
 || 
objeù
 =ğNULL || 
»ã»nûFigu»
 == NULL)

3379 
figu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
figu»T»eNode
->
	`g‘Figu»Id
()));

3380 if(
figu»
 =ğ
NULL
)

3383 
·»ÁNode
 = 
figu»T»eNode
->
	`g‘P¬’t
();

3384 if(
·»ÁNode
 =ğ
NULL
)

3387 
·»ÁFigu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
·»ÁNode
->
	`g‘Figu»Id
()));

3389 
rowCouÁ
 = 
figu»
->
	`g‘RowCouÁ
();

3390 
cŞumnCouÁ
 = 
figu»
->
	`g‘CŞumnCouÁ
();

3393 if(
rowOr›ÁedLšks
)

3395 
´im™iveIndexD–
 = 
cŞumnCouÁ
;

3396 
numPrim™ivesP”Lšk
 = 
rowCouÁ
;

3397 
ÃighbÜIndexD–
 = 1;

3401 
´im™iveIndexD–
 = 1;

3402 
numPrim™ivesP”Lšk
 = 
cŞumnCouÁ
;

3403 
ÃighbÜIndexD–
 = 
cŞumnCouÁ
;

3406 
lškCouÁ
 = 
figu»T»eNode
->
	`g‘LškCouÁ
();

3408 
middËIndex
 = 
lškCouÁ
 / 2;

3409 
d–Index
;

3411 
¡¬tIndex
 = 
middËIndex
;

3412 
d–Index
 = -1; deltaIndex <= 1; deltaIndex += 2)

3414 
i
 = 
¡¬tIndex
; i < 
lškCouÁ
 && i >ğ0; i +ğ
d–Index
)

3416 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(
i
);

3417 if(
lšk
 =ğ
NULL
)

3420 
´im™iveId
 = 
lšk
->primitiveId;

3421 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

3422 if(
´im™ive
 =ğ
NULL
)

3425 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

3426 if(
´im™ive
 =ğ
NULL
)

3429 
lškPo¡
 = 
figu»T»eNode
->
	`g‘Lšk
(
i
+1);

3430 if(
lškPo¡
 !ğ
NULL
){

3431 
´im™ivePo¡Id
 = 
lškPo¡
->
´im™iveId
;

3432 
´im™ivePo¡
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™ivePo¡Id
);

3433 if(
´im™ivePo¡
 !ğ
NULL
)

3434 
veùÜ1
=
´im™ivePo¡
->
	`g‘X
()-
´im™ive
->getX();

3436 
lškP»
 = 
figu»T»eNode
->
	`g‘Lšk
(
i
-1);

3437 if(
lškP»
 !ğ
NULL
){

3438 
´im™iveP»Id
 = 
lškP»
->
´im™iveId
;

3439 
´im™iveP»
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveP»Id
);

3440 if(
´im™iveP»
 !ğ
NULL
)

3441 
veùÜ2
=
´im™ive
->
	`g‘X
()-
´im™iveP»
->getX();

3444 ià(
lškPo¡
 =ğ
NULL
 || 
´im™ivePo¡
 == NULL)

3445 ià(
lškP»
 =ğ
NULL
 || 
´im™iveP»
 == NULL)

3448 
axis
=
veùÜ2
;

3450 ià(
lškP»
 =ğ
NULL
 || 
´im™iveP»
 == NULL)

3451 
axis
=
veùÜ1
;

3453 
axis
=(
veùÜ1
+
veùÜ2
)*0.5;

3455 
axis
.
	`nÜm®ize
();

3456 
d–Q
.
	`£tAxisAngË
(
axis
, 
ªgË
);

3459 
nÜm
 = 
d–Q
.
	`nÜm
();

3460 if(
nÜm
 > 1.0 - 
R_SMALL_TOLERANCE
 &&

3461 
nÜm
 < 1.0 + 
R_SMALL_TOLERANCE
)

3462 
doRÙ©iÚs
 = 
Œue
;

3464 
doRÙ©iÚs
 = 
çl£
;

3466 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

3467 if(
´im™ive
 =ğ
NULL
)

3470 if(
doRÙ©iÚs
)

3472 
´im™ive
->
	`rÙ©eBy
(
d–Q
);

3476 if(
i
 =ğ
middËIndex
)

3478 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

3480 
´evPrim™iveId
 = 
´im™iveId
;

3481 
´im™iveId
 +ğ
´im™iveIndexD–
;

3483 
	`£tPrim™iveToP»viousP»diùiÚ
(
figu»
, 
´im™iveId
,

3484 
´evPrim™iveId
, 
Ï¡ElÚg©eV®ue
);

3490 
j
 = 1; j < 
numPrim™ivesP”Lšk
; j++)

3492 
´evPrim™iveId
 = 
´im™iveId
;

3493 
´im™iveId
 +ğ
´im™iveIndexD–
;

3494 
ÃighbÜPrim™iveId
 = 
´im™iveId
 -

3495 
d–Index
 * 
ÃighbÜIndexD–
;

3497 
	`£tPrim™iveToAv”ageP»diùiÚ
(
figu»
, 
´im™iveId
,

3498 
´evPrim™iveId
, 
ÃighbÜPrim™iveId
, 
Ï¡SÿËV®ue
,

3499 
Ï¡ElÚg©eV®ue
);

3504 
¡¬tIndex
 = 
middËIndex
 + 1;

3506 
	}
}

3508 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$hšge
(
ªgË
)

3510 
i
;

3511 
d–
 = 0.1;

3512 
hšgeI‹¿tiÚs
;

3513 
Ï¡AngË
;

3516 
hšgeI‹¿tiÚs
 = (è
	`çbs
(
ªgË
 / 
d–
);

3517 ià(
ªgË
 > 0.0)

3518 
Ï¡AngË
 = 
ªgË
 - 
d–
 * 
hšgeI‹¿tiÚs
;

3520 
Ï¡AngË
 = 
ªgË
 + 
d–
 * 
hšgeI‹¿tiÚs
;

3522  
i
=0; i < 
hšgeI‹¿tiÚs
; i++)

3524 ià(
ªgË
 > 0.0)

3525 
	`hšgeS‹p
(
d–
);

3527 
	`hšgeS‹p
(-
d–
);

3528 
	`š™S‹p
();

3530 
	`hšgeS‹p
(
Ï¡AngË
);

3533 
	`»In™
();

3534 
	}
}

3546 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$checkFÜV®idLšks
()

3548 
lškCouÁ
;

3549 
rowCouÁ
,

3550 
cŞumnCouÁ
;

3551 
´im™iveId
;

3552 
M3DQuadFigu»
 * 
figu»
;

3554 
M3DPrim™iveLškInfo
 * 
lšk
;

3556 if(
figu»T»eNode
 =ğ
NULL
 || 
objeù
 == NULL)

3559 
figu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>Ğ
objeù
->
	`g‘Figu»PŒ
(
figu»T»eNode
->
	`g‘Figu»Id
()));

3560 if(
figu»
 =ğ
NULL
)

3563 
lškCouÁ
 = 
figu»T»eNode
->
	`g‘LškCouÁ
();

3565 
rowCouÁ
 = 
figu»
->
	`g‘RowCouÁ
();

3566 
cŞumnCouÁ
 = 
figu»
->
	`g‘CŞumnCouÁ
();

3569 if(
lškCouÁ
 < 1)

3571 
	`´štf
("Error: No†inks defined on subfigure.\n");

3572 
šv®idLšks
 = 
Œue
;

3577 if(
lškCouÁ
 == 1)

3580 if(
rowCouÁ
 !ğ1 && 
cŞumnCouÁ
 != 1)

3582 
	`´štf
("Error: Links‡re‚ot‡nƒntire„ow or column\n");

3583 
šv®idLšks
 = 
Œue
;

3587 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(0);

3588 
´im™iveId
 = 
lšk
->primitiveId;

3591 if((
rowCouÁ
 =ğ1 && (
´im™iveId
 !ğ0 &&…rim™iveId !ğ
cŞumnCouÁ
 - 1)) ||

3592 (
cŞumnCouÁ
 =ğ1 && (
´im™iveId
 !ğ0 &&…rim™iveId !ğ
rowCouÁ
 - 1)))

3594 
	`´štf
("Error: Links‡re‚ot‡nƒntire„ow or column\n");

3595 
šv®idLšks
 = 
Œue
;

3600 
rowOr›ÁedLšks
 = 
çl£
;

3604 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(0);

3605 
´im™iveId
 = 
lšk
->primitiveId;

3607 
lšk
 = 
figu»T»eNode
->
	`g‘Lšk
(1);

3608 if((
lšk
->
´im™iveId
 % 
cŞumnCouÁ
 == 0 &&

3609 
´im™iveId
 % 
cŞumnCouÁ
 == 0) ||

3610 (
lšk
->
´im™iveId
 % 
cŞumnCouÁ
 == columnCount-1 &&

3611 
´im™iveId
 % 
cŞumnCouÁ
 == columnCount-1))

3612 
rowOr›ÁedLšks
 = 
çl£
;

3614 
rowOr›ÁedLšks
 = 
Œue
;

3625 
	}
}

3627 
boŞ
 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$g‘IÁ”pŞ©edPrim™ive
(

3628 
M3DPrim™ive
 & 
´im
, 
M3DQuadFigu»
 * 
figu»
, 
u
, 
v
, 
t
)

3634 
Qu©
 
q
, 
rÙ©eQ
;

3635 
umax
, 
vmax
;

3637 
umax
 = (è(
figu»
->
	`g‘CŞumnCouÁ
() - 1);

3638 
vmax
 = (è(
figu»
->
	`g‘RowCouÁ
() - 1);

3639 if(
u
 > 
umax
 || u < 0.0 || 
v
 > 
vmax
 || v < 0.0)

3640  
çl£
;

3642 
rÙ©eQ
.
	`£tAxisAngË
(
	`VeùÜ3D
(1.0, 0.0, 0.0), -
R_HALF_PI
);

3644 
	`årštf
(
¡d”r
, "ERROR: M3DSubfigureTransformation::getInterpolatedPrimitive()\n");

3645 
	`årštf
(
¡d”r
, " This code should‚ot be used unless„ewritten.\n");

3670  
Œue
;

3671 
	}
}

3706 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$g‘SurçûPoštAndNÜm®
(

3707 
Th®lCode
::
Poši¡_£rv”2
* 
pLi¡2
, 
VeùÜ3D
 & 
pošt
, VeùÜ3D & 
nÜm®
, 
u
, 
v
, 
t
)

3710 
Bpošt
 
bpošt
;

3711 
pLi¡2
->
	`subdivBPos™iÚ
(&
bpošt
, 
u
, 
v
, 
t
);

3712 
pošt
.
	`£t
(
bpošt
.
²t
);

3713 
nÜm®
.
	`£t
(
bpošt
.
nÜm
);

3714 
nÜm®
.
	`nÜm®ize
();

3715 
	}
}

3717 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$£tPrim™iveToP»viousP»diùiÚ
(

3718 
M3DQuadFigu»
 * 
figu»
, 
´im™iveId
, 
´evPrim™iveId
, 
sÿË
)

3720 
M3DPrim™ive
 * 
´im™ive
,

3721 * 
´evPrim™ive
,

3722 * 
»fPrim™ive
,

3723 * 
»fP»vPrim™ive
;

3725 
VeùÜ3D
 
´evDiff
;

3727 
Qu©
 
q
, 
dq
;

3730 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

3731 
´evPrim™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´evPrim™iveId
);

3733 
»fPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

3734 
»fP»vPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
´evPrim™iveId
);

3736 if(
´im™ive
 =ğ
NULL
 || 
´evPrim™ive
 == NULL ||

3737 
»fPrim™ive
 =ğ
NULL
 || 
»fP»vPrim™ive
 == NULL)

3740 
´evDiff
 = 
sÿË
 * (
»fPrim™ive
->
	`g‘X
(è- 
»fP»vPrim™ive
->getX());

3742 
dq
 = 
´evPrim™ive
->
	`g‘Q
(è* 
»fP»vPrim™ive
->g‘Q().
	`cÚj
();

3743 
dq
.
	`rÙ©eVeùÜ
(
´evDiff
);

3745 
q
 = 
»fP»vPrim™ive
->
	`g‘Q
().
	`cÚj
(è* 
»fPrim™ive
->getQ();

3747 
´im™ive
->
	`£tX
(
´evPrim™ive
->
	`g‘X
(è+ 
´evDiff
);

3748 
´im™ive
->
	`£tQ
(
´evPrim™ive
->
	`g‘Q
(è* 
q
);

3749 
	}
}

3751 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$£tPrim™iveToAv”ageP»diùiÚ
(

3752 
M3DQuadFigu»
 * 
figu»
, 
´im™iveId
, 
´evPrim™iveId
,

3753 
ÃighbÜPrim™iveId
, 
sÿË
, 
–Úg©iÚ
)

3755 
M3DPrim™ive
 * 
´im™ive
,

3756 * 
´evPrim™ive
,

3757 * 
ÃighbÜPrim™ive
,

3758 * 
»fPrim™ive
,

3759 * 
»fP»vPrim™ive
,

3760 * 
»fNeighbÜPrim™ive
;

3762 
M3DQuadPrim™ive
 
´evP»diùiÚ
,

3763 
ÃighbÜP»diùiÚ
;

3765 
VeùÜ3D
 
´evDiff
,

3766 
ÃighbÜDiff
;

3767 
´evDi¡
,

3768 
ÃighbÜDi¡
,

3769 
weight
;

3771 
Qu©
 
q
, 
dq
;

3775 
´im™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

3776 
´evPrim™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
´evPrim™iveId
);

3777 
ÃighbÜPrim™ive
 = 
figu»
->
	`g‘Prim™ivePŒ
(
ÃighbÜPrim™iveId
);

3779 
»fPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
´im™iveId
);

3780 
»fP»vPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
´evPrim™iveId
);

3781 
»fNeighbÜPrim™ive
 = 
»ã»nûFigu»
->
	`g‘Prim™ivePŒ
(
ÃighbÜPrim™iveId
);

3783 if(
´im™ive
 =ğ
NULL
 || 
´evPrim™ive
 == NULL ||

3784 
ÃighbÜPrim™ive
 =ğ
NULL
 || 
»fPrim™ive
 == NULL ||

3785 
»fP»vPrim™ive
 =ğ
NULL
 || 
»fNeighbÜPrim™ive
 == NULL)

3789 
´evDiff
 = 
–Úg©iÚ
 * (
»fPrim™ive
->
	`g‘X
(è- 
»fP»vPrim™ive
->getX());

3790 
ÃighbÜDiff
 = 
sÿË
 * (
»fPrim™ive
->
	`g‘X
(è- 
»fNeighbÜPrim™ive
->getX());

3795 
dq
 = 
´evPrim™ive
->
	`g‘Q
(è* 
»fP»vPrim™ive
->g‘Q().
	`cÚj
();

3801 
dq
.
	`rÙ©eVeùÜ
(
´evDiff
);

3803 
q
 = 
»fP»vPrim™ive
->
	`g‘Q
().
	`cÚj
(è* 
»fPrim™ive
->getQ();

3805 
´evP»diùiÚ
.
	`£tX
(
´evPrim™ive
->
	`g‘X
(è+ 
´evDiff
);

3806 
´evP»diùiÚ
.
	`£tQ
(
´evPrim™ive
->
	`g‘Q
(è* 
q
);

3807 
´evP»diùiÚ
.
	`£tR
(
´im™ive
->
	`g‘R
());

3808 
´evP»diùiÚ
.
	`£tTh‘a
(
´im™ive
->
	`g‘Th‘a
());

3810 
dq
 = 
ÃighbÜPrim™ive
->
	`g‘Q
(è* 
»fNeighbÜPrim™ive
->g‘Q().
	`cÚj
();

3816 
dq
.
	`rÙ©eVeùÜ
(
ÃighbÜDiff
);

3818 
q
 = 
»fNeighbÜPrim™ive
->
	`g‘Q
().
	`cÚj
(è* 
»fPrim™ive
->getQ();

3820 
ÃighbÜP»diùiÚ
.
	`£tX
(
ÃighbÜPrim™ive
->
	`g‘X
(è+ 
ÃighbÜDiff
);

3821 
ÃighbÜP»diùiÚ
.
	`£tQ
(
ÃighbÜPrim™ive
->
	`g‘Q
(è* 
q
);

3822 
ÃighbÜP»diùiÚ
.
	`£tR
(
´im™ive
->
	`g‘R
());

3823 
ÃighbÜP»diùiÚ
.
	`£tTh‘a
(
´im™ive
->
	`g‘Th‘a
());

3825 
´evDiff
 = 
´im™ive
->
	`g‘X
(è- 
´evPrim™ive
->getX();

3826 
ÃighbÜDiff
 = 
´im™ive
->
	`g‘X
(è- 
ÃighbÜPrim™ive
->getX();

3827 
´evDi¡
 = 
´evDiff
.
	`nÜm
();

3828 
ÃighbÜDi¡
 = 
ÃighbÜDiff
.
	`nÜm
();

3830 
weight
 = 
–Úg©iÚ
 * 
ÃighbÜDi¡
 / (
sÿË
 * 
´evDi¡
 +ƒlongation *‚eighborDist);

3832 
	`av”agePrim™ives
(*
´im™ive
, 
´evP»diùiÚ
, 
ÃighbÜP»diùiÚ
, 
weight
);

3834 
	}
}

3836 
	gM3DSubfigu»T¿nsfÜm©iÚ
::
	$av”agePrim™ives
(
M3DPrim™ive
 & 
avePrim
,

3837 cÚ¡ 
M3DPrim™ive
 & 
´im1
, cÚ¡ M3DPrim™iv& 
´im2
, 
weight
)

3839 
Qu©
 
q
;

3841 
weight2
 = 1.0 - 
weight
;

3843 
avePrim
.
	`£tX
(
weight2
 * 
´im1
.
	`g‘X
(è+ 
weight
 * 
´im2
.getX());

3844 
avePrim
.
	`£tQ
(
q
.
	`¦”p
(
weight
, 
´im1
.
	`g‘Q
(), 
´im2
.getQ()));

3845 
avePrim
.
	`£tR
(
weight2
 * 
´im1
.
	`g‘R
(è+ 
weight
 * 
´im2
.getR());

3846 
avePrim
.
	`£tTh‘a
(
weight2
 * 
´im1
.
	`g‘Th‘a
(è+ 
weight
 * 
´im2
.getTheta());

3847 
	}
}

	@M3DTubeSimilarityPGAProblem.cpp

1 
	~<m©h.h
>

2 
	~<io¡»am
>

3 
	~"M3DTubeSim¬™yPGAProbËm.h
"

4 
	~"Tunšg.h
"

7 
glob®V”bos™y
;

10 
usšg
 
Çme¥aû
 
	g¡d
;

13 
	gM3DTubeSim¬™yPGAProbËm
::
	$M3DTubeSim¬™yPGAProbËm
(è: 
	$M3DSim¬™yPGAProbËm
()

15 
tubePhiMode
 = 
çl£
;

16 
	}
}

18 
	gM3DTubeSim¬™yPGAProbËm
::~
	$M3DTubeSim¬™yPGAProbËm
()

20 
	}
}

27 
M3DTubeSim¬™yPGAProbËm
::
	$·¿m‘”CouÁ
() const

29 
maxModes
, 
numModes
;

31 ià(
»fObjeù
 =ğ
NULL
)

34 
M3DFigu»T»eNode
* 
Œ“Node
 = 
»fObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“_šdex
);

35 ià(
Œ“Node
 =ğ
NULL
)

39 
figu»Id
 = 
Œ“Node
->
	`g‘Figu»Id
();

40 
Üd”
 = 
pga
->
	`fšdPGS‘Id
(
figu»Id
);

42 
PGD©a
 * 
pgPŒ
 = 
pga
->
	`g‘PGD©aPŒ
(
Üd”
);

44 
maxModes
 = (è
	`tunšgWt
(
Figu»MaxPGAModes
);

45 
numModes
 = 
pgPŒ
->
numPGs
;

47 ià(
maxModes
 < 
numModes
)

48 
numModes
 = 
maxModes
;

50 ià(0 =ğ(è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
))

51 
numModes
 += 7;

54 ifĞ
dyÇmic_ÿ¡
<
M3DTubeFigu»
*>(
»fObjeù
->
	`g‘Figu»PŒ
(
figu»Id
)è!ğ
NULL
 ) {

55 
tubePhiMode
 = 
Œue
;

58 
tubePhiMode
 = 
çl£
;

62 ifĞ
tubePhiMode
 ) {

63 
numModes
++;

66  
numModes
;

67 
	}
}

74 
M3DObjeù
 * 
	gM3DTubeSim¬™yPGAProbËm
::
	$ü—‹T¬g‘Objeù
(cÚ¡ 
VeùÜ
 & 
x
,

75 & 
figu»Id
, 
boŞ
 
´ediù
)

77 
´im™iveCouÁ
;

78 
M3DObjeù
 * 
rg‘Objeù
;

79 
M3DFigu»T»eNode
 * 
Œ“Node
;

80 
M3DFigu»
 * 
figu»
;

82 ià(
»fObjeù
 =ğ
NULL
 || 
x
.
	`size
(è!ğ
	`·¿m‘”CouÁ
())

83  
NULL
;

85 
Œ“Node
 = 
»fObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“_šdex
);

86 ià(
Œ“Node
 =ğ
NULL
)

87  
NULL
;

89 #ifdeà
BINARY


90 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

92 
figu»Id
 = 
Œ“Node
->
	`g‘Figu»Id
();

97 
rg‘Objeù
 = 
»fObjeù
->
	`assign
();

99 
figu»
 = 
rg‘Objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

100 ià(
figu»
 =ğ
NULL
) {

101 
d–‘e
 
rg‘Objeù
;

102  
NULL
;

104 
figu»
->
	`£Ëù
();

105 
M3DTubeFigu»
* 
tubeFigu»
 = 
dyÇmic_ÿ¡
<M3DTubeFigu»*>(
figu»
);

107 
´im™iveCouÁ
 = 
figu»
->
	`g‘Prim™iveCouÁ
();

109 
™”©iÚCouÁ”
 = 0;

110 ià(
glob®V”bos™y
 >= 1)

111 
cout
 << 
™”©iÚCouÁ”
 << ":";

112 
™”©iÚCouÁ”
++;

114 
¡d
::
veùÜ
<> 
v®s
 = 
	`pgaCÛffic›Ás
(
x
);

117 
Üd”
 = 
pga
->
	`fšdPGS‘Id
(
figu»Id
);

118 
pga
->
	`doPGADefÜm
(
rg‘Objeù
, 
v®s
, 
Üd”
, 
çl£
);

121 #ifdeà
UNFLIPPED


122 
VeùÜ3D
 
	`ûÁ”
(0.0, 1.0, 0.0);

124 
VeùÜ3D
 
	`ûÁ”
(0.0, 0.0, 0.0);

126 #ifdeà
BINARY


127 
u£MOM
 = (
	`tunšgWt
(
BpDoM‘hodOfMom’ts
) &&

128 ! 
	`tunšgWt
(
BpFigu»Re£tMod–BefÜe
));

129 cÚ¡ 
Sim¬™yT¿nsfÜm3D
 * 
xfÜm
 = 
u£MOM
 ? &
GLOBALMOMT¿nsfÜm


130 : 
rg‘Objeù
->
	`g‘T¿nsfÜm©iÚ
();

131 
figu»
->
	`­¶ySim¬™y
Ğ*
xfÜm
, 
ûÁ”
 );

132 
sim¬™yObjeù
 = 
rg‘Objeù
->
	`assign
();

134 
figu»
->
	`­¶ySim¬™y
Ğ
mašFigProbËmSimT¿nsfÜm
, 
ûÁ”
 );

140 cÚ¡ 
Sim¬™yT¿nsfÜm3D
 
hªdT¿nsfÜm
 = 
pga
->
	`g‘HªdPÏûm’tT¿nsfÜm
();

142 
figu»
->
	`­¶ySim¬™y
Ğ
hªdT¿nsfÜm
, 
ûÁ”
 );

148 
Sim¬™yT¿nsfÜm3D
 
Œf
;

150 ià((è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
) == 0) {

151 
VeùÜ3D
 
Œªs
, 
axis
;

152 
ªgË
, 
sÿË
;

153 
Qu©
 
fš®RÙ
;

156 
Œªs
.
	`£t
(
	`x
(0), x(1), x(2));

157 
Œªs
 *ğ
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
);

158 ià(
glob®V”bos™y
 >= 1)

159 
cout
 << " T¬g‘ obj: T(x,y,z): " << 
Œªs
.
	`g‘X
(è<< ' ' <<¿ns.
	`g‘Y
(è<< ' ' <<¿ns.
	`g‘Z
();

161 
axis
.
	`£t
(
	`x
(3), x(4), x(5));

162 
ªgË
 = 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
è* 
axis
.
	`nÜm®ize
();

163 
fš®RÙ
.
	`£tAxisAngË
(
axis
, 
ªgË
);

164 ià(
glob®V”bos™y
 >= 1)

165 
cout
 << " R(x,y,z,ªgË): " << 
axis
.
	`g‘X
(è<< ' ' <<‡xis.
	`g‘Y
(è<< ' ' <<‡xis.
	`g‘Z
(è<< ' ' << 
ªgË
;

167 
sÿË
 = 
	`exp
(
	`tunšgWt
(
Figu»SÿËFaùÜ
è* 
	`x
(6));

168 ià(
glob®V”bos™y
 >= 1)

169 
cout
 << " S: " << 
sÿË
;

171 
Œf
.
	`£tRÙ©iÚ
(
fš®RÙ
);

172 
Œf
.
	`£tSÿË
(
sÿË
);

173 
Œf
.
	`£tT¿n¦©iÚ
(
Œªs
);

176 ifĞ
tubePhiMode
 ) {

177 
	`as£¹
Ğ
tubeFigu»
 !ğ
NULL
 );

178 
hi
;

179 ià(0 !ğ(è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
))

180 
hi
 = 0;

182 
hi
 = 7;

183 cÚ¡ 
phi
 = 
	`x
(
hi
)*
	`tunšgWt
(
Figu»TubePhiFaùÜ
);

184 
Œf
.
	`£tTubePhi
(
phi
);

185 ià(
glob®V”bos™y
 >= 1)

186 
cout
 << "…hi: " << 
phi
;

189 ifĞ
addToResidueObjeù
 !ğ
NULL
 ) {

190 cÚ¡ 
M3DFigu»
* 
ba£Figu»
 = 
addToResidueObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

191  
i
 = 0; i !ğ
´im™iveCouÁ
; ++i ) {

192 
M3DPrim™ive
* 
»siduePrim
 = 
figu»
->
	`g‘Prim™ivePŒ
(
i
);

193 
M3DPrim™ive
* 
´im
 = 
ba£Figu»
->
	`g‘Prim™ivePŒ
(
i
)->
	`cİyPŒ
();

204 
SymPrim™ive
 * 
symPrim
 = 
´im
->
	`cÚv”t2Sym
();

205 
SymPrim™ive
 * 
symResiduePrim
 = 
»siduePrim
->
	`cÚv”t2Sym
();

206 *
symResiduePrim
 +ğ*
symPrim
;

210 ià(!
symResiduePrim
->
	`cÚv”t2L›
(
´im
)) {

211 
û¼
 << "E¼Ü whcÚv”tšg backØl› grou°»´e¢tiÚ." << 
’dl
;

212 
	`as£¹
(
çl£
);

223 
figu»
->
	`£tPrim™ivePŒ
(
i
, 
´im
);

229 
figu»
->
	`­¶ySim¬™yAboutCOG
Ğ&
Œf
 );

230 ià(
glob®V”bos™y
 >= 1)

231 
cout
 << 
’dl
;

233  
rg‘Objeù
;

234 
	}
}

237 
	g¡d
::
veùÜ
<> 
M3DTubeSim¬™yPGAProbËm
::
	$pgaCÛffic›Ás
(cÚ¡ 
VeùÜ
& 
x
)

239 
¡¬t
;

240 
¡d
::
veùÜ
<> 
cÛffs
;

241 ià(0 !ğ(è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
))

242 
¡¬t
 = 0;

244 
¡¬t
 = 7;

246 ifĞ
tubePhiMode
 ) {

247 
¡¬t
++;

249 ià(
glob®V”bos™y
 > 0è
cout
 << " [PGA: ";

250 
i
 = 
¡¬t
; i < 
x
.
	`size
(); i++) {

251 
cÛffs
.
	`push_back
(
	`x
(
i
)*
	`tunšgWt
(
Figu»PGAFaùÜ
));

252 ià(
glob®V”bos™y
 > 0è
cout
 << 
	`x
(
i
)*
	`tunšgWt
(
Figu»PGAFaùÜ
) << " ";

254 ià(
glob®V”bos™y
 > 0è
cout
 << "]\n";

255  
cÛffs
;

256 
	}
}

259 
	gM3DTubeSim¬™yPGAProbËmBoundsFunùiÚ
::
	$bound
Ğ
i
 )

261 
	`as£¹
(
i
 >= 0);

262 ifĞ
´obËm
->
tubePhiMode
 ) {

263 
VeùÜ
 
bounds
;

264 ià((è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
) == 0) {

265 
bounds
 = 
	`VeùÜ
(9,

266 
	`tunšgWt
(
Figu»T¿n¦©iÚBound
),uningWt(FigureTranslationBound),uningWt(FigureTranslationBound),

267 
	`tunšgWt
(
Figu»RÙ©iÚBound
)*
R_PI
/180.0,uningWt(FigureRotationBound)*R_PI/180.0,uningWt(FigureRotationBound)*R_PI/180.0,

268 
	`log
(
	`tunšgWt
(
Figu»SÿËBound
)),

269 
	`tunšgWt
(
Figu»TubePhiBound
)*
R_PI
/180.0,

270 
	`tunšgWt
(
Figu»PGABound
) );

273 
bounds
 = 
	`VeùÜ
(2,

274 
	`tunšgWt
(
Figu»TubePhiBound
)*
R_PI
/180.0,

275 
	`tunšgWt
(
Figu»PGABound
) );

277  
	`bounds
Ğ(
i
 < 
bounds
.
	`size
()) ? i : (bounds.size() - 1) );

281  
	`bounds
Ğ(
i
 < 
bounds
.
	`size
()) ? i : (bounds.size() - 1) );

283 
	}
}

285 
	gM3DTubeSim¬™yPGAProbËmBoundsFunùiÚ
::
	$çùÜ
Ğ
i
 )

287 
	`as£¹
(
i
 >= 0);

288 ifĞ
´obËm
->
tubePhiMode
 ) {

289 
VeùÜ
 
çùÜs
;

290 ià((è
	`tunšgWt
(
Figu»Mah®ªobisOÆy
) == 0) {

291 
çùÜs
 = 
	`VeùÜ
(9,

292 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
),

293 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
),

294 
	`tunšgWt
(
Figu»T¿n¦©iÚFaùÜ
),

295 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
),

296 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
),

297 
	`tunšgWt
(
Figu»RÙ©iÚFaùÜ
),

298 
	`tunšgWt
(
Figu»SÿËFaùÜ
),

299 
	`tunšgWt
(
Figu»TubePhiFaùÜ
),

300 
	`tunšgWt
(
Figu»PGAFaùÜ
));

303 
çùÜs
 = 
	`VeùÜ
(2,

304 
	`tunšgWt
(
Figu»TubePhiFaùÜ
),

305 
	`tunšgWt
(
Figu»PGAFaùÜ
));

307  
	`çùÜs
Ğ(
i
 < 
çùÜs
.
	`size
()) ? i : (factors.size() - 1) );

311  
	`çùÜs
Ğ(
i
 < 
çùÜs
.
	`size
()) ? i : (factors.size() - 1) );

313 
	}
}

	@M3DVoxelOptimizer.cpp

1 
	~<f¡»am
>

2 
	~<m©h.h
>

3 
	~<time.h
>

4 
	~"O±imiz”Ba£.h
"

5 
	~"M3DVox–O±imiz”.h
"

10 cÚ¡ 
	gMIN_PENALTY_WEIGHT
 = 0;

11 cÚ¡ 
	gMIN_PENALTY_WEIGHT_EXP
 = 0.0;

12 cÚ¡ 
	gMAX_PENALTY_WEIGHT_EXP
 = 10.0;

13 cÚ¡ 
	gPENALTY_WEIGHT_POWER
 = 0.4;

15 cÚ¡ 
	gTOLERENCE
 = 1e-4;

17 
usšg
 
Çme¥aû
 
	g¡d
;

18 
usšg
 
Çme¥aû
 
	gTh®lCode
;

20 
	gM3DVox–O±imiz”
::
	$M3DVox–O±imiz”
()

22 
ty³
 = 
Bound¬yDi¥l
;

24 
rg‘Objeù
 = 
NULL
;

25 
surçûLev–
 = 0;

26 
figu»Id
 = 0;

27 
fšished
 = 
çl£
;

29 
numPts
 = 0;

30 
B²t
 = 
NULL
;

31 
ÃighbÜs
 = 
NULL
;

32 
m©ch
 = 
NULL
;

34 
cumChªge
 = 0.0;

35 
Ï¡P’®ty
 = 0.0;

36 
Ï¡M©chV®ue
 = 0.0;

39 
	`£tP’®tyWeight
(0.5);

40 
	`£tCÚ¡¿štsP’®tyWeight
(0.5);

43 
sigma1
 = 0.3;

44 
sigma2
 = 1.0;

45 
	}
}

47 
	gM3DVox–O±imiz”
::~
	$M3DVox–O±imiz”
()

49 
	`ş—rWÜkS·û
();

50 
	`d–‘eT¬g‘Objeù
();

51 
	}
}

53 
	gM3DVox–O±imiz”
::
	$ş—rWÜkS·û
()

55 ià(
B²t
 !ğ
NULL
)

57 
d–‘e
 [] 
B²t
;

58 
B²t
 = 
NULL
;

61 ià(
ÃighbÜs
 !ğ
NULL
)

63 
d–‘e
 [] 
ÃighbÜs
;

64 
ÃighbÜs
 = 
NULL
;

66 
	}
}

68 
	gM3DVox–O±imiz”
::
	$d–‘eT¬g‘Objeù
()

70 ià(
rg‘Objeù
 !ğ
NULL
) {

71 
d–‘e
 
rg‘Objeù
;

72 
rg‘Objeù
 = 
NULL
;

74 
	}
}

76 
	gM3DVox–O±imiz”
::
	$£tP’®tyWeight
(
w
)

78 
³ÇÉyWeight
 = 
w
;

79 
	}
}

81 
	gM3DVox–O±imiz”
::
	$£tCÚ¡¿štsP’®tyWeight
(
w
)

83 
³ÇÉyExp
 = 
MIN_PENALTY_WEIGHT_EXP
 +

84 (
MAX_PENALTY_WEIGHT_EXP
 - 
MIN_PENALTY_WEIGHT_EXP
è* (
w
 - 1);

85 
cÚ¡¿štsP’®tyWeight
 = 
MIN_PENALTY_WEIGHT
 + 
	`pow
(10.0, 
³ÇÉyExp
);

87 
	}
}

89 
M3DObjeù
 * 
	gM3DVox–O±imiz”
::
	$g‘Reã»nûObjeù
()

91 ià(
m©ch
 !ğ
NULL
)

92  
m©ch
->
	`g‘Reã»nûObjeù
();

94  
NULL
;

95 
	}
}

97 
boŞ
 
	gM3DVox–O±imiz”
::
	$š™Ÿlize
(
M©ch
 * 
m©chPŒ
, 
M3DObjeù
 * 
objeù
,

98 
figId
, 
Ëv–
, 
boŞ
 
u£Wšdowšg
)

100 #ifdeà
DEBUG


101 
cout
 << "M3DVoxelOptimizer::initialize()\n";

103 
figu»Id
 = 
figId
;

104 
surçûLev–
 = 
Ëv–
;

105 
wšdowIÁ’s™›s
 = 
u£Wšdowšg
;

107 
m©ch
 = 
m©chPŒ
;

108 ià(
	`g‘Reã»nûObjeù
(è=ğ
NULL
) {

109 
cout
 << "M©ch‚Ù in™Ÿlized. Qu™tšg Bound¬yO±::š™()." << 
’dl
;

110  
çl£
;

113 
dmask
 = 
m©ch
 -> 
	`g‘DMask
(
figu»Id
);

114 
dmask
->
	`£tDmaskTy³
(
m©ch
->
	`g‘Ty³
());

120 ià(
dmask
 =ğ
NULL
 || dmask->
	`g‘MaskSize
() == 0)

122 
cout
 << "E¼Ü: s–eùedem¶©ty³‚Ù‡vaabË." << 
’dl
;

123  
çl£
;

126 
rg‘Image
 = 
m©ch
 -> 
	`g‘T¬g‘Image
();

127 ià(
rg‘Image
 =ğ
NULL
)

129 
cout
 << "E¼Ü:‚ØimagšfÜm©iÚ." << 
’dl
;

130  
çl£
;

133 ià(
objeù
 =ğ
NULL
) {

134 
cout
 << "E¼Ü:‚Øobjeù infÜm©iÚ iÀBDO±::š™()." << 
’dl
;

135  
çl£
;

138 
	`d–‘eT¬g‘Objeù
();

139 
rg‘Objeù
 = 
objeù
->
	`assign
();

141 ià(
rg‘Objeù
 =ğ
NULL
) {

142 
cout
 << "E¼Ü:‚uÎ objeù(sèš BO±:š™." << 
’dl
;

143  
çl£
;

146 
	`š™ŸlizeBound¬y
(
rg‘Objeù
);

148 
M3DQuadFigu»
 * 
figu»
 = 
dyÇmic_ÿ¡
<M3DQuadFigu»*>(
rg‘Objeù
 -> 
	`g‘Figu»PŒ
(
figu»Id
));

149 ià(
figu»
 =ğ
NULL
) {

150 
cout
 << "E¼Ü:‚uÎ figu» iÀBO±::š™()." << 
’dl
;

151  
çl£
;

154 
dmask
->
	`š™ŸlizeSurçûEls
(
figu»
, 
Ëv–
);

156 
bound¬y
 = 
figu»
 -> 
	`g‘Bound¬yPŒ
();

157 ià(
bound¬y
 =ğ
NULL
)

159 
cout
 << "E¼Ü:‚uÎ bound¬y iÀBdO±::š™." << 
’dl
;

160  
çl£
;

163 
bound¬y
 -> 
	`š™Di¥Ïûm’ts
(
surçûLev–
, 
numPts
);

164 
Di¥Ïûm’ts
 * 
d¥
 = 
bound¬y
 -> 
	`g‘Di¥Ïûm’ts
(
surçûLev–
);

165 ià(
d¥
 =ğ
NULL
)

167 
cout
 << "E¼Ü:‚uÎ di¥Ïûm’ˆšfØš BdO±::š™." << 
’dl
;

168  
çl£
;

171 
dV®s
 = 
d¥
 -> 
	`g‘V®s
();

172 ià(
dV®s
 =ğ
NULL
)

174 
cout
 << "E¼Ü:‚uÎ di¥Ïûm’ˆ¬¿y iÀBdO±::š™." << 
’dl
;

175  
çl£
;

178 
fšished
 = 
çl£
;

180  
Œue
;

181 
	}
}

183 
	gM3DVox–O±imiz”
::
	$š™ŸlizeBound¬y
(
M3DObjeù
 * 
objeù
)

185 ià(
objeù
 =ğ
NULL
) {

186 
¡d
::
cout
 << "NuÎ objeù iÀSubdivBound¬y::š™." << 
’dl
;

190 
M3DFigu»
 * 
figu»
 = 
objeù
 -> 
	`g‘Figu»PŒ
(
figu»Id
);

191 ià(
figu»
 =ğ
NULL
) {

192 
¡d
::
cout
 << "NuÎ figu» iÀBO±::š™Bd." << 
’dl
;

195 
Xã¾i¡
 * 
xãrLi¡
 = 
	`cÚv”tM3DtoXãr
(
figu»
);

197 
	`ş—rWÜkS·û
();

199 
Poši¡_£rv”2
 * 
pLi¡
 = 
Ãw
 Pointlist_server2;

200 
T’eighbÜs
 * 
vn
 = 
NULL
;

202 
pLi¡
 -> 
	`š™
(
xãrLi¡
);

203 
pLi¡
 -> 
	`Compu‹SubdivPoštCloud
(
surçûLev–
);

204 
pLi¡
 -> 
	`cİySubdivBound¬yInfo
(&
numPts
, &
B²t
);

206 
num_n
 = 0;

207 
pLi¡
 -> 
	`subdivv”‹xÃighbÜs
(&
num_n
, &
vn
);

209 ià(
num_n
 =ğ
numPts
 && 
vn
 !ğ
NULL
)

212 
ÃighbÜs
 = 
Ãw
 
NeighbÜLi¡
[
numPts
];

213 
i
, 
j
, 
tmp
;

215 
i
=0; i<
numPts
; i++)

217 
j
=0; j<
MAX_NEIGHBOR_COUNT
; j++)

219 
tmp
 = 
vn
[
i
][
j
];

220 ià(
tmp
 >ğ0 &&mp<
numPts
)

221 
ÃighbÜs
[
i
][
j
] = 
tmp
;

224 if(
tmp
>=
numPts
)

225 
cout
 << "Inv®id v”‹x‚eighbÜ index " << 
tmp
 \

226 << " iÀM3DVox–O±imiz”::š™ŸlizeBound¬y(...)" << 
’dl
;

230 
ÃighbÜs
[
i
].
	`£t_deg»e
(
j
);

231 
ÃighbÜs
[
i
][
j
] =‚eighbors[i][0];

235 
cout
 << "E¼Ü iÀv”‹x‚eighbÜ computiÚ iÀM3DBdO±::š™Bd." << 
’dl
;

237 
d–‘e
[] (
xãrLi¡
 -> 
©omli¡
);

238 
d–‘e
 
xãrLi¡
;

239 
d–‘e
 
pLi¡
;

240 
	}
}

242 
boŞ
 
	gM3DVox–O±imiz”
::
	$³rfÜmI‹¿tiÚs
(
nI‹¿tiÚs
)

244 
i
;

245 
cumChªge
 = 0.0;

247 #ifdeà
DEBUG


248 
cout
 << "M3DVoxelOptimizer::performIterations()\n";

250 ià(
B²t
 =ğ
NULL
 || 
ÃighbÜs
 == NULL)

252 
cout
 << "E¼Ü:‚Øbound¬y infÜm©iÚ iÀBdO±::³rfÜmIts." << 
’dl
;

253  
çl£
;

257 
®pha
 = 
³ÇÉyWeight
;

261 
®pha_Úe
 = 10000.0;

262 
b‘a
 = .001;

264 
cutoff
 = 
dmask
->
	`g‘Cutoff
();

265 
dmaskSize
 = 
dmask
->
	`g‘MaskSize
();

266 
dsize
 = 2 * 
cutoff
 / 
dmaskSize
;

268 *
´ofe
 = 
Ãw
 [
dmaskSize
 + 2];

269 
sum
, 
sum_sq
, 
rms
, 
mu
;

272 
cu¼’tI‹¿tiÚ
 = 0; cu¼’tI‹¿tiÚ < 
nI‹¿tiÚs
; currentIteration++)

274 
d–x
, 
d–y
, 
d–z
, 
dv
, 
v®1
;

275 
j
;

278 *
³rm
 = 
Ãw
 [
numPts
];

279 
šdex
, 
‹mp
;

280 
i
 = 0; i < 
numPts
; i++)

281 
³rm
[
i
] = i;

282 
i
 = 0; i < 
numPts
; i++)

284 
šdex
 = 
i
 + (
	`¿nd
(è% (
numPts
 - i));

285 
‹mp
 = 
³rm
[
i
];

286 
³rm
[
i
] =…”m[
šdex
];

287 
³rm
[
šdex
] = 
‹mp
;

290 
šdex
 = 0; index < 
numPts
; index++)

292 
i
 = 
³rm
[
šdex
];

294 
VeùÜ3D
 
	`Pi
(
B²t
[
i
].
²t
);

295 
VeùÜ3D
 
	`Ni
(
B²t
[
i
].
nÜm
);

296 
r
 = 
B²t
[
i
].
¿d
;

298 
D”ivMaskEËm’t
 * 
d–m
;

299 
¬—
 = 
dmask
 -> 
	`g‘SurçûEËm’t
(
surçûLev–
, 
i
) ->‡rea;

300 
VeùÜ3D
 
coÜd
;

301 
mV®
 = 0.0,

302 
pV®
 = 0.0;

309 
sum
 = 0.0; 
sum_sq
 = 0.0;

310 
j
 = 0; j < 
dmaskSize
; j++)

312 
d–m
 = 
dmask
 -> 
	`g‘MaskEËm’t
(
i
,
j
);

313 
coÜd
 = 
Pi
 + 
Ni
 * (
dV®s
[
i
] + 
d–m
->
di¡
è* 
r
;

314 
rg‘Image
->
	`mod–ToImageCoÜdš©es
(
coÜd
);

316 ià(
wšdowIÁ’s™›s
)

317 
´ofe
[
j
] = 
rg‘Image
->
	`g‘WšdowedIÁ”pŞ©edVox–V®ue
(

318 
coÜd
.
	`g‘X
(), coÜd.
	`g‘Y
(), coÜd.
	`g‘Z
());

320 
´ofe
[
j
] = 
rg‘Image
->
	`g‘IÁ”pŞ©edVox–V®ue
(

321 
coÜd
.
	`g‘X
(), coÜd.
	`g‘Y
(), coÜd.
	`g‘Z
());

323 
sum
 +ğ
´ofe
[
j
];

324 
sum_sq
 +ğ
´ofe
[
j
]*profile[j];

328 
coÜd
 = 
Pi
 + 
Ni
 * (
dV®s
[
i
] - 
cutoff
è* 
r
;

329 
rg‘Image
->
	`mod–ToImageCoÜdš©es
(
coÜd
);

330 ià(
wšdowIÁ’s™›s
)

331 
´ofe
[
dmaskSize
] = 
rg‘Image
->
	`g‘WšdowedIÁ”pŞ©edVox–V®ue
(

332 
coÜd
.
	`g‘X
(), coÜd.
	`g‘Y
(), coÜd.
	`g‘Z
());

334 
´ofe
[
dmaskSize
] = 
rg‘Image
->
	`g‘IÁ”pŞ©edVox–V®ue
(

335 
coÜd
.
	`g‘X
(), coÜd.
	`g‘Y
(), coÜd.
	`g‘Z
());

337 
sum
 +ğ
´ofe
[
dmaskSize
];

338 
sum_sq
 +ğ
´ofe
[
dmaskSize
]*profile[dmaskSize];

340 
coÜd
 = 
Pi
 + 
Ni
 * (
dV®s
[
i
] + 
cutoff
è* 
r
;

341 
rg‘Image
->
	`mod–ToImageCoÜdš©es
(
coÜd
);

342 ià(
wšdowIÁ’s™›s
)

343 
´ofe
[
dmaskSize
+1] = 
rg‘Image
->
	`g‘WšdowedIÁ”pŞ©edVox–V®ue
(

344 
coÜd
.
	`g‘X
(), coÜd.
	`g‘Y
(), coÜd.
	`g‘Z
());

346 
´ofe
[
dmaskSize
+1] = 
rg‘Image
->
	`g‘IÁ”pŞ©edVox–V®ue
(

347 
coÜd
.
	`g‘X
(), coÜd.
	`g‘Y
(), coÜd.
	`g‘Z
());

349 
sum
 +ğ
´ofe
[
dmaskSize
+1];

350 
sum_sq
 +ğ
´ofe
[
dmaskSize
+1]*profile[dmaskSize+1];

352 
rms
 = 
sum_sq
 - (1.0/(
dmaskSize
+2))*
sum
*sum;

353 
rms
 =„ms/(
dmaskSize
+1);

356 if(
rms
 <ğ
R_SMALL_TOLERANCE
)

357 
rms
 = 0.0;

359 
rms
 = 
	`sq¹
(rms);

367 
j
 = 0; j < 
dmaskSize
; j++)

369 
d–m
 = 
dmask
 -> 
	`g‘MaskEËm’t
(
i
,
j
);

371 
v®1
 = 
d–m
->
dTempV®
;

373 
mV®
 +ğ-
v®1
*
´ofe
[
j
];

376 
mV®
 *ğ
dsize
*
¬—
;

378 
v®1
 = 
dmask
->
	`g‘CutoffV®ue
(0,
i
);

379 
mV®
 +ğ-
v®1
 * 
´ofe
[
dmaskSize
] * 
¬—
;

381 
v®1
 = 
dmask
->
	`g‘CutoffV®ue
(1,
i
);

382 
mV®
 +ğ
v®1
 * 
´ofe
[
dmaskSize
+1] * 
¬—
;

383 
mV®
 /ğ
rms
;

388 
mu
 = 
sum
/(
dmaskSize
+2.0);

389 
mu
 = 
rms
/mu;

391 ià(
mu
 < .01)

393 ià(
mu
 > .004)

394 
mV®
 *ğ(1.0 - 
	`exp
(-200000*(
mu
-.004)*(mu-.004)));

396 
mV®
 = 0;

399 
pV®
 +ğ-
dV®s
[
i
] / 
sigma1
 / sigma1;

400 
c
 = 
ÃighbÜs
[
i
].
	`g‘_deg»e
();

401 
j
 = 0; j < 
c
; j += 2)

403 
ij
 = 
ÃighbÜs
[
i
][
j
];

404 
d–x
 = 
B²t
[
i
].
²t
[0] - B²t[
ij
].pnt[0];

405 
d–y
 = 
B²t
[
i
].
²t
[1] - B²t[
ij
].pnt[1];

406 
d–z
 = 
B²t
[
i
].
²t
[2] - B²t[
ij
].pnt[2];

407 
dv
 = 
d–x
*d–x + 
d–y
*d–y + 
d–z
*delz;

409 
pV®
 +ğ-(
dV®s
[
i
]*
r
 - dV®s[
ij
]*
B²t
[ij].
¿d
è/ (
sigma2
*sigma2*
dv
);

411 
pV®
 /ğ
numPts
;

413 
chªge
 = 
b‘a
*((1-
®pha
)*
®pha_Úe
*
mV®
 +‡Íha*
pV®
) ;

417 ià(
rms
 <ğ
R_SMALL_TOLERANCE
)

418 
chªge
 = 
b‘a
*(
®pha
*
pV®
);

420 
dV®s
[
i
] +ğ
chªge
;

422 
cumChªge
 = 
	`max
(cumChªge, 
	`çbs
(
chªge
));

425 
d–‘e
 [] 
³rm
;

429 
Ï¡ObjeùiveFunùiÚV®ue
 = (1 - 
³ÇÉyWeight
è* 
	`compu‹La¡M©chV®ue
() +

430 
³ÇÉyWeight
 * 
	`compu‹La¡P’®tyV®ue
();

432 ià(
cumChªge
 < 
TOLERENCE
)

433 
fšished
 = 
Œue
;

434  
Œue
;

435 
	}
}

437 
	gM3DVox–O±imiz”
::
	$compu‹La¡M©chV®ue
()

439 
i
, 
j
;

440 
imgV®
;

442 ià(
B²t
 =ğ
NULL
)

444 
cout
 << "E¼Ü:‚Øbound¬y infÜm©iÚ iÀBdO±::compM©ch." << 
’dl
;

448 
dmaskSize
 = 
dmask
->
	`g‘MaskSize
();

449 
cutoff
 = 
dmask
->
	`g‘Cutoff
();

450 
Ï¡M©chV®ue
 = 0.0;

452 
mu
 = 0.0, 
tÙv®2Sqr
 = 0.0, 
rms
;

454 
i
 = 0; i < 
numPts
; i++)

456 
D”ivMaskEËm’t
 * 
d–m
;

457 
¬—
 = 
dmask
->
	`g‘SurçûEËm’t
(
surçûLev–
, 
i
)->area;

458 
r
 = 
B²t
[
i
].
¿d
;

459 
vŞ
 = 2 * 
¬—
 * 
r
 * 
cutoff
 / 
dmaskSize
;

460 
VeùÜ3D
 
	`Pi
(
B²t
[
i
].
²t
);

461 
VeùÜ3D
 
	`Ni
(
B²t
[
i
].
nÜm
);

463 
j
 = 0; j < 
dmaskSize
; j++)

465 
d–m
 = 
dmask
 -> 
	`g‘MaskEËm’t
(
i
, 
j
);

466 
VeùÜ3D
 
coÜd
 = 
Pi
 + 
Ni
 * (
dV®s
[
i
] + 
d–m
->
di¡
è* 
r
;

467 
rg‘Image
->
	`mod–ToImageCoÜdš©es
(
coÜd
);

469 ià(
wšdowIÁ’s™›s
)

470 
imgV®
 = 
rg‘Image
->
	`m­Di¥ÏyToR–©ive
(

471 
rg‘Image
->
	`g‘WšdowedIÁ”pŞ©edVox–V®ue
(

472 
coÜd
.
	`g‘X
(), coÜd.
	`g‘Y
(), coÜd.
	`g‘Z
()));

474 
imgV®
 = 
rg‘Image
->
	`m­Di¥ÏyToR–©ive
(

475 
rg‘Image
->
	`g‘IÁ”pŞ©edVox–V®ue
(

476 
coÜd
.
	`g‘X
(), coÜd.
	`g‘Y
(), coÜd.
	`g‘Z
()));

478 
mu
 +ğ
imgV®
 * 
vŞ
;

479 
tÙv®2Sqr
 +ğ
imgV®
 * imgV® * 
vŞ
;

483 
maskVŞume
 = 
dmask
 -> 
	`g‘TÙ®VŞume
();

485 
mu
 /ğ
maskVŞume
;

486 
rms
 = (
tÙv®2Sqr
 / 
maskVŞume
è- (
mu
 * mu);

489 if(
rms
 <ğ
R_SMALL_TOLERANCE
)

490 
rms
 = 0.0;

492 
rms
 = 
	`sq¹
(rms);

494 if(
rms
 <ğ
R_SMALL_TOLERANCE
)

497 
i
 = 0; i < 
numPts
; i++)

499 
D”ivMaskEËm’t
 * 
d–m
;

500 
¬—
 = 
dmask
->
	`g‘SurçûEËm’t
(
surçûLev–
, 
i
)->area;

501 
r
 = 
B²t
[
i
].
¿d
;

502 
vŞ
 = 2 * 
¬—
 * 
r
 * 
cutoff
 / 
dmaskSize
;

503 
VeùÜ3D
 
	`Pi
(
B²t
[
i
].
²t
);

504 
VeùÜ3D
 
	`Ni
(
B²t
[
i
].
nÜm
);

506 
j
 = 0; j < 
dmaskSize
; j++)

508 
d–m
 = 
dmask
 -> 
	`g‘MaskEËm’t
(
i
,
j
);

509 
VeùÜ3D
 
coÜd
 = 
Pi
 + 
Ni
 * (
dV®s
[
i
] + 
d–m
->
di¡
è* 
r
;

510 
rg‘Image
->
	`mod–ToImageCoÜdš©es
(
coÜd
);

512 ià(
wšdowIÁ’s™›s
)

513 
imgV®
 = 
rg‘Image
->
	`m­Di¥ÏyToR–©ive
(

514 
rg‘Image
->
	`g‘WšdowedIÁ”pŞ©edVox–V®ue
(

515 
coÜd
.
	`g‘X
(), coÜd.
	`g‘Y
(), coÜd.
	`g‘Z
()));

517 
imgV®
 = 
rg‘Image
->
	`m­Di¥ÏyToR–©ive
(

518 
rg‘Image
->
	`g‘IÁ”pŞ©edVox–V®ue
(

519 
coÜd
.
	`g‘X
(), coÜd.
	`g‘Y
(), coÜd.
	`g‘Z
()));

521 
Ï¡M©chV®ue
 +ğ-
d–m
->
‹mpV®
 * (
imgV®
-
mu
)/
rms
 * 
vŞ
;

525 
Ï¡M©chV®ue
 /ğ
maskVŞume
;

527  
Ï¡M©chV®ue
;

528 
	}
}

530 
	gM3DVox–O±imiz”
::
	$compu‹La¡P’®tyV®ue
()

532 
i
, 
j
;

533 
d–x
, 
d–y
, 
d–z
, 
dv2
;

535 ià(
B²t
 =ğ
NULL
 || 
ÃighbÜs
 == NULL)

537 
cout
 << "E¼Ü:‚Øbound¬y infÜm©iÚ iÀBdO±::compP’®ty." << 
’dl
;

541 
Ï¡P’®ty
 = 0.0;

543 
i
 = 0; i < 
numPts
; i++)

545 
Ï¡P’®ty
 +ğ
dV®s
[
i
]*dV®s[i] / (2*
sigma1
*sigma1);

547 
j
 = 0; j < 
ÃighbÜs
[
i
].
	`g‘_deg»e
(); j += 2)

549 
ij
 = 
ÃighbÜs
[
i
][
j
];

550 
d–x
 = 
B²t
[
i
].
²t
[0] - B²t[
ij
].pnt[0];

551 
d–y
 = 
B²t
[
i
].
²t
[1] - B²t[
ij
].pnt[1];

552 
d–z
 = 
B²t
[
i
].
²t
[2] - B²t[
ij
].pnt[2];

553 
dv2
 = 
d–x
*d–x + 
d–y
*d–y + 
d–z
*delz;

555 
Ï¡P’®ty
 +ğ(
dV®s
[
i
]*
B²t
[i].
¿d
 - dV®s[
ij
]*Bpnt[ij].rad) *

556 (
dV®s
[
i
]*
B²t
[i].
¿d
 - dV®s[
ij
]*B²t[ij].¿dè/ (2*
sigma2
*sigma2*
dv2
);

559 
¬—
 = 
dmask
->
	`g‘SurçûEËm’t
(
surçûLev–
, 
i
)->area;

560 
Ï¡P’®ty
 *ğ
¬—
;

563  
Ï¡P’®ty
;

564 
	}
}

	@M3DtoPovray.cpp

1 
	~"M3DtoPov¿y.h
"

2 
	#D_DIATOM


	)

3 
	#D_XFERLIST


	)

4 
	#D_POINTLIST_SERVER2


	)

5 
	~"Sh­ed•’d.h
"

7 
usšg
 
Çme¥aû
 
	g¡d
;

9 cÚ¡ * 
	gSTD_SURFACE
 = "pigment{ stdColor }\nfinish{ stdFinish }\nno_shadow";

10 cÚ¡ * 
	gCONNECTOR_SURFACE
 = "pigment{ connectorColor }\nfinish{ stdFinish }\nno_shadow";

11 cÚ¡ * 
	gATOM_VEC_WIDTH
 = "atomVecWidth";

12 cÚ¡ * 
	gATOM_CENTER_WIDTH
 = "atomCenterWidth";

13 cÚ¡ * 
	gCONNECTOR_WIDTH
 = "connectorWidth";

15 
	gM3DtoPov¿y
::
	$M3DtoPov¿y
(
M3DObjeù
 * 
_objeù
)

17 
objeù
 = 
_objeù
;

18 
	}
}

20 
	gM3DtoPov¿y
::
	$ouut
(cÚ¡ * 
f’ame
)

22 
figu»CouÁ
,

23 
figu»Id
;

24 
M3DQuadFigu»
 * 
figu»
;

26 if(
objeù
 =ğ
NULL
)

29 
out
.
	`İ’
(
f’ame
);

31 
	`ouutH—d”
();

33 
figu»CouÁ
 = 
objeù
->
	`g‘Figu»CouÁ
();

34 
figu»Id
 = 0; figu»Id < 
figu»CouÁ
; figureId++)

37 
figu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
 *>(
objeù
->
	`g‘Figu»PŒ
(
figu»Id
));

38 if(
figu»
 =ğ
NULL
)

40 
	`ouutFigu»
(
figu»
);

43 
out
.
	`şo£
();

44 
	}
}

46 
	gM3DtoPov¿y
::
	$ouutH—d”
()

48 
out
 << "#deş¬¡dCŞÜ = cŞÜ„ed .6 g»’ .6 blu.6;" << 
’dl


49 << "#deş¬¡dFšish = fšish{amb›Á 0.4 diffu£ 0.8…hÚg 0.74};" << 
’dl


50 << "#deş¬©omVecWidth = 0.0075;" << 
’dl


51 << "#deş¬©omC’‹rWidth = 0.025;" << 
’dl


52 << "#deş¬cÚÃùÜWidth = 0.005;" << 
’dl


53 << "#deş¬cÚÃùÜCŞÜ = cŞÜ„ed .4 g»’ .4 blu.4;" << 
’dl


54 << "glob®_£‰šg {‡ssumed_gamm¨2.2 }" << 
’dl


55 << "background{ cŞÜ„gb<1,1,1> }" << 
’dl


56 << "ÿm”¨{"<< 
’dl


57 << " o¹hog¿phic" << 
’dl


58 << "„ighˆ-2.66 * x" << 
’dl


59 << " u°2 * y" << 
’dl


60 << "†oÿtiÚ <0.5, 0.5, 1000>" << 
’dl


61 << "†ook_© <0.5, 0.5, 0.5>" << 
’dl


62 << "}" << 
’dl


63 << "light_sourû { <0, 30, 25> cŞÜ„ed 1 g»’ 1 blu1 }" << 
’dl
;

64 
	}
}

66 
	gM3DtoPov¿y
::
	$ouutFigu»
(
M3DQuadFigu»
 * 
figu»
)

68 
M3DPrim™ive
 * 
´im
;

69 
i
, 
j
,

70 
´im™iveCouÁ
;

72 if(
figu»
 =ğ
NULL
)

75 
´im™iveCouÁ
 = 
figu»
->
	`g‘Prim™iveCouÁ
();

76 
i
 = 0; i < 
´im™iveCouÁ
; i++)

78 
out
 << "// S¹ Prim™iv#" << 
i
 << 
’dl
;

79 
	`ouutPrim™ive
(
figu»
->
	`g‘Prim™ivePŒ
(
i
));

80 
out
 << "// End Prim™iv#" << 
i
 << 
’dl
;

83 
numRows
, 
numCŞumns
;

84 
numRows
 = 
figu»
->
	`g‘RowCouÁ
();

85 
numCŞumns
 = 
figu»
->
	`g‘CŞumnCouÁ
();

86 
VeùÜ3D
 
a
, 
b
;

87 
i
 = 0; i < 
numRows
; i++)

89 
j
 = 0; j < 
numCŞumns
 - 1; j++)

91 
´im
 = 
figu»
->
	`g‘Prim™ivePŒ
(
i
, 
j
);

92 
a
 = 
´im
->
	`g‘X
();

93 
´im
 = 
figu»
->
	`g‘Prim™ivePŒ
(
i
, 
j
 + 1);

94 
b
 = 
´im
->
	`g‘X
();

96 
out
 << "// CÚÃùÜ (" << 
i
 << ", " << 
j
 << "è-> (" << i << ", " << j + 1 << ")" << 
’dl
;

97 
	`ouutCylšd”
(
a
, 
b
, 
CONNECTOR_WIDTH
, 
CONNECTOR_SURFACE
);

101 
j
 = 0; j < 
numCŞumns
; j++)

103 
i
 = 0; i < 
numRows
 - 1; i++)

105 
´im
 = 
figu»
->
	`g‘Prim™ivePŒ
(
i
, 
j
);

106 
a
 = 
´im
->
	`g‘X
();

107 
´im
 = 
figu»
->
	`g‘Prim™ivePŒ
(
i
 + 1, 
j
);

108 
b
 = 
´im
->
	`g‘X
();

110 
out
 << "// CÚÃùÜ (" << 
i
 << ", " << 
j
 << "è-> (" << i + 1 << ", " << j << ")" << 
’dl
;

111 
	`ouutCylšd”
(
a
, 
b
, 
CONNECTOR_WIDTH
, 
CONNECTOR_SURFACE
);

115 
	`ouutSurçû
(
figu»
);

116 
	}
}

118 
	gM3DtoPov¿y
::
	$ouutPrim™ive
(
M3DPrim™ive
 * 
´im
)

120 
VeùÜ3D
 
x
;

121 
VeùÜ3D
 
y0
, 
y1
;

122 
VeùÜ3D
 
exB
;

124 
x
 = 
´im
->
	`g‘X
();

125 
exB
 = 
´im
->
	`g‘Ex‹ndedB
();

126 
y0
 = 
´im
->
	`g‘Y0
();

127 
y1
 = 
´im
->
	`g‘Y1
();

129 
	`ouutCylšd”
(
x
, x + 
y0
, 
ATOM_VEC_WIDTH
, 
STD_SURFACE
);

130 
	`ouutCylšd”
(
x
, x + 
y1
, 
ATOM_VEC_WIDTH
, 
STD_SURFACE
);

131 
	`ouutSph”e
(
x
, 
ATOM_CENTER_WIDTH
, 
STD_SURFACE
);

133 if(
´im
->
	`ty³
(è=ğ
M3D_END_PRIMITIVE
)

134 
	`ouutCylšd”
(
x
, x + 
exB
, 
ATOM_VEC_WIDTH
, 
STD_SURFACE
);

135 
	}
}

137 
	gM3DtoPov¿y
::
	$ouutCylšd”
(cÚ¡ 
VeùÜ3D
 & 
a
, cÚ¡ VeùÜ3D & 
b
,

138 cÚ¡ * 
width
, cÚ¡ * 
surçû
)

140 
out
 << "cylšd”{" << 
æush
;

141 
	`ouutVeùÜ
(
a
);

142 
out
 << ", " << 
æush
;

143 
	`ouutVeùÜ
(
b
);

144 
out
 << ", " << 
width
 << 
’dl


145 << 
surçû
 << 
’dl


146 << "}" << 
’dl
;

147 
	}
}

149 
	gM3DtoPov¿y
::
	$ouutSph”e
(cÚ¡ 
VeùÜ3D
 & 
pos
, cÚ¡ * 
width
,

150 cÚ¡ * 
surçû
)

152 
out
 << "¥h”e{" << 
æush
;

153 
	`ouutVeùÜ
(
pos
);

154 
out
 << ", " << 
width
 << 
’dl
 << 
surçû
 <<ƒndl << "}" <<ƒndl;

155 
	}
}

157 
	gM3DtoPov¿y
::
	$ouutSurçû
(
M3DQuadFigu»
 * 
figu»
)

159 
Th®lCode
::
Poši¡_£rv”2
 
pLi¡
;

160 
Bpošt
 * 
te£t
;

161 
numtes
;

162 
i
;

164 
Xã¾i¡
 * 
xãrLi¡
 = 
	`cÚv”tM3DtoXãr
(
figu»
);

165 
pLi¡
.
	`š™
(
xãrLi¡
);

166 
pLi¡
.
	`Compu‹SubdivBound¬yTes
(3);

168 
pLi¡
.
	`subdivtešfo
(&
numtes
, &
te£t
);

170 
out
 << "mesh2 {" << 
’dl
;

173 
out
 << "v”‹x_veùÜ {" << 
’dl
;

174 
out
 << 4*
numtes
 << 
’dl
;

175 
i
 = 0; i < 4*
numtes
; i++)

177 
	`ouutVeùÜ
(
	`VeùÜ3D
(
te£t
[
i
].
²t
));

178 
out
 << "," << 
’dl
;

180 
out
 << "}" << 
’dl
;

183 
out
 << "nÜm®_veùÜ {" << 
’dl
;

184 
out
 << 4*
numtes
 << 
’dl
;

185 
i
 = 0; i < 4*
numtes
; i++)

187 
	`ouutVeùÜ
(
	`VeùÜ3D
(
te£t
[
i
].
nÜm
));

188 
out
 << "," << 
’dl
;

190 
out
 << "}" << 
’dl
;

193 
out
 << "çû_šdiû {" << 
’dl
;

194 
out
 << 2*
numtes
 << 
’dl
;

195 
i
 = 0; i < 4*
numtes
; i+=4)

197 
	`ouutVeùÜ
(
	`VeùÜ3D
(
i
+3, i, i+1));

198 
out
 << "," << 
’dl
;

199 
	`ouutVeùÜ
(
	`VeùÜ3D
(
i
+3, i+1, i+2));

200 
out
 << "," << 
’dl
;

202 
out
 << "}" << 
’dl
;

205 
out
 << "nÜm®_šdiû {" << 
’dl
;

206 
out
 << 2*
numtes
 << 
’dl
;

207 
i
 = 0; i < 4*
numtes
; i+=4)

209 
	`ouutVeùÜ
(
	`VeùÜ3D
(
i
+3, i, i+1));

210 
out
 << "," << 
’dl
;

211 
	`ouutVeùÜ
(
	`VeùÜ3D
(
i
+3, i+1, i+2));

212 
out
 << "," << 
’dl
;

214 
out
 << "}" << 
’dl
;

216 
out
 << "‹xtu» {" << 
’dl


217 << "…igm’ˆ{ cŞÜ„gbà<1,1,1,0.7> }" << 
’dl


218 << " fšish {…hÚg 0.4…hÚg_siz20 }" << 
’dl


219 << "}" << 
’dl


220 << "no_shadow" << 
’dl


221 << "}" << 
’dl
;

222 
	}
}

224 
	gM3DtoPov¿y
::
	$ouutVeùÜ
(cÚ¡ 
VeùÜ3D
 & 
v
)

226 
out
 << "<" << 
v
.
	`g‘X
(è<< ", " << v.
	`g‘Y
(è<< ", " << v.
	`g‘Z
() << ">"

227 << 
æush
;

228 
	}
}

	@MakeOptimizationVideo.cpp

1 
	~<io¡»am
>

2 
usšg
 
Çme¥aû
 
	g¡d
 ;

4 
	~<f¡»am
>

5 
	~<¡ršg
>

6 
	~<s¡»am
>

8 
	~"MakeO±imiz©iÚVideo.h
"

9 
	~"M3DObjeùFe.h
"

24 
Çme¥aû
 
	gMakeO±imiz©iÚVideo
 {

26 
boŞ
 
	gmakeVideoOn
 = 0 ;

28 * 
	gvideoFŞd”
 = 
NULL
 ;

30 
	gäameCouÁ
 = 0 ;

36 
wr™eCu¼’tMod–
Ğ
M3DObjeù
* cÚ¡ 
cu¼Objeù
 ) {

38 ifĞ! 
	gmakeVideoOn
 || ! 
	gvideoFŞd”
 ) {

39 
	gcout
 << "VideØİtiÚ‚Ù s³cif›d iÀ-videoFŞd” o¸-vàš PablØšput" << 
	g’dl
 ;

43 ifĞ
	gcu¼Objeù
 =ğ
NULL
 ) {

44 
cout
 << "NULL mod–…as£dØwr™eCu¼’tMod–()" << 
’dl
 ;

48 
	gäameCouÁ
 ++ ;

50 
	gouutFeName
[100] ;

54 ifĞ
	gvideoFŞd”
[
¡¾’
(
videoFŞd”
)-1] == '/' || videoFolder[strlen(videoFolder)-1] == '\\' )

55 
¥rštf
Ğ
ouutFeName
, "%s%d%s", 
videoFŞd”
, 
äameCouÁ
, ".m3d" ) ;

57 
¥rštf
Ğ
ouutFeName
, "%s%s%d%s", 
videoFŞd”
, "/", 
äameCouÁ
, ".m3d" ) ;

59 
M3DObjeùFe
 
	gmFe
 ;

61 
	#_DIBYENDU_CHECK_DILATION


	)

63 #ifdeà
_DIBYENDU_CHECK_DILATION


68 ifĞ
	gcu¼Objeù
->
isObjeùD©ed
() ) {

70 
M3DObjeù
 * 
	gobjToWr™e
 = 
cu¼Objeù
->
assign
() ;

72 
	gobjToWr™e
->
”ode
Ğ
cu¼Objeù
->
g‘D©iÚFaùÜInMod–Un™s
() ) ;

74 
	gmFe
.
wr™e
Ğ
ouutFeName
, *
objToWr™e
, 0, 0, -1, 0, 0, 0 ) ;

76 ifĞ
	gobjToWr™e
 ) {

77 
d–‘e
 
	gobjToWr™e
 ;

78 
	gobjToWr™e
 = 
NULL
 ;

82 
	gmFe
.
wr™e
Ğ
ouutFeName
, *
cu¼Objeù
, 0, 0, -1, 0, 0, 0 ) ;

86 
	gmFe
.
wr™e
Ğ
ouutFeName
, *
cu¼Objeù
, 0, 0, -1, 0, 0, 0 ) ;

	@OctTreeTauBand.cpp

17 
	~"OùT»eTauBªd.h
"

18 
	~<io¡»am
>

23 
	gOùT»eTauBªd
::
	$OùT»eTauBªd
(cÚ¡ 
VeùÜ3D
& 
pošt
) {

26 
±
.
	`£t
(
pošt
);

31 
Åt
.
	`£t
(0.0, 0.0, 0.0);

34 
mšX
 = 
maxX
 = 
pošt
.
	`g‘X
();

35 
mšY
 = 
maxY
 = 
pošt
.
	`g‘Y
();

36 
mšZ
 = 
maxZ
 = 
pošt
.
	`g‘Z
();

39 
chd
 = 0; child < 8; child++) {

40 
chd»n
[
chd
] = 0;

43 
size
 = 1;

45 
xLim™
 = 
yLim™
 = 
çl£
;

46 
zLim™
 = 
Œue
;

48 
	}
}

53 
	gOùT»eTauBªd
::~
	$OùT»eTauBªd
() {

54 
chd
 = 0; child < 8; child++) {

55 ià(
chd»n
[
chd
]) {

56 
d–‘e
 
chd»n
[
chd
];

57 
chd»n
[
chd
] = 0;

60 
	}
}

66 
OùT»eTauBªd
* 
	gOùT»eTauBªd
::
	$š£¹
 (cÚ¡ 
VeùÜ3D
& 
pošt
) {

67 
whichNeighbÜ
 = 0;

68 
x
 = 
pošt
.
	`g‘X
();

69 
y
 = 
pošt
.
	`g‘Y
();

70 
z
 = 
pošt
.
	`g‘Z
();

74 ià(
x
 < 
±
.
	`g‘X
()) {

75 ià(
x
 < 
mšX
) {

76 
mšX
 = 
x
;

78 
whichNeighbÜ
 |ğ
Leá
;

81 ià(
x
 > 
maxX
) {

82 
maxX
 = 
x
;

86 ià(
y
 < 
±
.
	`g‘Y
()) {

87 ià(
y
 < 
mšY
) {

88 
mšY
 = 
y
;

90 
whichNeighbÜ
 |ğ
Po¡
;

93 ià(
y
 > 
maxY
) {

94 
maxY
 = 
y
;

98 ià(
z
 < 
±
.
	`g‘Z
()) {

99 ià(
z
 < 
mšZ
) {

100 
mšZ
 = 
z
;

102 
whichNeighbÜ
 |ğ
Sup
;

105 ià(
z
 > 
maxZ
) {

106 
maxZ
 = 
z
;

110 
size
++;

115 ià(
chd»n
[
whichNeighbÜ
]) {

116  
chd»n
[
whichNeighbÜ
]->
	`š£¹
(
pošt
);

119 
chd»n
[
whichNeighbÜ
] = 
Ãw
 
	`OùT»eTauBªd
(
pošt
);

120  
chd»n
[
whichNeighbÜ
];

124 
	}
}

133 
	gOùT»eTauBªd
::
	$nÜm®ize
() {

134 
VeùÜ3D
 
	`mšEx‹Á
(
mšX
, 
mšY
, 
mšZ
);

135 
VeùÜ3D
 
	`Ëngths
(
maxX
 - 
mšX
, 
maxY
 - 
mšY
, 
maxZ
 - 
mšZ
);

136 
	`nÜm®ize
(
mšEx‹Á
, 
Ëngths
);

137 
	}
}

139 
	gOùT»eTauBªd
::
	$nÜm®ize
(cÚ¡ 
VeùÜ3D
& 
mšEx‹Á
, cÚ¡ VeùÜ3D& 
Ëngths
) {

140 
Åt
.
	`£t
(
±
);

141 
Åt
 -ğ
mšEx‹Á
;

142 
Åt
.
	`£tX
Ò±.
	`g‘X
(è/ 
Ëngths
.getX());

143 
Åt
.
	`£tY
Ò±.
	`g‘Y
(è/ 
Ëngths
.getY());

144 
Åt
.
	`£tZ
Ò±.
	`g‘Z
(è/ 
Ëngths
.getZ());

146 
chd
 = 0; child < 8; child++) {

147 ià(
chd»n
[
chd
]) {

148 
chd»n
[
chd
]->
	`nÜm®ize
(
mšEx‹Á
, 
Ëngths
);

151 
	}
}

164 
	gOùT»eTauBªd
::
	$g‘Di¡ªûSqr
(cÚ¡ 
VeùÜ3D
& 
pošt
,

165 cÚ¡ 
VeùÜ3D
& 
nÜm®izedPošt
, 
u
) {

167 
di¡ªû
 = 1000;

168 
	`g‘Di¡ªûSqr
(
pošt
, 
nÜm®izedPošt
, 
u
, 
di¡ªû
);

169  
di¡ªû
;

170 
	}
}

179 
	gOùT»eTauBªd
::
	$g‘Di¡ªûSqr
(cÚ¡ 
OùT»eTauBªd
* 
Ùh”
, 
u
) {

180 ià(
Ùh”
) {

181 
di¡Sqr
 = 
	`g‘Di¡ªûSqr
(
Ùh”
->
±
, oth”->
Åt
, 
u
);

182 
chd
 = 0; child < 8; child++) {

183 ià(
Ùh”
->
chd»n
[
chd
]) {

184 
di¡Sqr
 +ğ
	`g‘Di¡ªûSqr
(
Ùh”
->
chd»n
[
chd
], 
u
);

187  
di¡Sqr
;

193 
	}
}

202 
	gOùT»eTauBªd
::
	$g‘AvgDi¡ªûSqr
(cÚ¡ 
OùT»eTauBªd
* 
Ùh”
, 
u
) {

203 ià(
Ùh”
) {

204 
sum
 = 
	`g‘Di¡ªûSqr
(
Ùh”
, 
u
);

205  
sum
 / 
Ùh”
->
size
;

210 
	}
}

218 
	gOùT»eTauBªd
::
	$g‘Di¡ªûSqr
(cÚ¡ 
VeùÜ3D
& 
pošt
,

219 cÚ¡ 
VeùÜ3D
& 
nÜm®izedPošt
, 
u
,

220 & 
di¡ªû
) {

222 
boŞ
 
possib™›s
[8];

223 
i
=0; i<8; i++) {

224 
possib™›s
[
i
] = 
Œue
;

227 
VeùÜ3D
 
ndiff
 = 
nÜm®izedPošt
 - 
Åt
;

228 
ndx
 = 
ndiff
.
	`g‘X
();

229 
ndy
 = 
ndiff
.
	`g‘Y
();

230 
ndz
 = 
ndiff
.
	`g‘Z
();

240 
uSqr
 = 
u
*tau;

242 
di¡
 = 
±
.
	`di¡Squ¬e
(
pošt
);

249 (
xLim™
 && ((
ndx
 *‚dxè> 
uSqr
)) ||

250 (
yLim™
 && ((
ndy
 *‚dyè> 
uSqr
)) ||

251 (
zLim™
 && ((
ndz
 *‚dzè> 
uSqr
))

255 
di¡
 = 1000;

259 ià(
di¡
 < 
di¡ªû
) {

260 
di¡ªû
 = 
di¡
;

265 ià(
xLim™
) {

266 ià(
ndx
 > 
u
) {

268 
possib™›s
[
LeáAÁInf
] = 
çl£
;

269 
possib™›s
[
LeáAÁSup
] = 
çl£
;

270 
possib™›s
[
LeáPo¡Inf
] = 
çl£
;

271 
possib™›s
[
LeáPo¡Sup
] = 
çl£
;

273 ià(
ndx
 < -
u
) {

275 
possib™›s
[
RightAÁInf
] = 
çl£
;

276 
possib™›s
[
RightAÁSup
] = 
çl£
;

277 
possib™›s
[
RightPo¡Inf
] = 
çl£
;

278 
possib™›s
[
RightPo¡Sup
] = 
çl£
;

283 ià(
yLim™
) {

284 ià(
ndy
 > 
u
) {

285 
possib™›s
[
LeáPo¡Inf
] = 
çl£
;

286 
possib™›s
[
LeáPo¡Sup
] = 
çl£
;

287 
possib™›s
[
RightPo¡Inf
] = 
çl£
;

288 
possib™›s
[
RightPo¡Sup
] = 
çl£
;

290 ià(
ndy
 < -
u
) {

291 
possib™›s
[
LeáAÁInf
] = 
çl£
;

292 
possib™›s
[
LeáAÁSup
] = 
çl£
;

293 
possib™›s
[
RightAÁInf
] = 
çl£
;

294 
possib™›s
[
RightAÁSup
] = 
çl£
;

299 ià(
zLim™
) {

300 ià(
ndz
 > 
u
) {

301 
possib™›s
[
LeáAÁSup
] = 
çl£
;

302 
possib™›s
[
LeáAÁSup
] = 
çl£
;

303 
possib™›s
[
RightAÁSup
] = 
çl£
;

304 
possib™›s
[
RightAÁSup
] = 
çl£
;

306 ià(
ndz
 < -
u
) {

307 
possib™›s
[
LeáAÁInf
] = 
çl£
;

308 
possib™›s
[
LeáAÁInf
] = 
çl£
;

309 
possib™›s
[
RightAÁInf
] = 
çl£
;

310 
possib™›s
[
RightAÁInf
] = 
çl£
;

314 
chd
 = 0; child <8; child++) {

315 ià(
possib™›s
[
chd
] && 
chd»n
[child]) {

316 
chd»n
[
chd
]->
	`g‘Di¡ªûSqr
(
pošt
, 
nÜm®izedPošt
, 
u
, 
di¡ªû
);

319 
	}
}

	@OptimizerBase.cpp

1 
	~"O±imiz”Ba£.h
"

2 
	~"LogMªag”.h
"

3 
	~"Tunšg.h
"

5 #iâdeà
BINARY


9 cÚ¡ 
	gMAX_OPTIMIZER_ITERATIONS
 = 1 << 16;

13 
	gO±imiz”Ba£
::
	$O±imiz”Ba£
()

15 
Ï¡Be¡Objeù
 = 
NULL
;

16 
Ï¡P’®ty
 = 0.0;

17 
Ï¡Be¡V®
 = 0.0;

18 
Ï¡Be¡X
 = 
NULL
;

19 
Ï¡Be¡XSize
 = 0;

20 
m‘hod
 = 
NULL
;

21 
sk³d
 = 
çl£
;

22 
	}
}

24 
	gO±imiz”Ba£
::~
	$O±imiz”Ba£
()

26 
i
;

28 ià(
Ï¡Be¡Objeù
 !ğ
NULL
)

29 
d–‘e
 
Ï¡Be¡Objeù
;

31 ià(
m‘hod
 !ğ
NULL
)

32 
d–‘e
 
m‘hod
;

34 ià(
Ï¡Be¡X
 !ğ
NULL
)

36 
i
 = 0; i < 
Ï¡Be¡XSize
; i++)

38 ià(
Ï¡Be¡X
[
i
] !ğ
NULL
)

39 
d–‘e
 
Ï¡Be¡X
[
i
];

41 
d–‘e
 [] 
Ï¡Be¡X
;

43 
	}
}

45 
boŞ
 
	gO±imiz”Ba£
::
	$isFšished
()

47 ià(! 
m‘hod
)

48  
çl£
;

49 ià(
sk³d
)

50  
Œue
;

51 ià(
m‘hod
->
	`m‘hodTy³
(è=ğ
M‘hod
::
CÚjug©eG¿d›Á
)

52  ((
CÚjug©eG¿d›ÁM‘hod
 *è
m‘hod
)->
	`isFšished
();

54  
Œue
;

55 
	}
}

57 
VeùÜ
* 
	gO±imiz”Ba£
::
	$´ojeùMod–
(
M3DObjeù
* 
mod–
) {

58 #ifdeà
OPTIMIZATION_VISUALIZER


59 ià(
mod–
) {

61 
GeodesicDi¡ªûProbËm
 
	`´ob
(
this
, 
mod–
);

62 
Num”iÿlFunùiÚ
 
	`w¿µ”
(
´ob
, 1e-5);

63 ià(
Ï¡Be¡X
 &&†astBestX[0]) {

64 
ÿt
 = 
glob®LogMªag”
.
	`g‘Cu¼’tC©egÜy
();

65 
CÚjug©eG¿d›ÁM‘hod
 
	`İt
(
w¿µ”
, 0 * (*
Ï¡Be¡X
[0]));

66 
İt
.
	`£tB»ÁLš—rS—rchBoundFaùÜ
Ğ
	`tunšgWt
(
B»ÁLš—rS—rchBoundFaùÜ
) );

67 !
İt
.
	`isFšished
() ) {

68 
İt
.
	`³rfÜmI‹¿tiÚ
();

70 
glob®LogMªag”
.
	`£tC©egÜy
(
ÿt
);

71  
Ãw
 
	`VeùÜ
(
İt
.
	`g‘Be¡Ev”X
());

76 
	}
}

78 
	gGeodesicDi¡ªûProbËm
::
	$ev®u©e
(cÚ¡ 
VeùÜ
& 
x
) {

79 ià(
İt
 && 
»f
) {

80 
M3DObjeù
* 
rg‘
 = 
İt
->
	`ü—‹T¬g‘Objeù
(
x
);

81 ià(
rg‘
) {

82 
di¡ªû
 = 0;

83 #ifdeà
BINARY


84 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

85 
M3DFigu»
* 
rg‘Fig
 = 
rg‘
->
	`g‘Figu»PŒ
(
figu»Id
);

86 
M3DFigu»
* 
»fFig
 = 
»f
->
	`g‘Figu»PŒ
(
figu»Id
);

87 ià(
rg‘Fig
 && 
»fFig
) {

88 
di¡ªû
 = 
»fFig
->
	`di¡2FromFigu»
(
rg‘Fig
);

93 
figu»Id
 = 0;

94 
M3DFigu»
* 
rg‘Fig
 = 
rg‘
->
	`g‘Figu»PŒ
(
figu»Id
);

95 
M3DFigu»
* 
»fFig
 = 
»f
->
	`g‘Figu»PŒ
(
figu»Id
);

96 
©omDi¡
 = 0;

97 ià(
rg‘Fig
 && 
»fFig
) {

98 
a
 = 
rg‘Fig
->
	`g‘Prim™iveCouÁ
();

99 
b
 = 
»fFig
->
	`g‘Prim™iveCouÁ
();

100 
numPrims
 = 
a
 < 
b
 ?‡ : b;

101 
i
 = 0; i<
numPrims
; i++) {

103 
rg‘Fig
->
	`g‘Prim™ivePŒ
(
i
)->
	`©omDi¡ªû
(
»fFig
->getPrimitivePtr(i));

104 
di¡ªû
 +ğ(
©omDi¡
 *‡tomDist);

109 
d–‘e
 
rg‘
;

110  
di¡ªû
;

114 
	}
}

	@P3DControl.cpp

9 
	~<iomª
>

11 
	~<¡dio.h
>

12 
	~<m©h.h
>

13 
	~<sys/ty³s.h
>

14 
	~<sys/¡©.h
>

15 #ifdeà
_WIN32


16 
	~<dœeù.h
>r

18 
	~<lim™s.h
>

19 
	~<uni¡d.h
>

20 
	~<”ºo.h
>

22 
	~<io¡»am
>

23 
	~<™”©Ü
>

24 
	~<¡ršg.h
>

26 
	~<s¡»am
>

28 
	~<ty³šfo
>

29 
	~<memÜy
>

31 
	~"glob®BudP¬ms.h
"

32 #ifdeà
BINARY


33 
	~<f¡»am
>

35 
	~"CÚŒŞP¬ms.h
"

36 
	~"Sim¬™yT¿nsfÜm3D.h
"

37 
	~"M3DObjeù.h
"

38 
	~"M3DObjeùFe.h
"

39 
	~"WÜldSy¡em.h
"

40 
	~"ImageRe§m¶e3D.h
"

41 
	~"GaussŸnBlur3D.h
"

42 
	~"DQFImage.h
"

43 
	~"RAWImageFe.h
"

44 
	~"AÎImageIO.h
"

45 
	~"Lªdm¬kDefÜm©iÚ.h
"

46 
	~"SurçûP©chEn£mbË.h
"

47 
	~"DQFM©ch.h
"

48 
	~"ObjeùR–©iveSam¶šg.h
"

49 
	~"M3DQuadIÁ”pŞ©Ü.h
"

50 
	~"M3DSubfigu»T¿nsfÜm©iÚ.h
"

51 
	~"M3DFigu»T»eNode.h
"

52 
	~"Di¡ªûM­3D.h
"

53 
	~"ut™y.h
"

54 
	~"BYU.h
"

55 #ifdeà
BINARY


56 
	~"Di¡ªûVeùÜLi¡.h
"

58 
	~"M3DAtomP»diùÜ.h
"

59 
	~"Geodesic.h
"

60 
	~"O±imiz”Ba£.h
"

61 
	~"M3DAd­tiveRegi¡¿tiÚPGAO±imiz”.h
"

62 #iâdeà
BINARY


63 
	~"M3DMašFigResiduePGAO±imiz”.h
"

64 
	~"M3DPGASts.h
"

66 
	~"M3DPGAPrim™iveSts.h
"

67 
	~"ut™y.h
"

69 #ifdeà
PCA_VISUALIZER


70 
	~"PCA.h
"

72 
	~"P3DCÚŒŞ.h
"

73 #ifdeà
OPTIMIZATION_VISUALIZER


74 
	~"LogMªag”.h
"

76 
	~"F™UÆab–edPošts.h
"

77 
	~"Tunšg.h
"

81 
	~"MakeO±imiz©iÚVideo.h
"

88 #iâdeà
S_ISREG


89 
	#S_ISREG
(
m
è(((
S_IFREG
 & mè!ğ0è? 
Œue
 : 
çl£
)

	)

92 
usšg
 
Çme¥aû
 
	g¡d
;

95 
M3DObjeù
 * 
»adOldObjeùFe
(cÚ¡ * 
f’ame
);

97 cÚ¡ 
imageLªdm¬k_t
 
	gem±yImageLªdm¬k
 = { 0.0, 0.0, 0.0, -1, -1, 
NULL
 };

99 cÚ¡ 
	gm­pšgMsg
[] =

103 #ifdeà
BINARY


104 
şass
 
bpTunšg
 
	gtuÃV®s
;

106 
şass
 
gpTunšg
 
	gtuÃV®s
;

109 
boŞ
 
	gP3DCÚŒŞ
::
	$v”ifyAµliÿtiÚ
(
­¶iÿtiÚ_t
 
id
) const

111 
boŞ
 
­pDefšed
 = 
çl£
;

113 #iâdeà
BINARY


114 #ifdeà
AE2_BUILD


115 
­pDefšed
 = 
Œue
;

116 ià(
id
 =ğ
AE2
)

117  
Œue
;

129 #ifdeà
BINARY


130 #ifdeà
AE2_BUILD


131 
­pDefšed
 = 
Œue
;

132 ià(
id
 =ğ
AE2Bš¬y
)

133  
Œue
;

138 ià(! 
­pDefšed
) {

139 ià(
id
 =ğ
Pablo
)

140  
Œue
;

142  
çl£
;

143 
	}
}

145 
boŞ
 
	gP3DCÚŒŞ
::
	$v”ifyOr›Á©iÚ
() const

147 #ifdeà
UNFLIPPED


148  
Œue
;

150  
çl£
;

152 
	}
}

154 
	gP3DCÚŒŞ
::
	$P3DCÚŒŞ
(
undoL’gth
è: 
	$undoLi¡
(
undoL’gth
)

156 #ifdeà
DEBUG


157 
cout
 << "P3DCÚŒŞ::P3DCÚŒŞ(èhi ğ0x" << 
hex
 << 
this
 << 
dec
 << '\n';

159 
objeù
 = 
NULL
;

160 #ifdeà
AE2_BUILD


161 
ªaLi¡
 = 
NULL
;

163 
objeùSimT¿nsfÜm
 = 
NULL
;

164 
»cÜdedT¿nsfÜm©iÚ
 = 
NULL
;

165 #iâdeà
BINARY


166 
hªdPÏûm’tT¿nsfÜm
 = 
Ãw
 
Sim¬™yT¿nsfÜm3D
;

169 
imagePÏÃs
.
	`£tSmoÙhšg
(
glob®CÚŒŞ
->
	`»adBoŞ
(
SmoÙhImages
));

170 
AÎImageIO
::
	`£tImageSÿlšg
(
glob®CÚŒŞ
->
	`»adBoŞ
(
SÿËImages
));

171 
imagePÏÃsChªged
 = 
Œue
;

173 
£ËùiÚChªged
 = 
çl£
;

174 
wÜldWasAµl›d
 = 
çl£
;

176 
teS‘
 = 
NULL
;

177 
teS‘Mobe
 = 
çl£
;

178 
f
=0; f < 6; f++)

179 
teS‘MobeFigu»
[
f
] = 
Œue
;

180 
auxTeS‘
 = 
NULL
;

182 
objeùCİyBufãr
 = 
NULL
;

184 
	`£tEd™šgMode
(
ANY_EDITING_MODE
);

185 
	`®lowS–eùiÚ
(
Œue
);

187 
šO³¿tiÚ
 = 
çl£
;

188 
	`mod–IsSaved
();

190 
mod–FeName
 = 
NULL
;

191 
pgaMod–FeName
 = 
NULL
;

193 #ifdeà
BINARY


195 
di¡_m­
 = 
NULL
;

197 
imageFeName
 = 
NULL
;

199 
m¬kedPrim™iveId
 = 
INVALID_PRIMITIVE_ID
;

201 
š‹½Ş©edPrim™ive
 = 
NULL
;

203 
m©ch
 = 
NULL
;

205 
d¿wšg_·¹Ÿl_surçû
 = 
çl£
;

206 
d¿wšg_fuÎ_surçû
 = 
çl£
;

208 #iâdeà
BINARY


209 
İtimizeW™hWšdowšg
 = 
Œue
;

211 
İtimizeW™hWšdowšg
 = 
çl£
;

213 
»gi¡¿tiÚO±imiz”
 = 
NULL
;

214 
mašFigu»O±imiz”
 = 
NULL
;

215 
subfigu»O±imiz”
 = 
NULL
;

216 
defÜm©iÚO±imiz”
 = 
NULL
;

218 
sR•O±imiz”
 = 
NULL
;

219 
¥okeO±imiz”
 = 
NULL
;

220 
vox–SgeO±imiz”
 = 
NULL
;

222 #iâdeà
BINARY


223 
³ÇÉyWeights
 = 
NULL
;

224 
³ÇÉyNames
 = 
NULL
;

225 
numP’®tyWeights
 = 0;

228 
»ã»nûObjeù
 = 
NULL
;

229 
»cÜdšgT¿nsfÜm©iÚ
 = 
çl£
;

231 
–Úg©”
 = 
NULL
;

233 
cu¼’tO±imiz”Sge
 = 
NO_OPTIMIZER_STAGE
;

235 
numImageLªdm¬ks
 = 0;

237 
Œ“Figu»s
 = 
NULL
;

238 
¦ideShowSavedObjeù
 = 
NULL
;

239 
¦ideShowSavedEd™šgMode
 = 
ANY_EDITING_MODE
;

240 
šSlideShow
 = 
çl£
;

242 #ifdeà
LM_METHOD_OBJ


243 
Ïndm¬kObjeù
 = 
NULL
;

246 #iâdeà
BINARY


247 
¥e
 = 
NULL
;

248 
dqf
 = 
NULL
;

249 
mp
 = 
NULL
;

252 
m©chReã»nûObjeù
 = 
NULL
;

254 
»gi¡¿tiÚP’®tyWeight
 = 0.5;

255 
pgaSts
 = 
NULL
;

256 
©omPgaSts
 = 
NULL
;

257 
©chedSts
 = 
çl£
;

258 
»siduePGASge
 = 0;

261 
ınsSts
 = 
NULL
 ;

263 #ifdeà
PCA_VISUALIZER


264 
pÿ
 = 
NULL
;

267 
upd©eGui
 = 
NULL
;

268 
upd©eGuiSge
 = 
NULL
;

271 
şs
[0].
mask
 = 0;

272 
şs
[0].
equ©iÚ
[0] = 1.0;

273 
şs
[0].
equ©iÚ
[1] = 0.0;

274 
şs
[0].
equ©iÚ
[2] = 0.0;

275 
şs
[0].
equ©iÚ
[3] = 0.5;

277 
şs
[1].
mask
 = 0;

278 
şs
[1].
equ©iÚ
[0] = -1.0;

279 
şs
[1].
equ©iÚ
[1] = 0.0;

280 
şs
[1].
equ©iÚ
[2] = 0.0;

281 
şs
[1].
equ©iÚ
[3] = 0.5;

283 
şs
[2].
mask
 = 0;

284 
şs
[2].
equ©iÚ
[0] = 0.0;

285 
şs
[2].
equ©iÚ
[1] = 1.0;

286 
şs
[2].
equ©iÚ
[2] = 0.0;

287 
şs
[2].
equ©iÚ
[3] = 0.5;

289 
şs
[3].
mask
 = 0;

290 
şs
[3].
equ©iÚ
[0] = 0.0;

291 
şs
[3].
equ©iÚ
[1] = -1.0;

292 
şs
[3].
equ©iÚ
[2] = 0.0;

293 
şs
[3].
equ©iÚ
[3] = 0.5;

295 
şs
[4].
mask
 = 0;

296 
şs
[4].
equ©iÚ
[0] = 0.0;

297 
şs
[4].
equ©iÚ
[1] = 0.0;

298 
şs
[4].
equ©iÚ
[2] = 1.0;

299 
şs
[4].
equ©iÚ
[3] = 0.5;

301 
şs
[5].
mask
 = 0;

302 
şs
[5].
equ©iÚ
[0] = 0.0;

303 
şs
[5].
equ©iÚ
[1] = 0.0;

304 
şs
[5].
equ©iÚ
[2] = -1.0;

305 
şs
[5].
equ©iÚ
[3] = 0.5;

306 
	}
}

308 
	gP3DCÚŒŞ
::~
	$P3DCÚŒŞ
()

311 #ifdeà
DEBUG


312 
cout
 << "P3DCÚŒŞ::~P3DCÚŒŞ(èhi ğ0x" << 
hex
 << 
this
 << 
dec
 << '\n';

314 ià(
šSlideShow
)

315 
	`qu™Mod–SlideShow
();

317 
d–‘e
 
objeù
;

318 
d–‘e
 
objeùSimT¿nsfÜm
;

319 
d–‘e
 
»cÜdedT¿nsfÜm©iÚ
;

320 #ifdeà
AE2_BUILD


321 ià(
ªaLi¡
 !ğ
NULL
)

322 
d–‘e
 
ªaLi¡
;

325 #iâdeà
BINARY


326 
d–‘e
 
hªdPÏûm’tT¿nsfÜm
;

329 
d–‘e
 
teS‘
;

331 #iâdeà
BINARY


332 ià(
auxTeS‘
 !ğ
NULL
) {

333 
BYU
 * 
auxBYU
;

334 
auxBYU
 = (
BYU
 *è
auxTeS‘
;

335 
d–‘e
 
auxBYU
;

338 ià(
di¡_m­
)

340 
d–‘e
 
di¡_m­
;

341 
di¡_m­
 = 
NULL
;

345 ià(
objeùCİyBufãr
 !ğ
NULL
)

346 
d–‘e
 
objeùCİyBufãr
;

348 ià(
mod–FeName
 !ğ
NULL
)

349 
d–‘e
 [] 
mod–FeName
;

351 ià(
pgaMod–FeName
 !ğ
NULL
)

352 
d–‘e
 [] 
pgaMod–FeName
;

357 ià(
š‹½Ş©edPrim™ive
 !ğ
NULL
)

358 
d–‘e
 
š‹½Ş©edPrim™ive
;

360 ià(
m©ch
 !ğ
NULL
)

361 
d–‘e
 
m©ch
;

363 ià(
»gi¡¿tiÚO±imiz”
 !ğ
NULL
)

364 
d–‘e
 
»gi¡¿tiÚO±imiz”
;

366 ià(
mašFigu»O±imiz”
 !ğ
NULL
)

367 
d–‘e
 
mašFigu»O±imiz”
;

369 ià(
subfigu»O±imiz”
 !ğ
NULL
)

370 
d–‘e
 
subfigu»O±imiz”
;

372 ià(
defÜm©iÚO±imiz”
 !ğ
NULL
)

373 
d–‘e
 
defÜm©iÚO±imiz”
;

375 ià(
sR•O±imiz”
 !ğ
NULL
)

376 
d–‘e
 
sR•O±imiz”
;

378 ià(
¥okeO±imiz”
 !ğ
NULL
)

379 
d–‘e
 
¥okeO±imiz”
;

381 ià(
vox–SgeO±imiz”
 !ğ
NULL
)

382 
d–‘e
 
vox–SgeO±imiz”
;

384 #iâdeà
BINARY


385 ià(
³ÇÉyWeights
 !ğ
NULL
) {

386 
d–‘e
 [] 
³ÇÉyWeights
;

387 
d–‘e
 [] 
³ÇÉyNames
;

390 ià(
¥e
 !ğ
NULL
)

391 
d–‘e
 
¥e
;

393 ià(
di¡_m­
)

395 
d–‘e
 
di¡_m­
;

396 
di¡_m­
 = 
NULL
;

400 ià(
»ã»nûObjeù
 !ğ
NULL
)

401 
d–‘e
 
»ã»nûObjeù
;

403 
d–‘e
 
–Úg©”
;

405 ià(
Œ“Figu»s
 !ğ
NULL
)

406 
d–‘e
 [] 
Œ“Figu»s
;

408 #ifdeà
LM_METHOD_OBJ


409 
d–‘e
 
Ïndm¬kObjeù
;

412 ià(
¦ideShowSavedObjeù
 !ğ
NULL
)

413 
d–‘e
 
¦ideShowSavedObjeù
;

415 
i
 = 0; i < 
mod–SlideShow
.
	`size
(); i++)

416 
d–‘e
 
mod–SlideShow
[
i
];

417 
mod–SlideShow
.
	`ş—r
();

419 
i
 = 0; i < 
teSlideShow
.
	`size
(); i++)

420 
d–‘e
 
teSlideShow
[
i
];

421 
teSlideShow
.
	`ş—r
();

423 #ifdeà
PCA_VISUALIZER


424 ià(
pÿ
 !ğ
NULL
)

425 
d–‘e
 
pÿ
;

433 
	}
}

435 
	gP3DCÚŒŞ
::
£tGuiC®lbacks
((* 
guiCB
)(), (* 
guiSgeCB
)(
O±imiz”Sge
))

437 
upd©eGui
 = 
guiCB
;

438 
upd©eGuiSge
 = 
guiSgeCB
;

439 
	}
}

441 #ifdeà
LM_METHOD_OBJ


450 
	gP3DCÚŒŞ
::
	$fšdLªdm¬kPos™ByName
(
VeùÜ3D
 &
lmPos™
, 
M3DObjeù
 * 
obj
, 
figu»Id
,

451 cÚ¡ * 
Ïndm¬kName
, 
objTy³
)

453 ià(
obj
 =ğ
NULL
) {

454 
cout
 << "WARNING: iÁ”ÇÈ”rÜ iÀfšdLªdm¬kPos™ByName: inv®id obj" << 
’dl
;

458 
M3DPrim™ive
 *
lmAtom
;

459 
M3DFigu»
 *
fig
;

460 
lmAtomIndex
, 
li
, 
Æi
, 
lmAtomT
, 
lmIndex
;

462 
objTy³
)

467 ià(
figu»Id
 < 0) {

468 
cout
 << "WARNING: internalƒrror in findLandmarkPositByName: figureId < 0"

469 << 
’dl
;

474 
fig
 = 
obj
->
	`g‘Figu»PŒ
(
figu»Id
);

475 
lmAtomIndex
 = 
fig
->
	`fšdLªdm¬kAtomIndexByName
(
Ïndm¬kName
);

476 ià(
lmAtomIndex
 < 0)

478 
cout
 << "WARNING: cannot find model†andmark \""

479 << 
Ïndm¬kName
 << "\"" << 
’dl
;

482 
lmAtom
 = 
fig
->
	`g‘Prim™ivePŒ
(
lmAtomIndex
);

485 
lmIndex
 = 
fig
->
	`fšdLªdm¬kIndexByName
(
Ïndm¬kName
);

486 
lmAtomT
 = (è
fig
->
Ïndm¬kAtomTs
[
lmIndex
];

487 
lmAtomT
)

490 
lmPos™
 = 
lmAtom
->
	`g‘X
(è+†mAtom->
	`g‘Y0
();

493 
lmPos™
 = 
lmAtom
->
	`g‘X
(è+†mAtom->
	`g‘Ex‹ndedB
();

496 
lmPos™
 = 
lmAtom
->
	`g‘X
(è+†mAtom->
	`g‘Y1
();

503 
Æi
 = 
obj
->
	`g‘Figu»CouÁ
();

504 
li
 = 0;†˜< 
Æi
;†i++)

506 
fig
 = 
obj
->
	`g‘Figu»PŒ
(
li
);

507 ià(! 
	`¡rcmp
(
Ïndm¬kName
, 
fig
->
	`g‘Name
()+3))

509 
lmPos™
 = 
fig
->
	`g‘Prim™ivePŒ
(0)->
	`g‘X
();

513 ià(
glob®V”bos™y
 >= 0)

514 
cout
 << "WARNING: cannot find image†andmark \""

515 << 
Ïndm¬kName
 << "\"" << 
’dl
;

519 
cout
 << "WARNING: internalƒrror in findLandmarkPositByName: "

520 << "šv®id objTy³ (" << 
objTy³
 << ")" << 
’dl
;

525 
	}
}

529 #ifdeà
BINARY


533 
Image3D
 * 
	gP3DCÚŒŞ
::
	$g‘Re§m³dBš¬ySüt
(
Regi¡ry
 & 
süt
,

534 * 
bšImageFeKey
, * 
»sBšImageFeKey
)

536 cÚ¡ * 
f’ame
;

537 
Image3D
 * 
image
;

538 
RAWImageFe
 
imageFe
;

540 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
(
»sBšImageFeKey
, 
NULL
);

541 
image
 = 
imageFe
.
	`»ad
(
f’ame
);

543 ià(! 
image
) {

544 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
(
bšImageFeKey
, 
NULL
);

545 
image
 = 
imageFe
.
	`»ad
(
f’ame
);

547 
cout
 << "Lßded Bš¬y Image: " << 
f’ame
 << 
’dl
;

550 
ImageRe§m¶e3D
 
»§m¶”
;

551 
»§m¶”
.
	`isÙrİicSam¶e
(*
image
);

553 
cout
 << "Resampled Binary Image.\n";

555 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
(
»sBšImageFeKey
, 
NULL
);

556 if(
imageFe
.
	`wr™e
(
f’ame
, *
image
))

557 
cout
 << "Saved„e§m¶ed Image: " << 
f’ame
 << 
’dl
;

559 
cout
 << "Re§m¶ed ImagçedØ§ve: " << 
f’ame
 << 
’dl
;

562 
cout
 << "Lßded Re§m¶ed Bš¬y Image: " << 
f’ame
 << 
’dl
;

563  
image
;

564 
	}
}

566 
ImageDi¡ªûM­
 * 
	gP3DCÚŒŞ
::
	$g‘DDMSüt
(
Regi¡ry
 & 
süt
,

567 
Image3D
 * 
image
, * 
f’ameIn
)

569 cÚ¡ * 
f’ame
;

570 
RAWImageFe
 
imageFe
;

571 
ImageDi¡ªûM­
 * 
bš¬yDi¡ªûM­
;

572 
Image3D
 * 
di¡M­Image
;

573 
Image3D
 * 
imageOut
;

575 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
(
f’ameIn
, 
NULL
);

576 
di¡M­Image
 = 
imageFe
.
	`»ad
(
f’ame
);

578 ià(
di¡M­Image
 !ğ
NULL
) {

579 
cout
 << "Loading DistanceMap from file.\n";

580 
bš¬yDi¡ªûM­
 = 
Ãw
 
ImageDi¡ªûM­
;

581 
bš¬yDi¡ªûM­
->
	`äomImage3D
(
di¡M­Image
);

584 
cout
 << "Computing DistanceMap.\n";

585 
bš¬yDi¡ªûM­
 = 
Ãw
 
	`ImageDi¡ªûM­
(
image
);

586 (è
bš¬yDi¡ªûM­
->
	`ü—‹M­
();

587 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
(
f’ameIn
, 
NULL
);

588 
imageOut
 = 
bš¬yDi¡ªûM­
->
İ”©Ü
 
Image3D
 *();

589 
	`§veImage
(
f’ame
, 
imageOut
);

590 
d–‘e
 
imageOut
;

593  
bš¬yDi¡ªûM­
;

594 
	}
}

598 #ifdeà
LM_METHOD_OBJ


600 
	gP3DCÚŒŞ
::
	$bš¬yPabloLi¡Lªdm¬ks
()

602 ià(
objeù
 =ğ
NULL
)

605 ià(
glob®V”bos™y
 > 0) {

606 
cout
 << " Found " << 
objeù
->
	`g‘Lªdm¬kCouÁ
(è<< "†ªdm¬ks" << 
’dl
;

609 
nf
 = 
objeù
->
	`g‘Figu»CouÁ
();

610 
f
 = 0; f < 
nf
; f++) {

611 
M3DFigu»
 *
fig
 = 
objeù
->
	`g‘Figu»PŒ
(
f
);

614 
Æm
 = 
fig
->
	`g‘Lªdm¬kCouÁ
();

615 
lm
 = 0;†m < 
Æm
;†m++) {

616 
VeùÜ3D
 
lmPos™
;

617 * 
lmName
 = (*è
fig
->
	`g‘Lªdm¬kName
(
lm
);

618 
	`fšdLªdm¬kPos™ByName
(
lmPos™
, 
objeù
, 
f
, 
lmName
, 1);

620 
cout
 << "†m #" << 
lm
 << ":‚ame=\"" << 
lmName
 << "\"" << 
’dl
;

621 
cout
 << "…osition=<ucs>";

622 
lmPos™
.
	`´št
();

623 
Image3D
 * 
image
 = 
	`g‘ImagePŒ
();

624 ià(
image
) {

625 
image
->
	`mod–ToImageCoÜdš©es
(
lmPos™
);

626 
cout
 << "…osition=<ics>";

627 
lmPos™
.
	`´št
();

632 
	}
}

638 #ifdeà
LM_METHOD_OBJ


640 
boŞ
 
	gP3DCÚŒŞ
::
	$bš¬yPabloLßdLªdm¬kMod–
(cÚ¡ * 
f’ame
)

642 ià(
f’ame
 && *filename) {

644 ià(! 
	`»adLªdm¬kMod–
(
f’ame
)) {

645 ià(
f’ame
 && *filename)

646 
cout
 << "E¼Ü: uÇbËØlßd†ªdm¬k mod–: " << 
f’ame
 << 
’dl
;

648 
cout
 << "E¼Ü:‚ØÏndm¬k mod– f’amsuµl›d" << 
’dl
;

649  
çl£
;

652 ià(
glob®V”bos™y
 > -1)

653 
cout
 << "Lßded†ªdm¬k mod– " << 
f’ame
 << 
’dl
;

654 ià(
glob®V”bos™y
 > 0) {

655 
cout
 << " Found " << 
Ïndm¬kObjeù
->
	`g‘Figu»CouÁ
(è<< "†ªdm¬ks" << 
’dl
;

658 
Æi
 = 
Ïndm¬kObjeù
->
	`g‘Figu»CouÁ
();

659 
li
 = 0;†˜< 
Æi
;†i++) {

660 cÚ¡ * 
lmName
 = 
Ïndm¬kObjeù
->
	`g‘Figu»PŒ
(
li
)->
	`g‘Name
();

662 
VeùÜ3D
 
lmPos™
;

663 
	`fšdLªdm¬kPos™ByName
(
lmPos™
, 
Ïndm¬kObjeù
, 0, (*è
lmName
+3, 2);

665 
cout
 << "†m #" << 
li
 << ":‚ame=\"" << 
lmName
 << "\"…osition=<ucs>";

666 
lmPos™
.
	`´št
();

670  
Œue
;

672  
çl£
;

673 
	}
}

677 #ifdeà
BINARY


680 
boŞ
 
	gP3DCÚŒŞ
::
	$bš¬yPabloFigu»Sge
(
maxNumI‹¿tiÚs
,

681 
doSÿË
,

682 cÚ¡ * 
pgaF’ame
)

684 
cout
 << "bš¬yPabloFigu»Sge" << 
’dl
;

685 ià(! 
	`š™ŸlizeMašFigu»O±imiz”
(
doSÿË
, 
pgaF’ame
))

686  
çl£
;

687 
cout
 << "O±imiz” In™Ÿlized" << 
’dl
;

698 ià(! 
maxNumI‹¿tiÚs
)

699  
Œue
;

701 ià(
upd©eGuiSge
 !ğ
NULL
)

702 
	`upd©eGuiSge
(
cu¼’tO±imiz”Sge
);

704 
i
 = 0; i < 
maxNumI‹¿tiÚs
; i++) {

705 
	`doMašFigu»I‹¿tiÚs
(1);

706 ià(
	`mašFigu»SgeSk³d
())

707  
Œue
;

709 ià(
upd©eGui
 !ğ
NULL
)

710 
	`upd©eGui
(
i
);

714 ià(
glob®V”bos™y
 > -1) {

715 cÚ¡ 
M©ch
::
m©chResuÉ
 * 
mr
 = 
m©ch
->
	`g‘Figu»SgeResuÉs
();

716 
cout
 << " " << 
i
 << ": ";

717 
cout
 << "ObjFunc:" << 
	`g‘La¡MašFigu»ObjeùiveFunùiÚV®ue
();

718 
j
 = 0; j < 
MAX_NUM_FIG_MATCH_RESULTS
; j++) {

719 
bpTuÃ_t
 
šdex
 = (bpTuÃ_tè
mr
[
j
].
tunšgP¬m
;

720 
šdex
) {

721 
BpFigu»ImageM©ch
: 
cout
 << " Match";

723 
BpFigu»Lªdm¬kM©ch
: 
cout
 << " Landmark";

725 
BpFigu»Mod–M©ch
: 
cout
 << " Ref";

727 
Figu»Mah®ªobisM©ch
: 
cout
 << " Maha";

729 
BpFigu»IÁ”³ÃŒ©iÚM©ch
: 
cout
 << " Pen";

731 
BpFigu»RS¿dP’®ty
: 
cout
 << " RSrad";

733 
BpFigu»CurvšessP’®ty
: 
cout
 << " Curviness";

735 
Figu»CÚtourM©ch
: 
cout
 << " Contour";

737 
BpFigu»ImageNÜm®M©ch
: 
cout
 << " Boundary Normal";

739 
BpFigu»ImagePÏÃOr›nAtEnd
: 
cout
 << " Crest…rincipal direction";

741 
BpFigu»ImageV”‹xM©ch
: 
cout
 << " Crest vertex" ;

744 
BpAtomEndSpokeDœeùiÚ®CÚsi¡’cy
: 
cout
 << " End‡tom spoke direction";

746 : 
cout
 << " Unknown matchype";

749 
cout
 << ':' << 
mr
[
j
].
v®ue
;

751 
cout
 << '\n';

752 
cout
.
	`æush
();

755 ifĞ
MakeO±imiz©iÚVideo
::
makeVideoOn
 )

756 
MakeO±imiz©iÚVideo
::
	`wr™eCu¼’tMod–
Ğ
objeù
 ) ;

761 ià(
glob®V”bos™y
 > -1) {

762 
cout
 << "M©ch‡á” Figu» Sge:" << 
’dl
;

763 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

764 
M©chUt™y
::
	`ÿlcuÏ‹Av”ageDi¡ªû
(
objeù
, objeù->
	`lßdedObjeù
(),

765 
figu»Id
, 
	`g‘ImageDi¡M­Poš‹r
(), (è
	`tunšgWt
(
BpFigu»SurçûLev–
),

766 (
PrimNeighbÜhoodDeâ
è(è
	`tunšgWt
(
BpFigu»NeighbÜhood
),

767 (
Di¡ªûTy³
è(è
	`tunšgWt
(
BpFigu»Di¡ªûTy³
),

768 
glob®V”bos™y
);

771  
Œue
;

772 
	}
}

774 
boŞ
 
	gP3DCÚŒŞ
::
	$bš¬yPabloAtomSge
(
maxNumI‹¿tiÚs
)

776 
i
;

778 
boŞ
 
İtimiz”StİReque¡ed
 = 
çl£
;

779 
	`‹¡AndRe£tMod–Chªged
();

780 
	`š™ŸlizeDefÜm©iÚO±imiz”
();

782 ià(
upd©eGuiSge
 !ğ
NULL
)

783 
	`upd©eGuiSge
(
cu¼’tO±imiz”Sge
);

786 
i
 = 0; i < 
maxNumI‹¿tiÚs
; i++) {

788 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

794 
İtimiz”StİReque¡ed
 = 
	`doDefÜm©iÚI‹¿tiÚs
(
figu»Id
);

795 ià(
upd©eGui
 !ğ
NULL
)

796 
	`upd©eGui
(
i
);

799 ià(
glob®V”bos™y
 > -1) {

800 cÚ¡ 
M©ch
::
m©chResuÉ
 * 
mr
 = 
m©ch
->
	`g‘AtomSgeResuÉs
();

801 
cout
 << " " << 
i
 << ": ";

802 
cout
 << "ObjFunc:" << 
	`g‘La¡DefÜm©iÚObjeùiveFunùiÚV®ue
(
çl£
);

803 
j
 = 0; j < 
MAX_NUM_ATOM_MATCH_RESULTS
; j++) {

804 
bpTuÃ_t
 
šdex
 = (bpTuÃ_tè
mr
[
j
].
tunšgP¬m
;

805 
šdex
) {

806 
BpAtomImageM©ch
: 
cout
 << " Match";

808 
BpAtomLªdm¬kM©ch
: 
cout
 << " Landmark";

810 
BpAtomAv”ageNeighbÜM©ch
: 
cout
 << " Reg";

812 
BpAtomMod–M©ch
: 
cout
 << " Ref";

814 
AtomMah®ªobisM©ch
: 
cout
 << " Maha";

816 
BpAtomIÁ”³ÃŒ©iÚM©ch
: 
cout
 << " Pen";

818 
BpAtomRS¿dP’®ty
: 
cout
 << " Srad";

820 
BpAtomD–NeighbÜM©ch
: 
cout
 << " DelN";

822 
BpAtomCurvšessP’®ty
: 
cout
 << " Curviness";

824 
BpAtomImageNÜm®M©ch
: 
cout
 << " Boundary Normal";

826 
BpAtomImagePÏÃOr›nAtEnd
: 
cout
 << " Crest…rincipal direction";

828 
BpAtomImageV”‹xM©ch
: 
cout
 << " Crest vertex" ;

831 
cout
 << ':' << 
mr
[
j
].
v®ue
;

833 
cout
 << '\n';

834 
cout
.
	`æush
();

837 ifĞ
MakeO±imiz©iÚVideo
::
makeVideoOn
 )

838 
MakeO±imiz©iÚVideo
::
	`wr™eCu¼’tMod–
Ğ
objeù
 ) ;

840 ià(
İtimiz”StİReque¡ed
 =ğ
Œue
)

848 ià(
i
 =ğ(
maxNumI‹¿tiÚs
 - 1))

849 ià(
glob®V”bos™y
 > -1)

850 
cout
 << "\nOptimizer could‚ot„each‡n optimum in "

851 << 
maxNumI‹¿tiÚs
 << " i‹¿tiÚs" << 
’dl
;

853 ià(
glob®V”bos™y
 > 0) {

854 cÚ¡ 
M©ch
::
m©chResuÉ
 * 
mr
 = 
m©ch
->
	`g‘AtomSgeResuÉs
();

855 
cout
 << "\nMatch‡fter Atom Stage:\n";

857 
j
 = 0; j < 
MAX_NUM_ATOM_MATCH_RESULTS
 - 1; j++) {

858 
bpTuÃ_t
 
šdex
 = (bpTuÃ_tè
mr
[
j
].
tunšgP¬m
;

859 
šdex
) {

860 
BpAtomImageM©ch
: 
cout
 << " Match Distance";

862 
BpAtomLªdm¬kM©ch
: 
cout
 << " Landmark Distance";

864 
BpAtomAv”ageNeighbÜM©ch
: 
cout
 << " Match Regularity";

866 
BpAtomMod–M©ch
: 
cout
 << " Match Reference";

868 
AtomMah®ªobisM©ch
: 
cout
 << " Mahalanobis Distance";

870 
BpAtomIÁ”³ÃŒ©iÚM©ch
: 
cout
 << " Pen";

872 
BpAtomRS¿dP’®ty
: 
cout
 << " Srad";

874 
BpAtomD–NeighbÜM©ch
: 
cout
 << " Delta Neighbor";

877 
cout
 << ": " << 
mr
[
j
].
v®ue
 << '\n';

879 
cout
 << 
æush
;

882 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

883 (è
M©chUt™y
::
	`ÿlcuÏ‹Av”ageDi¡ªû
(
objeù
, objeù->
	`lßdedObjeù
(),

884 
figu»Id
, 
	`g‘ImageDi¡M­Poš‹r
(), (è
	`tunšgWt
(
BpAtomSurçûLev–
),

885 (
PrimNeighbÜhoodDeâ
è(è
	`tunšgWt
(
BpAtomNeighbÜhood
),

886 (
Di¡ªûTy³
è(è
	`tunšgWt
(
BpAtomDi¡ªûTy³
),

887 
glob®V”bos™y
);

889  
Œue
;

890 
	}
}

892 
boŞ
 
	gP3DCÚŒŞ
::
	$bš¬yPabloSR•NÜm®Adju¡m’ts
()

894 
M3DQuadFigu»
 * 
figu»
 = 
dyÇmic_ÿ¡
<M3DQuadFigu»*>(
objeù
->
	`g‘Figu»PŒ
(0));

896 
num_´ims
 = 
figu»
->
	`g‘Prim™iveCouÁ
();

898 
¡d
::
cout
 << 
num_´ims
 << std::
’dl
;

900 
i
 = 0; i < 
num_´ims
; i++)

902 
M3DPrim™ive
 * 
´im
 = 
figu»
->
	`g‘Prim™ivePŒ
(
i
);

903 ià(
´im
->
	`ty³
() == 0)

905 
m©ch
->
	`doSpokeNÜm®Adju¡m’t
(
objeù
, 0, 
i
, 0, 0);

906 
m©ch
->
	`doSpokeNÜm®Adju¡m’t
(
objeù
, 0, 
i
, 1, 0);

910  
Œue
;

912 
	}
}

914 
boŞ
 
	gP3DCÚŒŞ
::
	$bš¬yPabloSR•Sge
(
maxNumI‹¿tiÚs
)

916 
i
;

918 
boŞ
 
İtimiz”StİReque¡ed
 = 
çl£
;

919 
	`‹¡AndRe£tMod–Chªged
();

920 
	`š™ŸlizeSR•O±imiz”
();

922 ià(
upd©eGuiSge
 !ğ
NULL
)

923 
	`upd©eGuiSge
(
cu¼’tO±imiz”Sge
);

926 
i
 = 0; i < 
maxNumI‹¿tiÚs
; i++) {

928 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

934 
İtimiz”StİReque¡ed
 = 
	`doSR•I‹¿tiÚs
(
figu»Id
);

935 ià(
upd©eGui
 !ğ
NULL
)

936 
	`upd©eGui
(
i
);

939 ià(
glob®V”bos™y
 > -1) {

940 cÚ¡ 
M©ch
::
m©chResuÉ
 * 
mr
 = 
m©ch
->
	`g‘SR•SgeResuÉs
();

941 
cout
 << " " << 
i
 << ": ";

942 
cout
 << "ObjFunc:" << 
	`g‘La¡SR•ObjeùiveFunùiÚV®ue
(
çl£
);

943 
j
 = 0; j < 
MAX_NUM_SREP_MATCH_RESULTS
; j++) {

944 
bpTuÃ_t
 
šdex
 = (bpTuÃ_tè
mr
[
j
].
tunšgP¬m
;

945 
šdex
) {

946 
BpSR•Av”ageNeighbÜM©ch
: 
cout
 << " Reg";

948 
BpSR•ImageM©ch
: 
cout
 << " Match";

950 
SR•RadiusM©ch
: 
cout
 << " Atom Radius";

952 
BpSR•Lªdm¬kM©ch
: 
cout
 << " Landmark";

954 
BpSR•Mod–M©ch
: 
cout
 << " Ref";

956 
BpSR•IÁ”³ÃŒ©iÚM©ch
: 
cout
 << " Pen";

958 
BpSR•RS¿dP’®ty
: 
cout
 << " Srad";

960 
BpSR•D–NeighbÜM©ch
: 
cout
 << " DelN";

962 
BpSR•CurvšessP’®ty
: 
cout
 << " Curviness";

964 
BpSR•ImageNÜm®M©ch
: 
cout
 << " Boundary Normal";

966 
BpSR•ImagePÏÃOr›nAtEnd
: 
cout
 << " Crest…rincipal direction";

968 
BpSR•ImageV”‹xM©ch
: 
cout
 << " Crest vertex" ;

971 
cout
 << ':' << 
mr
[
j
].
v®ue
;

973 
cout
 << '\n';

974 
cout
.
	`æush
();

977 ifĞ
MakeO±imiz©iÚVideo
::
makeVideoOn
 )

978 
MakeO±imiz©iÚVideo
::
	`wr™eCu¼’tMod–
Ğ
objeù
 ) ;

980 ià(
İtimiz”StİReque¡ed
 =ğ
Œue
)

987 ià(
i
 =ğ(
maxNumI‹¿tiÚs
 - 1))

988 ià(
glob®V”bos™y
 > -1)

989 
cout
 << "\nOptimizer could‚ot„each‡n optimum in "

990 << 
maxNumI‹¿tiÚs
 << " i‹¿tiÚs" << 
’dl
;

992 ià(
glob®V”bos™y
 > 0) {

993 cÚ¡ 
M©ch
::
m©chResuÉ
 * 
mr
 = 
m©ch
->
	`g‘SR•SgeResuÉs
();

994 
cout
 << "\nMatch‡fter Atom Stage:\n";

996 
j
 = 0; j < 
MAX_NUM_ATOM_MATCH_RESULTS
 - 1; j++) {

997 
bpTuÃ_t
 
šdex
 = (bpTuÃ_tè
mr
[
j
].
tunšgP¬m
;

998 
šdex
) {

999 
BpSR•ImageM©ch
: 
cout
 << " Match Distance";

1001 
BpSR•Lªdm¬kM©ch
: 
cout
 << " Landmark Distance";

1003 
BpSR•Av”ageNeighbÜM©ch
: 
cout
 << " Match Regularity";

1005 
BpSR•Mod–M©ch
: 
cout
 << " Match Reference";

1007 
SR•RadiusM©ch
: 
cout
 << " Radius mismatch";

1009 
BpSR•IÁ”³ÃŒ©iÚM©ch
: 
cout
 << " Pen";

1011 
BpSR•RS¿dP’®ty
: 
cout
 << " Srad";

1013 
BpSR•D–NeighbÜM©ch
: 
cout
 << " Delta Neighbor";

1016 
cout
 << ": " << 
mr
[
j
].
v®ue
 << '\n';

1018 
cout
 << 
æush
;

1021 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

1022 (è
M©chUt™y
::
	`ÿlcuÏ‹Av”ageDi¡ªû
(
objeù
, objeù->
	`lßdedObjeù
(),

1023 
figu»Id
, 
	`g‘ImageDi¡M­Poš‹r
(), (è
	`tunšgWt
(
BpSR•SurçûLev–
),

1024 (
PrimNeighbÜhoodDeâ
è(è
	`tunšgWt
(
BpSR•NeighbÜhood
),

1025 (
Di¡ªûTy³
è(è
	`tunšgWt
(
BpSR•Di¡ªûTy³
),

1026 
glob®V”bos™y
);

1028  
Œue
;

1029 
	}
}

1032 
boŞ
 
	gP3DCÚŒŞ
::
	$bš¬yPabloSpokeSge
(
maxNumI‹¿tiÚs
)

1034 
i
;

1036 
boŞ
 
İtimiz”StİReque¡ed
 = 
çl£
;

1037 
	`‹¡AndRe£tMod–Chªged
();

1038 
	`š™ŸlizeSpokeO±imiz”
();

1040 ià(
upd©eGuiSge
 !ğ
NULL
)

1041 
	`upd©eGuiSge
(
cu¼’tO±imiz”Sge
);

1044 
i
 = 0; i < 
maxNumI‹¿tiÚs
; i++) {

1046 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

1052 
İtimiz”StİReque¡ed
 = 
	`doSpokeI‹¿tiÚs
(
figu»Id
);

1053 ià(
upd©eGui
 !ğ
NULL
)

1054 
	`upd©eGui
(
i
);

1057 ià(
glob®V”bos™y
 > -1) {

1058 cÚ¡ 
M©ch
::
m©chResuÉ
 * 
mr
 = 
m©ch
->
	`g‘SpokeSgeResuÉs
();

1059 
cout
 << " " << 
i
 << ": ";

1060 
cout
 << "ObjFunc:" << 
	`g‘La¡SpokeObjeùiveFunùiÚV®ue
(
çl£
);

1061 
j
 = 0; j < 
MAX_NUM_SPOKE_MATCH_RESULTS
; j++) {

1062 
bpTuÃ_t
 
šdex
 = (bpTuÃ_tè
mr
[
j
].
tunšgP¬m
;

1063 
šdex
) {

1064 
BpSpokeImageM©ch
: 
cout
 << " Match";

1066 
BpSpokeLªdm¬kM©ch
: 
cout
 << " Landmark";

1068 
BpSpokeAv”ageNeighbÜM©ch
: 
cout
 << " Reg";

1070 
BpSpokeMod–M©ch
: 
cout
 << " Ref";

1072 
SpokeMah®ªobisM©ch
: 
cout
 << " Maha";

1074 
BpSpokeIÁ”³ÃŒ©iÚM©ch
: 
cout
 << " Pen";

1076 
BpSpokeRS¿dP’®ty
: 
cout
 << " Srad";

1079 
cout
 << ':' << 
mr
[
j
].
v®ue
;

1081 
cout
 << '\n';

1083 ià(
İtimiz”StİReque¡ed
 =ğ
Œue
)

1090 ià(
i
 =ğ(
maxNumI‹¿tiÚs
 - 1))

1091 ià(
glob®V”bos™y
 > -1)

1092 
cout
 << "\nOptimizer could‚ot„each‡n optimum in "

1093 << 
maxNumI‹¿tiÚs
 << " i‹¿tiÚs" << 
’dl
;

1095 ià(
glob®V”bos™y
 > 0) {

1096 cÚ¡ 
M©ch
::
m©chResuÉ
 * 
mr
 = 
m©ch
->
	`g‘SpokeSgeResuÉs
();

1097 
cout
 << "\nMatch‡fter Spoke Stage:\n";

1099 
j
 = 0; j < 
MAX_NUM_SPOKE_MATCH_RESULTS
 - 1; j++) {

1100 
bpTuÃ_t
 
šdex
 = (bpTuÃ_tè
mr
[
j
].
tunšgP¬m
;

1101 
šdex
) {

1102 
BpSpokeImageM©ch
: 
cout
 << " Match Distance";

1104 
BpSpokeLªdm¬kM©ch
: 
cout
 << " Landmark Distance";

1106 
BpSpokeAv”ageNeighbÜM©ch
: 
cout
 << " Match Regularity";

1108 
BpSpokeMod–M©ch
: 
cout
 << " Match Reference";

1110 
SpokeMah®ªobisM©ch
: 
cout
 << " Mahalanobis Distance";

1112 
BpSpokeIÁ”³ÃŒ©iÚM©ch
: 
cout
 << " Pen";

1114 
BpSpokeRS¿dP’®ty
: 
cout
 << " Srad";

1117 
cout
 << ": " << 
mr
[
j
].
v®ue
 << '\n';

1119 
cout
 << 
æush
;

1122 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

1123 (è
M©chUt™y
::
	`ÿlcuÏ‹Av”ageDi¡ªû
(
objeù
, objeù->
	`lßdedObjeù
(),

1124 
figu»Id
, 
	`g‘ImageDi¡M­Poš‹r
(), (è
	`tunšgWt
(
BpSpokeSurçûLev–
),

1125 (
PrimNeighbÜhoodDeâ
è(è
	`tunšgWt
(
BpSpokeNeighbÜhood
),

1126 (
Di¡ªûTy³
è(è
	`tunšgWt
(
BpSpokeDi¡ªûTy³
),

1127 
glob®V”bos™y
);

1129  
Œue
;

1130 
	}
}

1133 
	gP3DCÚŒŞ
::
	$bš¬yPabloNextO±imiz©iÚSge
(
surçûLev–
)

1136 ià(! 
objeù
) {

1137 
û¼
 << "A mod– mu¡ fœ¡ blßded" << 
’dl
;

1142 ià(! 
	`haveImage
()) {

1143 
û¼
 << "AÀimagmu¡ fœ¡ blßded" << 
’dl
;

1148 
cu¼’tO±imiz”Sge
)

1150 
NO_OPTIMIZER_STAGE
:

1151 
OPTIMIZER_SETUP_STAGE
:

1152 ià(! 
	`š™ŸlizeM©ch
(
BINARY_IMAGE_MATCH
, 
surçûLev–
))

1156 
OPTIMIZER_OBJECT_STAGE
:

1159 
OPTIMIZER_ENSEMBLE_STAGE
:

1162 
OPTIMIZER_FIGURE_STAGE
:

1165 
OPTIMIZER_MAIN_FIGURE_STAGE
:

1168 
OPTIMIZER_SUBFIGURE_STAGE
:

1171 
OPTIMIZER_PRIMITIVE_STAGE
:

1174 
OPTIMIZER_SREP_STAGE
:

1178 
OPTIMIZER_SPOKE_STAGE
:

1181 
OPTIMIZER_BOUNDARY_DISPLACEMENT_STAGE
:

1184 
OPTIMIZER_END_STAGE
:

1188 
cout
 << "WARNING: Cu¼’ˆİtimiz” sg(" << 
cu¼’tO±imiz”Sge
 << "èi nÙ defšed:" << 
’dl
;

1193 
cu¼’tO±imiz”Sge
 = 
	`ÃxtO±imiz”Sge
();

1195 
	}
}

1201 * 
	$ÿlcAÁŸlŸ£dDMF’ame
(* 
_imageF’ame
) {

1206 
Ën
 = 
	`¡¾’
(
_imageF’ame
);

1211 * 
suffix
 = 
NULL
;

1213 ià((
	`¡r¡r
(
_imageF’ame
, ".¿w3" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".raw3" ))))

1214 
suffix
 = ".raw3";

1216 ià((
	`¡r¡r
(
_imageF’ame
, ".¿w3z" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".raw3z" ))))

1217 
suffix
 = ".raw3z";

1219 ià((
	`¡r¡r
(
_imageF’ame
, ".gl" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".gipl" ))))

1220 
suffix
 = ".gipl";

1222 ià((
	`¡r¡r
(
_imageF’ame
, ".mhd" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".mhd" ))))

1223 
suffix
 = ".mhd";

1225 ià((
	`¡r¡r
(
_imageF’ame
, ".mha" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".mha" ))))

1226 
suffix
 = ".mha";

1228 ià(!
suffix
)

1229  
NULL
;

1231 
suffixL’
 = 
	`¡¾’
(
suffix
);

1233 cÚ¡ * 
ddmFeEx‹nsiÚ
 = ".raw3";

1235 * 
ddmF’ame
 = 
Ãw
 [ 
Ën
 + 20 + 1 ];

1237 
	`¡rıy
(
ddmF’ame
, 
_imageF’ame
);

1239 
	`¡rıy
(
ddmF’ame
 + 
Ën
 - 
suffixL’
, "-antiAliased");

1241 
¡ršg
 
	`ddmF’ameTemp
(
ddmF’ame
);

1242 
ddmF’ameTemp
.
	`­³nd
(".mhd");

1243 
if¡»am
 
	`ife
(
ddmF’ameTemp
.
	`c_¡r
());

1245 if(
ife
){

1246 
	`¡rÿt
(
ddmF’ame
, ".mhd");

1248 
	`¡rÿt
(
ddmF’ame
, 
ddmFeEx‹nsiÚ
);

1251  
ddmF’ame
;

1252 
	}
}

1256 * 
	$ÿlcOuutDMF’ame
(* 
_imageF’ame
) {

1261 
Ën
 = 
	`¡¾’
(
_imageF’ame
);

1266 * 
suffix
 = 
NULL
;

1268 ià((
	`¡r¡r
(
_imageF’ame
, ".¿w3" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".raw3" ))))

1269 
suffix
 = ".raw3";

1271 ià((
	`¡r¡r
(
_imageF’ame
, ".¿w3z" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".raw3z" ))))

1272 
suffix
 = ".raw3z";

1274 ià((
	`¡r¡r
(
_imageF’ame
, ".gl" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".gipl" ))))

1275 
suffix
 = ".gipl";

1277 ià((
	`¡r¡r
(
_imageF’ame
, ".mhd" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".mhd" ))))

1278 
suffix
 = ".mhd";

1280 ià((
	`¡r¡r
(
_imageF’ame
, ".mha" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".mha" ))))

1281 
suffix
 = ".mha";

1283 ià(!
suffix
)

1284  
NULL
;

1286 
suffixL’
 = 
	`¡¾’
(
suffix
);

1288 cÚ¡ * 
ddmFeEx‹nsiÚ
 = ".raw3";

1290 * 
ddmF’ame
 = 
Ãw
 [ 
Ën
 + 20 + 1 ];

1292 
	`¡rıy
(
ddmF’ame
, 
_imageF’ame
);

1294 
	`¡rıy
(
ddmF’ame
 + 
Ën
 - 
suffixL’
, "-outputDM");

1296 
	`¡rÿt
(
ddmF’ame
, 
ddmFeEx‹nsiÚ
);

1298  
ddmF’ame
;

1299 
	}
}

1309 * 
	$ÿlcDDMF’ame
(* 
_imageF’ame
, 
mask
 = 0xFFFF)

1311 * 
ddmF’ame
;

1312 
Ën
 = 
	`¡¾’
(
_imageF’ame
);

1313 cÚ¡ * 
ddmFeEx‹nsiÚ
 = ".raw3";

1316 * 
suffix
 = 
NULL
;

1317 ià((
	`¡r¡r
(
_imageF’ame
, ".¿w3" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".raw3" ))))

1318 
suffix
 = ".raw3";

1319 ià((
	`¡r¡r
(
_imageF’ame
, ".¿w3z" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".raw3z" ))))

1320 
suffix
 = ".raw3z";

1321 ià((
	`¡r¡r
(
_imageF’ame
, ".gl" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".gipl" ))))

1322 
suffix
 = ".gipl";

1323 ià((
	`¡r¡r
(
_imageF’ame
, ".mhd" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".mhd" ))))

1324 
suffix
 = ".mhd";

1325 ià((
	`¡r¡r
(
_imageF’ame
, ".mha" ) =ğ(_imageF’am+ 
Ën
 - 
	`¡¾’
(".mha" ))))

1326 
suffix
 = ".mha";

1327 ià(!
suffix
)

1328  
NULL
;

1330 
suffixL’
 = 
	`¡¾’
(
suffix
);

1331 
ddmF’ame
 = 
Ãw
 [
Ën
+
suffixL’
+1+7];

1332 
	`¡rıy
(
ddmF’ame
, 
_imageF’ame
);

1333 
	`¡rıy
(
ddmF’ame
 + 
Ën
 - 
suffixL’
, "-ddm");

1334 ià(
mask
 != 0xFFFF) {

1335 
	`¥rštf
(
ddmF’ame
 + 
Ën
 - 
suffixL’
 + 4, "-0x%0.4x", 
mask
);

1337 
	`¡rÿt
(
ddmF’ame
, 
ddmFeEx‹nsiÚ
);

1338  
ddmF’ame
;

1339 
	}
}

1342 #ifdeà
INTEGRATE_WHEN_OBJ_HISTORY_STRING_DONE


1345 
	$­³ndHi¡oy
(
M3DObjeù
 * 
obj
, cÚ¡ * 
ÇmeUpd©e
)

1347 
ÃwName
[1000];

1348 * 
tok’
;

1350 ià(
obj
 && 
ÇmeUpd©e
 && *nameUpdate) {

1351 cÚ¡ *
objName
 = 
obj
->
	`g‘Name
();

1352 
tok’
 = 
	`¡r¡r
(
objName
, 
ÇmeUpd©e
);

1353 ià(! 
tok’
) {

1354 ià(
objName
)

1355 
	`¡rıy
(
ÃwName
, 
objName
);

1357 
ÃwName
[0] = '\0';

1358 
	`¡rÿt
(
ÃwName
, ":");

1359 
	`¡rÿt
(
ÃwName
, 
ÇmeUpd©e
);

1360 
obj
->
	`£tName
(
ÃwName
);

1361 ià(
glob®V”bos™y
 > 0)

1362 
cout
 << "„’amšg mod– objeùØ" << 
ÃwName
 << 
’dl
;

1365 
M3DFigu»
 * 
fig
 = 
obj
->
	`g‘Figu»PŒ
(
	`tunšgWt
(
BpFigu»Id
));

1366 ià(
fig
) {

1367 cÚ¡ * 
figName
 = 
fig
->
	`g‘Name
();

1368 
tok’
 = 
	`¡r¡r
(
figName
, 
ÇmeUpd©e
);

1369 ià(! 
tok’
) {

1370 ià(
figName
)

1371 
	`¡rıy
(
ÃwName
, 
figName
);

1373 
ÃwName
[0] = '\0';

1375 
	`¡rÿt
(
ÃwName
, ":");

1376 
	`¡rÿt
(
ÃwName
, 
ÇmeUpd©e
);

1377 
fig
->
	`£tName
(
ÃwName
);

1378 ià(
glob®V”bos™y
 > 0)

1379 
cout
 << "„’amšg mod–' fœ¡ figu»Ø" << 
ÃwName
 << 
’dl
;

1383 
	}
}

1388 
	~<®gÜ™hm
>

1390 
	sTPSPošt
 {

1391 
	mx
,
	my
,
	mz
;

1392 
	mm
;

1393 
	mdi¡
;

1394 
	mu
,
	mv
,
	mt
;

1395 
TPSPošt
(è: 
di¡
(
HUGE_VAL
), 
m
(-1) {}

1397 
	mTPSPošt
& 
	mİ”©Ü
 = (cÚ¡ 
TPSPošt
& 
a
) {

1398 
x
 = 
a
.x;

1399 
	my
 = 
a
.
y
;

1400 
	mz
 = 
a
.
z
;

1401 
	mm
 = 
a
.
m
;

1402 
	mdi¡
 = 
a
.
di¡
;

1403 
	mu
 = 
a
.
u
;

1404 
	mv
 = 
a
.
v
;

1405 
	mt
 = 
a
.
t
;

1406  (*
	mthis
);

1411 
boŞ
 
	gİ”©Ü
 < (cÚ¡ 
	gTPSPošt
& 
	ga
, cÚ¡ TPSPošt& 
	gb
) {

1412  (
	ga
.
	gm
 < 
	gb
.mè|| ( (a.m =ğ
b
.
m
) &&

1413 ((
a
.
u
 < 
b
.u) || ( (a.u == b.u) &&

1414 ((
a
.
v
 < 
b
.vè|| ( (a.v =ğb.vè&& (a.
t
 < b.t))))));

1417 
boŞ
 
	gİ”©Ü
 =ğ(cÚ¡ 
TPSPošt
& 
a
, cÚ¡ 
	gTPSPošt
& 
	gb
) {

1418  (
	ga
.
	gm
 =ğ
b
.
m
è&& (
a
.
u
 =ğb.uè&& (a.
v
 =ğb.vè&& (a.
t
 == b.t);

1421 
	gP3DCÚŒŞ
::
	$runThšPÏ‹S¶še
(
Regi¡ry
 &
»gi¡ry
)

1423 cÚ¡ 
subdivLev–
 = 
»gi¡ry
.
	`g‘IÁV®ue
("Subdivisionlevel",3);

1424 cÚ¡ * 
šPoštsfName
 = 
»gi¡ry
.
	`g‘SŒšgV®ue
("Inpoints","");

1425 cÚ¡ * 
outPoštsfName
 = 
»gi¡ry
.
	`g‘SŒšgV®ue
("Outpoints","");

1427 cÚ¡ 
numMod–s
 = 
»gi¡ry
.
	`g‘IÁV®ue
("NumModels",0);

1428 cÚ¡ 
numS‹ps
 = 
»gi¡ry
.
	`g‘IÁV®ue
("NumSteps", 2);

1430 cÚ¡ * 
imgName
 = 
»gi¡ry
.
	`g‘SŒšgV®ue
("Image",
NULL
);

1431 cÚ¡ 
boŞ
 
§veInWÜldCoÜdš©es


1432 ğ
»gi¡ry
.
	`g‘BoŞ—nV®ue
("SaveInWÜldCoÜdš©es",
çl£
);

1433 cÚ¡ * 
rg‘ImageName
 = 
»gi¡ry
.
	`g‘SŒšgV®ue
("T¬g‘Image",
NULL
);

1435 
¡d
::
veùÜ
<cÚ¡ *> 
	`¤cMod–Names
(
numMod–s
), 
	`d¡Mod–Names
(numModels);

1436 
¡d
::
veùÜ
<
M3DObjeù
*> 
	`¤cObjeùs
(
numMod–s
), 
	`d¡Objeùs
ÒumMod–s), 
	`š‹½Objeùs
(numModels);

1437 
¡d
::
veùÜ
<
Th®lCode
::
Poši¡_£rv”2
*> 
	`pLi¡
(
numMod–s
);

1441 
¡d
::
veùÜ
<> 
	`´ojeùiÚCouÁ
(
numMod–s
,0);

1444 
M3DObjeùFe
 
m3dfe
;

1445 
Xã¾i¡
* 
xãr
;

1446 
bufãr
[1000];

1447 
p
,
m
;

1449 
nSrc
, 
nD¡
;

1451 if(!
imgName
 || !*imgName) {

1452 
û¼
 << "ERROR: Lßdšg imag" << 
’dl
;

1456 ifĞ
glob®V”bos™y
 > -1 ) {

1457 
cout
 << "Lßdšg imag" << 
imgName
 << " ... " << 
’dl
;

1459 
Image3D
* 
image
 = 
	`RAWImageFe
().
	`»ad
(
imgName
);

1460 ifĞ
image
 =ğ
NULL
 ) {

1461 
û¼
 << "ERROR: Lßdšg imag" << 
imgName
 << ",„—sÚ: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

1465 
Image3D
* 
rg‘Image
 = 
NULL
;

1466 if(
§veInWÜldCoÜdš©es
) {

1467 if(!
rg‘ImageName
 || !*targetImageName) {

1468 
û¼
 << "ERROR: Lßdšg¬g‘ imag" << 
’dl
;

1472 ifĞ
glob®V”bos™y
 > -1 ) {

1473 
cout
 << "Lßdšg¬g‘ imag" << 
rg‘ImageName
 << " ... " << 
’dl
;

1475 
rg‘Image
 = 
	`RAWImageFe
().
	`»ad
(
rg‘ImageName
);

1476 ifĞ
rg‘Image
 =ğ
NULL
 ) {

1477 
û¼
 << "ERROR: Lßdšg¬g‘ imag" << 
rg‘ImageName
 << ",„—sÚ: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

1482 
m
 = 0; m !ğ
numMod–s
; ++m ) {

1484 
¤cMod–Names
[
m
] = 
»gi¡ry
.
	`g‘SŒšgV®ue
("Srcmod–[%d]", 
NULL
,m);

1486 ifĞ
glob®V”bos™y
 > -1 ) {

1487 
cout
 << "Lßdšg srømod– " << 
¤cMod–Names
[
m
] << " ... ";

1489 
¤cObjeùs
[
m
] = 
m3dfe
.
	`»ad
(
¤cMod–Names
[m]);

1490 if(
¤cObjeùs
[
m
] =ğ
NULL
) {

1491 
û¼
 << "ERROR: Could‚Ù†ßd srømod– " << 
¤cMod–Names
[
m
] << 
’dl
;

1495 ifĞ
glob®V”bos™y
 > -1 ) {

1496 
cout
 << "computing…oint cloud ... ";

1498 
xãr
 = 
	`cÚv”tM3DtoXãr
(
¤cObjeùs
[
m
]->
	`g‘Figu»PŒ
(0));

1499 
pLi¡
[
m
] = 
Ãw
 
Th®lCode
::
	`Poši¡_£rv”2
();

1500 
pLi¡
[
m
]->
	`š™
(
xãr
);

1501 
pLi¡
[
m
]->
	`Compu‹SubdivPoštCloud
(
subdivLev–
);

1502 
d–‘e
[] 
xãr
->
©omli¡
;

1503 
d–‘e
 
xãr
;

1504 ifĞ
glob®V”bos™y
 > -1 ) {

1505 
cout
 << "dÚe" << 
’dl
;

1508 
š‹½Objeùs
[
m
] = 
¤cObjeùs
[m]->
	`şÚe
();

1511 
d¡Mod–Names
[
m
] = 
»gi¡ry
.
	`g‘SŒšgV®ue
("D¡mod–[%d]", 
NULL
,m);

1513 ifĞ
glob®V”bos™y
 > -1 ) {

1514 
cout
 << "Lßdšg d¡ mod– " << 
d¡Mod–Names
[
m
] << " ... ";

1516 
d¡Objeùs
[
m
] = 
m3dfe
.
	`»ad
(
d¡Mod–Names
[m]);

1517 if(
d¡Objeùs
[
m
] =ğ
NULL
) {

1518 
û¼
 << "ERROR: Could‚Ù†ßd d¡ mod– " << 
d¡Mod–Names
[
m
] << 
’dl
;

1521 ifĞ
glob®V”bos™y
 > -1 ) {

1522 
cout
 << "dÚe" << 
’dl
;

1526 
nSrc
 = 
¤cObjeùs
[
m
]->
	`g‘Prim™iveCouÁ
();

1527 
nD¡
 = 
d¡Objeùs
[
m
]->
	`g‘Prim™iveCouÁ
();

1528 ifĞ
nSrc
 !ğ
nD¡
 ) {

1529 
û¼
 << "ERROR: Prim™ivcouÁ dØnÙ m©ch: " << 
¤cMod–Names
[
m
] << "(" << 
nSrc
 << ") != "

1530 << 
d¡Mod–Names
[
m
] << "(" << 
nD¡
 << ")" << 
’dl
;

1536 
veùÜ
<
TPSPošt
> 
pošts
;

1537 
¡d
::
if¡»am
 
šPošts
;

1538 
¡d
::
of¡»am
 
outPošts
;

1539 ià(
šPoštsfName
[0] != '\0') {

1540 
šPošts
.
	`İ’
(
šPoštsfName
);

1541 ifĞ
šPošts
.
	`bad
() ) {

1542 
û¼
 << "ERROR: Could‚Ù†ßd iÅošt f" << 
šPoštsfName
 << ",„—sÚ: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

1546 
outPošts
.
	`İ’
(
outPoštsfName
);

1547 ifĞ
outPošts
.
	`bad
() ) {

1548 
û¼
 << "ERROR: Could‚Ù†ßd ouošt f" << 
outPoštsfName
 << ",„—sÚ: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

1552 
di¡
;

1553 
muÉlic™y
;

1554 
Th®lCode
::
DbVeùÜ3
 
Ã¬poštXYZ
;

1555 
Th®lCode
::
DbVeùÜ3
 
Ã¬poštUVT
;

1556 
VeùÜ3D
 
coÜd
;

1558 
Bpošt
 
bp
;

1559 
¡d
::
veùÜ
< std::veùÜ<
Di¡ªûVeùÜ
> > 
	`poši¡
(
numMod–s
);

1561 ifĞ
»gi¡ry
.
	`g‘IÁV®ue
("BackProject", 0) == 0 ) {

1562 ifĞ
šPoštsfName
[0] != '\0') {

1563  
p
 = 0; !
šPošts
.
	`eof
(); ++p ) {

1564 ifĞ
p
 % 1000 == 0) {

1565 
cout
 << "\rT¿nsfÜmšg ... " << 
p
;

1566 
cout
.
	`æush
();

1568 
x
,
y
,
z
;

1569 
šPošts
 >> 
x
 >> 
y
 >> 
z
;

1570 ifĞ
šPošts
.
	`eof
() ) {

1579 
coÜd
.
	`£t
(
x
,
y
,
z
);

1580 
image
->
	`imageToMod–CoÜdš©es
(
coÜd
);

1583 if(
§veInWÜldCoÜdš©es
)

1584 
rg‘Image
->
	`mod–ToWÜldCoÜdš©es
(
coÜd
);

1585 
outPošts
 << 
coÜd
.
	`g‘X
(è<< '\t' << coÜd.
	`g‘Y
(è<< '\t' << coÜd.
	`g‘Z
(è<< 
’dl
;

1587 
cout
 << 
’dl
;

1589  
m
 = 0; m !ğ
numMod–s
; ++m) {

1590 
numPošts
;

1591 
Bpošt
 *
surçûPoštLi¡
;

1592 
pLi¡
[
m
]->
	`subdivbound¬yšfo
(&
numPošts
, &
surçûPoštLi¡
);

1593 
´ojeùiÚCouÁ
[
m
] = 
numPošts
;

1594 
poši¡
[
m
].
	`»size
(
´ojeùiÚCouÁ
[m]);

1595 
´ojeùiÚCouÁ
[
m
] = 0;

1596  
p
 = 0;… !ğ
numPošts
; ++p ) {

1597 ifĞ!
pLi¡
[
m
]->
thisMesh
->
	`isEndMedcoÜd
(
Th®lCode
::
	`MedcoÜd
(
surçûPoštLi¡
[
p
])) ) {

1598 
Di¡ªûVeùÜ
& 
dv
 = 
poši¡
[
m
][
p
];

1599 
dv
.
p
.
	`£t
(
surçûPoštLi¡
[p].
²t
[0], surfacePointList[p].pnt[1], surfacePointList[p].pnt[2]);

1600 
dv
.
g¿d
.
	`£t
(0.001,0.000,0.000);

1601 
dv
.
n
.
	`£t
(0.0,0.001,0.0);

1602 
dv
.
m‘hod
 = 1;

1603 
dv
.
di¡
 = 1.0;

1604 
TPSPošt
 
²t
;

1605 
²t
.
di¡
 = 1.0;

1606 
²t
.
m
 = m;

1607 
²t
.
u
 = 
surçûPoštLi¡
[
p
].u;

1608 
²t
.
v
 = 
surçûPoštLi¡
[
p
].v;

1609 
²t
.
t
 = 
surçûPoštLi¡
[
p
].t;

1610 
²t
.
x
 = 
surçûPoštLi¡
[
p
].pnt[0];

1611 
²t
.
y
 = 
surçûPoštLi¡
[
p
].pnt[1];

1612 
²t
.
z
 = 
surçûPoštLi¡
[
p
].pnt[2];

1613 
pošts
.
	`push_back
Ğ
²t
 );

1614 
´ojeùiÚCouÁ
[
m
]++;

1617 
poši¡
[
m
].
	`»size
(
´ojeùiÚCouÁ
[m]);

1621  
p
 = 0; !
šPošts
.
	`eof
(); ++p ) {

1622 ifĞ
p
 % 100 == 0) {

1623 
cout
 << "\rBack…rojeùšg ... " << 
p
;

1624 
cout
.
	`æush
();

1626 
x
,
y
,
z
;

1627 
šPošts
 >> 
x
 >> 
y
 >> 
z
;

1628 ifĞ
šPošts
.
	`eof
() ) {

1637 
coÜd
.
	`£t
(
x
,
y
,
z
);

1638 
image
->
	`imageToMod–CoÜdš©es
(
coÜd
);

1640 
pošts
.
	`push_back
Ğ
	`TPSPošt
() );

1641  
m
 = 0; m !ğ
numMod–s
; ++m ) {

1642 
di¡
 = 
pLi¡
[
m
]->
	`subdivN—½ošt
(
coÜd
.
	`g‘X
(), coÜd.
	`g‘Y
(), coÜd.
	`g‘Z
(), &
Ã¬poštXYZ
, &
Ã¬poštUVT
, &
muÉlic™y
);

1643 ifĞ
di¡
 < 
pošts
[
p
].di¡ ||…ošts[p].
m
 == -1 ) {

1644 
pošts
[
p
].
di¡
 = dist;

1645 
pošts
[
p
].
m
 = m;

1646 
pošts
[
p
].
u
 = 
Ã¬poštUVT
.
	`x
();

1647 
pošts
[
p
].
v
 = 
Ã¬poštUVT
.
	`y
();

1648 
pošts
[
p
].
t
 = 
Ã¬poštUVT
.
	`z
();

1649 
pošts
[
p
].
x
 = 
Ã¬poštXYZ
.
	`x
();

1650 
pošts
[
p
].
y
 = 
Ã¬poštXYZ
.
	`y
();

1651 
pošts
[
p
].
z
 = 
Ã¬poštXYZ
.
	`z
();

1655 
´ojeùiÚCouÁ
[
pošts
[
p
].
m
]++;

1658 if(
§veInWÜldCoÜdš©es
)

1659 
rg‘Image
->
	`mod–ToWÜldCoÜdš©es
(
coÜd
);

1660 
outPošts
 << 
coÜd
.
	`g‘X
(è<< '\t' << coÜd.
	`g‘Y
(è<< '\t' << coÜd.
	`g‘Z
(è<< 
’dl
;

1662 
¡d
::
	`sÜt
Ğ
pošts
.
	`begš
(),…ošts.
	`’d
() );

1663 
pošts
.
	`”a£
Ğ
¡d
::
	`unique
Ğpošts.
	`begš
(),…ošts.
	`’d
() ),…oints.end() );

1666  
m
 = 0; m !ğ
numMod–s
; ++m ) {

1667 
poši¡
[
m
].
	`»size
(
´ojeùiÚCouÁ
[m]);

1668 
´ojeùiÚCouÁ
[
m
] = 0;

1670  
p
 = 0;… !ğ
pošts
.
	`size
(); ++p ) {

1671 
Di¡ªûVeùÜ
& 
dv
 = 
poši¡
[
pošts
[
p
].
m
][
´ojeùiÚCouÁ
[points[p].m]++];

1681 
dv
.
p
.
	`£t
(
pošts
[p].
x
,pošts[p].
y
,pošts[p].
z
);

1682 
dv
.
g¿d
.
	`£t
(0.001,0.000,0.000);

1683 
dv
.
n
.
	`£t
(0.0,0.001,0.0);

1684 
dv
.
m‘hod
 = 1;

1685 
dv
.
di¡
 = 1.0;

1687  
m
 = 0; m !ğ
numMod–s
; ++m ) {

1688 
poši¡
[
m
].
	`»size
(
´ojeùiÚCouÁ
[m]);

1690 
cout
 << 
’dl
;

1692  
m
 = 0; m !ğ
numMod–s
; ++m ) {

1693 
	`¥rštf
(
bufãr
,"%s.li¡",
¤cMod–Names
[
m
]);

1694 
¡d
::
of¡»am
 
	`¶i¡out
(
bufãr
, 
ios
::
out
|ios::
Œunc
);

1695 
¡d
::
	`cİy
(
poši¡
[
m
].
	`begš
(),…oši¡[m].begš(è+ 
´ojeùiÚCouÁ
[m],

1696 
¡d
::
o¡»am_™”©Ü
<
Di¡ªûVeùÜ
>(
¶i¡out
));

1697 
¶i¡out
.
	`şo£
();

1701 
M3DPrim™ive
 *
´im
, *
¤cP
, *
d¡P
;

1702  
¡•_num
 = 1; s‹p_num <ğ
numS‹ps
; ++step_num ) {

1703 
	`¥rštf
(
bufãr
, "csv/D©a%d.csv", 
¡•_num
 );

1704 
¡d
::
of¡»am
 
	`outPošts
(
bufãr
);

1705 ifĞ
outPošts
.
	`bad
() ) {

1706 
û¼
 << "ERROR: Could‚Ù†ßd ouošt f" << 
bufãr
 << ",„—sÚ: " << 
	`¡»¼Ü
(
”ºo
è<< 
’dl
;

1711 
cout
 << "\r" << "S‹°" << 
¡•_num
 << " oà" << 
numS‹ps
;

1712 
cout
.
	`æush
();

1713  
m
 = 0; m !ğ
numMod–s
; ++m ) {

1714 
nSrc
 = 
¤cObjeùs
[
m
]->
	`g‘Prim™iveCouÁ
();

1716  
p
 = 0;… !ğ
nSrc
; ++p ) {

1717 
¤cP
 = 
¤cObjeùs
[
m
]->
	`g‘Prim™ivePŒ
(
p
);

1718 
d¡P
 = 
d¡Objeùs
[
m
]->
	`g‘Prim™ivePŒ
(
p
);

1719 
´im
 = 
¤cP
->
	`cİyPŒ
();

1720 
´im
->
	`©omIÁ”p
((
¡•_num
 - 1.0)/(
numS‹ps
 - 1.0), 
¤cP
, 
d¡P
);

1721 *(
š‹½Objeùs
[
m
]->
	`g‘Prim™ivePŒ
(
p
)èğ*
´im
;

1725 cÚ¡ * 
f’ame
 = 
	`¡¼chr
(
¤cMod–Names
[
m
], '/');

1726 ifĞ
f’ame
 =ğ
NULL
 ) {

1727 
f’ame
 = 
	`¡¼chr
(
¤cMod–Names
[
m
], '\\');

1729 ifĞ
f’ame
 =ğ
NULL
 ) {

1730 
f’ame
 = 
¤cMod–Names
[
m
];

1732 
	`¥rštf
(
bufãr
,"debug/%02d-%s",
¡•_num
, 
f’ame
);

1734 
´ojeùiÚCouÁ
[
m
] = 0;

1736 
xãr
 = 
	`cÚv”tM3DtoXãr
(
š‹½Objeùs
[
m
]->
	`g‘Figu»PŒ
(0));

1737 
d–‘e
 
pLi¡
[
m
];

1738 
pLi¡
[
m
] = 
Ãw
 
Th®lCode
::
	`Poši¡_£rv”2
();

1739 
pLi¡
[
m
]->
	`š™
(
xãr
);

1740 
pLi¡
[
m
]->
	`Compu‹SubdivPoštCloud
(
subdivLev–
);

1741 
d–‘e
[] 
xãr
->
©omli¡
;

1742 
d–‘e
 
xãr
;

1745  
p
 = 0;… !ğ
pošts
.
	`size
(); ++p ) {

1746 if(!
pLi¡
[
pošts
[
p
].
m
]->
	`subdivBpos™iÚ
Ğ&
bp
,…ošts[p].
u
,…ošts[p].
v
,…ošts[p].
t
)) {

1747 
û¼
 << "ERROR: " << 
__FILE__
 << ':' << 
__LINE__
 << "…=" << 
p
 << " m=" << 
m
 << 
’dl


1748 << "uvt=" << 
pošts
[
p
].
u
 << ',' <<…ošts[p].
v
 << ',' <<…ošts[p].
t
 << 
’dl
;

1754 
Di¡ªûVeùÜ
& 
dv
 = 
poši¡
[
pošts
[
p
].
m
][
´ojeùiÚCouÁ
[points[p].m]++];

1755 
dv
.
p
.
	`£t
(
bp
.
²t
[0],bp.pnt[1],bp.pnt[2]);

1756 
dv
.
g¿d
.
	`£t
(0.001,0.000,0.000);

1757 
dv
.
n
.
	`£t
(0.0,0.001,0.0);

1758 
dv
.
m‘hod
 = 1;

1759 
dv
.
di¡
 = 1.0;

1761 if(
§veInWÜldCoÜdš©es
) {

1765 
bp
.
²t
[0] = 
rg‘Image
->
	`mod–XToWÜld
(bp.pnt[0]);

1766 
bp
.
²t
[1] = 
rg‘Image
->
	`mod–YToWÜld
(bp.pnt[1]);

1767 
bp
.
²t
[2] = 
rg‘Image
->
	`mod–ZToWÜld
(bp.pnt[2]);

1769 
outPošts
 << 
bp
.
²t
[0] << ", " << bp.²t[1] << ", " << bp.²t[2] << 
’dl
;

1772  
m
 = 0; m !ğ
numMod–s
; ++m ) {

1773 cÚ¡ * 
f’ame
 = 
	`¡¼chr
(
¤cMod–Names
[
m
], '/');

1774 ifĞ
f’ame
 =ğ
NULL
 ) {

1775 
f’ame
 = 
	`¡¼chr
(
¤cMod–Names
[
m
], '\\');

1777 ifĞ
f’ame
 =ğ
NULL
 ) {

1778 
f’ame
 = 
¤cMod–Names
[
m
];

1780 
	`¥rštf
(
bufãr
,"debug/%02d-%s.li¡",
¡•_num
, 
f’ame
);

1781 
¡d
::
of¡»am
 
	`¶i¡out
(
bufãr
, 
ios
::
out
|ios::
Œunc
);

1782 
¡d
::
	`cİy
(
poši¡
[
m
].
	`begš
(),…oši¡[m].begš(è+ 
´ojeùiÚCouÁ
[m],

1783 
¡d
::
o¡»am_™”©Ü
<
Di¡ªûVeùÜ
>(
¶i¡out
));

1784 
¶i¡out
.
	`şo£
();

1789  
m
 = 0; m !ğ
numMod–s
; ++m ) {

1790 
d–‘e
 
¤cObjeùs
[
m
];

1791 
d–‘e
 
d¡Objeùs
[
m
];

1792 
d–‘e
 
š‹½Objeùs
[
m
];

1793 
d–‘e
 
pLi¡
[
m
];

1796 
	}
}

1799 
boŞ
 
	gP3DCÚŒŞ
::
	$runBš¬yPablo
(
Regi¡ry
 & 
süt
)

1801 
boŞ
 
¡©us
;

1802 cÚ¡ * 
f’ame
;

1803 cÚ¡ * 
mod–F’ame
;

1804 cÚ¡ * 
xfÜmF’ame
;

1805 cÚ¡ * 
pgaF’ame
;

1808 
¡ršg
 
¥okeDi¡FeName
 ;

1812 cÚ¡ * 
videoFŞd”Name
 = 
süt
.
	`g‘SŒšgV®ue
("VideoFŞd”", 
NULL
) ;

1814 ifĞ
videoFŞd”Name
 ) {

1816 
MakeO±imiz©iÚVideo
::
makeVideoOn
 = 1 ;

1817 
MakeO±imiz©iÚVideo
::
videoFŞd”
 = (*è
videoFŞd”Name
 ;

1822 
MakeO±imiz©iÚVideo
::
makeVideoOn
 = 0 ;

1823 
MakeO±imiz©iÚVideo
::
videoFŞd”
 = 
NULL
 ;

1826 
videoFŞd”Name
 = 
NULL
 ;

1830 ià(
glob®V”bos™y
 > -1)

1831 
cout
 << "---- LOADING FILES" << 
’dl
;

1834 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("PgaResidueMod–", 
NULL
);

1835 ià(
f’ame
 !ğ
NULL
) {

1836 
pgaMod–FeName
 = 
Ãw
 [
	`¡¾’
(
f’ame
) + 1];

1837 
	`¡rıy
(
pgaMod–FeName
, 
f’ame
);

1838 ià(
glob®V”bos™y
 > -1)

1839 
cout
 << "PGA m—Àmod–: " << 
pgaMod–FeName
 << '\n';

1843 
pgaF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("PgaMod–", 
NULL
);

1848 
mod–F’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Mod–", 
NULL
);

1849 
xfÜmF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("T¿nsfÜm", 
NULL
);

1851 ià(! 
	`»ad
(
mod–F’ame
, 
çl£
, 
xfÜmF’ame
, 
pgaF’ame
)) {

1852 ià(
glob®V”bos™y
 > -1) {

1853 ià(
mod–F’ame
 =ğ
NULL
)

1854 
cout
 << "Error: No model file specified\n";

1856 
cout
 << "E¼Ü: UÇbËØlßd mod–: " << 
mod–F’ame
 << '\n';

1858  
çl£
;

1861 ià(
glob®V”bos™y
 > -1)

1862 
cout
 << "Lßded mod– " << 
mod–F’ame
 << '\n';

1863 
	`bš¬yPabloLi¡Lªdm¬ks
();

1864 
	`£ËùAÎ
();

1867 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Lªdm¬kMod–", 
NULL
);

1868 ià(
f’ame
 && *filename) {

1870 
¡©us
 = 
	`bš¬yPabloLßdLªdm¬kMod–
(
f’ame
);

1871 ià(! 
¡©us
)

1872  
çl£
;

1876 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Image", 
NULL
);

1878 * 
_imageF’ame
;

1880 ià(
f’ame
 && *filename) {

1881 
_imageF’ame
 = 
	`¡rdup
(
f’ame
);

1882 ià(
glob®V”bos™y
 > -1)

1883 
cout
 << "Lßdšg imag" << 
f’ame
 << 
’dl
;

1885 
¡©us
 = 
	`lßdImage
(
f’ame
, 
çl£
);

1888 ià(
glob®V”bos™y
 > -1)

1889 
cout
 << "E¼Ü: AÀimagfi »quœed fÜ o±imiz©iÚ" << 
’dl
;

1890 
¡©us
 = 
çl£
;

1893 
cout
 << "Imaglßded" << 
’dl
;

1896 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("OutMod–Image", 
NULL
);

1897 ià(
f’ame
 && *filename) {

1898 
	`expÜtToImage
(
f’ame
);

1899  
Œue
;

1902 ià(! 
¡©us
)

1903  
çl£
;

1905 ifĞ
f’ame
 !ğ
NULL
 )

1906 
d–‘e
 [] 
f’ame
 ;

1907 
f’ame
 = 
NULL
 ;

1909 
Image3D
 * 
image
 = 
	`g‘ImagePŒ
();

1910 
©tMask
 = (è
	`tunšgWt
(
A‰¿ùiÚMask
);

1911 
image
->
	`pushImageIsScked
(
©tMask
 != 0xFFFF,‡ttMask);

1922 ià(((è
	`tunšgWt
(
BpDDMEÇbË
) != 3))

1924 * 
d—Îoÿ‹_f’ame
 = 
NULL
;

1927 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Di¡ªûM­", 
NULL
);

1929 ià(! 
f’ame
) {

1930 ifĞ(
boŞ
è
	`tunšgWt
(
BpDDMAÁŸlŸ£d
) ) {

1932 
d—Îoÿ‹_f’ame
 = 
	`ÿlcAÁŸlŸ£dDMF’ame
Ğ
_imageF’ame
 ) ;

1936 
d—Îoÿ‹_f’ame
 = 
	`ÿlcDDMF’ame
(
_imageF’ame
, 
©tMask
);

1939 
f’ame
 = 
d—Îoÿ‹_f’ame
;

1941 ià(
glob®V”bos™y
 > -1)

1942 
cout
 << "Di¡ªû m­ image: " << 
f’ame
 << 
’dl
;

1949 ifĞ
_imageF’ame
 )

1951 
	`ä“
(
_imageF’ame
);

1952 
_imageF’ame
 = 
NULL
;

1957 
	#SIGNED_RAW3


	)

1958 #ifdeà
SIGNED_RAW3


1961 ià(((è
	`tunšgWt
(
BpIgnÜeDi¡Fe
è=ğ1è|| ( ! 
	`lßdDi¡M­
(
f’ame
) ) ) {

1963 
cout
 << "WARNING: fignÜed; sigÃd di¡ªû m­ fe ¬nÙ suµÜ‹d iÀthi v”siÚ" << 
’dl
;

1965 
	`di¡M­
(
f’ame
);

1967 
cout
 << "Lßded di¡ªû m­ " << 
f’ame
 << 
’dl
 ;

1970 ifĞ
d—Îoÿ‹_f’ame
 )

1971 
d–‘e
[] 
d—Îoÿ‹_f’ame
;

1972 
d—Îoÿ‹_f’ame
 = 
NULL
 ;

1974 
f’ame
 = 
NULL
 ;

1978 
cout
 << "Di¡ªû M­ di§bËd by DDMEÇbË" << 
’dl
;

1980 
	#DEBUG_DIBYENDU_DIST_MAP


	)

1981 #ifdeà
DEBUG_DIBYENDU_DIST_MAP


1983 
ImageDi¡ªûM­
 * 
dÚÙD–‘eDM­
 = 
NULL
 ;

1985 cÚ¡ * 
m­Size
 = 
NULL
 ;

1987 ifĞ
m©ch
 && m©ch->
	`g‘ImageDi¡M­Poš‹r
() ) {

1988 
m­Size
 = 
m©ch
->
	`g‘ImageDi¡M­Poš‹r
()->
	`g‘M­Size
() ;

1989 
dÚÙD–‘eDM­
 = 
m©ch
->
	`g‘ImageDi¡M­Poš‹r
() ;

1991 ifĞ
di¡_m­
 ) {

1992 
m­Size
 = 
di¡_m­
->
	`g‘M­Size
() ;

1993 
dÚÙD–‘eDM­
 = 
di¡_m­
 ;

1996 
cout
 << "NULL Imagdi¡ªû m­…oš‹¸!" << 
’dl
 ;

1998 ifĞ
m­Size
 && 
dÚÙD–‘eDM­
 ) {

2000 cÚ¡ * 
debugF’ame
 = "../../bin/test_dist_map.txt" ;

2002 
¡d
::
of¡»am
 
f
 ;

2003 
f
.
	`İ’
Ğ(cÚ¡ *è
debugF’ame
, 
ios
::
Œunc
);

2005 ifĞ
f
 ) {

2006 
f
 << 
	`£tiosæags
(
ios
::
fixed
) ;

2007 
cout
 << 
debugF’ame
 << " ha b“Àİ’ed fÜ wr™šg di¡ªû m­" << 
’dl
 ;

2009 
f
 << 
	`£tw
(12è<< 
	`£»cisiÚ
(8è<< 
m­Size
[0] << " " << m­Size[1] << " " << m­Size[2] << 
’dl
 ;

2011  
k
 = 0 ; k < 
m­Size
[2] ; k++ ) {

2012  
i
 = 0 ; i < 
m­Size
[0] ; i++ ) {

2013  
j
 = 0 ; j < 
m­Size
[1] ; j++ )

2014 
f
 << 
	`£tw
(12è<< 
	`£»cisiÚ
(8è<< 
dÚÙD–‘eDM­
->
	`g‘Di¡ªû
(
i
, 
j
, 
k
) ;

2016 
f
 << 
’dl
 ;

2018 
f
 << 
’dl
 ;

2021 
f
.
	`şo£
() ;

2027 
	`¤ªd
((è
	`tunšgWt
(
O±imiz”RªdomS“d
));

2034 ià(
glob®V”bos™y
 > -1)

2035 
cout
 << "---- INITIALIZATION STAGE" << 
’dl
;

2037 
GLOBALMOMT¿nsfÜm
 = 
M©chUt™y
::
	`š™ŸlizeObjeùToImage
(
objeù
, 
	`g‘ImagePŒ
(),

2038 (è
	`tunšgWt
(
BpDoM‘hodOfMom’ts
), 
glob®V”bos™y
);

2041 cÚ¡ * 
outSimT¿nsMod–Fe
 = 
süt
.
	`g‘SŒšgV®ue
("OutSimT¿nsMod–", 
NULL
);

2043 ià(
outSimT¿nsMod–Fe
 && *outSimTransModelFile) {

2044 
cout
 << "Wr™šg sim¬™y¿nsfÜmØ" << 
outSimT¿nsMod–Fe
 << 
’dl
;

2045 
GLOBALMOMT¿nsfÜm
.
	`wr™eSim¬™y
(
outSimT¿nsMod–Fe
, 
çl£
);

2048 ifĞ
MakeO±imiz©iÚVideo
::
makeVideoOn
 )

2049 
MakeO±imiz©iÚVideo
::
	`wr™eCu¼’tMod–
Ğ
objeù
 ) ;

2059 
d©iÚFaùÜInMod–Un™s
 = 0;

2060 ià(
	`tunšgWt
(
BpD©iÚFaùÜ
) != 0) {

2061 
imageToMod–SÿË
 = 1.0 / 
	`g‘Di¡M­PŒ
()->
	`g‘Mod–ToImageSÿË
()[0];

2062 
d©iÚFaùÜInMod–Un™s
 = 
	`tunšgWt
(
BpD©iÚFaùÜ
è* 
imageToMod–SÿË
;

2063 
	`g‘ObjeùPŒ
()->
	`d©e
(
d©iÚFaùÜInMod–Un™s
);

2067 ià((
	`tunšgWt
(
BpSubdivide
)) != 0) {

2068 
cout
 << "Subdividšg mod– " << (
	`tunšgWt
(
BpSubdivide
)è<< "imes" << 
’dl
;

2069  
i
 = 0; i < (
	`tunšgWt
(
BpSubdivide
)); ++i) {

2070 
	`g‘ObjeùPŒ
()->
	`subdivide
();

2071 
	`g‘ObjeùPŒ
()->
	`lßdedObjeù
()->
	`subdivide
();

2076 ià(
glob®V”bos™y
 > -1)

2077 
cout
 << "---- FIGURE STAGE" << 
’dl
;

2121 
boŞ
 
wšdowIÁ’s
 = 
süt
.
	`g‘BoŞ—nV®ue
("WšdowIÁ’s™›s", 
çl£
);

2122 ià(
glob®V”bos™y
 > 0 && ! 
wšdowIÁ’s
)

2123 
cout
 << "Intensities will be windowed in optimization\n";

2125 
	`£tO±imiz”IÁ’s™yWšdowšg
(
wšdowIÁ’s
);

2127 
	`bš¬yPabloNextO±imiz©iÚSge
((è
	`tunšgWt
(
BpFigu»SurçûLev–
));

2132 ià(
	`tunšgWt
(
BpFigu»Re£tMod–BefÜe
) == 1.0) {

2133 
M3DFigu»
 *
fig
 = 
objeù
->
	`g‘Figu»PŒ
((è
	`tunšgWt
(
BpFigu»Id
));

2135 #ifdeà
UNFLIPPED


2136 
VeùÜ3D
 
cog
 = 
fig
->
	`g‘COG
();

2137 
cog
.
	`£tY
(1.0 - cog.
	`g‘Y
());

2138 
fig
->
	`­¶ySim¬™y
(
GLOBALMOMT¿nsfÜm
, 
cog
);

2140 
fig
->
	`­¶ySim¬™yAboutCOG
(&
GLOBALMOMT¿nsfÜm
);

2144 
M3DObjeù
 * 
lobj
 = 
objeù
->
	`lßdedObjeù
();

2145 
fig
 = 
lobj
->
	`g‘Figu»PŒ
((è
	`tunšgWt
(
BpFigu»Id
));

2146 #ifdeà
UNFLIPPED


2147 
cog
 = 
fig
->
	`g‘COG
();

2148 
cog
.
	`£tY
(1.0 - cog.
	`g‘Y
());

2149 
fig
->
	`­¶ySim¬™y
(
GLOBALMOMT¿nsfÜm
, 
cog
);

2151 
fig
->
	`­¶ySim¬™yAboutCOG
(&
GLOBALMOMT¿nsfÜm
);

2154 
GLOBALMOMT¿nsfÜm
.
	`£tToId’t™y
();

2156 ià(
glob®V”bos™y
 >= 0) {

2157 ià(
	`tunšgWt
(
BpFigu»Re£tMod–BefÜe
) == 1.0)

2158 
cout
 << "Re£ˆ»ã»nû mod– vŸ MOM¿nsfÜm" << 
’dl
;

2160 
cout
 << "Did‚Ù„e£ˆ»ã»nû mod– vŸ MOM¿nsfÜm" << 
’dl
;

2163 
M3DQuadFigu»
 * 
qFigThis
 = 
dyÇmic_ÿ¡
 <M3DQuadFigu» *>(
objeù
->
	`g‘Figu»PŒ
(0)) ;

2165 * 
sR•VeùÜ
 = 
qFigThis
->
	`veùÜize
() ;

2167 
numAtoms
 = 
qFigThis
->
	`g‘Prim™iveCouÁ
() ;

2171 * 
pos™iÚs
 = 
Ãw
 [ 3*
numAtoms
 ] ;

2172  
i
 = 0 ; i < 3*
numAtoms
 ; i++ )

2173 
pos™iÚs
[
i
] = 0.0 ;

2175  
i
 = 0 ; i < 
numAtoms
 ; i++ ) {

2176 
pos™iÚs
[ 3*
i
 + 0 ] = 
sR•VeùÜ
[ 3*i + 0 ] ;

2177 
pos™iÚs
[ 3*
i
 + 1 ] = 
sR•VeùÜ
[ 3*i + 1 ] ;

2178 
pos™iÚs
[ 3*
i
 + 2 ] = 
sR•VeùÜ
[ 3*i + 2 ] ;

2181 ifĞ
sR•VeùÜ
 !ğ
NULL
 )

2182 
d–‘e
 [] 
sR•VeùÜ
 ;

2183 
sR•VeùÜ
 = 
NULL
 ;

2185 
m—nX
 = 0.0, 
m—nY
 =0.0 , 
m—nZ
 =0.0 ;

2187  
i
 = 0 ; i < 
numAtoms
 ; i++ ) {

2188 
m—nX
 +ğ
pos™iÚs
[ 3*
i
 + 0 ] ;

2189 
m—nY
 +ğ
pos™iÚs
[ 3*
i
 + 1 ] ;

2190 
m—nZ
 +ğ
pos™iÚs
[ 3*
i
 + 2 ] ;

2193 
m—nX
 /ğ
numAtoms
 ;

2194 
m—nY
 /ğ
numAtoms
 ;

2195 
m—nZ
 /ğ
numAtoms
 ;

2197 *
ÃwM—n
 = 
Ãw
 [3];

2198 
ÃwM—n
[0] = 
m—nX
;

2199 
ÃwM—n
[1] = 
m—nY
;

2200 
ÃwM—n
[2] = 
m—nZ
;

2204 
i
 = 0; i < 
numAtoms
; i++)

2206 
pos™iÚs
[3*
i
 + 0] -ğ
ÃwM—n
[0];

2207 
pos™iÚs
[3*
i
 + 1] -ğ
ÃwM—n
[1];

2208 
pos™iÚs
[3*
i
 + 2] -ğ
ÃwM—n
[2];

2212 
ÃwSÿËSh­e
 = 0.0;

2214 
i
 = 0; i < 3*
numAtoms
; i++)

2215 
ÃwSÿËSh­e
 +ğ
pos™iÚs
[
i
] *…ositions[i];

2217 
ÃwSÿËSh­e
 = 
	`sq¹
(newScaleShape);

2225 
boŞ
 
have_PGA
 = 
	`havePGA
();

2226 
ınsSts
 = 
objeù
->
	`g‘CPNSSts
();

2227 
boŞ
 
have_CPNS
 = (
ınsSts
 !ğ
NULL
);

2228 
boŞ
 
wªtPGA
 = (
	`tunšgWt
(
Figu»Mah®ªobisM©ch
) != 0);

2230 ià(
wªtPGA
 && !
have_PGA
 && !
have_CPNS
) {

2231 
cout
 << "E¼Ü: PGA/CPNS m©ch weighˆ£ˆ(" << 
	`tunšg
(
Figu»Mah®ªobisM©ch
).
lÚgName


2232 << "=" << 
	`tunšgWt
(
Figu»Mah®ªobisM©ch
)

2233 << "èbuˆPGA/CPNS missšg from mod– " << 
mod–F’ame
 << 
’dl
;

2234  
çl£
;

2236 ià(! 
wªtPGA
 && 
have_PGA
) {

2237 
cout
 << "Warning: model contains PGA stat's but‚otƒnabled with " <<

2238 
	`tunšg
(
Figu»Mah®ªobisM©ch
).
lÚgName
 << 
’dl
;

2241 
	#DEBUG_DIBYENDU_WRITE_DIST


	)

2243 #ifdeà
DEBUG_DIBYENDU_WRITE_DIST


2248 ifĞ
mod–F’ame
 !ğ
NULL
 ) {

2250 
¥okeDi¡FeName
 = 
	`¡ršg
Ğ
mod–F’ame
 ) + ".dist.txt" ;

2252 
this
->
	`wr™eDi¡ªûsAtSpokeEnds
Ğ(cÚ¡ *è
¥okeDi¡FeName
.
	`c_¡r
() ) ;

2258 ià(
	`tunšgWt
(
Figu»I‹¿tiÚs
) > 0)

2262 cÚ¡ * 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("CÚtour", 
NULL
);

2263 ià(
f’ame
) {

2264 ià(! 
m©ch
->
	`š™CÚtourM©ch
(
f’ame
))

2265 
cout
 <<

2267 << 
’dl
;

2269 
cout
 << "Usšg cÚtou¸f" << 
f’ame
 << 
’dl
;

2272 ià(
	`tunšgWt
(
Figu»CÚtourM©ch
) != 0.0) {

2273 
cout
 << "Error: A contour file must be specifiedo use contour matching"

2274 << 
’dl
;

2275  
çl£
;

2279 
	`bš¬yPabloFigu»Sge
((è
	`tunšgWt
(
Figu»I‹¿tiÚs
),

2280 (è
	`tunšgWt
(
BpFigu»DoSÿË
), 
mod–F’ame
);

2283 ià(
outSimT¿nsMod–Fe
 && *outSimTransModelFile) {

2284 
cout
 << "Wr™šg sim¬™y¿nsfÜmØ" << 
outSimT¿nsMod–Fe
 << 
’dl
;

2285 
GLOBALMOMT¿nsfÜm
.
	`wr™eSim¬™y
(
outSimT¿nsMod–Fe
, 
çl£
);

2290 ià(
glob®V”bos™y
 > -1)

2291 
cout
 << "---- ATOM STAGE" << 
’dl
;

2293 
	`bš¬yPabloNextO±imiz©iÚSge
((è
	`tunšgWt
(
BpAtomSurçûLev–
));

2294 ià(
	`tunšgWt
(
BpAtomRe£tMod–BefÜe
) == 1.0) {

2301 
M3DObjeù
 * 
lobj
 = 
objeù
->
	`lßdedObjeù
();

2302 *
lobj
 = *
objeù
;

2304 ià(
glob®V”bos™y
 >= 0) {

2305 ià(
	`tunšgWt
(
BpAtomRe£tMod–BefÜe
) == 1.0)

2306 
cout
 << "Re£ˆ»ã»nû mod–" << 
’dl
;

2308 
cout
 << "Did NOT„e£ˆ»ã»nû mod–" << 
’dl
;

2311 
n
 = (è
	`tunšgWt
(
AtomI‹¿tiÚs
);

2312 ià(
n
 < 0)

2313 
n
 = 
MAX_OPTIMIZER_ITERATIONS
;

2314 ià(
n
 != 0)

2315 
	`bš¬yPabloAtomSge
((è
	`tunšgWt
(
AtomI‹¿tiÚs
));

2322 ià(
glob®V”bos™y
 > -1)

2323 
cout
 << "---- SREP STAGE" << 
’dl
;

2325 
	`bš¬yPabloNextO±imiz©iÚSge
((è
	`tunšgWt
(
BpSR•SurçûLev–
));

2326 ià(
	`tunšgWt
(
BpSR•Re£tMod–BefÜe
) == 1.0) {

2333 
M3DObjeù
 * 
lobj
 = 
objeù
->
	`lßdedObjeù
();

2334 *
lobj
 = *
objeù
;

2336 ià(
glob®V”bos™y
 >= 0) {

2337 ià(
	`tunšgWt
(
BpSR•Re£tMod–BefÜe
) == 1.0)

2338 
cout
 << "Re£ˆ»ã»nû mod–" << 
’dl
;

2340 
cout
 << "Did NOT„e£ˆ»ã»nû mod–" << 
’dl
;

2343 
¡d
::
cout
 << "nÜm: " << (è
	`tunšgWt
(
SR•DoNÜm®Adju¡m’ts
è<< std::
’dl
;

2345 ià((è
	`tunšgWt
(
SR•DoNÜm®Adju¡m’ts
) == 1)

2346 
	`bš¬yPabloSR•NÜm®Adju¡m’ts
();

2348 
nS
 = (è
	`tunšgWt
(
SR•I‹¿tiÚs
);

2349 ià(
nS
 < 0)

2350 
n
 = 
MAX_OPTIMIZER_ITERATIONS
;

2351 ià(
nS
 != 0)

2352 
	`bš¬yPabloSR•Sge
((è
	`tunšgWt
(
SR•I‹¿tiÚs
));

2359 ià(
glob®V”bos™y
 > -1)

2360 
cout
 << "---- SPOKE STAGE" << 
’dl
;

2362 
	`bš¬yPabloNextO±imiz©iÚSge
((è
	`tunšgWt
(
BpSpokeSurçûLev–
));

2363 ià(
	`tunšgWt
(
BpSpokeRe£tMod–BefÜe
) == 1.0) {

2370 
M3DObjeù
 * 
lobj
 = 
objeù
->
	`lßdedObjeù
();

2371 *
lobj
 = *
objeù
;

2373 ià(
glob®V”bos™y
 >= 0) {

2374 ià(
	`tunšgWt
(
BpSpokeRe£tMod–BefÜe
) == 1.0)

2375 
cout
 << "Re£ˆ»ã»nû mod–" << 
’dl
;

2377 
cout
 << "Did NOT„e£ˆ»ã»nû mod–" << 
’dl
;

2380 
n
 = (è
	`tunšgWt
(
SpokeI‹¿tiÚs
);

2381 ià(
n
 < 0)

2382 
n
 = 
MAX_OPTIMIZER_ITERATIONS
;

2383 ià(
n
 != 0)

2384 
	`bš¬yPabloSpokeSge
((è
	`tunšgWt
(
SpokeI‹¿tiÚs
));

2386 #iâdeà
OPTIMIZATION_VISUALIZER


2387 
	`ÿnûlO±imiz©iÚ
();

2393 ià(
	`tunšgWt
(
BpD©iÚFaùÜ
) != 0)

2394 
	`g‘ObjeùPŒ
()->
	`”ode
(
d©iÚFaùÜInMod–Un™s
);

2398 ià(
glob®V”bos™y
 > -1)

2399 
cout
 << "---- SAVE" << 
’dl
;

2401 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("OutMod–", 
NULL
);

2402 ià(
f’ame
 && *filename) {

2403 #ifdeà
INTEGRATE_WHEN_OBJ_HISTORY_STRING_DONE


2406 ià((è
	`tunšgWt
(
BP_TUNE_MRENAME
) == 1)

2407 
	`»ÇmeObjeùAndFigu»
(
objeù
, 
f’ame
);

2410 ià(
glob®V”bos™y
 > -1)

2411 
cout
 << "Wr™šg mod–Ø" << 
f’ame
 << 
’dl
;

2412 
	`wr™e
(
f’ame
);

2414 #ifdeà
DEBUG_DIBYENDU_WRITE_DIST


2419 ifĞ
f’ame
 !ğ
NULL
 ) {

2421 
¥okeDi¡FeName
 = 
	`¡ršg
Ğ
f’ame
 ) + ".dist.txt" ;

2423 
this
->
	`wr™eDi¡ªûsAtSpokeEnds
Ğ(cÚ¡ *è
¥okeDi¡FeName
.
	`c_¡r
() ) ;

2429 ià(
	`tunšgWt
(
SaveDi¡ªûVeùÜs
) != 0) {

2431 * 
dvec_âame
 = 
Ãw
 [
	`¡¾’
(
f’ame
) + strlen(".list") + 1];

2432 
	`¥rštf
(
dvec_âame
,"%s.li¡",
f’ame
);

2434 ià(
m©ch
 !ğ
NULL
) {

2435 
Di¡ªûVeùÜLi¡
 * 
dvli¡
 = 
m©ch
->
	`g‘Di¡ªûVeùÜLi¡
();

2436 ià(
glob®V”bos™y
 > -1)

2437 
cout
 << "Wr™šg di¡ªû veùÜ tØ" << 
dvec_âame
 << 
’dl
;

2438 
¡d
::
of¡»am
 
	`outf
(
dvec_âame
, 
ios
::
out
|ios::
Œunc
);

2439 
¡d
::
	`cİy
(
dvli¡
->
¶i¡
.
	`begš
(), dvli¡->¶i¡.
	`’d
(),

2440 
o¡»am_™”©Ü
<
Di¡ªûVeùÜ
>(
outf
));

2441 
outf
.
	`şo£
();

2443 
d–‘e
 [] 
dvec_âame
;

2447 ià(
glob®V”bos™y
 > -1)

2448 
cout
 << "OutMod– f’amundefšed. Mod–‚Ù saved." << 
’dl
;

2451 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("OutTe", 
NULL
);

2452 ià(
f’ame
 && *filename)

2453 
	`expÜtToBYUTes
(
f’ame
, (
	`tunšgWt
(
TeQuads
) == 1.0),

2454 (
	`tunšgWt
(
TeUn™
) == 0.0),

2455 (è
	`tunšgWt
(
TeSurçûLev–
));

2457 ià(
glob®V”bos™y
 > -1)

2458 
cout
 << "OutTf’amundefšed. Te nÙ saved." << 
’dl
;

2464 
cout
 << "Prštšghov”®Èf™tšg infÜm©iÚ:" << 
’dl
;

2467 
M3DObjeù
 * 
lobj
 = 
objeù
->
	`lßdedObjeù
();

2468 *
lobj
 = *
objeù
;

2469 
M3DFigu»
 * 
fig
 = 
lobj
->
	`g‘Figu»PŒ
(0);

2473 
m©ch
->
	`£tUpAtomP»diùÜ
(0);

2477 
numOfAtoms
 = 
fig
->
	`g‘Prim™iveCouÁ
();

2478 
³ÇÉy
 = 0.0;

2481 
sumP’®ty
 = 0.0;

2482 
i
 = 0; i < 
numOfAtoms
; i++) {

2483 
CompÚ’ts
 
p
 = 
m©ch
->
	`compu‹AtomM©chAndP’®t›sAsCompÚ’ts
(
lobj
 , 0, 
i
, 
NULL
, 
³ÇÉy
);

2484 
cout
 << 
p
.
rough
 << 
’dl
;

2485 
sumP’®ty
 +ğ
p
.
rough
;

2488 
cout
 << "Sum oàthobjeùivfunùiÚ v®ue: " << 
sumP’®ty
 << 
’dl
;

2492 ià(
	`tunšgWt
(
Figu»I‹¿tiÚs
) > 0) {

2493 
cout
 << "Figu» sgİtimiz©iÚ wa ³rfÜmed." << 
’dl
;

2496 
cout
 << "NØfigu» sge." << 
’dl
;

2500  
Œue
;

2501 
	}
}

2515 
boŞ
 
	gP3DCÚŒŞ
::
	$runPablo
(
Regi¡ry
 & 
süt
)

2517 cÚ¡ * 
f’ame
;

2518 cÚ¡ * 
outF’ame
;

2519 cÚ¡ * 
xfÜmF’ame
;

2520 cÚ¡ * 
pgaF’ame
;

2523 ià(
süt
.
	`g‘DoubËV®ue
("FigureGeometryWeight", -1.0) > 0.0 &&

2524 
süt
.
	`g‘DoubËV®ue
("FigureMahalanobisMatch", -1.0) > 0.0)

2526 
cout
 << "Mah®ªobi ªd D/R…’®t› ÿÂÙ bÙh bu£d" << 
’dl
;

2527  
çl£
;

2531 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("PgaResidueMod–", 
NULL
);

2532 ià(
f’ame
 !ğ
NULL
) {

2533 
pgaMod–FeName
 = 
Ãw
 [
	`¡¾’
(
f’ame
) + 1];

2534 
	`¡rıy
(
pgaMod–FeName
, 
f’ame
);

2535 ià(
glob®V”bos™y
 > -1)

2536 
cout
 << "Usšg PGA m—Àmod– " << 
pgaMod–FeName
 << '\n';

2540 
pgaF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("PgaMod–", 
NULL
);

2541 ià(
pgaF’ame
 !ğ
NULL
) {

2542 ià(
glob®V”bos™y
 > -1)

2543 
cout
 << "PGA statistics will beaken from model "

2544 << 
pgaF’ame
 << "\n";

2551 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Mod–", 
NULL
);

2552 
xfÜmF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("T¿nsfÜm", 
NULL
);

2554 ià(! 
	`»ad
(
f’ame
, 
çl£
, 
xfÜmF’ame
, 
pgaF’ame
)) {

2555 ià(
f’ame
 =ğ
NULL
) {

2556 #ifdeà
AE2_BUILD


2557 ià(0 !ğ(è
süt
.
	`g‘DoubËV®ue
("LoadedModel", 0.0))

2558 
cout
 << "Usšg†ßded mod–" << 
’dl
;

2562 ià(
glob®V”bos™y
 > -1)

2563 
cout
 << "Error: No model file specified\n";

2564  
çl£
;

2568 ià(
glob®V”bos™y
 > -1) {

2569 
cout
 << "E¼Ü: UÇbËØlßd " << 
f’ame
;

2570 ià(
pgaF’ame
 !ğ
NULL
)

2571 
cout
 << " o¸" << 
pgaF’ame
;

2572 
cout
 << '\n';

2574  
çl£
;

2578 ià(
glob®V”bos™y
 > -1)

2579 
cout
 << "Lßded mod– " << 
f’ame
 << '\n';

2582 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Image", 
NULL
);

2583 ià(
f’ame
) {

2584 ià(! 
	`lßdImage
(
f’ame
, 
çl£
)) {

2585 ià(
glob®V”bos™y
 > -1) {

2586 ià(
f’ame
)

2587 
cout
 << "E¼Ü: UÇbËØlßd imag" << 
f’ame
 << '\n';

2589 
cout
 << "Error: An image file is„equired for optimization\n";

2591  
çl£
;

2594 ià(
glob®V”bos™y
 > -1) {

2595 
cout
 << "Loaded";

2598 
cout
 << " imag" << 
f’ame
 << '\n';

2603 #ifdeà
AE2_BUILD


2604 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("LßdedImage", 
NULL
);

2605 ià(
f’ame
)

2606 
cout
 << "Usšg imag" << 
f’ame
 << '\n';

2609 
cout
 << "Cannot optimize without‡n input image\n";

2612 ià(
süt
.
	`g‘BoŞ—nV®ue
("CmdHi¡T¿ššg", 
çl£
)) {

2613 
	`doCommªdHi¡og¿mT¿ššg
(
süt
);

2614  
Œue
;

2617 ià(
süt
.
	`g‘BoŞ—nV®ue
("CmdMuÉiP©chT¿ššg", 
çl£
)) {

2618 
	`doCommªdMuÉiP©chT¿ššg
(
süt
);

2619  
Œue
;

2622 ià(
süt
.
	`g‘BoŞ—nV®ue
("CmdDQFT¿ššg", 
çl£
)) {

2623 
	`doCommªdDi¡ªûQuªteFunùiÚs
(
süt
);

2624  
Œue
;

2627 ià(
süt
.
	`g‘BoŞ—nV®ue
("CmdDQFImageMak”", 
çl£
)) {

2628 
	`doCommªdDi¡ªûQuªteFunùiÚImageMak”
(
süt
);

2629  
Œue
;

2632 ià(
süt
.
	`g‘BoŞ—nV®ue
("CmdDQFMod–Mak”", 
çl£
)) {

2633 
	`doCommªdDi¡ªûQuªteFunùiÚMod–Mak”
(
süt
);

2634  
Œue
;

2640 
outF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("OutMod–", 
NULL
);

2641 ià(
outF’ame
 =ğ
NULL
) {

2642 
cout
 << "Optimizing via script„equires‡n output model filename\n";

2643  
çl£
;

2646 
ºs
 = 
süt
.
	`g‘IÁV®ue
("OptimizerRandomSeed", -1);

2647 ià(
ºs
 >= 0) {

2649 
	`¤ªd
(
ºs
);

2650 ià(
glob®V”bos™y
 > -1)

2651 
cout
 << "S‘„ªdom‚umb” s“dØ" << 
ºs
 << '\n';

2654 
boŞ
 
wšdowIÁ’s
 = 
süt
.
	`g‘BoŞ—nV®ue
("WšdowIÁ’s™›s", 
Œue
);

2655 ià(
glob®V”bos™y
 > 0 && ! 
wšdowIÁ’s
)

2656 
cout
 << "Intensities will‚ot be windowed in optimization\n";

2657 
	`£tO±imiz”IÁ’s™yWšdowšg
(
wšdowIÁ’s
);

2659 ià(! 
	`š™ŸlizeO±imiz”
(
süt
))

2660  
çl£
;

2664 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("CÚtour", 
NULL
);

2665 ià(
f’ame
) {

2666 ià(! 
m©ch
->
	`š™CÚtourM©ch
(
f’ame
))

2667 
cout
 <<

2669 << 
’dl
;

2671 
cout
 << "Usšg cÚtou¸f" << 
f’ame
 << 
’dl
;

2674 ià(
	`tunšgWt
(
Figu»CÚtourM©ch
) != 0.0) {

2675 
cout
 << "Error: A contour file must be specifiedo use contour matching"

2676 << 
’dl
;

2677  
çl£
;

2681 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_SETUP_STAGE
;

2682 
cu¼’tO±imiz”Sge
 !ğ
OPTIMIZER_END_STAGE
) {

2683 
O±imiz”Sge
 
¡age
 = 
	`ÃxtO±imiz”Sge
();

2684 
¡age
) {

2685 
OPTIMIZER_ENSEMBLE_STAGE
:

2686 ià(
glob®V”bos™y
 > -1)

2687 
cout
 << "---- En£mbË Sg----" << 
’dl
;

2688 
	`mod–Sge
(
Œue
, 
süt
);

2691 
OPTIMIZER_OBJECT_STAGE
:

2692 ià(
glob®V”bos™y
 > -1)

2693 
cout
 << "---- Objeù Sg----" << 
’dl
;

2694 
	`mod–Sge
(
çl£
, 
süt
);

2697 
OPTIMIZER_FIGURE_STAGE
:

2698 ià(
glob®V”bos™y
 > -1)

2699 
cout
 << "---- Figu» Sg----" << 
’dl
;

2700 
	`figu»Sge
(
çl£
, 
süt
);

2703 
OPTIMIZER_MAIN_FIGURE_STAGE
:

2704 ià(
glob®V”bos™y
 > -1)

2705 
cout
 << "---- Maš Figu» Sg----" << 
’dl
;

2706 
	`figu»Sge
(
Œue
, 
süt
);

2709 
OPTIMIZER_SUBFIGURE_STAGE
:

2710 ià(
glob®V”bos™y
 > -1)

2711 
cout
 << "---- Subfigu» Sg----" << 
’dl
;

2712 
	`subfigu»Sge
(
süt
);

2715 
OPTIMIZER_PRIMITIVE_STAGE
:

2716 ià(
glob®V”bos™y
 > -1)

2717 
cout
 << "---- Atom Sg----" << 
’dl
;

2718 
	`©omSge
(
süt
);

2721 
OPTIMIZER_SPOKE_STAGE
:

2722 ià(
glob®V”bos™y
 > -1)

2723 
cout
 << "---- SpokSg----" << 
’dl
;

2724 
	`¥okeSge
(
süt
);

2727 
OPTIMIZER_BOUNDARY_DISPLACEMENT_STAGE
:

2728 ià(
glob®V”bos™y
 > -1)

2729 
cout
 << "---- Bound¬y Di¥Ïûm’ˆSg----" << 
’dl
;

2730 
	`vox–Sge
(
süt
);

2733 
OPTIMIZER_END_STAGE
:

2734 ià(
upd©eGuiSge
 !ğ
NULL
)

2735 
	`upd©eGuiSge
(
OPTIMIZER_END_STAGE
);

2738 ià(
glob®V”bos™y
 > -1) {

2739 ià(
¡age
 =ğ
OPTIMIZER_END_STAGE
)

2740 
cout
 << "Optimization completed\n";

2742 
cout
 << "Stage completed\n";

2746 
boŞ
 
»t
 = 
Œue
;

2747 ià(! 
	`wr™e
(
outF’ame
)) {

2748 
cout
 << "Error:‚o output model was written\n";

2749 
»t
 = 
çl£
;

2752 
cout
 << "Saved mod– " << 
outF’ame
 << 
’dl
;

2755 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("OutTe", 
NULL
);

2756 ià(
f’ame
 && *filename)

2757 
	`expÜtToBYUTes
(
f’ame
, (
	`tunšgWt
(
TeQuads
) == 1.0),

2758 (
	`tunšgWt
(
TeUn™
) == 0.0),

2759 (è
	`tunšgWt
(
TeSurçûLev–
),

2760 (è
	`tunšgWt
(
TeFigu»sMask
),

2761 (
boŞ
è(
	`tunšgWt
(
TeS•¬©eFes
) != 0.0));

2763 #ifdeà
CLUELESS


2765 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("OutSimT¿nsMod–", 
NULL
);

2766 ià(
f’ame
 && *filename)

2776  
»t
;

2777 
	}
}

2779 
boŞ
 
	gP3DCÚŒŞ
::
	$š™ŸlizeO±imiz”
(
Regi¡ry
 & 
süt
)

2781 cÚ¡ * 
f’ame
;

2782 
boŞ
 
»t
;

2784 
surçûLev–
 = 
süt
.
	`g‘IÁV®ue
("SurfaceLevel", 2);

2786 ià(
glob®V”bos™y
 > 0)

2787 
cout
 << "Surçû†ev– = " << 
surçûLev–
 << 
’dl
;

2788 ià(
objeù
 =ğ
NULL
) {

2790 
cout
 << "No object!\n";

2791  
çl£
;

2793 ià(! 
objeù
->
	`v”ifyInBounds
())

2794 
cout
 << "W¬nšg:hmod– i Ïrg”hª o¸outsidthun™ cube" << 
’dl
;

2796 
m‘hod
 = 
süt
.
	`g‘IÁV®ue
("OptimizerMatchMethod", -1);

2799 cÚ¡ * 
dqfCÚfigF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("DqfCÚfig", 
NULL
);

2801 
Regi¡ry
 
dqfReg
;

2802 
boŞ
 
didDQF
 = 
çl£
;

2804 if(
dqfCÚfigF’ame
 !ğ
NULL
) {

2805 
boŞ
 
»gE¼Ü
 = 
çl£
;

2808 
Œy
 {

2809 
dqfReg
.
	`»adFromFe
(
dqfCÚfigF’ame
);

2811 
	`ÿtch
 (
RExû±iÚ
 
exı
) {

2812 
exı
.
	`´št
(
¡d
::
cout
);

2813 
cout
 << "ERR: süˆf" << 
dqfCÚfigF’ame
 << "‚ot found (failedo†oad).\n";

2814 
»gE¼Ü
 = 
Œue
;

2816 ià(
»gE¼Ü
)

2817  
çl£
;

2819 
didDQF
 = 
Œue
;

2822 ià(
didDQF
)

2824 
dqf
 = 
Ãw
 
	`DQFM©ch
(
dqfReg
);

2826 
numFigs
 = 
objeù
->
	`g‘Figu»CouÁ
();

2827 
key
[256];

2828 cÚ¡ ** 
dqfStF’ames
 = 
Ãw
 cÚ¡ * [
numFigs
];

2829 cÚ¡ ** 
dqfImageF’ames
 = 
Ãw
 cÚ¡ * [
numFigs
];

2830 
f
 = 0; f < 
numFigs
; f ++)

2832 
	`¥rštf
(
key
, "Dqf%d", 
f
);

2833 
dqfStF’ames
[
f
] = 
süt
.
	`g‘SŒšgV®ue
(
key
, 
NULL
);

2836 
	`¥rštf
(
key
, "DqfImage%d", 
f
);

2837 
dqfImageF’ames
[
f
] = 
süt
.
	`g‘SŒšgV®ue
(
key
, 
NULL
);

2840 
dqf
->
	`š™ŸlizeDQFM©ch
(
	`g‘ImagePŒ
(), 
objeù
, 
dqfImageF’ames
, 
dqfStF’ames
);

2844 
»t
 = 
çl£
;

2845 ià(
glob®V”bos™y
 > 0)

2846 
cout
 << "Match method is ";

2847 
m‘hod
) {

2850 ià(
glob®V”bos™y
 > 0)

2851 
cout
 << "light-to-dark Gaussian derivative\n";

2852 
»t
 = 
	`š™ŸlizeM©ch
(
GAUSSIAN_DERIVATIVE_MATCH
, 
surçûLev–
);

2855 ià(
glob®V”bos™y
 > 0)

2856 
cout
 << "dark-to-light Gaussian derivative\n";

2857 
»t
 = 
	`š™ŸlizeM©ch
(
NEG_GAUSSIAN_DERIVATIVE_MATCH
, 
surçûLev–
);

2860 ià(
glob®V”bos™y
 > 0)

2861 
cout
 << "simple mask\n";

2862 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Sim¶eMaskFe", 
NULL
);

2863 ià(
f’ame
 =ğ
NULL
) {

2864 
cout
 << "Error: No simple mask file was specified\n";

2865  
çl£
;

2867 ià(
glob®V”bos™y
 > 0)

2868 
cout
 << "Sim¶mask fğ" << 
f’ame
 << 
’dl
;

2869 
»t
 = 
	`š™ŸlizeM©ch
(
SIMPLE_MASK_MATCH
, 
surçûLev–
, 
NULL
, 
f’ame
);

2872 
cout
 << "Binary match cannot be used in‡ script:„un Binary Pablo instead\n";

2873  
çl£
;

2875 ià(
glob®V”bos™y
 > 0)

2876 
cout
 << "histogram\n";

2878 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Hi¡", 
NULL
);

2879 ià(! 
f’ame
) {

2880 ià(
glob®V”bos™y
 > -1) {

2881 
cout
 << "Error: No surface…atchƒnsemble histogram supplied\n";

2882  
çl£
;

2886 
	`lßdSPEObjeù
(
f’ame
, 
süt
);

2888 ià(
glob®V”bos™y
 > -1)

2889 
cout
 << "Surçû…©chƒn£mbË fğ" << 
f’ame
 << ".\n";

2892 cÚ¡ *
¥eM—nF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Hi¡M—n", 
NULL
);

2893 ià(
¥eM—nF’ame
 && *speMeanFilename) {

2894 
Hi¡og¿mM©chTy³
 
hmt
 = 
SurçûP©chEn£mbË
::
	`štToHi¡og¿mM©chTy³
(

2895 
süt
.
	`g‘IÁV®ue
("HistogramMatchType", 0));

2896 
SurçûP©chEn£mbË
 *
¥eM—n
 = 
Ãw
 
	`SurçûP©chEn£mbË
(
hmt
, 
¥eM—nF’ame
, 
NULL
);

2897 
¥e
->
	`£tM—n
(
¥eM—n
->
	`g‘M—n
());

2898 
d–‘e
 
¥eM—n
;

2901 
»t
 = 
	`š™ŸlizeM©ch
(
HISTO_IMAGE_MATCH
, 
surçûLev–
);

2905 ià(
glob®V”bos™y
 > 0)

2906 
cout
 << "MultiPatch match...\n";

2908 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("MpCÚfig", 
NULL
);

2909 ià(! 
f’ame
) {

2910 ià(
glob®V”bos™y
 > -1) {

2911 
cout
 << "Error: No MultiPatch file supplied\n";

2912  
çl£
;

2917 ià(! 
	`lßdMPObjeù
(
f’ame
, 
süt
))

2919 
cout
 << "Error: MultiPatch Training failed, MP Object failedo†oad\n";

2920  
çl£
;

2923 ià(
glob®V”bos™y
 > -1)

2924 
cout
 << "MuÉiP©ch fğ" << 
f’ame
 << ".\n";

2927 
»t
 = 
	`š™ŸlizeM©ch
(
MULTIPATCH_MATCH
, 
surçûLev–
, (*è
süt
.
	`g‘SŒšgV®ue
("MPFDebug", 
NULL
));

2930 
cout
 << "Unknown match method specified\n";

2931  
çl£
;

2934 ià(
didDQF
)

2936 
»t
 = 
	`š™ŸlizeM©ch
(
HISTO_IMAGE_MATCH
, 
surçûLev–
);

2937  
Œue
;

2941  
»t
;

2942 
	}
}

2944 cÚ¡ 
	g¥4
[] = " ";

2945 cÚ¡ 
	g¥5
[] = " ";

2946 cÚ¡ 
	g¥6
[] = " ";

2948 
	gP3DCÚŒŞ
::
	$mod–Sge
(
boŞ
 
mod–Sge
, 
Regi¡ry
 & 
süt
)

2950 ià(0 !ğ
süt
.
	`g‘IÁV®ue
("SkipModelStage", 0)) {

2951 ià(
mod–Sge
)

2952 
cout
 << "Ensemble";

2954 
cout
 << "Model";

2955 
cout
 << " sgsk³d" << 
’dl
;

2959 
wt
 = 
süt
.
	`g‘DoubËV®ue
("ModelPenaltyWeight", 0.5);

2960 ià(
glob®V”bos™y
 > 0)

2961 
cout
 << "P’®ty weighˆğ" << 
wt
 << '\n';

2962 
	`£tRegi¡¿tiÚP’®tyWeight
(
wt
);

2964 
surçûLev–
 = 
süt
.
	`g‘IÁV®ue
("SurfaceLevel", 2);

2966 
boŞ
 
u£PGA
 = 
süt
.
	`g‘BoŞ—nV®ue
("U£PGA", 
Œue
);

2967 ià(
glob®V”bos™y
 > 0 && 
u£PGA
)

2968 
cout
 << "Using PGA data\n";

2970 
	`š™ŸlizeRegi¡¿tiÚO±imiz”
();

2971 ià(
upd©eGuiSge
 !ğ
NULL
)

2972 
	`upd©eGuiSge
(
cu¼’tO±imiz”Sge
);

2974 cÚ¡ * 
¥
 = 
¥4
;

2975 
i
 = 1; i < 
MAX_OPTIMIZER_ITERATIONS
; i++) {

2976 
	`doRegi¡¿tiÚI‹¿tiÚs
(1);

2977 ià(
upd©eGui
 !ğ
NULL
)

2978 
	`upd©eGui
(
i
);

2979 ià(
glob®V”bos™y
 > 0) {

2980 
cout
 << 
i
 << ". Current…enalty: "

2981 << 
	`g‘La¡Regi¡¿tiÚP’®tyV®ue
() << '\n';;

2982 ià((
i
 + 1)% 10 == 0) {

2983 ià((
i
 + 1) % 100 == 0)

2984 
¥
 = 
¥6
;

2986 
¥
 = 
¥5
;

2988 
cout
 << 
¥
 << "Cu¼’ˆm©ch: " << -
	`g‘La¡Regi¡¿tiÚM©chV®ue
()

2992 ià(
	`»gi¡¿tiÚO±imiz”IsFšished
())

2995 
	}
}

2997 
boŞ
 
	$wr™eMod–Sim¶y
(cÚ¡ * 
f’ame
, 
M3DObjeù
 * 
objeù
)

2999 ià(!
f’ame
 || !*f’am|| !
objeù
)

3000  
çl£
;

3002 
M3DObjeùFe
 
objeùFe
;

3003  
objeùFe
.
	`wr™e
(
f’ame
, *
objeù
);

3004 
	}
}

3006 
	gP3DCÚŒŞ
::
	$figu»Sge
(
boŞ
 
mašFigu»Sge
, 
Regi¡ry
 & 
süt
)

3008 
wt
;

3009 
n
;

3011 
boŞ
 
u£PGA
 = 
süt
.
	`g‘BoŞ—nV®ue
("U£PGA", 
Œue
è&& (süt.
	`g‘DoubËV®ue
("FigureMahalanobisMatch",-1.0) >0.0);

3013 ià(
u£PGA
) {

3014 ià(! 
	`haveFigu»PGA
()) {

3015 
cout
 << "NØPGA sti¡ic avaabË; ignÜšg„eque¡Øu£ PGA d©a" << 
’dl
;

3016 
u£PGA
 = 
çl£
;

3018 ià(
glob®V”bos™y
 > 0)

3019 
cout
 << "Using PGA data\n";

3022 
	`ş—rP’®tyWeights
();

3025 
wt
 = 
süt
.
	`g‘DoubËV®ue
("FigureMahalanobisMatch", -1.0);

3026 ià(
wt
 <= 0.0) {

3027 
wt
 = 
süt
.
	`g‘DoubËV®ue
("FigureGeometryWeight", 0.5);

3028 ià(
glob®V”bos™y
 > 0)

3029 
cout
 << "Geom‘ry weighˆğ" << 
wt
 << '\n';

3030 
	`£tMašFigu»P’®tyWeight
(
GpFigu»Geom‘ryWeight
, 
wt
);

3033 ià(
glob®V”bos™y
 > 0)

3034 
cout
 << "Mah®ªobi weighˆğ" << 
wt
 << '\n';

3035 
	`£tMašFigu»P’®tyWeight
(
Figu»Mah®ªobisM©ch
, 
wt
);

3038 ià(
objeù
->
	`g‘Figu»CouÁ
() > 1) {

3039 
wt
 = 
süt
.
	`g‘DoubËV®ue
("FigureInterObjectWeight", 0.5);

3040 ià(
glob®V”bos™y
 > 0)

3041 
cout
 << "IÁ”-objeù weighˆğ" << 
wt
 << '\n';

3044 
wt
 = 0.0;

3045 
	`£tMašFigu»P’®tyWeight
(
GpFigu»IÁ”ObjeùWeight
, 
wt
);

3048 ià(! 
	`š™ŸlizeMašFigu»O±imiz”
(
çl£
, 
u£PGA
)) {

3049 
cout
 << "Figu» sgcould‚Ù brun" << 
’dl
;

3054 
n
 = 
süt
.
	`g‘IÁV®ue
("Figu»I‹¿tiÚs", 
MAX_OPTIMIZER_ITERATIONS
 - 1);

3055 ià(
glob®V”bos™y
 > 0) {

3056 
cout
 << "Number of iterations ";

3057 ià(
n
 =ğ
MAX_OPTIMIZER_ITERATIONS
 - 1)

3058 
cout
 << "is unlimited\n";

3060 
cout
 << "ğ" << 
n
 << '\n';

3062 
n
++;

3064 ià(
upd©eGuiSge
 !ğ
NULL
)

3065 
	`upd©eGuiSge
(
cu¼’tO±imiz”Sge
);

3068 cÚ¡ * 
¥
 = 
¥4
;

3069 ifĞ
n
 == 0 ) {

3071 
	`doMašFigu»I‹¿tiÚs
(0, 
Œue
);

3073 ià(
glob®V”bos™y
 > -1) {

3074 
i
 = 0;

3075 
cout
 << 
i
 << ". Geometric deviation: "

3076 << 
	`g‘La¡MašFigu»Geom‘ricM©chV®ue
() << '\n';

3077 ià(
i
 % 10 == 0) {

3078 ià(
i
 % 100 == 0)

3079 
¥
 = 
¥6
;

3081 
¥
 = 
¥5
;

3083 
cout
 << 
¥
 << "Imagm©ch: " << (
	`g‘La¡MašFigu»ObjeùiveFunùiÚV®ue
()

3084 - 
	`g‘La¡MašFigu»Geom‘ricM©chV®ue
()) << '\n';

3085 
cout
 << 
¥
 << "Objective function: "

3086 << 
	`g‘La¡MašFigu»ObjeùiveFunùiÚV®ue
() << '\n';

3092 cÚ¡ *
wr™eMod–
 = 
	`tunšgSŒ
(
Figu»Mod–P”I‹¿tiÚ
);

3094 
i
 = 1; i < 
n
; i++) {

3095 
	`doMašFigu»I‹¿tiÚs
(1, 
i
 == 1);

3096 ià(
	`mašFigu»SgeSk³d
())

3099 ià(
upd©eGui
 !ğ
NULL
)

3100 
	`upd©eGui
(
i
);

3102 ià(
glob®V”bos™y
 > 0) {

3103 
cout
 << 
i
 << ". Geometric deviation: "

3104 << 
	`g‘La¡MašFigu»Geom‘ricM©chV®ue
() << '\n';

3105 ià(
i
 % 10 == 0) {

3106 ià(
i
 % 100 == 0)

3107 
¥
 = 
¥6
;

3109 
¥
 = 
¥5
;

3111 
cout
 << 
¥
 << "Imagm©ch: " << (
	`g‘La¡MašFigu»ObjeùiveFunùiÚV®ue
()

3112 - 
	`g‘La¡MašFigu»Geom‘ricM©chV®ue
()) << '\n';

3113 
cout
 << 
¥
 << "Objective function: "

3114 << 
	`g‘La¡MašFigu»ObjeùiveFunùiÚV®ue
() << '\n';

3115 
cout
.
	`æush
();

3118 ià(
wr™eMod–
 && *writeModel) {

3119 
mod–FeName
[1000];

3120 
	`¥rštf
(
mod–FeName
, 
wr™eMod–
, 
i
);

3121 
cout
 << " Wr™šg mod– figP”I‹¸tØ" << 
mod–FeName
 << 
’dl
;

3122 
	`wr™eMod–Sim¶y
(
mod–FeName
, 
mašFigu»O±imiz”
->
	`g‘La¡Be¡Objeù
());

3125 ià(
	`mašFigu»O±imiz”IsFšished
())

3129 
wr™eMod–
 = 
	`tunšgSŒ
(
Figu»Mod–ResuÉ
);

3130 ià(
wr™eMod–
 && *writeModel) {

3131 
cout
 << " Wr™šg mod–„esuÉØ" << 
wr™eMod–
 << 
’dl
;

3132 
	`wr™eMod–Sim¶y
(
wr™eMod–
, 
objeù
);

3134 
	}
}

3136 
	gP3DCÚŒŞ
::
	$©omSge
(
Regi¡ry
 & 
süt
)

3138 
M3DFigu»
 * 
cu¼Figu»
;

3139 
i
, 
n
, 
m
, 
figu»Id
, 
numFigu»s
, 
Ën
;

3140 
wt
;

3142 
	`ş—rP’®tyWeights
();

3145 
wt
 = 
süt
.
	`g‘DoubËV®ue
("AtomGeometryWeight", 0.5);

3146 ià(
glob®V”bos™y
 > 0)

3147 
cout
 << "Geom‘ry weighˆğ" << 
wt
 << '\n';

3148 
	`£tDefÜm©iÚP’®tyWeight
(
GpAtomGeom‘ryWeight
, 
wt
);

3150 
wt
 = 
süt
.
	`g‘DoubËV®ue
("AtomInterWeight", 0.5);

3151 ià(
glob®V”bos™y
 > 0)

3152 
cout
 << "IÁ”-©om weighˆğ" << 
wt
 << '\n';

3153 
	`£tDefÜm©iÚP’®tyWeight
(
GpAtomIÁ”Weight
, 
wt
);

3155 
wt
 = 
süt
.
	`g‘DoubËV®ue
("AtomNumberWeight", 0.5);

3156 ià(
glob®V”bos™y
 > 0)

3157 
cout
 << "NeighbÜ…’®ty weighˆğ" << 
wt
 << '\n';

3158 
	`£tDefÜm©iÚP’®tyWeight
(
GpAtomNeighbÜWeight
, 
wt
);

3160 
n
 = 
süt
.
	`g‘IÁV®ue
("AtomIterations", -1);

3161 ià(
n
 < 0)

3162 
n
 = 
MAX_OPTIMIZER_ITERATIONS
;

3163 
m
 = 
süt
.
	`g‘IÁV®ue
("AtomSubIterations", -1);

3164 ià(
m
 < 0)

3165 
m
 = 
MAX_OPTIMIZER_ITERATIONS
;

3166 ià(
glob®V”bos™y
 > 0) {

3167 
cout
 << "Number of iterations ";

3168 ià(
n
 >ğ
MAX_OPTIMIZER_ITERATIONS
)

3169 
cout
 << "is unlimited\n";

3171 
cout
 << "ğ" << 
n
 << '\n';

3172 ià(
m
 < 
MAX_OPTIMIZER_ITERATIONS
)

3173 
cout
 << "Numb” oà©om f™ ğ" << 
m
 << '\n';

3176 
	`š™ŸlizeDefÜm©iÚO±imiz”
();

3177 ià(
upd©eGuiSge
 !ğ
NULL
)

3178 
	`upd©eGuiSge
(
cu¼’tO±imiz”Sge
);

3181 
M3DDefÜm©iÚO±imiz”
 * 
defÜm©iÚO±imiz”
 = 
	`g‘DefÜm©iÚO±imiz”
();

3182 
M3DObjeù
 * 
ÿndid©eObjeù
 = 
defÜm©iÚO±imiz”
->
	`g‘Cªdid©eObjeù
();

3183 
numFigu»s
 = 
ÿndid©eObjeù
->
	`g‘Figu»CouÁ
();

3184 
figu»Id
 = 0; figu»Id < 
numFigu»s
; figureId++) {

3185 
cu¼Figu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

3186 ià(
cu¼Figu»
 !ğ
NULL
 && cu¼Figu»->
	`isAnyS–eùed
())

3190 cÚ¡ * 
skFigs
 = 
	`tunšgLi¡
(
AtomSkFigu»s
, 
Ën
);

3193 cÚ¡ * 
¥
 = 
¥4
;

3194 ià(
figu»Id
 < 
numFigu»s
) {

3196 
i
 = 0; i < 
Ën
; i++)

3197 ià(
skFigs
[
i
] =ğ
figu»Id
) {

3198 
cout
 << "Figu»‚umb” " << 
figu»Id
;

3199 
M3DFigu»
 * 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

3200 cÚ¡ * 
Çme
 = 
figu»
->
	`g‘Name
();

3201 ià(
Çme
 !ğ
NULL
)

3202 
cout
 << " (" << 
Çme
 << ')';

3203 
cout
 << " sk³d" << 
’dl
;

3207 ià(
glob®V”bos™y
 >= 0) {

3208 
cout
 << "Figu»‚umb” " << 
figu»Id
;

3209 
M3DFigu»
 * 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

3210 cÚ¡ * 
Çme
 = 
figu»
->
	`g‘Name
();

3211 ià(
Çme
 !ğ
NULL
)

3212 
cout
 << " (" << 
Çme
 << ")\n";

3214 
cout
 << '\n';

3218 
boŞ
 
wªtPGA
 = (
	`tunšgWt
(
AtomMah®ªobisM©ch
) != 0.0);

3219 ià(
wªtPGA
) {

3220 ià(
©omPgaSts
 =ğ
NULL
) {

3221 
cout
 << "Error:‚o‡tom PGA data‡vailable; ignoring AtomMahalanobisMatch"

3222 << 
’dl
;

3223 
wªtPGA
 = 
çl£
;

3227 ià(
wªtPGA
) {

3228 
defÜm©iÚO±imiz”
->
	`š™ŸlizeAtomPGASge
(
©omPgaSts
,
figu»Id
);

3232 
n
 *ğ(
objeù
->
	`g‘Figu»PŒ
(
figu»Id
))->
	`g‘Prim™iveCouÁ
();

3233 ià(
m
 < 
n
) {

3234 
n
 = 
m
;

3235 ià(
glob®V”bos™y
 >= 1)

3236 
cout
 << "AtomSubIterations supersedes‡tomIterations\n";

3239 
i
 = 0; i < 
n
; i++) {

3240 
boŞ
 
İtimiz”StİReque¡ed
 = 
	`doDefÜm©iÚI‹¿tiÚs
(
figu»Id
, 
çl£
, (
glob®V”bos™y
 <= 0));

3241 ià(
upd©eGui
 !ğ
NULL
)

3242 
	`upd©eGui
(
i
);

3244 
cout
 << 
i
 + 1 << ". Geometric deviation: ";

3245 ià(
	`tunšgWt
(
AtomMah®ªobisM©ch
)>0)

3246 
cout
 << 
	`g‘La¡DefÜm©iÚGeom‘ricM©chV®ue
()/
	`tunšgWt
(
AtomMah®ªobisM©ch
) << '\n';

3248 
cout
 << 
	`g‘La¡DefÜm©iÚGeom‘ricM©chV®ue
()<< '\n';

3250 ià((
i
 + 1)% 10 == 0) {

3251 ià((
i
 + 1) % 100 == 0)

3252 
¥
 = 
¥6
;

3254 
¥
 = 
¥5
;

3256 
cout
 << 
¥
 << "Imagm©ch: " << (
	`g‘La¡DefÜm©iÚObjeùiveFunùiÚV®ue
(
çl£
)

3257 -
	`g‘La¡DefÜm©iÚGeom‘ricM©chV®ue
()) << '\n';

3258 
cout
 << 
¥
 << "Objective function: " <<

3259 
	`g‘La¡DefÜm©iÚObjeùiveFunùiÚV®ue
(
çl£
è<< 
’dl
;

3262 ià(
İtimiz”StİReque¡ed
)

3265 ià(
İtimiz”StİReque¡ed
)

3272 ià(
©omPgaSts
 !ğ
NULL
){

3273 
Sim¬™yT¿nsfÜm3D
 * 
xfÜm
 = 
ÿndid©eObjeù
->
	`g‘T¿nsfÜm©iÚ
();

3274 ià(
xfÜm
!ğ
NULL
){

3275 
VeùÜ3D
 
	`z”o
(0.0, 0.0, 0.0);

3276 
objeù
->
	`­¶ySim¬™y
Ğ*
xfÜm
, 
z”o
 );

3281 ià(
glob®V”bos™y
 <= 0)

3282 
cout
 << 
’dl
;

3283 
	}
}

3285 
	gP3DCÚŒŞ
::
	$¥okeSge
(
Regi¡ry
 & 
süt
)

3287 
M3DFigu»
 * 
cu¼Figu»
;

3288 
i
, 
n
, 
figu»Id
, 
numFigu»s
, 
Ën
;

3289 
wt
;

3291 
	`ş—rP’®tyWeights
();

3294 
wt
 = 
süt
.
	`g‘DoubËV®ue
("SpokeGeometryWeight", 0.5);

3295 ià(
glob®V”bos™y
 > 0)

3296 
cout
 << "Geom‘ry weighˆğ" << 
wt
 << '\n';

3297 
	`£tSpokeP’®tyWeight
(
GpSpokeGeom‘ryWeight
, 
wt
);

3299 
wt
 = 
süt
.
	`g‘DoubËV®ue
("SpokeInterWeight", 0.5);

3300 ià(
glob®V”bos™y
 > 0)

3301 
cout
 << "IÁ”-©om weighˆğ" << 
wt
 << '\n';

3302 
	`£tSpokeP’®tyWeight
(
GpSpokeIÁ”Weight
, 
wt
);

3304 
wt
 = 
süt
.
	`g‘DoubËV®ue
("SpokeNumberWeight", 0.5);

3305 ià(
glob®V”bos™y
 > 0)

3306 
cout
 << "NeighbÜ…’®ty weighˆğ" << 
wt
 << '\n';

3307 
	`£tSpokeP’®tyWeight
(
GpSpokeNeighbÜWeight
, 
wt
);

3309 
n
 = (
	`tunšgWt
(
SpokeI‹¿tiÚs
));

3310 ià(
n
 < 0)

3311 
n
 = 
MAX_OPTIMIZER_ITERATIONS
;

3312 ià(
glob®V”bos™y
 > 0) {

3313 
cout
 << "Number of iterations ";

3314 ià(
n
 >ğ
MAX_OPTIMIZER_ITERATIONS
)

3315 
cout
 << "is unlimited\n";

3317 
cout
 << "ğ" << 
n
 << '\n';

3320 
	`š™ŸlizeSpokeO±imiz”
();

3321 ià(
upd©eGuiSge
 !ğ
NULL
)

3322 
	`upd©eGuiSge
(
cu¼’tO±imiz”Sge
);

3325 
M3DSpokeO±imiz”
 * 
¥okeO±imiz”
 = 
	`g‘SpokeO±imiz”
();

3326 
M3DObjeù
 * 
ÿndid©eObjeù
 = 
¥okeO±imiz”
->
	`g‘Cªdid©eObjeù
();

3327 
numFigu»s
 = 
ÿndid©eObjeù
->
	`g‘Figu»CouÁ
();

3328 
figu»Id
 = 0; figu»Id < 
numFigu»s
; figureId++) {

3329 
cu¼Figu»
 = 
ÿndid©eObjeù
->
	`g‘Figu»PŒ
(
figu»Id
);

3330 ià(
cu¼Figu»
 !ğ
NULL
 && cu¼Figu»->
	`isAnyS–eùed
())

3334 cÚ¡ * 
skFigs
 = 
	`tunšgLi¡
(
SpokeSkFigu»s
, 
Ën
);

3337 cÚ¡ * 
¥
 = 
¥4
;

3338 ià(
figu»Id
 < 
numFigu»s
) {

3340 
i
 = 0; i < 
Ën
; i++)

3341 ià(
skFigs
[
i
] =ğ
figu»Id
) {

3342 
cout
 << "Figu»‚umb” " << 
figu»Id
;

3343 
M3DFigu»
 * 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

3344 cÚ¡ * 
Çme
 = 
figu»
->
	`g‘Name
();

3345 ià(
Çme
 !ğ
NULL
)

3346 
cout
 << " (" << 
Çme
 << ')';

3347 
cout
 << " sk³d" << 
’dl
;

3351 ià(
glob®V”bos™y
 >= 0) {

3352 
cout
 << "Figu»‚umb” " << 
figu»Id
;

3353 
M3DFigu»
 * 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

3354 cÚ¡ * 
Çme
 = 
figu»
->
	`g‘Name
();

3355 ià(
Çme
 !ğ
NULL
)

3356 
cout
 << " (" << 
Çme
 << ")\n";

3358 
cout
 << '\n';

3362 
boŞ
 
wªtPGA
 = (
	`tunšgWt
(
SpokeMah®ªobisM©ch
) != 0.0);

3363 ià(
wªtPGA
) {

3364 ià(
¥okePgaSts
 =ğ
NULL
) {

3365 
cout
 << "Error:‚o spoke PGA data‡vailable; ignoring SpokeMahalanobisMatch"

3366 << 
’dl
;

3367 
wªtPGA
 = 
çl£
;

3371 ià(
wªtPGA
) {

3372 
M3DObjeù
 * 
m—nObj
;

3375 
m—nObj
 = 
NULL
;

3376 ià(
pgaSts
 !ğ
NULL
)

3377 
m—nObj
 = 
pgaSts
->
	`g‘M—nObjPŒ
();

3379 ià(
m—nObj
 !ğ
NULL
)

3380 
¥okeO±imiz”
->
	`š™ŸlizeSpokePGASge
(
¥okePgaSts
,
m—nObj
,
figu»Id
);

3382 
cout
 << "E¼Ü: m—nObj i nÙ‡vaabË!\n" <<
’dl
;

3388 
n
 *ğ(
objeù
->
	`g‘Figu»PŒ
(
figu»Id
))->
	`g‘Prim™iveCouÁ
();

3390 
i
 = 0; i < 
n
; i++) {

3391 
boŞ
 
İtimiz”StİReque¡ed
 = 
	`doSpokeI‹¿tiÚs
(
figu»Id
, 
çl£
, (
glob®V”bos™y
 <= 0));

3392 ià(
upd©eGui
 !ğ
NULL
)

3393 
	`upd©eGui
(
i
);

3394 ià(
glob®V”bos™y
 > 0) {

3396 
cout
 << 
i
 + 1 << ". Geometric deviation: ";

3397 ià(
	`tunšgWt
(
SpokeMah®ªobisM©ch
)>0)

3398 
cout
 << -
	`g‘La¡SpokeGeom‘ricM©chV®ue
()/
	`tunšgWt
(
SpokeMah®ªobisM©ch
) << '\n';

3400 
cout
 << -
	`g‘La¡SpokeGeom‘ricM©chV®ue
()<< '\n';

3402 ià((
i
 + 1)% 10 == 0) {

3403 ià((
i
 + 1) % 100 == 0)

3404 
¥
 = 
¥6
;

3406 
¥
 = 
¥5
;

3408 
cout
 << 
¥
 << "Imagm©ch: " << -(
	`g‘La¡SpokeObjeùiveFunùiÚV®ue
(
çl£
)

3409 -
	`g‘La¡SpokeGeom‘ricM©chV®ue
()) << '\n';

3410 
cout
 << 
¥
 << "Objective function: " <<

3411 -
	`g‘La¡SpokeObjeùiveFunùiÚV®ue
(
çl£
è<< 
’dl
;

3413 ià(
İtimiz”StİReque¡ed
)

3418 ià(
glob®V”bos™y
 <= 0)

3419 
cout
 << 
’dl
;

3420 
	}
}

3423 
	gP3DCÚŒŞ
::
	$subfigu»Sge
(
Regi¡ry
 & 
süt
)

3425 
cout
 << "NÙ im¶em’‹d" << 
’dl
;

3427 ià(
upd©eGuiSge
 !ğ
NULL
)

3428 
	`upd©eGuiSge
(
cu¼’tO±imiz”Sge
);

3429 
	}
}

3431 
	gP3DCÚŒŞ
::
	$vox–Sge
(
Regi¡ry
 & 
süt
)

3433 
cout
 << "NÙ im¶em’‹d" << 
’dl
;

3435 ià(
upd©eGuiSge
 !ğ
NULL
)

3436 
	`upd©eGuiSge
(
cu¼’tO±imiz”Sge
);

3437 
	}
}

3440 
boŞ
 
	gP3DCÚŒŞ
::
	$doCommªdMuÉiP©chT¿ššg
(
Regi¡ry
 & 
süt
)

3442 
Image3D
 * 
image
 = 
	`g‘ImagePŒ
();

3444 cÚ¡ * 
mpF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("MpCÚfig", 
NULL
);

3446 ià(! 
	`lßdMPObjeù
(
mpF’ame
, 
süt
)){

3447 
cout
 << "MultiPatch Training failed, MP Object failedo†oad\n";

3448  
çl£
;

3452 cÚ¡ * 
§veF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("MpOut", 
NULL
);

3454 ià(
§veF’ame
 =ğ
NULL
){

3455 
cout
 << "MultiPatch Training failed,‚o save filename found.\n";

3456  
çl£
;

3459 
mp
->
	`š™ŸlizeP©ches
(
objeù
, 
image
);

3462 
f
, 
numFigu»s
 = 
objeù
->
	`g‘Figu»CouÁ
();

3463 * 
key
 = 
Ãw
 [1024];

3464 
AÎImageIO
 
imageFe
;

3465 
Image3D
 *
bš¬yImage
 = 
NULL
;

3467 
f
 = 0; f < 
numFigu»s
; f++)

3469 
	`¥rštf
(
key
, "MPBš¬yImage%d", 
f
);

3470 cÚ¡ * 
bš¬yImageF’ame
 = 
süt
.
	`g‘SŒšgV®ue
(
key
, 
NULL
);

3472 ià(
bš¬yImageF’ame
 !ğ
NULL
)

3474 
bš¬yImage
 = 
imageFe
.
	`»ad
(
bš¬yImageF’ame
);

3476 ià(
bš¬yImage
 =ğ
NULL
) {

3477 
cout
 << "Bš¬y imag" << 
bš¬yImageF’ame
 << " FAILEDo†oad.\n";

3478  
çl£
;

3482 
mp
->
	`§m¶eYour£lf
(
objeù
, 
image
, 
f
, 
bš¬yImage
, 
Œue
);

3484 ià(
bš¬yImage
 !ğ
NULL
)

3485 
d–‘e
 
bš¬yImage
;

3486 
bš¬yImage
 = 
NULL
;

3490 
mp
->
	`§veMP
(
§veF’ame
);

3492 
cout
 << "MuiP©ch f§ved " << 
§veF’ame
 << ".\n";

3495  
Œue
;

3496 
	}
}

3498 
boŞ
 
	gP3DCÚŒŞ
::
	$doCommªdHi¡og¿mT¿ššg
(
Regi¡ry
 & 
süt
)

3501 
Image3D
 * 
image
 = 
	`g‘ImagePŒ
();

3503 cÚ¡ * 
¥eF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Hi¡", 
NULL
);

3505 ià(! 
	`lßdSPEObjeù
(
¥eF’ame
, 
süt
)) {

3506 
cout
 << "Histogram Training failed, SPE Object failedo†oad\n";

3507  
çl£
;

3510 cÚ¡ * 
§veF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Hi¡Out", 
NULL
);

3512 ià(
§veF’ame
 =ğ
NULL
){

3513 
cout
 << "Histogram Training failed,‚o save filename found.\n";

3514  
çl£
;

3517 
f
, 
numFigu»s
 = 
objeù
->
	`g‘Figu»CouÁ
();

3518 
key
[256];

3520 
f
 = 0; f < 
numFigu»s
; f++){

3521 
	`¥rštf
(
key
, "Hi¡P©chImage%d", 
f
);

3522 cÚ¡ * 
·tchImageF’ame
 = 
süt
.
	`g‘SŒšgV®ue
(
key
, 
NULL
);

3524 
	`¥rštf
(
key
, "Hi¡Bš¬yImage%d", 
f
);

3525 cÚ¡ * 
bš¬yImageF’ame
 = 
süt
.
	`g‘SŒšgV®ue
(
key
, 
NULL
);

3527 
¥e
->
	`upd©e
(
image
, 
objeù
, 
f
, -1, 
bš¬yImageF’ame
, 
·tchImageF’ame
);

3530 
¥e
->
	`§ve
(
§veF’ame
);

3531 
cout
 << "Surçû P©ch En£mbË FSaved: " << 
§veF’ame
 << ".\n";

3533  
Œue
;

3534 
	}
}

3536 cÚ¡ * 
	gP3DCÚŒŞ
::
	$ÿlcDQFF’ame
(* 
imageF’ame
, 
figID
)

3538 * 
dqfF’ame
;

3539 
Ën
 = 
	`¡¾’
(
imageF’ame
);

3542 * 
suffix
 = 
NULL
;

3543 ià((
	`¡r¡r
(
imageF’ame
, ".¿w3" ) =ğ(imageF’am+ 
Ën
 - 
	`¡¾’
(".raw3" ))))

3544 
suffix
 = ".raw3";

3545 ià((
	`¡r¡r
(
imageF’ame
, ".¿w3z" ) =ğ(imageF’am+ 
Ën
 - 
	`¡¾’
(".raw3z" ))))

3546 
suffix
 = ".raw3z";

3547 ià((
	`¡r¡r
(
imageF’ame
, ".gl" ) =ğ(imageF’am+ 
Ën
 - 
	`¡¾’
(".gipl" ))))

3548 
suffix
 = ".gipl";

3549 ià((
	`¡r¡r
(
imageF’ame
, ".mhd" ) =ğ(imageF’am+ 
Ën
 - 
	`¡¾’
(".mhd" ))))

3550 
suffix
 = ".mhd";

3551 ià((
	`¡r¡r
(
imageF’ame
, ".mha" ) =ğ(imageF’am+ 
Ën
 - 
	`¡¾’
(".mha" ))))

3552 
suffix
 = ".mha";

3553 ià(!
suffix
)

3554  
NULL
;

3556 
suffixL’
 = 
	`¡¾’
(
suffix
);

3557 
dqfF’ame
 = 
Ãw
 [
Ën
+
suffixL’
+1+7];

3558 
	`¡rıy
(
dqfF’ame
, 
imageF’ame
);

3559 
	`¡rıy
(
dqfF’ame
 + 
Ën
 - 
suffixL’
, "-dqf");

3561 
	`¥rštf
(
dqfF’ame
 + 
Ën
 - 
suffixL’
 + 4, "-%i", 
figID
);

3563 
	`¡rÿt
(
dqfF’ame
, 
suffix
);

3566  
dqfF’ame
;

3567 
	}
}

3569 
boŞ
 
	gP3DCÚŒŞ
::
	$doCommªdDi¡ªûQuªteFunùiÚs
(
Regi¡ry
 & 
süt
)

3572 
Image3D
 * 
image
 = 
	`g‘ImagePŒ
();

3574 cÚ¡ * 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Image", 
NULL
);

3575 * 
imageF’ame
 = 
	`¡rdup
(
f’ame
);

3577 cÚ¡ * 
dqfF’ame
 = 
	`ÿlcDQFF’ame
(
imageF’ame
,0);

3579 cÚ¡ * 
dqfCÚfigF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("DqfCÚfig", 
NULL
);

3581 
Regi¡ry
 
dqfReg
;

3583 if(
dqfCÚfigF’ame
 !ğ
NULL
) {

3584 
boŞ
 
»gE¼Ü
 = 
çl£
;

3587 
Œy
 {

3588 
dqfReg
.
	`»adFromFe
(
dqfCÚfigF’ame
);

3590 
	`ÿtch
 (
RExû±iÚ
 
exı
) {

3591 
exı
.
	`´št
(
¡d
::
cout
);

3592 
cout
 << "ERR: süˆf" << 
dqfCÚfigF’ame
 << "‚ot found (failedo†oad).\n";

3593 
»gE¼Ü
 = 
Œue
;

3595 ià(
»gE¼Ü
)

3596  
çl£
;

3599 
DQFT¿ššg
 *
myT¿š”
 = 
Ãw
 
	`DQFT¿ššg
(
dqfReg
);

3607 ià(
myT¿š”
->
	`doMod–DQFT¿ššg
(
image
, 
objeù
, 0, 
NULL
, 
dqfF’ame
))

3609 
cout
 << "made dqf model file.\n";

3612  
Œue
;

3613 
	}
}

3615 
boŞ
 
	gP3DCÚŒŞ
::
	$doCommªdDi¡ªûQuªteFunùiÚImageMak”
(
Regi¡ry
 & 
süt
)

3618 
Image3D
 * 
image
 = 
	`g‘ImagePŒ
();

3620 cÚ¡ * 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Image", 
NULL
);

3621 * 
imageF’ame
 = 
	`¡rdup
(
f’ame
);

3623 
figID
 = (è
	`tunšgWt
(
GP_TUNE_FIGURE_ID
);

3625 cÚ¡ * 
dqfF’ame
 = 
	`ÿlcDQFF’ame
(
imageF’ame
, 
figID
);

3627 cÚ¡ * 
dqfCÚfigF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("DqfCÚfig", 
NULL
);

3629 
Regi¡ry
 
dqfReg
;

3631 if(
dqfCÚfigF’ame
 !ğ
NULL
) {

3632 
boŞ
 
»gE¼Ü
 = 
çl£
;

3635 
Œy
 {

3636 
dqfReg
.
	`»adFromFe
(
dqfCÚfigF’ame
);

3638 
	`ÿtch
 (
RExû±iÚ
 
exı
) {

3639 
exı
.
	`´št
(
¡d
::
cout
);

3640 
cout
 << "ERR: süˆf" << 
dqfCÚfigF’ame
 << "‚ot found (failedo†oad).\n";

3641 
»gE¼Ü
 = 
Œue
;

3643 ià(
»gE¼Ü
)

3644  
çl£
;

3647 
DQFT¿ššg
 *
myT¿š”
 = 
Ãw
 
	`DQFT¿ššg
(
dqfReg
);

3649 ià(
myT¿š”
->
	`ü—‹DQFImage
(
image
, 
dqfF’ame
, 
objeù
, 
figID
))

3651 
cout
 << "DQF Imagmak” sucûeded." << 
’dl
;

3654  
Œue
;

3655 
	}
}

3657 
boŞ
 
	gP3DCÚŒŞ
::
	$doCommªdDi¡ªûQuªteFunùiÚMod–Mak”
(
Regi¡ry
 & 
süt
)

3660 
Image3D
 * 
image
 = 
	`g‘ImagePŒ
();

3662 cÚ¡ * 
f’ame
 = 
süt
.
	`g‘SŒšgV®ue
("Image", 
NULL
);

3663 * 
imageF’ame
 = 
	`¡rdup
(
f’ame
);

3665 
figID
 = (è
	`tunšgWt
(
GP_TUNE_FIGURE_ID
);

3674 cÚ¡ ** 
dqfImageF’ames
 = 
Ãw
 cÚ¡ * [
objeù
->
	`g‘Figu»CouÁ
()];

3675 
key
[256];

3677 
i
 = 0; i < 
objeù
->
	`g‘Figu»CouÁ
(); i ++)

3679 
	`¥rštf
(
key
, "DqfImage%d", 
i
);

3680 
dqfImageF’ames
[
i
] = 
süt
.
	`g‘SŒšgV®ue
(
key
, 
NULL
);

3686 cÚ¡ * 
dqfCÚfigF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("DqfCÚfig", 
NULL
);

3688 
Regi¡ry
 
dqfReg
;

3690 if(
dqfCÚfigF’ame
 !ğ
NULL
) {

3691 
boŞ
 
»gE¼Ü
 = 
çl£
;

3694 
Œy
 {

3695 
dqfReg
.
	`»adFromFe
(
dqfCÚfigF’ame
);

3697 
	`ÿtch
 (
RExû±iÚ
 
exı
) {

3698 
exı
.
	`´št
(
¡d
::
cout
);

3699 
cout
 << "ERR: süˆf" << 
dqfCÚfigF’ame
 << "‚ot found (failedo†oad).\n";

3700 
»gE¼Ü
 = 
Œue
;

3702 ià(
»gE¼Ü
)

3703  
çl£
;

3706 cÚ¡ * 
dqfOutF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("DqfOut", 
NULL
);

3708 
DQFT¿ššg
 *
myT¿š”
 = 
Ãw
 
	`DQFT¿ššg
(
dqfReg
);

3713 ià(
myT¿š”
->
	`doMod–DQFT¿ššg
(
image
, 
objeù
, 
figID
, 
dqfOutF’ame
, 
dqfImageF’ames
[figID]))

3715 
cout
 << "made dqf model file.\n";

3718  
Œue
;

3719 
	}
}

3721 
boŞ
 
	gP3DCÚŒŞ
::
	$lßdMPObjeù
(cÚ¡ *
mpF’ame
, 
Regi¡ry
 &
süt
)

3723 ià(
mp
 !ğ
NULL
){

3724 
d–‘e
 
mp
;

3725 
mp
 = 
NULL
;

3728 
Regi¡ry
 
mpReg
;

3732 if(
mpF’ame
 =ğ
NULL
) {

3733 
cout
 << "ERR: MultiPatch (MP) script file‚ot supplied -„equired for MPraining.\n";

3734  
çl£
;

3737 
mp
 = 
Ãw
 
	`MuÉiP©ch
(
mpF’ame
);

3740  
Œue
;

3741 
	}
}

3743 
boŞ
 
	gP3DCÚŒŞ
::
	$lßdSPEObjeù
(cÚ¡ *
¥eF’ame
, 
Regi¡ry
 &
süt
)

3745 ià(
¥e
 !ğ
NULL
){

3746 
d–‘e
 
¥e
;

3747 
¥e
 = 
NULL
;

3750 
Regi¡ry
 
¥eReg
;

3751 
Hi¡og¿mM©chTy³
 
hmt
 = 
SurçûP©chEn£mbË
::
	`štToHi¡og¿mM©chTy³
(
süt
.
	`g‘IÁV®ue
("HistogramMatchType", 0));

3753 if(
¥eF’ame
 =ğ
NULL
) {

3754 
cout
 << "ERR: SPE script file‚on supplied -„equired for SPEraining.\n";

3755  
çl£
;

3758 cÚ¡ * 
QFD©aF’ame
 = 
süt
.
	`g‘SŒšgV®ue
("QFD©a", 
NULL
);

3760 
¥e
 = 
Ãw
 
	`SurçûP©chEn£mbË
(
hmt
, 
¥eF’ame
, 
QFD©aF’ame
);

3762  
Œue
;

3763 
	}
}

3773 
boŞ
 
	gP3DCÚŒŞ
::
	$fšishImageLßdšg
(
Image3D
 * 
image
, 
boŞ
 
¡acked
, boŞ 
m­ToWÜld
,

3774 
boŞ
 
ex‹º®
)

3776 ià(
image
 =ğ
NULL
)

3777  
çl£
;

3779 ià(
m­ToWÜld
) {

3780 ià(
objeù
 !ğ
NULL
 && 
wÜldWasAµl›d
) {

3781 
Image3D
 * 
im
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

3782 
objeù
->
	`unAµlyWÜld
(
im
);

3786 
image
->
	`£tIsImageScked
(
¡acked
);

3787 
imagePÏÃs
.
	`£tImagePŒ
(
image
, 512, 
ex‹º®
);

3788 
imagePÏÃsChªged
 = 
Œue
;

3790 ià(
m©ch
 !ğ
NULL
)

3791 
m©ch
->
	`£tT¬g‘Image
(
image
);

3793 ià(
m­ToWÜld
) {

3794 
	`­¶yWÜld
(
image
);

3796 ià(
»ã»nûObjeù
 !ğ
NULL
) {

3797 
d–‘e
 
»ã»nûObjeù
;

3798 
»ã»nûObjeù
 = 
NULL
;

3802 
blu¼ed
 = 
çl£
;

3803  
Œue
;

3804 
	}
}

3806 
	gP3DCÚŒŞ
::
	$disÿrdImage
(
boŞ
 
ex‹º®
)

3808 
imagePÏÃs
.
	`£tImagePŒ
(
NULL
, 0, 
ex‹º®
);

3809 
imagePÏÃsChªged
 = 
Œue
;

3811 ià(
m©ch
 !ğ
NULL
)

3812 
m©ch
->
	`£tT¬g‘Image
(
NULL
);

3814 ià(
imageFeName
 !ğ
NULL
) {

3815 
d–‘e
 [] 
imageFeName
;

3816 
imageFeName
 = 
NULL
;

3818 
	}
}

3823 
boŞ
 
	gP3DCÚŒŞ
::
	$§veImage
(cÚ¡ * 
f’ame
, 
Image3D
 * 
image
,

3824 
G»yV®ue
 
lowIÁ’s
, G»yV®u
highIÁ’s
)

3826 
AÎImageIO
 
fe
;

3828 ià(
image
 =ğ
NULL
)

3829 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

3831 ià(
image
 =ğ
NULL
)

3832  
çl£
;

3834 ià(
f’ame
 =ğ
NULL
 || filename[0] == '\0')

3835  
çl£
;

3837 ià(
lowIÁ’s
 > 
highIÁ’s
)

3838 
image
->
	`¿nge
(
lowIÁ’s
, 
highIÁ’s
);

3839  
fe
.
	`wr™e
(
f’ame
, *
image
, 
lowIÁ’s
, 
highIÁ’s
);

3840 
	}
}

3842 
boŞ
 
	gP3DCÚŒŞ
::
	$§veDQF
(cÚ¡ * 
f’ame
, 
DQFImage
 * 
dqf
) const

3844 
AÎImageIO
 
fe
;

3846 ià(
dqf
 =ğ
NULL
)

3847  
çl£
;

3849 ià(
f’ame
 =ğ
NULL
 || filename[0] == '\0')

3850  
çl£
;

3854  
fe
.
	`wr™e
(
f’ame
, *
dqf
, 
MIN_GREY_VALUE
, 
MAX_GREY_VALUE
,

3855 
AÎImageIO
::
Raw3
);

3856 
	}
}

3859 
DQFImage
 * 
	gP3DCÚŒŞ
::
	$»adDQF
(cÚ¡ * 
f’ame
) const

3861 
AÎImageIO
 
fe
;

3863 ià(
f’ame
 =ğ
NULL
)

3864  
NULL
;

3866  (
DQFImage
 *è
fe
.
	`»ad
(
f’ame
, 
çl£
, false);

3867 
	}
}

3870 
Image3D
 * 
	gP3DCÚŒŞ
::
	$»adImage
(cÚ¡ * 
f’ame
, 
boŞ
 
¡acked
,

3871 
boŞ
 
h—d”OÆy
) const

3873 
AÎImageIO
 
fe
;

3875 ià(
f’ame
 =ğ
NULL
)

3876  
NULL
;

3878  
fe
.
	`»ad
(
f’ame
, 
¡acked
, 
h—d”OÆy
);

3879 
	}
}

3881 
boŞ
 
	gP3DCÚŒŞ
::
	$lßdImage
(cÚ¡ * 
f’ame
, 
boŞ
 
¡acked
,

3882 
boŞ
 
m­ToWÜld
, boŞ 
h—d”OÆy
, boŞ 
ex‹º®
)

3884 
Ën
;

3885 
Image3D
 * 
image
;

3887 ià(
f’ame
 =ğ
NULL
)

3888  
çl£
;

3890 
Ën
 = 
	`¡¾’
(
f’ame
);

3891 ià(0 =ğ
Ën
)

3892  
çl£
;

3894 
image
 = 
	`»adImage
(
f’ame
, 
¡acked
, 
h—d”OÆy
);

3895 ià(
image
 =ğ
NULL
)

3896  
çl£
;

3898 ià(
imageFeName
 !ğ
NULL
)

3900 
d–‘e
 [] 
imageFeName
;

3901 
imageFeName
 = 
NULL
;

3903 #ifdeà
_WIN32


3904 ià(
f’ame
[1] != ':' || (filename[2] != '\\' && filename[2] != '/'))

3906 ià(
f’ame
[0] != '/')

3910 #ifdeà
_WIN32


3911 
	#MAX_PATH_LEN
 512

	)

3913 
	#MAX_PATH_LEN
 
PATH_MAX


	)

3915 
cwd
[
MAX_PATH_LEN
 + 1];

3916 #ifdeà
_WIN32


3917 ià(
	`_g‘cwd
(
cwd
, 
MAX_PATH_LEN
è=ğ
NULL
)

3919 ià(
	`g‘cwd
(
cwd
, 
MAX_PATH_LEN
è=ğ
NULL
)

3921 
	`¡rıy
(
cwd
, "...");

3922 
imageFeName
 = 
Ãw
 [
	`¡¾’
(
cwd
è+ 
Ën
 + 200];

3924 
	`¡rıy
(
imageFeName
, 
cwd
);

3925 
	`¡rÿt
(
imageFeName
, "/");

3926 
	`¡rÿt
(
imageFeName
, 
f’ame
);

3930 
imageFeName
 = 
Ãw
 [
Ën
 + 1];

3932 
	`¡rıy
(
imageFeName
, 
f’ame
);

3934 #ifdeà
_WIN32


3935 
	`»v”£BackSÏshes
(
imageFeName
);

3938  
	`fšishImageLßdšg
(
image
, 
¡acked
, 
m­ToWÜld
, 
ex‹º®
);

3939 
	}
}

3941 
boŞ
 
	gP3DCÚŒŞ
::
	$g‘IsImageScked
()

3943 
Image3D
 * 
image
;

3945 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

3946 ià(
image
 =ğ
NULL
)

3947  
çl£
;

3948  
image
->
	`g‘IsImageScked
();

3949 
	}
}

3951 
	gP3DCÚŒŞ
::
	$£tIÅutImageSÿlšg
(
boŞ
 
sÿËIÅut
)

3953 
AÎImageIO
::
	`£tImageSÿlšg
(
sÿËIÅut
);

3954 
	}
}

3956 #ifdeà
BINARY


3958 
	gP3DCÚŒŞ
::
	$£tDi¡M­PŒ
(
ImageDi¡ªûM­
 * 
im
)

3960 
di¡_m­
 = 
im
 ;

3962 ià(
m©ch
 =ğ
NULL
)

3970 
m©ch
->
	`£tDi¡M­
(
di¡_m­
);

3972 
di¡_m­
 = 
NULL
;

3974 
	}
};

3978 
ImageDi¡ªûM­
 * 
	gP3DCÚŒŞ
::
	$g‘Di¡M­PŒ
()

3980 ià(
di¡_m­
)

3981  
di¡_m­
;

3982 ià(
m©ch
)

3983  
m©ch
->
	`g‘ImageDi¡M­Poš‹r
();

3984  
NULL
;

3985 
	}
}

3987 
boŞ
 
	gP3DCÚŒŞ
::
	$lßdDi¡M­
(cÚ¡ * 
f’ame
)

3989 
AÎImageIO
 
imageFe
;

3990 
Image3D
 * 
di¡M­Image
;

3992 ià(! 
f’ame
 || ! *filename)

3993  
çl£
;

3995 
cout
 << 
f’ame
 << 
’dl
;

3996 
di¡M­Image
 = 
imageFe
.
	`»ad
(
f’ame
);

3998 ià(
di¡M­Image
 =ğ
NULL
)

3999  
çl£
;

4001 
ImageDi¡ªûM­
 * 
dm
 = 
Ãw
 ImageDistanceMap;

4002 
dm
->
	`äomImage3D
(
di¡M­Image
);

4003 
	`£tDi¡M­PŒ
(
dm
);

4004  
Œue
;

4006 
	#WRITE_DISTANCE_MAPS


	)

4008 #ifdeà
WRITE_DISTANCE_MAPS


4010 * 
ouutDi¡ªûM­D©aFeName
 = 
	`ÿlcOuutDMF’ame
Ğ(*è
f’ame
 ) ;

4012 
G»yV®ue
 
mšI
, 
maxI
 ;

4014 
di¡M­Image
->
	`¿nge
Ğ
mšI
, 
maxI
 ) ;

4016 
imageFe
.
	`wr™e
Ğ
ouutDi¡ªûM­D©aFeName
, *
di¡M­Image
, 
mšI
, 
maxI
 ) ;

4020 
	}
}

4022 
boŞ
 
	gP3DCÚŒŞ
::
	$lßdAÁŸlŸ£dDi¡M­
(cÚ¡ * 
f’ame
 )

4024 
Ën
 = 
	`¡¾’
(
f’ame
);

4025 cÚ¡ * 
ddmFeEx‹nsiÚ
 = ".mhd";

4026 
suffixL’
 = 
	`¡¾’
(".mhd");

4028 * 
f’ame_g¿dX
 = 
NULL
 ;

4029 * 
f’ame_g¿dY
 = 
NULL
 ;

4030 * 
f’ame_g¿dZ
 = 
NULL
 ;

4036 
boŞ
 
USE_PABLO_DMAP
 = 1 ;

4038 ifĞ
USE_PABLO_DMAP
 ) {

4040 
f’ame_g¿dX
 = 
Ãw
 [
Ën
] ;

4041 
	`¡rıy
Ğ
f’ame_g¿dX
, 
f’ame
 ) ;

4043 
f’ame_g¿dY
 = 
Ãw
 [
Ën
] ;

4044 
	`¡rıy
Ğ
f’ame_g¿dY
, 
f’ame
 ) ;

4046 
f’ame_g¿dZ
 = 
Ãw
 [
Ën
] ;

4047 
	`¡rıy
Ğ
f’ame_g¿dZ
, 
f’ame
 ) ;

4052 
f’ame_g¿dX
 = 
Ãw
 [
Ën
+
suffixL’
+6];

4053 
	`¡rıy
(
f’ame_g¿dX
, 
f’ame
);

4054 
	`¡rıy
(
f’ame_g¿dX
 + 
Ën
 - 
suffixL’
, "_gradX");

4055 
f’ame_g¿dX
 = 
	`¡rÿt
(f’ame_g¿dX, 
ddmFeEx‹nsiÚ
);

4057 
f’ame_g¿dY
 = 
Ãw
 [
Ën
+
suffixL’
+6];

4058 
	`¡rıy
(
f’ame_g¿dY
, 
f’ame
);

4059 
	`¡rıy
(
f’ame_g¿dY
 + 
Ën
 - 
suffixL’
, "_gradY");

4060 
f’ame_g¿dY
 = 
	`¡rÿt
(f’ame_g¿dY, 
ddmFeEx‹nsiÚ
);

4062 
f’ame_g¿dZ
 = 
Ãw
 [
Ën
+
suffixL’
+6];

4063 
	`¡rıy
(
f’ame_g¿dZ
, 
f’ame
);

4064 
	`¡rıy
(
f’ame_g¿dZ
 + 
Ën
 - 
suffixL’
, "_gradZ");

4065 
f’ame_g¿dZ
 = 
	`¡rÿt
(f’ame_g¿dZ, 
ddmFeEx‹nsiÚ
);

4073 
AÎImageIO
 
imageIOHªdËr
 ;

4075 
Image3D
 * 
ªtŸlŸ£dDi¡M­Image
 ;

4077 
Image3D
 * 
ªtŸlŸ£dDi¡G¿dXImage
 ;

4078 
Image3D
 * 
ªtŸlŸ£dDi¡G¿dYImage
 ;

4079 
Image3D
 * 
ªtŸlŸ£dDi¡G¿dZImage
 ;

4081 ià(! 
f’ame
 || ! *f’ame||! 
f’ame_g¿dX
 || ! *f’ame_g¿dX||! 
f’ame_g¿dY


4082 || ! *
f’ame_g¿dY
||! *
f’ame_g¿dZ
||! filename_gradZ)

4083  
çl£
;

4086 
ªtŸlŸ£dDi¡M­Image
 = 
imageIOHªdËr
.
	`»ad
(
f’ame
);

4088 ifĞ
ªtŸlŸ£dDi¡M­Image
 =ğ
NULL
 )

4089 Ğ
çl£
 ) ;

4093 
ªtŸlŸ£dDi¡G¿dXImage
 = 
imageIOHªdËr
.
	`»ad
(
f’ame_g¿dX
);

4095 
ªtŸlŸ£dDi¡G¿dYImage
 = 
imageIOHªdËr
.
	`»ad
(
f’ame_g¿dY
);

4097 
ªtŸlŸ£dDi¡G¿dZImage
 = 
imageIOHªdËr
.
	`»ad
(
f’ame_g¿dZ
);

4099 iàĞ(
ªtŸlŸ£dDi¡M­Image
 =ğ
NULL
è|| (
ªtŸlŸ£dDi¡G¿dXImage
 == NULL) ||

4100 (
ªtŸlŸ£dDi¡G¿dYImage
 =ğ
NULL
è|| (
ªtŸlŸ£dDi¡G¿dZImage
 == NULL) ) {

4101  
çl£
;

4106 
ImageDi¡ªûM­
 * 
dm
 = 
Ãw
 ImageDistanceMap ;

4108 
dm
->
	`äomImage3D
(
ªtŸlŸ£dDi¡M­Image
);

4112 
dm
->
	`ü—‹G¿dDi¡M­FromG¿dXYZ
(
ªtŸlŸ£dDi¡G¿dXImage
,
ªtŸlŸ£dDi¡G¿dYImage
,
ªtŸlŸ£dDi¡G¿dZImage
);

4117 
	`£tDi¡M­PŒ
(
dm
);

4126  
Œue
;

4127 
	}
}

4130 
boŞ
 
	gP3DCÚŒŞ
::
	$lßdTeS‘
(cÚ¡ * 
f’ame
, 
boŞ
 
¥l™
, boŞ 
u£WÜldCoÜds
)

4132 ià(
f’ame
 =ğ
NULL
 || 0 =ğ
	`¡¾’
(filename))

4133  
çl£
;

4135 
Image3D
 * 
image
;

4136 ià(
u£WÜldCoÜds
) {

4137 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

4138 ià(
image
 =ğ
NULL
) {

4139 
cout
 << "An image mustƒxisto†oad BYUiles in world coordinates"

4140 << 
’dl
;

4141 
	`b“p
();

4142 
image
 = 
NULL
;

4146 
image
 = 
NULL
;

4149 ià(
teS‘
 !ğ
NULL
) {

4150 ià(
teS‘
->
	`lßdFe
(
f’ame
, 
¥l™
, 
image
è=ğ
çl£
)

4151  
çl£
;

4154 
teS‘
 = 
Ãw
 
	`TeS‘
(
f’ame
, 
¥l™
, 
image
);

4155 ià(
teS‘
->
	`teCouÁ
() == 0)

4156  
çl£
;

4158 
teS‘
->
	`ÿlcCOG
(
teS‘MobeFigu»
);

4159  
Œue
;

4160 
	}
}

4162 
boŞ
 
	gP3DCÚŒŞ
::
	$­³ndTeS‘
(cÚ¡ * 
f’ame
, 
boŞ
 
¥l™
, boŞ 
u£WÜldCoÜds
)

4164 ià(
teS‘
 =ğ
NULL
)

4165  
	`lßdTeS‘
(
f’ame
, 
¥l™
, 
u£WÜldCoÜds
);

4167 ià(
f’ame
 =ğ
NULL
 || 0 =ğ
	`¡¾’
(filename))

4168  
çl£
;

4170 ià(! 
teS‘
->
	`byuFÜm©
()) {

4171 
cout
 << "Firstile set†oaded must have BYU formato mergeile sets"

4172 << 
’dl
;

4173  
çl£
;

4176 
Image3D
 * 
image
;

4177 ià(
u£WÜldCoÜds
) {

4178 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

4179 ià(
image
 =ğ
NULL
) {

4180 
cout
 << "An image mustƒxisto†oad BYUiles in world coordinates"

4181 << 
’dl
;

4182 
	`b“p
();

4183 
image
 = 
NULL
;

4187 
image
 = 
NULL
;

4190 ià(
teS‘
->
	`lßdAµ’dFe
(
f’ame
, 
¥l™
, 
image
è=ğ
çl£
)

4191  
çl£
;

4193  
Œue
;

4194 
	}
}

4242 
boŞ
 
	gP3DCÚŒŞ
::
	$ev®u©eTeS‘Ty³s
(
numFes
, cÚ¡ ** 
f’ames
,

4243 & 
mš
, & 
max
)

4245 
TeS‘
 
ts
;

4246 
ty³1
, 
ty³2
;

4247 
boŞ
 
isBYU
, 
dÚe
;

4249 
ty³1
 = 
ts
.
	`ty³
(
f’ames
[0], 
isBYU
);

4251 ià(! 
isBYU
) {

4252 
cout
 << "Old-¡yË .t fe ÿÂÙ blßded w™h oth”£ts" << 
’dl
;

4253  
çl£
;

4255 
mš
 = 
ty³1
;

4256 
max
 = 
ty³1
;

4257 ià(
ty³1
 == 0)

4258  
çl£
;

4260 
dÚe
 = 
çl£
;

4261 
i
 = 1; i < 
numFes
; i++) {

4262 
ty³2
 = 
ts
.
	`ty³
(
f’ames
[
i
], 
isBYU
);

4264 ià(! 
isBYU
) {

4265 
cout
 << "Old-¡yË .t fe ÿÂÙ blßded w™h oth”£ts" << 
’dl
;

4266  
çl£
;

4268 ià(
ty³2
 == 0)

4269  
çl£
;

4271 ià(! 
dÚe
 && 
ty³1
 !ğ
ty³2
) {

4272 
mš
 = 3;

4273 
max
 = 4;

4274 
dÚe
 = 
Œue
;

4278  
Œue
;

4279 
	}
}

4282 
boŞ
 
	gP3DCÚŒŞ
::
	$lßdAuxTeS‘
(cÚ¡ * 
f’ame
)

4284 
BYU
 * 
auxBYU
;

4286 if(
f’ame
 =ğ
NULL
 || 0 =ğ
	`¡¾’
(filename))

4287  
çl£
;

4289 
auxBYU
 = (
BYU
 *è
auxTeS‘
;

4290 if(
auxBYU
 !ğ
NULL
) {

4291 
auxBYU
->
	`ş—r
();

4292 ià(
auxBYU
->
	`»ad
(
f’ame
è=ğ
çl£
)

4293  
çl£
;

4296 
auxBYU
 = 
Ãw
 
	`BYU
(
f’ame
);

4297 
auxTeS‘
 = 
auxBYU
;

4298 ià(
auxBYU
->
	`teLi¡L’gth
() == 0)

4299  
çl£
;

4302  
Œue
;

4303 
	}
}

4305 
	gP3DCÚŒŞ
::
	$ş—rTeS‘
()

4307 ià(
teS‘
)

4309 
d–‘e
 
teS‘
;

4310 
teS‘
 = 
NULL
;

4312 ià(!
teS‘
)

4313 
teS‘
 = 
Ãw
 
TeS‘
;

4314 
	}
}

4317 
boŞ
 
	gP3DCÚŒŞ
::
	$g’”©eTeS‘
()

4319 
Image3D
 * 
image
;

4321 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

4322 ià(
image
 =ğ
NULL
)

4323  
çl£
;

4325 #ifdeà
BINARY


4326 ià(
glob®V”bos™y
 > -1)

4327 
cout
 << "R•Ïcšge by g’”©edes..." << 
æush
;

4329 
cout
 << "G’”©šge£ˆ" << 
æush
;

4331 ià(! 
teS‘
)

4332 
teS‘
 = 
Ãw
 
TeS‘
;

4334 ià(! 
teS‘
->
	`sim¶eM¬chšgCubes
(
image
)) {

4335 
	`b“p
();

4336  
çl£
;

4339 #ifdeà
BINARY


4340 ià(
glob®V”bos™y
 > -1)

4342 
cout
 << " dÚe" << 
’dl
;

4344  
Œue
;

4345 
	}
}

4348 
boŞ
 
	gP3DCÚŒŞ
::
	$§veTeS‘
(cÚ¡ * 
f’ame
, 
boŞ
 
u£WÜldCoÜds
)

4350 
Image3D
 * 
image
;

4352 ià(
f’ame
 =ğ
NULL
 || 0 =ğ
	`¡¾’
(filename))

4353  
çl£
;

4355 ià(
teS‘
 =ğ
NULL
)

4356  
çl£
;

4357 ià(
teS‘
->
	`teCouÁ
() == 0)

4358  
çl£
;

4360 ià(
u£WÜldCoÜds
) {

4361 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

4362 ià(
image
 =ğ
NULL
) {

4363 
cout
 << "An image mustƒxisto save BYUiles in world coordinates"

4364 << 
’dl
;

4365 
	`b“p
();

4366  
çl£
;

4370 
image
 = 
NULL
;

4372 
boŞ
 
quads
 = 
glob®CÚŒŞ
->
	`»adBoŞ
(
BYUOuutTy³
);

4373  
teS‘
->
	`§veFe
(
f’ame
, 
quads
, 
image
);

4374 
	}
}

4376 
boŞ
 
	gP3DCÚŒŞ
::
	$haveTeS‘
() const

4378 ià(
teS‘
 =ğ
NULL
)

4379  
çl£
;

4380 ià(
teS‘
->
	`teCouÁ
() == 0)

4381  
çl£
;

4382  
Œue
;

4383 
	}
}

4385 
	gP3DCÚŒŞ
::
	$addQuadFigu»
(
numRows
, 
numCŞumns
, * 
figu»Name
,

4386 * 
cŞÜ
)

4388 
M3DFigu»
 * 
figu»
;

4390 
makeLªdm¬k
 = 0;

4392 
off£t
 = 0;

4393 ià(
	`¡r¡r
(
figu»Name
, "LM-"))

4397 
off£t
 = 3;

4398 
makeLªdm¬k
 = 1;

4403 cÚ¡ 
wh™e
[] = { 1.0, 1.0, 1.0 };

4405 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

4408 if(
objeù
 =ğ
NULL
)

4409 
objeù
 = 
Ãw
 
M3DObjeù
;

4411 
	`¡¬tO³¿tiÚ
();

4413 ifĞ
numRows
 == 1 ) {

4414 
M3DTubeFigu»
* 
tube
 = 
Ãw
 M3DTubeFigure;

4415 ià(
makeLªdm¬k
)

4416 
tube
->
	`makeLªdm¬kStockFigu»
(2);

4418 
tube
->
	`makeEÎtiÿlStockFigu»
(
numCŞumns
);

4419 
figu»
 = 
tube
;

4422 
M3DQuadFigu»
* 
quad
 = 
Ãw
 M3DQuadFigure;

4423 ià(
makeLªdm¬k
)

4424 
quad
->
	`makeLªdm¬kStockFigu»
(2,2);

4426 
quad
->
	`makeEÎtiÿlStockFigu»
(
numRows
, 
numCŞumns
);

4427 
figu»
 = 
quad
;

4430 ià(
figu»Name
 && *figureName)

4431 
figu»
->
	`£tName
(
figu»Name
 + 
off£t
);

4432 ià(
cŞÜ
[0] != 0.0 || color[1] != 0.0 || color[2] != 0.0)

4433 
figu»
->
	`£tCŞÜ
(
cŞÜ
);

4435 
figu»
->
	`£tCŞÜ
(
wh™e
);

4436 
objeù
->
	`de£Ëù
();

4437 
figu»
->
	`£Ëù
();

4439 
objeù
->
	`addFigu»
((
M3DFigu»
*è
figu»
);

4441 
	`’dO³¿tiÚ
();

4443 
	`mod–N“dsSavšg
();

4444 
£ËùiÚChªged
 = 
Œue
;

4446  
objeù
->
	`g‘Figu»CouÁ
() - 1;

4447 
	}
}

4450 
	gP3DCÚŒŞ
::
	$»moveS–eùedFigu»s
()

4452 
M3DFigu»
 * 
figu»PŒ
;

4453 
numFigu»s
;

4454 
i
;

4455 
m¬kedFigu»
, 
´imIndex
;

4457 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

4460 if(
objeù
 =ğ
NULL
)

4463 
	`¡¬tO³¿tiÚ
();

4464 
	`g‘R–©iveM¬kedPrim™iveId
(
m¬kedFigu»
, 
´imIndex
);

4466 
numFigu»s
 = 
objeù
->
	`g‘Figu»CouÁ
();

4467 
i
 = 
numFigu»s
 - 1; i >= 0; i--)

4469 
figu»PŒ
 = 
objeù
->
	`g‘Figu»PŒ
(
i
);

4470 if(
figu»PŒ
 !ğ
NULL
 && figu»PŒ->
	`isS–eùed
()) {

4471 ià(
i
 =ğ
m¬kedFigu»
)

4472 
m¬kedPrim™iveId
 = 
INVALID_PRIMITIVE_ID
;

4473 ià(
i
 < 
m¬kedFigu»
)

4474 
m¬kedPrim™iveId
 -ğ
figu»PŒ
->
	`g‘Prim™iveCouÁ
();

4475 
objeù
->
	`d–‘eFigu»
(
i
);

4478 ià(
m¬kedPrim™iveId
 < 0)

4479 
m¬kedPrim™iveId
 = 
INVALID_PRIMITIVE_ID
;

4481 
numFigu»s
 = 
objeù
->
	`g‘Figu»CouÁ
();

4482 ià(
numFigu»s
 == 0)

4485 
d–‘e
 
objeù
;

4486 
objeù
 = 
NULL
;

4487 ià(! 
©chedSts
) {

4488 
d–‘e
 
pgaSts
;

4489 
d–‘e
 
©omPgaSts
;

4491 
pgaSts
 = 
NULL
;

4492 
©omPgaSts
 = 
NULL
;

4493 
ınsSts
 = 
NULL
 ;

4495 ià(
glob®V”bos™y
 >= 0)

4496 
cout
 << "AÎ figu» »moved: mod– disÿrded" << 
’dl
;

4498 ià(
»ã»nûObjeù
 !ğ
NULL
) {

4499 
d–‘e
 
»ã»nûObjeù
;

4500 
»ã»nûObjeù
 = 
NULL
;

4502 
m¬kedPrim™iveId
 = 
INVALID_PRIMITIVE_ID
;

4504 
	`mod–IsSaved
();

4505 
shiáOnPa¡e
 = 
çl£
;

4508 
	`mod–N“dsSavšg
(
Œue
);

4509 
£ËùiÚChªged
 = 
Œue
;

4512 
	`’dO³¿tiÚ
();

4513 
	}
}

4517 
boŞ
 
	gP3DCÚŒŞ
::
	$isFigu»SubT»eS–eùed
(
M3DFigu»T»eNode
 * 
node
)

4519 if(!
objeù
->
	`g‘Figu»PŒ
(
node
->
	`g‘Figu»Id
())->
	`isS–eùed
())

4520  
çl£
;

4522 
M3DFigu»T»eNode
 * 
chd
;

4523 
chdCouÁ
, 
i
;

4525 
chdCouÁ
 = 
node
->
	`g‘ChdCouÁ
();

4526 
i
 = 0; i < 
chdCouÁ
; i++)

4528 
chd
 = 
node
->
	`g‘Chd
(
i
);

4529 ià(! 
	`isFigu»SubT»eS–eùed
(
chd
))

4530  
çl£
;

4533  
Œue
;

4534 
	}
}

4537 
	gP3DCÚŒŞ
::
	$Œª¦©e
(cÚ¡ 
VeùÜ3D
 &
Œªs
)

4539 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
 &&

4540 
ed™šgMode
 !ğ
SIMILARITY_ONLY_EDITING_MODE
)

4543 if(
objeù
)

4546 #ifdeà
BINARY


4550 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

4553 
M3DFigu»
 *
figu»
;

4554 
M3DFigu»
 *
ŞdFigu»
;

4555 #ifdeà
BINARY


4556 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

4558 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(0);

4560 
ŞdFigu»
 = 
figu»
->
	`assign
();

4562 
	`¡¬tO³¿tiÚ
();

4564 
objeù
->
	`Œª¦©eBy
(
Œªs
);

4565 #iâdeà
BINARY


4566 
hªdPÏûm’tT¿nsfÜm
->
	`Œª¦©eBy
(
Œªs
);

4569 if(
»cÜdšgT¿nsfÜm©iÚ
)

4570 
»cÜdedT¿nsfÜm©iÚ
->
	`Œª¦©eBy
(
Œªs
);

4572 #iâdeà
BINARY


4587 
M3DFigu»T»eNode
 *
figu»T»eNode
, *
subFigNode
;

4588 
i
;

4589 #iâdeà
BINARY


4590 
figu»Id
 = 0;

4594 
M3DSubfigu»T¿nsfÜm©iÚ
 
subfigu»_xfÜm
;

4596 
figu»T»eNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

4597 ià(
figu»
->
	`isAnyS–eùed
(è&& ! 
	`isFigu»SubT»eS–eùed
(
figu»T»eNode
))

4599 
figu»T»eNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

4601 
i
 = 0;

4602 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

4603 
subFigNode
 !ğ
NULL
)

4605 
subfigu»_xfÜm
.
	`š™
(
objeù
, 
subFigNode
);

4606 
subfigu»_xfÜm
.
	`upd©eSubfigu»
(
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>(
ŞdFigu»
));

4607 
i
++;

4608 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

4612 
	`mod–N“dsSavšg
(
Œue
);

4613 
£ËùiÚChªged
 = 
Œue
;

4616 ià(
teS‘
 && 
teS‘Mobe
) {

4617 
teS‘
->
	`Œª¦©eBy
(
Œªs
, 
teS‘MobeFigu»
);

4618 
teS‘
->
	`£tG’”©ed
();

4620 
	}
}

4622 
	gP3DCÚŒŞ
::
	$rÙ©e
(
Qu©
 &
q
)

4624 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
 &&

4625 
ed™šgMode
 !ğ
SIMILARITY_ONLY_EDITING_MODE
)

4628 if(
objeù
)

4630 
M3DFigu»
 *
figu»
;

4631 
M3DFigu»
 *
ŞdFigu»
;

4632 #ifdeà
BINARY


4633 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

4634 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

4636 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(0);

4638 
ŞdFigu»
 = 
figu»
->
	`assign
();

4640 
	`¡¬tO³¿tiÚ
();

4642 
objeù
->
	`rÙ©eBy
(
q
);

4644 #iâdeà
BINARY


4646 
VeùÜ3D
 
g¿vûÁ”
 = 
objeù
->
	`g‘COG
();

4647 
hªdPÏûm’tT¿nsfÜm
->
	`Œª¦©eBy
(-
g¿vûÁ”
);

4648 
hªdPÏûm’tT¿nsfÜm
->
	`rÙ©eBy
(
q
);

4649 
hªdPÏûm’tT¿nsfÜm
->
	`Œª¦©eBy
(
g¿vûÁ”
);

4652 if(
»cÜdšgT¿nsfÜm©iÚ
)

4654 
VeùÜ3D
 
cog
 = 
objeù
->
	`g‘COG
();

4655 
»cÜdedT¿nsfÜm©iÚ
->
	`Œª¦©eBy
(-
cog
);

4656 
»cÜdedT¿nsfÜm©iÚ
->
	`rÙ©eBy
(
q
);

4657 
»cÜdedT¿nsfÜm©iÚ
->
	`Œª¦©eBy
(
cog
);

4660 
M3DFigu»T»eNode
 *
figu»T»eNode
, *
subFigNode
;

4661 
i
;

4662 #iâdeà
BINARY


4663 
figu»Id
 = 0;

4669 
M3DSubfigu»T¿nsfÜm©iÚ
 
subfigu»_xfÜm
;

4671 
figu»T»eNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

4672 ià(
figu»
->
	`isAnyS–eùed
(è&& ! 
	`isFigu»SubT»eS–eùed
(
figu»T»eNode
))

4674 
figu»T»eNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

4676 
i
 = 0;

4677 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

4678 
subFigNode
 !ğ
NULL
)

4680 
subfigu»_xfÜm
.
	`š™
(
objeù
, 
subFigNode
);

4681 
subfigu»_xfÜm
.
	`upd©eSubfigu»
(
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>(
ŞdFigu»
));

4682 
i
++;

4683 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

4687 
	`mod–N“dsSavšg
(
Œue
);

4688 
£ËùiÚChªged
 = 
Œue
;

4690 
	}
}

4692 
	gP3DCÚŒŞ
::
	$rÙ©eTeS‘
(
Qu©
 &
q
)

4694 ià(
teS‘
 && 
teS‘Mobe
) {

4695 
teS‘
->
	`rÙ©eBy
(
q
, 
teS‘MobeFigu»
);

4696 
teS‘
->
	`£tG’”©ed
();

4698 
	}
}

4700 
	gP3DCÚŒŞ
::
	$pœou‘‹TeS‘
(
Qu©
 &
q
)

4702 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
 &&

4703 
ed™šgMode
 !ğ
SIMILARITY_ONLY_EDITING_MODE
)

4706 ià(
teS‘
 && 
teS‘Mobe
) {

4707 
teS‘
->
	`pœou‘‹By
(
q
, 
teS‘MobeFigu»
);

4708 
teS‘
->
	`£tG’”©ed
();

4710 
	}
}

4714 
	gP3DCÚŒŞ
::
	$sÿË
(
v®
)

4716 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
 &&

4717 
ed™šgMode
 !ğ
SIMILARITY_ONLY_EDITING_MODE
)

4720 if(
objeù
)

4722 
M3DFigu»
 *
figu»
;

4723 
M3DFigu»
 *
ŞdFigu»
;

4724 #ifdeà
BINARY


4725 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

4726 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

4728 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(0);

4730 
ŞdFigu»
 = 
figu»
->
	`assign
();

4732 
	`¡¬tO³¿tiÚ
();

4734 
objeù
->
	`sÿËBy
(
v®
);

4736 #iâdeà
BINARY


4737 
VeùÜ3D
 
g¿vûÁ”
 = 
objeù
->
	`g‘COG
();

4738 
hªdPÏûm’tT¿nsfÜm
->
	`Œª¦©eBy
(-
g¿vûÁ”
);

4739 
hªdPÏûm’tT¿nsfÜm
->
	`sÿËBy
(
v®
);

4740 
hªdPÏûm’tT¿nsfÜm
->
	`Œª¦©eBy
(
g¿vûÁ”
);

4743 if(
»cÜdšgT¿nsfÜm©iÚ
)

4745 
VeùÜ3D
 
cog
 = 
objeù
->
	`g‘COG
();

4746 
»cÜdedT¿nsfÜm©iÚ
->
	`Œª¦©eBy
(-
cog
);

4747 
»cÜdedT¿nsfÜm©iÚ
->
	`sÿËBy
(
v®
);

4748 
»cÜdedT¿nsfÜm©iÚ
->
	`Œª¦©eBy
(
cog
);

4751 
M3DFigu»T»eNode
 *
figu»T»eNode
, *
subFigNode
;

4752 
i
;

4753 #ifdeà
BINARY


4756 
figu»Id
 = 0;

4760 
M3DSubfigu»T¿nsfÜm©iÚ
 
subfigu»_xfÜm
;

4762 
figu»T»eNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

4763 ià(
figu»
->
	`isAnyS–eùed
(è&& ! 
	`isFigu»SubT»eS–eùed
(
figu»T»eNode
))

4765 
figu»T»eNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

4767 
i
 = 0;

4768 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

4769 
subFigNode
 !ğ
NULL
)

4771 
subfigu»_xfÜm
.
	`š™
(
objeù
, 
subFigNode
);

4772 
subfigu»_xfÜm
.
	`upd©eSubfigu»
(
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>(
ŞdFigu»
));

4773 
i
++;

4774 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

4778 
	`mod–N“dsSavšg
(
Œue
);

4779 
£ËùiÚChªged
 = 
Œue
;

4782 ià(
teS‘
 && 
teS‘Mobe
) {

4783 
teS‘
->
	`sÿËBy
(
v®
, 
teS‘MobeFigu»
);

4784 
teS‘
->
	`£tG’”©ed
();

4787 
	}
}

4790 
	gP3DCÚŒŞ
::
	$sÿËWidth
(
v®
)

4792 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

4795 if(
objeù
 =ğ
NULL
)

4798 
	`¡¬tO³¿tiÚ
();

4800 
objeù
->
	`sÿËWidth
(
v®
);

4802 
	`mod–N“dsSavšg
(
Œue
);

4803 
£ËùiÚChªged
 = 
Œue
;

4804 
	}
}

4806 
	gP3DCÚŒŞ
::
	$–Úg©eRow
(
v®
)

4808 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

4811 ià(! 
	`š™ŸlizeElÚg©”
())

4814 if(
–Úg©”
 =ğ
NULL
)

4817 
	`¡¬tO³¿tiÚ
();

4820 
–Úg©”
->
	`£tElÚg©iÚM‘hod
(
M3D_ELONGATE_ROW
);

4821 
–Úg©”
->
	`–Úg©e
(
v®
);

4822 
	`’dO³¿tiÚ
();

4823 
	`mod–N“dsSavšg
(
Œue
);

4824 
£ËùiÚChªged
 = 
Œue
;

4825 
–Úg©”
->
	`upd©e
();

4826 
	}
}

4828 
	gP3DCÚŒŞ
::
	$–Úg©eCŞumn
(
v®
)

4830 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

4833 ià(! 
	`š™ŸlizeElÚg©”
())

4836 ià(
–Úg©”
 =ğ
NULL
)

4839 
	`¡¬tO³¿tiÚ
();

4842 
–Úg©”
->
	`£tElÚg©iÚM‘hod
(
M3D_ELONGATE_COLUMN
);

4843 
–Úg©”
->
	`–Úg©e
(
v®
);

4844 
	`’dO³¿tiÚ
();

4845 
	`mod–N“dsSavšg
(
Œue
);

4846 
£ËùiÚChªged
 = 
Œue
;

4847 
–Úg©”
->
	`upd©e
();

4848 
	}
}

4850 
boŞ
 
	gP3DCÚŒŞ
::
	$š™ŸlizeElÚg©”
()

4852 
M3DFigu»
 * 
figu»
;

4853 
figu»Id
, 
©omId
;

4855 if(
–Úg©”
 !ğ
NULL
) {

4856 
d–‘e
 
–Úg©”
;

4857 
–Úg©”
 = 
NULL
;

4860 ià(
objeù
 =ğ
NULL
)

4861  
çl£
;

4863 
	`g‘R–©iveM¬kedPrim™iveId
(
figu»Id
, 
©omId
);

4864 ià(
figu»Id
 < 0)

4865  
çl£
;

4868 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

4869 
–Úg©”
 = 
Ãw
 
	`M3DFigu»ElÚg©”
(
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>(
figu»
));

4870  
Œue
;

4871 
	}
}

4873 
	gP3DCÚŒŞ
::
	$£tTh‘a
(
v®
)

4875 
M3DPrim™ive
 * 
m¬kedPrim™ive
;

4877 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

4880 if(
objeù
 =ğ
NULL
)

4883 
m¬kedPrim™ive
 = 
	`g‘M¬kedPrim™ive
();

4884 if(
m¬kedPrim™ive
 =ğ
NULL
)

4893 
	`¡¬tO³¿tiÚ
();

4895 
m¬kedPrim™ive
->
	`£tTh‘a
(
v®
);

4897 
	`’dO³¿tiÚ
();

4898 
	`mod–N“dsSavšg
(
Œue
);

4899 
£ËùiÚChªged
 = 
Œue
;

4900 
	}
}

4902 
	gP3DCÚŒŞ
::
	$£tElÚg©iÚ
(
v®
)

4904 
M3DPrim™ive
 * 
m¬kedPrim™ive
;

4906 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

4909 if(
objeù
 =ğ
NULL
)

4912 
m¬kedPrim™ive
 = 
	`g‘M¬kedPrim™ive
();

4913 if(
m¬kedPrim™ive
 =ğ
NULL
 || m¬kedPrim™ive->
	`ty³
(è!ğ
M3D_END_PRIMITIVE
)

4922 
	`¡¬tO³¿tiÚ
();

4924 
dyÇmic_ÿ¡
<
M3DEndPrim™ive
*>(
m¬kedPrim™ive
)->
	`£tElÚg©iÚ
(
v®
);

4926 
	`’dO³¿tiÚ
();

4927 
	`mod–N“dsSavšg
(
Œue
);

4928 
£ËùiÚChªged
 = 
Œue
;

4929 
	}
}

4931 
	gP3DCÚŒŞ
::
	$toggËFigu»
(
figId
)

4933 
M3DFigu»
 * 
figu»PŒ
;

4935 if(
objeù
 =ğ
NULL
 || ! 
	`£ËùiÚIsAÎowed
())

4938 
figu»PŒ
 = 
objeù
->
	`g‘Figu»PŒ
(
figId
);

4939 ià(
figu»PŒ
 !ğ
NULL
) {

4940 ià(
figu»PŒ
->
	`isS–eùed
())

4941 
figu»PŒ
->
	`de£Ëù
();

4943 
figu»PŒ
->
	`£Ëù
();

4945 
£ËùiÚChªged
 = 
Œue
;

4946 
	}
}

4948 
	gP3DCÚŒŞ
::
	$toggËPrim™ive
(
´imId
)

4950 
M3DPrim™ive
 * 
´im™ivePŒ
;

4952 if(
objeù
 =ğ
NULL
 || ! 
	`£ËùiÚIsAÎowed
())

4955 
´im™ivePŒ
 = 
objeù
->
	`g‘Prim™ivePŒ
(
´imId
);

4956 if(
´im™ivePŒ
 !ğ
NULL
)

4957 
´im™ivePŒ
->
	`toggËS–eùed
();

4958 
£ËùiÚChªged
 = 
Œue
;

4959 
	}
}

4961 
	gP3DCÚŒŞ
::
	$£ËùAÎ
()

4963 if(
objeù
 =ğ
NULL
 || ! 
	`£ËùiÚIsAÎowed
())

4966 
objeù
->
	`£Ëù
();

4967 
£ËùiÚChªged
 = 
Œue
;

4968 
	}
}

4970 
	gP3DCÚŒŞ
::
	$de£ËùAÎ
()

4972 if(
objeù
 =ğ
NULL
 || ! 
	`£ËùiÚIsAÎowed
())

4975 
objeù
->
	`de£Ëù
();

4976 
£ËùiÚChªged
 = 
Œue
;

4977 
	}
}

4979 
	gP3DCÚŒŞ
::
	$toggËAÎ
()

4981 if(
objeù
 =ğ
NULL
 || ! 
	`£ËùiÚIsAÎowed
())

4984 
objeù
->
	`toggËS–eùed
();

4985 
£ËùiÚChªged
 = 
Œue
;

4986 
	}
}

4989 
	gP3DCÚŒŞ
::
	$cİy
()

4991 
M3DFigu»
 * 
figu»PŒ
;

4992 
M3DFigu»
 * 
ÃwFigu»PŒ
;

4993 
numFigu»s
, 
numT»es
;

4994 
M3DFigu»T»eNode
 * 
node
;

4995 
M3DFigu»T»eNode
 * 
·»Á
;

4996 
M3DFigu»T»eNode
 * 
cİ›dNode
;

4997 
M3DPrim™iveLškInfo
 * 
ÃwLšk
;

4998 
M3DPrim™iveLškInfo
 * 
ŞdLšk
;

4999 * 
cİ›dFigu»s
;

5000 
numCİ›dFigu»s
;

5001 
chdId
;

5002 
ÃwChdId
;

5005 if(
objeù
 =ğ
NULL
)

5008 if(
objeùCİyBufãr
 !ğ
NULL
)

5010 
d–‘e
 
objeùCİyBufãr
;

5011 
objeùCİyBufãr
 = 
NULL
;

5014 
objeùCİyBufãr
 = 
Ãw
 
M3DObjeù
;

5015 
shiáOnPa¡e
 = 
Œue
;

5017 
numFigu»s
 = 
objeù
->
	`g‘Figu»CouÁ
();

5018 
cİ›dFigu»s
 = 
Ãw
 [
numFigu»s
 +‚umFigures];

5019 
numCİ›dFigu»s
 = 0;

5022 
ÃwChdId
 = 0;

5023 
chdId
 = 0; chdId < 
numFigu»s
; childId++)

5025 
figu»PŒ
 = 
objeù
->
	`g‘Figu»PŒ
(
chdId
);

5027 ià(
figu»PŒ
 =ğ
NULL
 || !(figu»PŒ->
	`isS–eùed
()))

5030 
ÃwFigu»PŒ
 = 
figu»PŒ
->
	`assign
();

5031 
objeùCİyBufãr
->
	`addFigu»
(
ÃwFigu»PŒ
);

5032 
cİ›dFigu»s
[
numCİ›dFigu»s
++] = 
chdId
;

5033 
cİ›dFigu»s
[
numCİ›dFigu»s
++] = 
ÃwChdId
;

5034 
ÃwChdId
++;

5038 
numT»es
 = 
objeù
->
	`g‘Figu»T»eCouÁ
();

5039 ià(
numT»es
 =ğ
numFigu»s
)

5042 
chdId
 = 0; chdId < 
numFigu»s
; childId++)

5044 
·»ÁId
;

5045 
ÃwP¬’tId
;

5046 
i
;

5047 
boŞ
 
cİy_©chm’t
;

5049 
figu»PŒ
 = 
objeù
->
	`g‘Figu»PŒ
(
chdId
);

5051 ià(
figu»PŒ
 =ğ
NULL
 || !(figu»PŒ->
	`isS–eùed
()))

5055 
node
 = 
objeù
->
	`g‘Figu»T»eNode
(
chdId
);

5056 
·»Á
 = 
node
->
	`g‘P¬’t
();

5057 ià(
·»Á
 =ğ
NULL
)

5061 
·»ÁId
 = 
·»Á
->
	`g‘Figu»Id
();

5062 
cİy_©chm’t
 = 
çl£
;

5063 
i
 = 0; i < 
numCİ›dFigu»s
; i += 2)

5064 ià(
cİ›dFigu»s
[
i
] =ğ
·»ÁId
) {

5066 
ÃwP¬’tId
 = 
cİ›dFigu»s
[
i
 + 1];

5067 
cİy_©chm’t
 = 
Œue
;

5070 ià(
cİy_©chm’t
) {

5072 
i
 = 0; i < 
numCİ›dFigu»s
; i += 2)

5073 ià(
cİ›dFigu»s
[
i
] =ğ
chdId
) {

5074 
ÃwChdId
 = 
cİ›dFigu»s
[
i
 + 1];

5078 
cİ›dNode
 = 
objeùCİyBufãr
->
	`g‘Figu»T»eNode
(
ÃwChdId
);

5079 
cİ›dNode
->
	`£tBËndAmouÁ
(
node
->
	`g‘BËndAmouÁ
());

5080 
cİ›dNode
->
	`£tBËndEx‹Á
(
node
->
	`g‘BËndEx‹Á
());

5081 
i
 = 0; i < 
node
->
	`g‘LškCouÁ
(); i++) {

5082 
ÃwLšk
 = 
Ãw
 
M3DPrim™iveLškInfo
;

5083 
ŞdLšk
 = 
node
->
	`g‘Lšk
(
i
);

5084 *
ÃwLšk
 = *
ŞdLšk
;

5085 
cİ›dNode
->
	`addLšk
(
ÃwLšk
);

5087 
objeùCİyBufãr
->
	`©chFigu»T»eNode
(
cİ›dNode
, 
ÃwP¬’tId
);

5090 
	}
}

5093 
	gP3DCÚŒŞ
::
	$·¡e
()

5095 
M3DFigu»
 * 
figu»PŒ
;

5096 
M3DFigu»
 * 
ÃwFigu»PŒ
;

5097 
numFigu»s
, 
numT»es
;

5098 
M3DFigu»T»eNode
 * 
node
;

5099 
M3DFigu»T»eNode
 * 
·»Á
;

5100 
M3DFigu»T»eNode
 * 
cİ›dNode
;

5101 
M3DPrim™iveLškInfo
 * 
ÃwLšk
;

5102 
M3DPrim™iveLškInfo
 * 
ŞdLšk
;

5103 * 
cİ›dFigu»s
;

5104 
numCİ›dFigu»s
;

5105 
chdId
;

5106 
ÃwChdId
;

5109 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

5112 if(
objeù
 =ğ
NULL
 || 
objeùCİyBufãr
 == NULL)

5115 
	`¡¬tO³¿tiÚ
();

5117 
objeù
->
	`de£Ëù
();

5118 
numFigu»s
 = 
objeùCİyBufãr
->
	`g‘Figu»CouÁ
();

5120 
cİ›dFigu»s
 = 
Ãw
 [
numFigu»s
 +‚umFigures];

5121 
numCİ›dFigu»s
 = 0;

5124 
VeùÜ3D
 
Œªs
;

5125 ià(
shiáOnPa¡e
 && 
numFigu»s
 > 0) {

5126 
figu»PŒ
 = 
objeùCİyBufãr
->
	`g‘Figu»PŒ
(0);

5127 
M3DPrim™ive
 * 
´im
 = 
figu»PŒ
->
	`g‘Prim™ivePŒ
(0);

5128 
t
 = 
´im
->
	`g‘R
()/3.0;

5129 
Œªs
 = 
	`VeùÜ3D
(
t
,,);

5133 
ÃwChdId
 = 
objeù
->
	`g‘Figu»CouÁ
();

5134 
chdId
 = 0; chdId < 
numFigu»s
; childId++)

5136 
figu»PŒ
 = 
objeùCİyBufãr
->
	`g‘Figu»PŒ
(
chdId
);

5138 ià(
figu»PŒ
 =ğ
NULL
)

5141 
ÃwFigu»PŒ
 = 
figu»PŒ
->
	`şÚe
();

5142 
ÃwFigu»PŒ
->
	`£tModif›d
(
Œue
);

5143 ià(
shiáOnPa¡e
)

5144 
ÃwFigu»PŒ
->
	`Œª¦©eBy
(
Œªs
);

5145 
objeù
->
	`addFigu»
(
ÃwFigu»PŒ
);

5146 
cİ›dFigu»s
[
numCİ›dFigu»s
++] = 
chdId
;

5147 
cİ›dFigu»s
[
numCİ›dFigu»s
++] = 
ÃwChdId
;

5148 
ÃwChdId
++;

5152 
numT»es
 = 
objeùCİyBufãr
->
	`g‘Figu»T»eCouÁ
();

5153 ià(
numT»es
 !ğ
numFigu»s
) {

5154 
chdId
 = 0; chdId < 
numFigu»s
; childId++)

5156 
·»ÁId
;

5157 
ÃwP¬’tId
;

5158 
i
;

5159 
boŞ
 
cİy_©chm’t
;

5161 
figu»PŒ
 = 
objeùCİyBufãr
->
	`g‘Figu»PŒ
(
chdId
);

5163 ià(
figu»PŒ
 =ğ
NULL
)

5167 
node
 = 
objeùCİyBufãr
->
	`g‘Figu»T»eNode
(
chdId
);

5168 
·»Á
 = 
node
->
	`g‘P¬’t
();

5169 ià(
·»Á
 =ğ
NULL
)

5173 
·»ÁId
 = 
·»Á
->
	`g‘Figu»Id
();

5174 
cİy_©chm’t
 = 
çl£
;

5175 
i
 = 0; i < 
numCİ›dFigu»s
; i += 2)

5176 ià(
cİ›dFigu»s
[
i
] =ğ
·»ÁId
) {

5178 
ÃwP¬’tId
 = 
cİ›dFigu»s
[
i
 + 1];

5179 
cİy_©chm’t
 = 
Œue
;

5182 ià(
cİy_©chm’t
) {

5184 
i
 = 0; i < 
numCİ›dFigu»s
; i += 2)

5185 ià(
cİ›dFigu»s
[
i
] =ğ
chdId
) {

5186 
ÃwChdId
 = 
cİ›dFigu»s
[
i
 + 1];

5190 
cİ›dNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
ÃwChdId
);

5191 
cİ›dNode
->
	`£tBËndAmouÁ
(
node
->
	`g‘BËndAmouÁ
());

5192 
cİ›dNode
->
	`£tBËndEx‹Á
(
node
->
	`g‘BËndEx‹Á
());

5193 
i
 = 0; i < 
node
->
	`g‘LškCouÁ
(); i++) {

5194 
ÃwLšk
 = 
Ãw
 
M3DPrim™iveLškInfo
;

5195 
ŞdLšk
 = 
node
->
	`g‘Lšk
(
i
);

5196 *
ÃwLšk
 = *
ŞdLšk
;

5197 
cİ›dNode
->
	`addLšk
(
ÃwLšk
);

5199 
objeù
->
	`©chFigu»T»eNode
(
cİ›dNode
, 
ÃwP¬’tId
);

5204 
	`’dO³¿tiÚ
();

5206 
	`mod–N“dsSavšg
(
Œue
);

5207 
shiáOnPa¡e
 = 
Œue
;

5208 
	}
}

5211 
	gP3DCÚŒŞ
::
	$m”ge
(
M3DObjeù
 * 
m”geObjeù
)

5213 
numAddedT»es
;

5214 
M3DFigu»T»eNode
 * 
node
;

5215 * 
cÜ»¥Úd’û
;

5216 
ş’
;

5217 
M3DFigu»
 * 
ÃwFigu»
;

5218 
numfigs
, 
Üig_numfigs
;

5221 ià(
m”geObjeù
 =ğ
NULL
)

5224 ià(
objeù
 =ğ
NULL
) {

5225 *
objeù
 = *
m”geObjeù
;

5230 
numfigs
 = 
m”geObjeù
->
	`g‘Figu»CouÁ
();

5231 
cÜ»¥Úd’û
 = 
Ãw
 [
numfigs
];

5232 
ş’
 = 
numfigs
;

5233 
Üig_numfigs
 = 
objeù
->
	`g‘Figu»CouÁ
();

5235 
numAddedT»es
 = 
m”geObjeù
->
	`g‘Figu»T»eCouÁ
();

5236 
Œ“Id
 = 0;»eId < 
numAddedT»es
;reeId++)

5238 
node
 = 
m”geObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“Id
);

5239 
objeù
->
	`addT»e
(
node
, 
m”geObjeù
, 
cÜ»¥Úd’û
);

5245 
numfigs
 = 
objeù
->
	`g‘Figu»CouÁ
();

5246 
ÃwFigu»Id
 = 
Üig_numfigs
;‚ewFigu»Id < 
numfigs
;‚ewFigureId++) {

5247 
ÃwFigu»
 = 
objeù
->
	`g‘Figu»PŒ
(
ÃwFigu»Id
);

5248 
IÁ”figu¿lCÚ¡¿šts
 & 
cÚ¡¿šts
 = 
ÃwFigu»
->
	`cÚ¡¿šts
();

5249 
cÚ¡¿šts
.
	`»m­Figu»Ids
(
cÜ»¥Úd’û
, 
ş’
);

5251 
d–‘e
 [] 
cÜ»¥Úd’û
;

5254 
M3DObjeù
 * 
backup
 = 
objeù
->
	`lßdedObjeù
();

5255 *
backup
 = *
objeù
;

5257 
	`mod–N“dsSavšg
(
Œue
);

5258 
	}
}

5260 #ifdeà
LM_METHOD_OBJ


5263 
	gP3DCÚŒŞ
::
	$m”geLªdm¬kMod–
(
M3DObjeù
 * 
m”geObjeù
)

5265 
numAddedT»es
;

5266 
M3DFigu»T»eNode
 * 
node
;

5267 * 
cÜ»¥Úd’û
;

5268 
ş’
;

5269 
M3DFigu»
 * 
ÃwFigu»
;

5270 
numfigs
, 
Üig_numfigs
;

5273 ià(
m”geObjeù
 =ğ
NULL
)

5276 ià(
Ïndm¬kObjeù
 =ğ
NULL
) {

5277 *
Ïndm¬kObjeù
 = *
m”geObjeù
;

5282 
numfigs
 = 
m”geObjeù
->
	`g‘Figu»CouÁ
();

5283 
cÜ»¥Úd’û
 = 
Ãw
 [
numfigs
];

5284 
ş’
 = 
numfigs
;

5285 
Üig_numfigs
 = 
objeù
->
	`g‘Figu»CouÁ
();

5287 
numAddedT»es
 = 
m”geObjeù
->
	`g‘Figu»T»eCouÁ
();

5288 
Œ“Id
 = 0;»eId < 
numAddedT»es
;reeId++)

5290 
node
 = 
m”geObjeù
->
	`g‘Figu»T»eRoÙ
(
Œ“Id
);

5291 
Ïndm¬kObjeù
->
	`addT»e
(
node
, 
m”geObjeù
, 
cÜ»¥Úd’û
);

5297 
numfigs
 = 
Ïndm¬kObjeù
->
	`g‘Figu»CouÁ
();

5298 
ÃwFigu»Id
 = 
Üig_numfigs
;‚ewFigu»Id < 
numfigs
;‚ewFigureId++) {

5299 
ÃwFigu»
 = 
Ïndm¬kObjeù
->
	`g‘Figu»PŒ
(
ÃwFigu»Id
);

5301 
d–‘e
 [] 
cÜ»¥Úd’û
;

5302 
	}
}

5307 
	gP3DCÚŒŞ
::
	$mœrÜ
()

5309 
M3DFigu»
 * 
figu»PŒ
;

5310 
M3DPrim™ive
 * 
´im™ivePŒ
;

5312 
numFigu»s
;

5313 
numPrim™ives
;

5315 
VeùÜ3D
 
	`Œª¦©eVeùÜ
(0.0, 0.0, 0.0),

5316 
posVeùÜ
,

5317 
ÃwBVeùÜ
;

5319 
Qu©
 
æAboutY
;

5320 
Qu©
 
q
;

5322 
xCOG
;

5323 
couÁ
,

5324 
i
,

5325 
j
;

5328 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

5331 if(
objeù
 =ğ
NULL
)

5334 
	`¡¬tO³¿tiÚ
();

5336 
æAboutY
.
	`£tAxisAngË
(
	`VeùÜ3D
(0.0, 1.0, 0.0), 
R_PI
);

5338 
xCOG
 = 0.0;

5339 
couÁ
 = 0;

5341 
numFigu»s
 = 
objeù
->
	`g‘Figu»CouÁ
();

5342 
i
 = 0; i < 
numFigu»s
; i++)

5344 
figu»PŒ
 = 
objeù
->
	`g‘Figu»PŒ
(
i
);

5345 if(
figu»PŒ
 =ğ
NULL
 || !(figu»PŒ->
	`isS–eùed
()))

5348 
xCOG
 +ğ
figu»PŒ
->
	`g‘COG
().
	`g‘X
();

5349 
couÁ
++;

5352 if(
couÁ
 != 0)

5353 
xCOG
 = xCOG / (è
couÁ
;

5357 
i
 = 0; i < 
numFigu»s
; i++)

5359 
figu»PŒ
 = 
objeù
->
	`g‘Figu»PŒ
(
i
);

5360 if(
figu»PŒ
 =ğ
NULL
 || !(figu»PŒ->
	`isS–eùed
()))

5363 
numPrim™ives
 = 
figu»PŒ
->
	`g‘Prim™iveCouÁ
();

5364 
j
 = 0; j < 
numPrim™ives
; j++)

5366 
´im™ivePŒ
 = 
figu»PŒ
->
	`g‘Prim™ivePŒ
(
j
);

5367 if(
´im™ivePŒ
 =ğ
NULL
)

5370 
posVeùÜ
 = 
´im™ivePŒ
->
	`g‘X
();

5372 
q
 = 
´im™ivePŒ
->
	`g‘Q
();

5373 
q
.
	`£tX
(-q.
	`g‘X
());

5374 
q
.
	`£tW
(-q.
	`g‘W
());

5376 
´im™ivePŒ
->
	`£tQ
(
q
 * 
æAboutY
);

5378 
ÃwBVeùÜ
 = 
´im™ivePŒ
->
	`g‘B
();

5379 
q
.
	`£tAxisAngË
(
ÃwBVeùÜ
, 
R_PI
);

5380 
´im™ivePŒ
->
	`rÙ©eBy
(
q
);

5383 
Œª¦©eVeùÜ
.
	`£tX
(-2.0 * 
posVeùÜ
.
	`g‘X
());

5384 
´im™ivePŒ
->
	`Œª¦©eBy
(
Œª¦©eVeùÜ
);

5387 
Œª¦©eVeùÜ
.
	`£tX
(2.0 * 
xCOG
);

5388 
figu»PŒ
->
	`Œª¦©eBy
(
Œª¦©eVeùÜ
);

5391 
	`’dO³¿tiÚ
();

5393 
	`mod–N“dsSavšg
(
Œue
);

5394 
£ËùiÚChªged
 = 
Œue
;

5395 
	}
}

5398 
	gP3DCÚŒŞ
::
	$¡¬tO³¿tiÚ
()

5400 
n
 = 
undoLi¡
.
	`size
();

5401 ià(! 
šO³¿tiÚ
) {

5402 
undoLi¡
.
	`addUndo
(
objeù
, 
m¬kedPrim™iveId
);

5403 
šO³¿tiÚ
 = 
Œue
;

5405  
n
;

5406 
	}
}

5409 
	gP3DCÚŒŞ
::
	$’dO³¿tiÚ
()

5411 
šO³¿tiÚ
 = 
çl£
;

5412  
undoLi¡
.
	`size
();

5413 
	}
}

5416 
boŞ
 
	gP3DCÚŒŞ
::
	$undo
()

5418 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

5419  
çl£
;

5421 if(
objeù
 =ğ
NULL
)

5422  
çl£
;

5424 
M3DObjeù
 * 
obj
 = 
undoLi¡
.
	`undoObjeù
(
objeù
, 
m¬kedPrim™iveId
);

5425 ià(
obj
 =ğ
objeù
)

5426  
çl£
;

5428 
objeù
 = 
obj
;

5429 
objeù
->
	`£tModif›d
(
Œue
);

5430 
£ËùiÚChªged
 = 
Œue
;

5433  
Œue
;

5434 
	}
}

5437 
	gP3DCÚŒŞ
::
	$»£tO³¿tiÚs
(
Åushes
)

5439 
l
 = 
undoLi¡
.
	`size
();

5440 ià(
Åushes
 > 
l
)

5441 
Åushes
 = 
l
;

5442 
i
 = 0; i < 
Åushes
; i++)

5443 
objeù
 = 
undoLi¡
.
	`d–‘eUndo
(
m¬kedPrim™iveId
);

5445 if(
objeù
 !ğ
NULL
)

5446 
objeù
->
	`£tModif›d
(
Œue
);

5447 
	}
}

5450 
boŞ
 
	gP3DCÚŒŞ
::
	$»do
()

5452 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

5453  
çl£
;

5455 if(
objeù
 =ğ
NULL
)

5456  
çl£
;

5458 
M3DObjeù
 * 
obj
 = 
undoLi¡
.
	`»doObjeù
(
objeù
, 
m¬kedPrim™iveId
);

5459 ià(
obj
 =ğ
objeù
)

5460  
çl£
;

5462 
objeù
 = 
obj
;

5463 
objeù
->
	`£tModif›d
(
Œue
);

5464 
£ËùiÚChªged
 = 
Œue
;

5467  
Œue
;

5468 
	}
}

5470 
	gP3DCÚŒŞ
::
	$»Üd”SubMod–
(
M3DFigu»T»eNode
 * 
node
, * 
ÃwFigu»Nums
, & 
n
)

5472 
ÃwFigu»Nums
[
n
++] = 
node
->
	`g‘Figu»Id
();

5473 
nChd»n
 = 
node
->
	`g‘ChdCouÁ
();

5474 
c
 = 0; c < 
nChd»n
; c++) {

5475 
M3DFigu»T»eNode
 * 
chd
 = 
node
->
	`g‘Chd
(
c
);

5476 ià(
chd
 =ğ
NULL
)

5478 
	`»Üd”SubMod–
(
chd
, 
ÃwFigu»Nums
, 
n
);

5480 
	}
}

5483 
boŞ
 
	gP3DCÚŒŞ
::
	$»Üd”Mod–
()

5485 * 
ÃwFigu»Nums
;

5486 
numFigu»s
;

5487 
numT»es
, 
t
, 
n
;

5488 
M3DFigu»T»eNode
 * 
node
;

5490 ià(
objeù
 =ğ
NULL
)

5491  
çl£
;

5493 
numFigu»s
 = 
objeù
->
	`g‘Figu»CouÁ
();

5494 ià(
numFigu»s
 == 0)

5495  
çl£
;

5497 
ÃwFigu»Nums
 = 
Ãw
 [
numFigu»s
];

5498 
numT»es
 = 
objeù
->
	`g‘Figu»T»eCouÁ
();

5499 
n
 = 0;

5501 
t
 = 0; < 
numT»es
;++) {

5502 
node
 = 
objeù
->
	`g‘Figu»T»eRoÙ
(
t
);

5503 
ÃwFigu»Nums
[
n
++] = 
node
->
	`g‘Figu»Id
();

5504 
nChd»n
 = 
node
->
	`g‘ChdCouÁ
();

5505 
c
 = 0; c < 
nChd»n
; c++) {

5506 
M3DFigu»T»eNode
 * 
chd
 = 
node
->
	`g‘Chd
(
c
);

5507 ià(
chd
 =ğ
NULL
)

5509 
	`»Üd”SubMod–
(
chd
, 
ÃwFigu»Nums
, 
n
);

5516 
undoLi¡
.
	`addUndo
(
objeù
, 
m¬kedPrim™iveId
);

5517 
objeù
->
	`»numb”
(
ÃwFigu»Nums
);

5519  
Œue
;

5520 
	}
}

5522 
boŞ
 
	gP3DCÚŒŞ
::
	$‹¡ReÜd”SubMod–
(
M3DFigu»T»eNode
 * 
node
, & 
n
)

5524 ià(
n
++ !ğ
node
->
	`g‘Figu»Id
())

5525  
Œue
;

5526 
nChd»n
 = 
node
->
	`g‘ChdCouÁ
();

5527 
c
 = 0; c < 
nChd»n
; c++) {

5528 
M3DFigu»T»eNode
 * 
chd
 = 
node
->
	`g‘Chd
(
c
);

5529 ià(
chd
 =ğ
NULL
)

5531 ià(
	`‹¡ReÜd”SubMod–
(
chd
, 
n
))

5532  
Œue
;

5534  
çl£
;

5535 
	}
}

5538 
boŞ
 
	gP3DCÚŒŞ
::
	$‹¡ReÜd”Mod–
()

5540 
numFigu»s
;

5541 
numT»es
, 
t
, 
n
;

5542 
M3DFigu»T»eNode
 * 
node
;

5544 ià(
objeù
 =ğ
NULL
)

5545  
çl£
;

5547 
numFigu»s
 = 
objeù
->
	`g‘Figu»CouÁ
();

5548 ià(
numFigu»s
 == 0)

5549  
çl£
;

5551 
numT»es
 = 
objeù
->
	`g‘Figu»T»eCouÁ
();

5552 
n
 = 0;

5554 
t
 = 0; < 
numT»es
;++) {

5555 
node
 = 
objeù
->
	`g‘Figu»T»eRoÙ
(
t
);

5556 ià(
n
++ !ğ
node
->
	`g‘Figu»Id
())

5557  
Œue
;

5558 
nChd»n
 = 
node
->
	`g‘ChdCouÁ
();

5559 
c
 = 0; c < 
nChd»n
; c++) {

5560 
M3DFigu»T»eNode
 * 
chd
 = 
node
->
	`g‘Chd
(
c
);

5561 ià(
chd
 =ğ
NULL
)

5563 ià(
	`‹¡ReÜd”SubMod–
(
chd
, 
n
))

5564  
Œue
;

5567  
çl£
;

5568 
	}
}

5570 * 
	gP3DCÚŒŞ
::
	$g‘Mod–FeName
()

5572 * 
Çme
;

5574 if(
mod–FeName
 =ğ
NULL
)

5575  
NULL
;

5577 
Çme
 = 
Ãw
 [
	`¡¾’
(
mod–FeName
) + 1];

5578 
	`¡rıy
(
Çme
, 
mod–FeName
);

5580  
Çme
;

5581 
	}
}

5584 
	gP3DCÚŒŞ
::
	$ÃwMod–
()

5586 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

5589 if(
mod–FeName
 !ğ
NULL
)

5591 
d–‘e
 [] 
mod–FeName
;

5592 
mod–FeName
 = 
NULL
;

5595 if(
objeù
 !ğ
NULL
)

5597 
d–‘e
 
objeù
;

5598 
objeù
 = 
NULL
;

5600 ià(
glob®V”bos™y
 >= 0) {

5601 
cout
 << "Started‡‚ew model";

5602 ià(
pgaSts
 !ğ
NULL
 || 
©omPgaSts
 != NULL)

5603 
cout
 << "; discarded geometric statistics";

5604 
cout
 << 
’dl
;

5607 ià(! 
©chedSts
) {

5608 
d–‘e
 
pgaSts
;

5609 
d–‘e
 
©omPgaSts
;

5611 
pgaSts
 = 
NULL
;

5612 
©omPgaSts
 = 
NULL
;

5613 
ınsSts
 = 
NULL
 ;

5616 if(
»ã»nûObjeù
 !ğ
NULL
) {

5617 
d–‘e
 
»ã»nûObjeù
;

5618 
»ã»nûObjeù
 = 
NULL
;

5620 
m¬kedPrim™iveId
 = 
INVALID_PRIMITIVE_ID
;

5622 
	`mod–IsSaved
();

5623 
shiáOnPa¡e
 = 
çl£
;

5624 
	}
}

5626 #ifdeà
LM_METHOD_OBJ


5629 
	gP3DCÚŒŞ
::
	$ÃwLªdm¬kMod–
()

5631 if(
Ïndm¬kObjeù
 !ğ
NULL
)

5633 
d–‘e
 
Ïndm¬kObjeù
;

5634 
Ïndm¬kObjeù
 = 
NULL
;

5636 ià(
glob®V”bos™y
 >= 0)

5637 
cout
 << "S¹ed‡‚ew LANDMARK mod–" << 
’dl
;

5640 
	`mod–IsSaved
();

5641 
shiáOnPa¡e
 = 
çl£
;

5642 
wÜldWasAµl›d
 = 
çl£
;

5643 
	}
}

5647 
	gP3DCÚŒŞ
::
	$ÃwMod–
(
M3DObjeù
 *
ÃwMod–
)

5649 ià(
ÃwMod–
 =ğ
NULL
)

5652 if(
objeù
 !ğ
NULL
)

5654 
d–‘e
 
objeù
;

5655 
objeù
 = 
NULL
;

5656 ià(! 
©chedSts
) {

5657 
d–‘e
 
pgaSts
;

5658 
d–‘e
 
©omPgaSts
;

5660 
pgaSts
 = 
NULL
;

5661 
©omPgaSts
 = 
NULL
;

5662 
ınsSts
 = 
NULL
 ;

5665 
objeù
 = 
ÃwMod–
;

5666 if(
»ã»nûObjeù
 !ğ
NULL
) {

5667 
d–‘e
 
»ã»nûObjeù
;

5668 
»ã»nûObjeù
 = 
NULL
;

5670 
m¬kedPrim™iveId
 = 
INVALID_PRIMITIVE_ID
;

5672 
	`mod–IsSaved
();

5673 
shiáOnPa¡e
 = 
çl£
;

5674 
wÜldWasAµl›d
 = 
çl£
;

5676 ià(
glob®V”bos™y
 >= 0)

5677 
cout
 << "R•Ïûd cu¼’ˆmod– w™h‡nÙh”" << 
’dl
;

5678 
	}
}

5680 
	gP3DCÚŒŞ
::
	$­¶yWÜld
(
Image3D
 * 
image
)

5682 ià(
image
 =ğ
NULL
)

5684 ià(
objeù
 =ğ
NULL
)

5687 
	`¡¬tO³¿tiÚ
();

5688 ià(
objeù
->
	`­¶yWÜld
(
image
))

5689 
cout
 << 
m­pšgMsg
;

5691 
	`’dO³¿tiÚ
();

5692 
	`»£tO³¿tiÚs
(1);

5695 
	`’dO³¿tiÚ
();

5696 
objeù
->
	`£tModif›d
(
Œue
);

5697 
	`mod–N“dsSavšg
(
Œue
);

5698 
wÜldWasAµl›d
 = 
Œue
;

5699 
	}
}

5701 #ifdeà
OPTIMIZATION_VISUALIZER


5709 
M3DObjeù
 * 
	gP3DCÚŒŞ
::
	$»¶aûObjeùPŒ
(
M3DObjeù
 * 
obj
)

5711 
M3DObjeù
 * 
o
;

5713 
o
 = 
objeù
;

5714 
objeù
 = 
obj
;

5715 ià(
objeù
 =ğ
NULL
)

5716  
o
;

5717 
objeù
->
	`£tModif›d
(
Œue
);

5718 
	`mod–N“dsSavšg
(
Œue
);

5719  
o
;

5720 
	}
}

5726 
	gP3DCÚŒŞ
::
	$v”ifyOr›Á©iÚM©ches
(
M3DObjeù
 * 
mod–
)

5728 ià(
	`v”ifyOr›Á©iÚ
()) {

5729 ià(
mod–
->
	`Ü›Á©iÚ
(è=ğ
çl£
) {

5730 
cout
 << "Warning:his model hashe Y-axis oriented…ositively;\n";

5731 
cout
 << "his model should‚ot be fit withhis version of ";

5732 #ifdeà
AE2_BUILD


5733 
cout
 << "CÚSŒuù." << 
’dl
;

5735 
cout
 << "Pablo." << 
’dl
;

5740 ià(
mod–
->
	`Ü›Á©iÚ
(è=ğ
Œue
) {

5741 
cout
 << "Warning:his model hashe Y-axis oriented‚egatively;\n";

5742 
cout
 << "his model should‚ot be fit withhis version of ";

5743 #ifdeà
AE2_BUILD


5744 
cout
 << "CÚSŒuù." << 
’dl
;

5746 
cout
 << "Pablo." << 
’dl
;

5750 
	}
}

5769 
boŞ
 
	gP3DCÚŒŞ
::
	$»ad
(cÚ¡ * 
f’ame
, 
boŞ
 
m­ToWÜld
,

5770 cÚ¡ * 
xfÜmF’ame
, cÚ¡ * 
pgaF’ame
)

5772 
cout
 << "R—dšg..." << 
’dl
;

5773 
M3DObjeùFe
 
objeùFe
;

5774 
Sim¬™yT¿nsfÜm3D
 * 
xfÜm
;

5775 
M3DObjeù
 * 
obj
;

5776 
WÜldSy¡em
 * 
wÜld
;

5777 
Image3D
 * 
image
;

5778 * 
¡r
;

5779 
M3DObjeùFe
 
pgaObjeùFe
;

5780 
M3DObjeù
 * 
pgaObj
;

5782 ià(
f’ame
 =ğ
NULL
)

5783  
çl£
;

5785 ià(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

5786  
çl£
;

5788 ià(
mod–FeName
 !ğ
NULL
)

5789 
d–‘e
 [] 
mod–FeName
;

5790 
mod–FeName
 = 
Ãw
 [
	`¡¾’
(
f’ame
) + 1];

5791 ià(
mod–FeName
 =ğ
NULL
)

5792  
çl£
;

5793 
	`¡rıy
(
mod–FeName
, 
f’ame
);

5795 
xfÜm
 = 
Ãw
 
Sim¬™yT¿nsfÜm3D
;

5796 
wÜld
 = 
Ãw
 
WÜldSy¡em
;

5797 
obj
 = 
objeùFe
.
	`»ad
(
mod–FeName
, 
m¬kedPrim™iveId
,

5798 (
xfÜmF’ame
 !ğ
NULL
 ? NULL : 
xfÜm
), 
wÜld
, 
pgaF’ame
);

5802 ià(
obj
 !ğ
NULL
) {

5803 ià(
objeù
 !ğ
NULL
) {

5804 
d–‘e
 
objeù
;

5805 ià(! 
©chedSts
) {

5806 
d–‘e
 
pgaSts
;

5807 
d–‘e
 
©omPgaSts
;

5809 
pgaSts
 = 
NULL
;

5810 
©omPgaSts
 = 
NULL
;

5811 
ınsSts
 = 
NULL
 ;

5813 ià(
objeùSimT¿nsfÜm
 !ğ
NULL
)

5814 
d–‘e
 
objeùSimT¿nsfÜm
;

5815 
objeùSimT¿nsfÜm
 = 
NULL
;

5820 
objeù
 = 
obj
;

5821 
objeù
->
	`£tWÜld
(
wÜld
, 
Œue
);

5824 
d–‘e
 
wÜld
;

5825  
çl£
;

5828 
	`v”ifyOr›Á©iÚM©ches
(
objeù
);

5830 ià(
pgaMod–FeName
 !ğ
NULL
) {

5831 
pgaObj
 = 
pgaObjeùFe
.
	`»ad
(
pgaMod–FeName
);

5834 
pgaSts
 = 
pgaObj
->
	`g‘PGASts
();

5835 
©omPgaSts
 = 
pgaObj
->
	`g‘AtomPGASts
();

5837 
©chedSts
 = 
çl£
;

5838 
pgaObj
->
	`£tPGASts
(
NULL
, 
Œue
);

5839 
pgaObj
->
	`£tAtomPGASts
(
NULL
, 
Œue
);

5842 
d–‘e
 
pgaObj
;

5845 
pgaSts
 = 
objeù
->
	`g‘PGASts
();

5846 
©omPgaSts
 = 
objeù
->
	`g‘AtomPGASts
();

5848 
©chedSts
 = 
Œue
;

5852 
ınsSts
 = 
objeù
->
	`g‘CPNSSts
() ;

5853 ifĞ
ınsSts
 )

5854 
cout
 << 
’dl
 << "CPNS Statistics†oaded intohe object" <<ƒndl ;

5856 
¡r
 = 
NULL
;

5857 ià(
xfÜmF’ame
 !ğ
NULL
)

5858 
xfÜm
->
	`»adSim¬™y
(
xfÜmF’ame
);

5859 ià(! 
xfÜm
->
	`wasR—d
()) {

5860 
Ën
 = 
	`¡¾’
(
mod–FeName
);

5861 
¡r
 = 
Ãw
 [
Ën
 + 1];

5862 
	`¡ºıy
(
¡r
, 
mod–FeName
, 
Ën
 - 3);

5863 
¡r
[
Ën
 - 3] = '\0';

5864 
	`¡rÿt
(
¡r
, "sim");

5865 
xfÜm
->
	`»adSim¬™y
(
¡r
);

5866 
xfÜmF’ame
 = 
¡r
;

5869 ià(
xfÜm
->
	`wasR—d
()) {

5870 #ifdeà
DEBUG


5871 
cout
 << "Sim¬™y¿nsfÜm©iÚ†ßded" << 
’dl
;

5873 ià(
xfÜmF’ame
 !ğ
NULL
)

5874 
cout
 << "Lßded sim¬™y¿nsfÜm©iÚ " << 
xfÜmF’ame
 << 
’dl
;

5877 
cout
 << "Sim¬™y¿nsfÜm©iÚ‚Ù†ßded" << 
’dl
;

5879 
objeùSimT¿nsfÜm
 = 
xfÜm
;

5880 
objeù
->
	`£tT¿nsfÜm©iÚ
(
objeùSimT¿nsfÜm
);

5881 
objeù
->
	`lßdedObjeù
()->
	`£tT¿nsfÜm©iÚ
(
objeùSimT¿nsfÜm
);

5883 ià(
»ã»nûObjeù
 !ğ
NULL
) {

5884 
d–‘e
 
»ã»nûObjeù
;

5885 
»ã»nûObjeù
 = 
NULL
;

5888 
	`mod–IsSaved
();

5889 
shiáOnPa¡e
 = 
çl£
;

5890 
d–‘e
 [] 
¡r
;

5892 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

5893 ià(
image
 =ğ
NULL
)

5894  
Œue
;

5896 ià(
m­ToWÜld
) {

5897 ià(! 
wÜld
->
	`equ®s
(
image
->
	`g‘Mod–Origš
(), image->
	`g‘Mod–Bound
(), image->
	`g‘S·cšg
()))

5898 
	`­¶yWÜld
(
image
);

5901 
wÜldWasAµl›d
 = 
çl£
;

5903  
Œue
;

5904 
	}
}

5906 
boŞ
 
	gP3DCÚŒŞ
::
	$»adAµ’d
(cÚ¡ * 
f’ame
, 
boŞ
 
m­ToWÜld
, boŞ & 
ignÜedPGA
)

5908 
M3DObjeùFe
 
objeùFe
;

5909 
Sim¬™yT¿nsfÜm3D
 * 
xfÜm
;

5910 
WÜldSy¡em
 * 
wÜld
;

5911 
Image3D
 * 
image
;

5912 
m
;

5914 if(
objeù
 =ğ
NULL
)

5915  
	`»ad
(
f’ame
);

5917 if(
f’ame
 =ğ
NULL
)

5918  
çl£
;

5920 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

5921  
çl£
;

5923 
xfÜm
 = 
NULL
;

5924 
wÜld
 = 
Ãw
 
WÜldSy¡em
;

5925 
M3DObjeù
 * 
ÃwObjeù
 = 
objeùFe
.
	`»ad
(
f’ame
, 
m
, 
xfÜm
, 
wÜld
);

5926 ià(
ÃwObjeù
 =ğ
NULL
)

5927  
çl£
;

5928 ià(
m¬kedPrim™iveId
 =ğ
INVALID_PRIMITIVE_ID
)

5929 
m¬kedPrim™iveId
 = 
m
;

5931 
	`v”ifyOr›Á©iÚM©ches
(
ÃwObjeù
);

5939 
ignÜedPGA
 = 
çl£
;

5940 ià(
pgaSts
 =ğ
NULL
)

5941 
pgaSts
 = 
ÃwObjeù
->
	`g‘PGASts
();

5943 ià(
ÃwObjeù
->
	`g‘PGASts
(è!ğ
NULL
)

5944 
ignÜedPGA
 = 
Œue
;

5947 ià(
©omPgaSts
 =ğ
NULL
)

5948 
©omPgaSts
 = 
ÃwObjeù
->
	`g‘AtomPGASts
();

5950 ià(
ÃwObjeù
->
	`g‘AtomPGASts
(è!ğ
NULL
)

5951 
ignÜedPGA
 = 
Œue
;

5954 
ignÜedPGA
 = 
Œue
;

5957 
	`m”ge
(
ÃwObjeù
);

5958 
d–‘e
 
ÃwObjeù
;

5960 ià(
»ã»nûObjeù
 !ğ
NULL
) {

5961 
d–‘e
 
»ã»nûObjeù
;

5962 
»ã»nûObjeù
 = 
NULL
;

5965 
	`mod–IsSaved
();

5967 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

5968 ià(
image
 =ğ
NULL
)

5969  
Œue
;

5971 
boŞ
 
wÜldWasAµl›dTo1¡Mod–
 = 
wÜldWasAµl›d
;

5972 ià(
m­ToWÜld
) {

5973 ià(! 
wÜld
->
	`equ®s
(
image
->
	`g‘Mod–Origš
(), image->
	`g‘Mod–Bound
(), image->
	`g‘S·cšg
()))

5974 
	`­¶yWÜld
(
image
);

5977 
wÜldWasAµl›d
 = 
çl£
;

5978 
wÜldWasAµl›d
 |ğ
wÜldWasAµl›dTo1¡Mod–
;

5987  
Œue
;

5988 
	}
}

5990 
boŞ
 
	gP3DCÚŒŞ
::
	$lßdSimT¿nsfÜm
(cÚ¡ * 
xfÜmF’ame
)

5992 
Sim¬™yT¿nsfÜm3D
 * 
xfÜm
;

5993 
boŞ
 
»t
;

5996 ià(
objeù
 =ğ
NULL
)

5997  
çl£
;

5999 ià(
xfÜmF’ame
 !ğ
NULL
) {

6000 
xfÜm
 = 
Ãw
 
Sim¬™yT¿nsfÜm3D
;

6001 
»t
 = 
xfÜm
->
	`»adSim¬™y
(
xfÜmF’ame
);

6004  
çl£
;

6006 ià(
»t
) {

6007 
cout
 << "Lßded sim¬™y¿nsfÜm©iÚ " << 
xfÜmF’ame
 << 
’dl
;

6008 ià(
objeùSimT¿nsfÜm
 !ğ
NULL
)

6009 
d–‘e
 
objeùSimT¿nsfÜm
;

6010 
objeùSimT¿nsfÜm
 = 
xfÜm
;

6011 
objeù
->
	`£tT¿nsfÜm©iÚ
(
objeùSimT¿nsfÜm
);

6012 
objeù
->
	`lßdedObjeù
()->
	`£tT¿nsfÜm©iÚ
(
objeùSimT¿nsfÜm
);

6015 
cout
 << "Sim¬™y¿nsfÜm©iÚ " << 
xfÜmF’ame
 << "‚Ù†ßded" << 
’dl
;

6017  
»t
;

6018 
	}
}

6020 #ifdeà
AE2_BUILD


6021 
	gP3DCÚŒŞ
::
	$­¶ySimT¿nsfÜm
(
Sim¬™yT¿nsfÜm3D
 * 
ŒªsfÜm
)

6023 ià(
ŒªsfÜm
 !ğ
NULL
)

6024 *
objeùSimT¿nsfÜm
 = *
ŒªsfÜm
;

6026 
P3DCÚŒŞ
::
	$­¶ySimT¿nsfÜm
()

6029 ià(
objeùSimT¿nsfÜm
 =ğ
NULL
) {

6031 
cout
 << "Error:‡pplySimTransform:‚oransformation…resent\n";

6035 ià(
objeù
 =ğ
NULL
) {

6037 
cout
 << "Error:‡pplySimTransform:‚o model…resent\n";

6041 #ifdeà
UNFLIPPED


6042 
objeù
->
	`­¶ySim¬™y
(*
objeùSimT¿nsfÜm
, 
	`VeùÜ3D
(0.0, 1.0, 0.0));

6044 
objeù
->
	`­¶ySim¬™y
(*
objeùSimT¿nsfÜm
, 
	`VeùÜ3D
(0.0, 0.0, 0.0));

6046 
objeù
->
	`£tModif›d
(
Œue
);

6047 
	`mod–N“dsSavšg
(
Œue
);

6048 
objeùSimT¿nsfÜm
->
	`£tToId’t™y
();

6049 
	}
}

6051 #ifdeà
LM_METHOD_OBJ


6053 
boŞ
 
	gP3DCÚŒŞ
::
	$»adLªdm¬kMod–
(cÚ¡ * 
f’ame
)

6055 
M3DObjeùFe
 
objeùFe
;

6056 
lm¬kedPrim™iveId
;

6058 ià(
f’ame
 =ğ
NULL
)

6059  
çl£
;

6061 ià(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

6062  
çl£
;

6071 ià(
Ïndm¬kObjeù
 !ğ
NULL
)

6072 
d–‘e
 
Ïndm¬kObjeù
;

6075 
Ïndm¬kObjeù
 = 
objeùFe
.
	`»ad
(
f’ame
, 
lm¬kedPrim™iveId
);

6076 ià(
Ïndm¬kObjeù
 =ğ
NULL
)

6077  
çl£
;

6079 
shiáOnPa¡e
 = 
çl£
;

6080  
Œue
;

6081 
	}
}

6083 
boŞ
 
	gP3DCÚŒŞ
::
	$»adAµ’dLªdm¬kMod–
(cÚ¡ * 
f’ame
)

6085 
M3DObjeùFe
 
objeùFe
;

6087 if(
Ïndm¬kObjeù
 =ğ
NULL
)

6088  
	`»ad
(
f’ame
);

6090 if(
f’ame
 =ğ
NULL
)

6091  
çl£
;

6093 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

6094  
çl£
;

6096 
M3DObjeù
 * 
ÃwObjeù
 = 
objeùFe
.
	`»ad
(
f’ame
);

6097 ià(
ÃwObjeù
 =ğ
NULL
)

6098  
çl£
;

6100 
	`m”geLªdm¬kMod–
(
ÃwObjeù
);

6102  
Œue
;

6103 
	}
}

6111 
boŞ
 
	gP3DCÚŒŞ
::
	$wr™eDi¡ªûsAtSpokeEnds
(cÚ¡ *
f’ame
) {

6113 ifĞĞ
f’ame
 =ğ
NULL
 ) || ( 
objeù
 =ğNULL ) || ( 
m©ch
 =ğNULL ) || ( m©ch->
	`g‘ImageDi¡M­Poš‹r
() == NULL ) ) {

6114 
cout
 << 
’dl
 << "NULL‡rguments…assedo P3DControl::writeDistancesAtSpokeEnds() !" <<ƒndl ;

6120 
veùÜ
 <> 
di¡VeùÜ
 ;

6122 
veùÜ
 <> 
rowNumVeùÜ
 ;

6123 
veùÜ
 <> 
cŞNumVeùÜ
 ;

6124 
veùÜ
 <> 
¥okeNumVeùÜ
 ;

6128 
M3DFigu»
 * 
figThis
 = 
objeù
->
	`g‘Figu»PŒ
(0) ;

6130 
M3DQuadFigu»
 * 
quadFigThis
 = 
dyÇmic_ÿ¡
 <M3DQuadFigu» *> (
figThis
) ;

6132 ifĞ
quadFigThis
 =ğ
NULL
 ) {

6133 
cout
 << 
’dl
 << "P3DControl::writeDistancesAtSpokeEnds() does‚ot work with Tube figures" <<ƒndl ;

6137 
d©iÚFaùÜ
 = 
objeù
->
	`g‘D©iÚFaùÜInMod–Un™s
() ;

6139 
nPrims
 = 
quadFigThis
->
	`g‘Prim™iveCouÁ
() ;

6141 
VeùÜ3D
 
thisSpokeEnd
 ;

6143 
nRows
 = 
quadFigThis
->
	`g‘RowCouÁ
() ;

6144 
nCŞs
 = 
quadFigThis
->
	`g‘CŞumnCouÁ
() ;

6146  
ii
 = 0 ; i˜< 
quadFigThis
->
	`g‘RowCouÁ
() ; ii ++ ) {

6148  
jj
 = 0 ; jj < 
quadFigThis
->
	`g‘CŞumnCouÁ
() ; jj ++ ) {

6150 
M3DPrim™ive
 * 
´imThis
 = 
quadFigThis
->
	`g‘Prim™ivePŒ
Ğ
ii
, 
jj
 ) ;

6154 
thisSpokeEnd
 = 
´imThis
->
	`g‘X
(è+…rimThis->
	`g‘Y0
() ;

6156 
di¡VeùÜ
.
	`push_back
Ğ
	`çbs
Ğ
m©ch
->
	`g‘ImageDi¡M­Poš‹r
()->
	`g‘Di¡ªû
(
thisSpokeEnd
è- 
d©iÚFaùÜ
 ) ) ;

6158 
rowNumVeùÜ
.
	`push_back
Ğ
ii
 ) ; 
cŞNumVeùÜ
.push_backĞ
jj
 ) ; 
¥okeNumVeùÜ
.push_back( 0 ) ;

6161 
d0
 = 
	`çbs
Ğ
m©ch
->
	`g‘ImageDi¡M­Poš‹r
()->
	`g‘Di¡ªû
(
thisSpokeEnd
è- 
d©iÚFaùÜ
 ) ;

6165 
thisSpokeEnd
 = 
´imThis
->
	`g‘X
(è+…rimThis->
	`g‘Y1
() ;

6167 
di¡VeùÜ
.
	`push_back
Ğ
	`çbs
Ğ
m©ch
->
	`g‘ImageDi¡M­Poš‹r
()->
	`g‘Di¡ªû
(
thisSpokeEnd
è- 
d©iÚFaùÜ
 ) ) ;

6169 
rowNumVeùÜ
.
	`push_back
Ğ
ii
 ) ; 
cŞNumVeùÜ
.push_backĞ
jj
 ) ; 
¥okeNumVeùÜ
.push_back( 1 ) ;

6172 
d1
 = 
	`çbs
Ğ
m©ch
->
	`g‘ImageDi¡M­Poš‹r
()->
	`g‘Di¡ªû
(
thisSpokeEnd
è- 
d©iÚFaùÜ
 ) ;

6176 ifĞ
´imThis
->
	`ty³
(è=ğ
M3D_END_PRIMITIVE
 ) {

6178 
thisSpokeEnd
 = 
´imThis
->
	`g‘X
(è+ (
dyÇmic_ÿ¡
 <
M3DQuadEndPrim™ive
*> (´imThis))->
	`g‘YEnd
() ;

6180 
di¡VeùÜ
.
	`push_back
Ğ
	`çbs
Ğ
m©ch
->
	`g‘ImageDi¡M­Poš‹r
()->
	`g‘Di¡ªû
(
thisSpokeEnd
è- 
d©iÚFaùÜ
 ) ) ;

6183 
d2
 = 
	`çbs
Ğ
m©ch
->
	`g‘ImageDi¡M­Poš‹r
()->
	`g‘Di¡ªû
(
thisSpokeEnd
è- 
d©iÚFaùÜ
 ) ;

6185 
rowNumVeùÜ
.
	`push_back
Ğ
ii
 ) ; 
cŞNumVeùÜ
.push_backĞ
jj
 ) ; 
¥okeNumVeùÜ
.push_back( 2 ) ;

6194 
¡d
::
of¡»am
 
f
;

6196 
f
.
	`İ’
Ğ
f’ame
, 
ios
::
Œunc
);

6198 ià(!
f
) {

6199 
¡ršg
 
	`s
("UÇbËØİ’ " + 
	`¡ršg
(
f’ame
) + " for writing spokeƒnd distances!" ) ;

6200 
cout
 << 
s
 << 
’dl
 ;

6204 
f
 << 
	`£tw
(10è<< "Row No." << s‘w(10è<< "CŞ. No." << s‘w(10è<< "SpokNo." << s‘w(20è<< "Di¡ªû" << 
’dl
 ;

6206  
ii
 = 0 ; i˜< 
di¡VeùÜ
.
	`size
() ; ii ++ ) {

6208 
f
 << 
	`£tw
(10è<< 
rowNumVeùÜ
[
ii
] ;

6209 
f
 << 
	`£tw
(10è<< 
cŞNumVeùÜ
[
ii
] ;

6210 
f
 << 
	`£tw
(10è<< 
¥okeNumVeùÜ
[
ii
] ;

6211 
f
 << 
	`£tw
(20è<< 
di¡VeùÜ
[
ii
] ;

6212 
f
 << 
’dl
 ;

6215 
f
.
	`şo£
() ;

6217 
di¡VeùÜ
.
	`ş—r
() ;

6219 
cout
 << 
’dl
 << "Wr™šg di¡ªû © spok’d tØ" << 
f’ame
 <<ƒndl ;

6223 
	}
}

6243 
boŞ
 
	gP3DCÚŒŞ
::
	$wr™e
(cÚ¡ * 
f’ame
, cÚ¡ * 
xfÜmF’ame
)

6245 
M3DObjeùFe
 
objeùFe
;

6246 
Image3D
 * 
image
;

6247 * 
¡r
;

6248 * 
xåŒ
;

6251 ià(
f’ame
 !ğ
NULL
)

6253 if(
mod–FeName
 !ğ
NULL
)

6254 
d–‘e
 [] 
mod–FeName
;

6256 
mod–FeName
 = 
Ãw
 [
	`¡¾’
(
f’ame
) + 1];

6257 
	`¡rıy
(
mod–FeName
, 
f’ame
);

6259 ià(
mod–FeName
 =ğ
NULL
)

6260  
çl£
;

6262 
boŞ
 
wr™eM©rix
 = 
glob®CÚŒŞ
->
	`»adBoŞ
(
SimT¿nsfÜmM©rix
);

6263 
boŞ
 
£·¿‹
 = 
glob®CÚŒŞ
->
	`»adBoŞ
(
SimT¿nsfÜmS•¬©e
);

6265 
¡r
 = 
NULL
;

6266 ià(
objeùSimT¿nsfÜm
) {

6267 cÚ¡ 
dÙ
 = '.';

6268 
Ën
;

6270 ià(
xfÜmF’ame
 =ğ
NULL
) {

6271 ià(
£·¿‹
) {

6272 * 
ext
 = 
	`¡¼chr
(
mod–FeName
, 
dÙ
);

6273 ià(
ext
 =ğ
NULL
)

6274 
Ën
 = 
	`¡¾’
(
mod–FeName
);

6276 
Ën
 = 
ext
 - 
mod–FeName
;

6277 
¡r
 = 
Ãw
 [
Ën
 + 5];

6278 
	`¡ºıy
(
¡r
, 
mod–FeName
, 
Ën
);

6279 
¡r
[
Ën
] = '\0';

6280 
	`¡rÿt
(
¡r
, ".sim");

6282 
xåŒ
 = 
¡r
;

6285 
xåŒ
 = (*è
xfÜmF’ame
;

6288 
xåŒ
 = 
NULL
;

6289 
£·¿‹
 = 
Œue
;

6292 ià(
objeù
 !ğ
NULL
) {

6296 
i
 = 0 ; i !ğ
objeù
->
	`g‘Figu»CouÁ
(); ++i) {

6297 
M3DFigu»
* 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
i
);

6298 
figu»
->
	`fixGlob®CÚsi¡’cy
();

6299 ià(
glob®V”bos™y
 >= 1) {

6300 
cout
 << "Curvšes  : " << 
figu»
->
	`curvšess
(è<< 
’dl
;

6301 
M3DTubeFigu»
* 
tube_fig
 = 
dyÇmic_ÿ¡
<M3DTubeFigu»*>(
figu»
);

6302 ià(
tube_fig
 !ğ
NULL
) {

6303 
cout
 << "rSrad…enalty : " <<

6304 
	`M3DAtomP»diùÜTube
().
	`g‘Figu»RS¿dP’®ty
(
tube_fig
, -1, 
PEL_BOTH
, 
	`tunšgWt
(
RS¿dP’®tyNÜm
),unšgWt(
RS¿dP’®tyTh»shŞd
) )

6305 << 
’dl
;

6307 
M3DQuadFigu»
* 
quad_fig
 = 
dyÇmic_ÿ¡
<M3DQuadFigu»*>(
figu»
);

6308 ià(
quad_fig
 !ğ
NULL
) {

6309 
cout
 << "rSrad…enalty : " <<

6310 
	`M3DAtomP»diùÜQuad
().
	`g‘Figu»RS¿dP’®ty
(
quad_fig
, -1, 
PEL_BOTH
, 
	`tunšgWt
(
RS¿dP’®tyNÜm
),unšgWt(
RS¿dP’®tyTh»shŞd
) )

6311 << 
’dl
;

6315 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

6322 ià(
objeùFe
.
	`wr™e
(
mod–FeName
, *
objeù
,

6323 (
£·¿‹
 ? 
NULL
 : 
objeùSimT¿nsfÜm
), 
wr™eM©rix
,

6324 
m¬kedPrim™iveId
, 
image
, 
imageFeName
, 
Œue
))

6325 
	`mod–IsSaved
();

6328 ià(
£·¿‹
 && 
xåŒ
 !ğ
NULL
) {

6329 ià(
objeùSimT¿nsfÜm
->
	`wr™eSim¬™y
(
xåŒ
, 
wr™eM©rix
))

6330 
cout
 << "Saved sim¬™y¿nsfÜm©iÚ " << 
xåŒ
 << 
’dl
;

6332 
cout
 << "UÇbËØ§vsim¬™y¿nsfÜm©iÚ" << 
’dl
;

6335 ià(
¡r
 !ğ
NULL
)

6336 
d–‘e
 [] 
¡r
;

6337  
Œue
;

6338 
	}
}

6340 
boŞ
 
	gP3DCÚŒŞ
::
	$»adOldFe
(cÚ¡ * 
f’ame
)

6342 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

6343  
çl£
;

6345 if(
f’ame
 =ğ
NULL
 || 0 =ğ
	`¡¾’
(filename))

6346  
çl£
;

6348 if(
mod–FeName
 !ğ
NULL
)

6349 
d–‘e
 [] 
mod–FeName
;

6351 
mod–FeName
 = 
Ãw
 [
	`¡¾’
(
f’ame
) + 5];

6352 if(
mod–FeName
 =ğ
NULL
)

6353  
çl£
;

6355 
	`¡rıy
(
mod–FeName
, 
f’ame
);

6356 
	`¡rÿt
(
mod–FeName
, ".m3d");

6358 if(
objeù
 !ğ
NULL
) {

6359 
d–‘e
 
objeù
;

6360 ià(! 
©chedSts
) {

6361 
d–‘e
 
pgaSts
;

6362 
d–‘e
 
©omPgaSts
;

6364 
pgaSts
 = 
NULL
;

6365 
©omPgaSts
 = 
NULL
;

6366 
ınsSts
 = 
NULL
 ;

6369 
objeù
 = 
	`»adOldObjeùFe
(
f’ame
);

6370 ià(
objeù
 =ğ
NULL
)

6371  
çl£
;

6373 
	`mod–N“dsSavšg
();

6374 
shiáOnPa¡e
 = 
çl£
;

6375 
wÜldWasAµl›d
 = 
çl£
;

6376  
Œue
;

6377 
	}
}

6379 
	gP3DCÚŒŞ
::
	$expÜtToImage
(cÚ¡ * 
f’ame
)

6382 if(
objeù
 =ğ
NULL
)

6384 ià(! 
objeù
->
	`v”ifyInBounds
()) {

6385 
cout
 << "This model is†argerhan or outsidehe unit cube --\n"

6386 << " cªnÙƒxpÜˆ¨cÜ»ù image" << 
’dl
;

6387 
	`b“p
();

6391 
Di¡ªûM­3D
 
di¡ªûM­
;

6392 
BoundšgBox
 
bbox
;

6393 
bbox
.
Üigš
 = 
	`VeùÜ3D
(0.0, 0.0, 0.0);

6394 
bbox
.
size
 = 
	`VeùÜ3D
(1.0, 1.0, 1.0);

6395 
m­_size
[3];

6396 
m­_size
[0] = (è
	`tunšgWt
(
OutMod–ImageX
);

6397 
m­_size
[1] = (è
	`tunšgWt
(
OutMod–ImageY
);

6398 
m­_size
[2] = (è
	`tunšgWt
(
OutMod–ImageZ
);

6400 
Image3D
* 
sourûImage
 = 
this
->
	`g‘ImagePŒ
();

6401 ià(
sourûImage
 !ğ
NULL
) {

6402 
tuÃV®s
.
	`£tWeight
(
OutMod–ImageFixedSize
, 1);

6403 
bbox
.
size
.
	`£tX
(
sourûImage
->
	`g‘XMod–Ex‹Á
());

6404 
bbox
.
size
.
	`£tY
(
sourûImage
->
	`g‘YMod–Ex‹Á
());

6405 
bbox
.
size
.
	`£tZ
(
sourûImage
->
	`g‘ZMod–Ex‹Á
());

6406 
m­_size
[0] = 
sourûImage
->
	`g‘XDim
();

6407 
m­_size
[1] = 
sourûImage
->
	`g‘YDim
();

6408 
m­_size
[2] = 
sourûImage
->
	`g‘ZDim
();

6411 ià(
	`tunšgWt
(
OutMod–ImageFixedSize
)) {

6412 
cout
 << "map size starts‡s "

6413 << 
m­_size
[0] << " "

6414 << 
m­_size
[1] << " "

6415 << 
m­_size
[2] << " "

6416 << 
’dl
;

6419 
sizeChªged
 = 
di¡ªûM­
.
	`š™ŸlizeW™hBBox
(

6420 
objeù
, &
bbox
, 
m­_size
,

6421 (è
	`tunšgWt
(
OutMod–ImageSurçûLev–
),

6423 
	`tunšgWt
(
OutMod–ImageFixedSize
è> 0 ? 
Œue
 : 
çl£
);

6425 ià(!
	`tunšgWt
(
OutMod–ImageFixedSize
è&& 
sizeChªged
 > 0) {

6426 
cout
 << "map size changed from "

6427 << 
m­_size
[0] << " "

6428 << 
m­_size
[1] << " "

6429 << 
m­_size
[2];

6430 
m­_size
[0] = 
di¡ªûM­
.
	`g‘M­Size
()[0];

6431 
m­_size
[1] = 
di¡ªûM­
.
	`g‘M­Size
()[1];

6432 
m­_size
[2] = 
di¡ªûM­
.
	`g‘M­Size
()[2];

6433 
cout
 << "o "

6434 << 
m­_size
[0] << " "

6435 << 
m­_size
[1] << " "

6436 << 
m­_size
[2] << " "

6437 << 
’dl
;

6440 
di¡ªûM­
.
	`ü—‹M­
(
Œue
);

6441 if(
di¡ªûM­
.
	`¡©us
(è=ğ
çl£
) {

6442 
cout
 << "E¼Ü: could‚ÙƒxpÜˆª image" << 
’dl
;

6443 
	`b“p
();

6447 
Image3D
* 
image
 = 
Ãw
 
	`Image3D
(
m­_size
[0], map_size[1], map_size[2]);

6450 ià(
sourûImage
 =ğ
NULL
) {

6451 
image
->
	`£tS·cšgAndOrigš
(

6452 1.0 / ()
m­_size
[0],

6453 1.0 / ()
m­_size
[1],

6454 1.0 / ()
m­_size
[2]);

6456 
VeùÜ3D
 
Üigš
 = 
sourûImage
->
	`g‘WÜldOrigš
();

6457 
image
->
	`£tS·cšgAndOrigš
(

6458 
sourûImage
->
	`g‘XS·cšg
(),

6459 
sourûImage
->
	`g‘YS·cšg
(),

6460 
sourûImage
->
	`g‘ZS·cšg
(),

6461 &
Üigš
);

6465 
G»yV®ue
* 
vox–s
 = 
image
->
	`g‘Vox–s
();

6466 
i
;

6467 
size
 = 
m­_size
[0] * map_size[1] * map_size[2];

6469 
i
 = 0; i < 
size
; i++)

6471 if(
di¡ªûM­
.
	`g‘Di¡ªû
(
i
) <= 0.0f)

6472 #ifdeà
BINARY


6473 
vox–s
[
i
] = 1;

6475 
vox–s
[
i
] = 
MAX_GREY_VALUE_WRITTEN
;

6478 
vox–s
[
i
] = 
MIN_GREY_VALUE
;

6482 
AÎImageIO
 
fe
;

6483 ià(
fe
.
	`wr™e
(
f’ame
, *
image
, 
MIN_GREY_VALUE
, 
MAX_GREY_VALUE_WRITTEN
)) {

6484 ià(
glob®V”bos™y
 >= 0)

6485 
cout
 << "ExpÜ‹d mod–Øimag" << 
f’ame
 << 
’dl
;

6488 
cout
 << "UÇbËØexpÜˆmod–Øimage: wr™çed" << 
’dl
;

6489 
	`b“p
();

6492 
d–‘e
 
image
;

6493 
	}
}

6495 #iâdeà
PRODUCTION_VERSION


6497 
	gP3DCÚŒŞ
::
	$expÜtDi¡ªûM­
(cÚ¡ * 
f’ame
)

6499 
G»yV®ue
 * 
vox–s
;

6500 
mš
, 
max
;

6501 
BoundšgBox
 
bbox
;

6503 if(
objeù
 =ğ
NULL
)

6505 ià(! 
objeù
->
	`v”ifyInBounds
()) {

6506 
cout
 << "This model is†argerhan or outsidehe unit cube --\n"

6507 << " cªnÙƒxpÜˆ¨cÜ»ù di¡ªû m­" << 
’dl
;

6508 
	`b“p
();

6512 cÚ¡ 
MAP_SIZE
[3] = {128, 128, 128};

6514 
Di¡ªûM­3D
 
di¡ªûM­
;

6515 
bbox
.
Üigš
 = 
	`VeùÜ3D
(0.0, 0.0, 0.0);

6516 
bbox
.
size
 = 
	`VeùÜ3D
(1.0, 1.0, 1.0);

6518 (è
di¡ªûM­
.
	`š™ŸlizeW™hBBox
(
objeù
, &
bbox
, 
MAP_SIZE
, 6, 0.6, 
Œue
);

6520 
di¡ªûM­
.
	`ü—‹M­
(
Œue
);

6521 ià(
di¡ªûM­
.
	`¡©us
(è=ğ
çl£
)

6524 
di¡ªûM­
.
	`¿nge
(
mš
, 
max
);

6525 ià(
glob®V”bos™y
 >= 1)

6526 
cout
 << "Di¡ªû m­„ªgğ(" << 
mš
 << ", " << 
max
 << ")\n";

6527 cÚ¡ * 
m­Size
 = 
di¡ªûM­
.
	`g‘M­Size
();

6528 ià(
glob®V”bos™y
 >= 1)

6529 
cout
 << "Imagsize: " << 
m­Size
[0] << ", " << mapSize[1] << ", "

6530 << 
m­Size
[2] << 
’dl
;

6531 
Image3D
 
	`image
(
m­Size
[0], mapSize[1], mapSize[2]);

6532 
image
.
	`£tS·cšgAndOrigš
(1.0 / ()
m­Size
[0], 1.0 / ()mapSize[1],

6533 1.0 / ()
m­Size
[2]);

6535 
vox–s
 = 
image
.
	`g‘Vox–s
();

6536 
i
;

6537 
size
 = 
m­Size
[0] * mapSize[1] * mapSize[2];

6539 
i
 = 0; i < 
size
; i++)

6541 
d
 = 
di¡ªûM­
.
	`g‘Di¡ªû
(
i
);

6542 ià(
d
 < 0)

6543 
vox–s
[
i
] = 
MIN_GREY_VALUE
;

6545 
vox–s
[
i
] = (
G»yV®ue
è(
MAX_GREY_VALUE_WRITTEN
*
d
/
max
);

6548 
AÎImageIO
 
fe
;

6549 ià(! 
fe
.
	`wr™e
(
f’ame
, 
image
, 
MIN_GREY_VALUE
, 
MAX_GREY_VALUE_WRITTEN
)) {

6550 
cout
 << "UÇbËØwr™di¡ªû m­ image" << 
’dl
;

6551 
	`b“p
();

6553 ià(
glob®V”bos™y
 >= 0)

6554 
cout
 << "ExpÜ‹d di¡ªû m­Ø" << 
f’ame
 << 
’dl
;

6555 
	}
}

6763 
	gP3DCÚŒŞ
::
	$expÜtToBYUTes
(cÚ¡ * 
f’ame
, 
boŞ
 
quads
,

6764 
boŞ
 
u£WÜldCoÜds
, 
Ëv–
, 
figu»Mask
, boŞ 
£·¿‹
)

6766 
Image3D
 * 
image
;

6767 
BYU
::
BYUPŞy_t
 
ty³
;

6769 if(
objeù
 =ğ
NULL
)

6772 ià(
u£WÜldCoÜds
) {

6773 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

6774 ià(
image
 =ğ
NULL
) {

6775 
cout
 << "Error: An image mustƒxistoƒxport BYUiles in world coordinates"

6776 << 
’dl
;

6777 
	`b“p
();

6780 #ifdeà
BINARY


6781 
cout
 << "Sÿlšge tØwÜld coÜdš©e oàimage" << 
’dl
;

6785 
image
 = 
NULL
;

6787 
BYU
 
byu
;

6788 ià(
quads
)

6789 
ty³
 = 
BYU
::
Quads
;

6791 
ty³
 = 
BYU
::
Tris
;

6793 #ifdeà
BINARY


6794 cÚ¡ 
boŞ
 
disÿrdEnds
 = (
	`tunšgWt
(
WeightM©chAtEnds
) < 1e-5);

6796 cÚ¡ 
boŞ
 
disÿrdEnds
 = (
	`tunšgWt
(
IgnÜeM©chAtEnds
) != 0.0);

6798 iàĞ!
byu
.
	`expÜtMod–ToBYU
(
f’ame
, 
ty³
, 
Ëv–
, 
objeù
,

6799 
disÿrdEnds
, 
figu»Mask
, 
£·¿‹
, 
image
, 
BYU
::
XYZ
) )

6801 
cout
 << "E¼Ü: BYU fnÙ saved" << 
’dl
;

6802 
	`b“p
();

6806 
âame_Ën
 = 
	`¡¾’
(
f’ame
);

6807 
auto_±r
<> 
	`âame
Ğ
Ãw
 [
âame_Ën
+13] );

6808 if(
	`¡r¡r
(
f’ame
, ".byu"è+ 4 - 
âame_Ën
 == filename) {

6809 
âame_Ën
 -= 4;

6811 
	`memıy
(
âame
.
	`g‘
(), 
f’ame
, ()*(
âame_Ën
+1));

6812 
	`memıy
(
âame
.
	`g‘
(è+ 
âame_Ën
, "-uvt.byu", 9*());

6813 iàĞ!
byu
.
	`expÜtMod–ToBYU
(
âame
.
	`g‘
(), 
ty³
, 
Ëv–
, 
objeù
,

6814 
disÿrdEnds
, 
figu»Mask
, 
£·¿‹
, 
image
, 
BYU
::
UVT
) )

6816 
cout
 << "E¼Ü: BYU f(uvˆd©aènÙ saved" << 
’dl
;

6817 
	`b“p
();

6821 
	`memıy
(
âame
.
	`g‘
(è+ 
âame_Ën
, "-normals.byu", 13*());

6822 iàĞ!
byu
.
	`expÜtMod–ToBYU
(
âame
.
	`g‘
(), 
ty³
, 
Ëv–
, 
objeù
,

6823 
disÿrdEnds
, 
figu»Mask
, 
£·¿‹
, 
image
, 
BYU
::
NORMALS
) )

6825 
cout
 << "E¼Ü: BYU fÒÜm® d©aènÙ saved" << 
’dl
;

6826 
	`b“p
();

6831 ià(
glob®V”bos™y
 >= 0) {

6832 
cout
 << "ExpÜ‹d BYUe a " << (
quads
 ? "quads" : "triangles")

6833 << "‡ˆËv– " << 
Ëv–
 << "o ";

6834 ià(
£·¿‹
)

6835 
cout
 << "fe Çmed \À " << 
byu
.
	`ba£Name
(è<< "NN" << byu.
	`ex‹nsiÚ
()

6836 << ", wh”'NN' i thfigu»‚umb”" << 
’dl
;

6838 
cout
 << 
f’ame
 << 
’dl
;

6840 
	}
}

6842 
	gP3DCÚŒŞ
::
	$g‘R–©iveM¬kedPrim™iveId
(& 
figIndex
, & 
´imIndex
)

6844 
M3DFigu»
 * 
figu»PŒ
;

6845 
numFigu»s
;

6846 
numPrim™ives
;

6847 
i
;

6849 
´imIndex
 = 
m¬kedPrim™iveId
;

6850 
figIndex
 = -1;

6851 if(
objeù
 =ğ
NULL
 || 
m¬kedPrim™iveId
 =ğ
INVALID_PRIMITIVE_ID
)

6854 
numFigu»s
 = 
objeù
->
	`g‘Figu»CouÁ
();

6855 
i
 = 0; i < 
numFigu»s
; i++)

6857 
figu»PŒ
 = 
objeù
->
	`g‘Figu»PŒ
(
i
);

6858 if(
figu»PŒ
 =ğ
NULL
)

6861 
numPrim™ives
 = 
figu»PŒ
->
	`g‘Prim™iveCouÁ
();

6862 if(
´imIndex
 >ğ
numPrim™ives
)

6863 
´imIndex
 -ğ
numPrim™ives
;

6867 
figIndex
 = 
i
;

6871 
	}
}

6873 
	gP3DCÚŒŞ
::
	$´im™iveFigu¿lCoÜdš©es
(
figIndex
, 
´imIndex
, & 
u
, & 
v
)

6875 
M3DFigu»
 * 
figu»PŒ
;

6876 
numFigu»s
;

6877 
numPrim™ives
;

6879 
u
 = -1;

6880 
v
 = -1;

6881 if(
objeù
 =ğ
NULL
 || 
figIndex
 < 0 || 
´imIndex
 =ğ
INVALID_PRIMITIVE_ID
)

6884 
numFigu»s
 = 
objeù
->
	`g‘Figu»CouÁ
();

6885 ià(
figIndex
 >ğ
numFigu»s
)

6888 
figu»PŒ
 = 
objeù
->
	`g‘Figu»PŒ
(
figIndex
);

6889 ià(
figu»PŒ
 =ğ
NULL
)

6892 
numPrim™ives
 = 
figu»PŒ
->
	`g‘Prim™iveCouÁ
();

6893 ià(
´imIndex
 >ğ
numPrim™ives
)

6896 if(
	`ty³id
(*
figu»PŒ
è=ğty³id(
M3DQuadFigu»
)) {

6897 
¡©ic_ÿ¡
<
M3DQuadFigu»
*>(
figu»PŒ
)->
	`figu¿lCoÜdš©es
(
´imIndex
, 
u
, 
v
);

6900 
u
 = 
´imIndex
;

6901 
v
 = 0;

6904 
	}
}

6906 
	gP3DCÚŒŞ
::
	$toggËM¬kedPrim™ive
(
id
)

6908 if(
objeù
 =ğ
NULL
)

6911 if(
id
 =ğ
m¬kedPrim™iveId
)

6912 
m¬kedPrim™iveId
 = 
INVALID_PRIMITIVE_ID
;

6914 
m¬kedPrim™iveId
 = 
id
;

6915 
	}
}

6917 
M3DPrim™ive
 * 
	gP3DCÚŒŞ
::
	$g‘M¬kedPrim™ive
()

6919 if(
objeù
 =ğ
NULL
 || 
m¬kedPrim™iveId
 =ğ
INVALID_PRIMITIVE_ID
)

6920  
NULL
;

6922  
objeù
->
	`g‘Prim™ivePŒ
(
m¬kedPrim™iveId
);

6923 
	}
}

6925 
	gP3DCÚŒŞ
::
	$ş—rIÁ”pŞ©edPrim™ive
() {

6926 if(
š‹½Ş©edPrim™ive
 !ğ
NULL
)

6928 
d–‘e
 
š‹½Ş©edPrim™ive
;

6929 
š‹½Ş©edPrim™ive
 = 
NULL
;

6931 
	}
}

6933 
	gP3DCÚŒŞ
::
	$£tIÁ”pŞ©edPrim™ive
(
u
, 
v
)

6935 
figu»Id
, 
´im™iveId
;

6936 
M3DFigu»
 * 
figu»PŒ
;

6938 
	`ş—rIÁ”pŞ©edPrim™ive
();

6940 if(
objeù
 =ğ
NULL
)

6943 
	`g‘R–©iveM¬kedPrim™iveId
(
figu»Id
, 
´im™iveId
);

6944 ià(
figu»Id
 < 0) {

6945 
cout
 << "You must first mark‡n‡tom ofhe figure you wanto interpolate"

6946 << 
’dl
;

6947 
	`b“p
();

6951 
figu»PŒ
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

6952 if(
figu»PŒ
 =ğ
NULL
)

6955 
M3DSubfigu»T¿nsfÜm©iÚ
 
ŒªsfÜm
;

6957 
š‹½Ş©edPrim™ive
 = 
Ãw
 
M3DQuadPrim™ive
;

6958 
cout
 << "IÁ”pŞ©ed…rim™iv© u = " << 
u
 << ", v = " << 
v
;

6960 ià(
ŒªsfÜm
.
	`g‘IÁ”pŞ©edPrim™ive
(*
š‹½Ş©edPrim™ive
, 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>(
figu»PŒ
), 
u
, 
v
, 0)) {

6961 
cout
 << ":\n";

6962 
š‹½Ş©edPrim™ive
->
	`´št
();

6965 
cout
 << " unknown" << 
’dl
;

6966 
	`ş—rIÁ”pŞ©edPrim™ive
();

6968 
	}
}

6971 
	gP3DCÚŒŞ
::
	$»guÏrize
(
¡•size
, 
™”©iÚs
)

6973 ià(
¡•size
 <ğ0.0 || 
™”©iÚs
 < 0)

6976 ià(
objeù
 =ğ
NULL
)

6979 
	`¡¬tO³¿tiÚ
();

6981  
i
 = 0; i !ğ
objeù
->
	`g‘Figu»CouÁ
(); ++i ) {

6982 
M3DFigu»
* 
fig
 = 
objeù
->
	`g‘Figu»PŒ
(
i
);

6983 ifĞ
	`ty³id
(*
fig
è=ğty³id(
M3DTubeFigu»
)) {

6984 
fig
->
	`»§m¶eFÜReguÏrS·cšg
();

6991 
objeù
->
	`£tModif›d
(
Œue
);

6992 
	`mod–N“dsSavšg
(
Œue
);

6994 
	`’dO³¿tiÚ
();

6995 
£ËùiÚChªged
 = 
Œue
;

6997 ià(
glob®V”bos™y
 >= 0)

6998 
cout
 << "ReguÏrized mod–" << 
’dl
;

6999 
	}
}

7003 
	gP3DCÚŒŞ
::
	$®loÿ‹ImageLªdm¬ks
(
couÁ
)

7005 
imageLªdm¬ks
.
	`ş—r
();

7006 
i
 = 0; i < 
couÁ
; i++)

7007 
imageLªdm¬ks
.
	`push_back
(
em±yImageLªdm¬k
);

7008 
numImageLªdm¬ks
 = 0;

7009 
	}
}

7011 
	gP3DCÚŒŞ
::
	$š£¹ImageLªdm¬k
(
©
)

7013 
imageLªdm¬ks
.
	`push_back
(
em±yImageLªdm¬k
);

7014 
i
 = 
imageLªdm¬ks
.
	`size
(è- 1; i > 
©
; i--)

7015 
imageLªdm¬ks
[
i
] = imageLandmarks[i - 1];

7016 
imageLªdm¬ks
[
©
] = 
em±yImageLªdm¬k
;

7017 
	}
}

7019 
	gP3DCÚŒŞ
::
	$­³ndImageLªdm¬k
()

7021 
imageLªdm¬ks
.
	`push_back
(
em±yImageLªdm¬k
);

7022 
	}
}

7024 
boŞ
 
	gP3DCÚŒŞ
::
	$£tImageLªdm¬k
(
Ïndm¬kId
, 
x
, 
y
, 
z
,

7025 
figu»Id
, 
numb”
, cÚ¡ * 
Çme
)

7027 ià(
Ïndm¬kId
 < 0 ||†ªdm¬kId >ğ
imageLªdm¬ks
.
	`size
())

7028  
çl£
;

7030 ià(
imageLªdm¬ks
[
Ïndm¬kId
].
numb”
 < 0)

7031 
numImageLªdm¬ks
++;

7032 
imageLªdm¬ks
[
Ïndm¬kId
].
coÜds
[0] = 
x
;

7033 
imageLªdm¬ks
[
Ïndm¬kId
].
coÜds
[1] = 
y
;

7034 
imageLªdm¬ks
[
Ïndm¬kId
].
coÜds
[2] = 
z
;

7035 
imageLªdm¬ks
[
Ïndm¬kId
].
figu»Id
 = figureId;

7036 
imageLªdm¬ks
[
Ïndm¬kId
].
numb”
 =‚umber;

7037 
imageLªdm¬ks
[
Ïndm¬kId
].
Çme
 =‚ame;

7038  
Œue
;

7039 
	}
}

7041 
imageLªdm¬k_t
 
	gP3DCÚŒŞ
::
	$g‘ImageLªdm¬k
(
Ïndm¬kId
) const

7043 ià(
Ïndm¬kId
 < 0 ||†ªdm¬kId >ğ
imageLªdm¬ks
.
	`size
())

7044  
em±yImageLªdm¬k
;

7046  
imageLªdm¬ks
[
Ïndm¬kId
];

7047 
	}
}

7063 
boŞ
 
	gP3DCÚŒŞ
::
	$Ïndm¬kIsPaœed
(
figu»Id
, 
Ïndm¬k
)

7065 ià(
numImageLªdm¬ks
 == 0)

7066  
çl£
;

7068 
l
 = 0;† < 
imageLªdm¬ks
.
	`size
();†++) {

7069 ià(
imageLªdm¬ks
[
l
].
figu»Id
 =ğfigu»Id && imageLªdm¬ks[l].
numb”
 =ğ
Ïndm¬k
)

7070  
Œue
;

7073  
çl£
;

7074 
	}
}

7096 
	gP3DCÚŒŞ
::
	$figu»OfLªdm¬k
(
šdex
, & 
Ïndm¬k
)

7098 ià(
šdex
 < 
imageLªdm¬ks
.
	`size
()) {

7099 
Ïndm¬k
 = 
imageLªdm¬ks
[
šdex
].
numb”
;

7100  
imageLªdm¬ks
[
šdex
].
figu»Id
;

7103 
Ïndm¬k
 = -1;

7106 
	}
}

7111 
	gP3DCÚŒŞ
::
	$d–‘eImageLªdm¬ks
() {

7112 #ifdeà
DEBUG


7113 
cout
 << "P3DCÚŒŞ::d–‘eImageLªdm¬ks()" << 
’dl
;

7115 
imageLªdm¬ks
.
	`ş—r
();

7116 
numImageLªdm¬ks
 = 0;

7117 
	}
}

7121 
	gP3DCÚŒŞ
::
	$ş—rImageLªdm¬ks
() {

7122 
i
 = 0; i < 
imageLªdm¬ks
.
	`size
(); i++)

7123 ià(
imageLªdm¬ks
[
i
].
figu»Id
 >= 0)

7124 
imageLªdm¬ks
[
i
] = 
em±yImageLªdm¬k
;

7126 
numImageLªdm¬ks
 = 0;

7127 
	}
}

7161 
boŞ
 
	gP3DCÚŒŞ
::
	$ş—rImageLªdm¬k
(
šdex
)

7163 
figu»Id
;

7165 #ifdeà
DEBUG


7166 
cout
 << "P3DCÚŒŞ::ş—rImageLªdm¬k(" << 
šdex
 << ')' << 
’dl
;

7168 ià(
šdex
 < 0 || index >ğ
imageLªdm¬ks
.
	`size
())

7169  
çl£
;

7175 ià(
imageLªdm¬ks
[
šdex
].
numb”
 >= 0)

7177 
figu»Id
 = 
imageLªdm¬ks
[
šdex
].figureId;

7178 
imageLªdm¬ks
[
šdex
] = 
em±yImageLªdm¬k
;

7179 
imageLªdm¬ks
[
šdex
].
figu»Id
 = figureId;

7181 
numImageLªdm¬ks
--;

7188  
Œue
;

7191 
cout
 << "There is‚o†andmarko delete\n";

7192  
çl£
;

7193 
	}
}

7198 
	gP3DCÚŒŞ
::
	$d–‘eImageLªdm¬k
(
šdex
)

7200 
i
;

7201 
figu»Id
;

7202 
boŞ
 
·œed
;

7204 #ifdeà
DEBUG


7205 
cout
 << "P3DCÚŒŞ::d–‘eImageLªdm¬k(" << 
šdex
 << ')' << 
’dl
;

7207 ià(
šdex
 < 0 || index >ğ
imageLªdm¬ks
.
	`size
())

7214 ià(
imageLªdm¬ks
[
šdex
].
numb”
 >= 0)

7215 
·œed
 = 
Œue
;

7217 
·œed
 = 
çl£
;

7218 
figu»Id
 = 
imageLªdm¬ks
[
šdex
].figureId;

7220 
i
 = 
šdex
 + 1; i < 
imageLªdm¬ks
.
	`size
(); i++) {

7221 
imageLªdm¬ks
[
i
 - 1] = imageLandmarks[i];

7223 ià(
figu»Id
 >ğ0 && 
imageLªdm¬ks
[
i
 - 1].figureId == figureId)

7224 
imageLªdm¬ks
[
i
 - 1].
numb”
--;

7226 
imageLªdm¬ks
.
	`pİ_back
();

7228 ià(
·œed
)

7229 
numImageLªdm¬ks
--;

7236 
	}
}

7238 #iâdeà
BINARY


7240 
	gP3DCÚŒŞ
::
	$­¶yLªdm¬kT¿nsfÜm©iÚ
()

7242 
M3DFigu»
 * 
figu»
;

7243 
numFigu»s
;

7244 
numLªdm¬ks
;

7246 ià(
objeù
 =ğ
NULL
)

7249 
numLªdm¬ks
 = 
objeù
->
	`g‘Lªdm¬kCouÁ
();

7250 ià(
numLªdm¬ks
 < 2) {

7251 
cout
 << "AÀšsuffic›Á‚umb” oàÏndm¬k ha b“À£t" << 
’dl
;

7252 
	`b“p
();

7255 ià(
numLªdm¬ks
 !ğ
numImageLªdm¬ks
) {

7256 
cout
 << "AÎ†ªdm¬k havnÙ b“À·œed" << 
’dl
;

7257 
	`b“p
();

7261 
usšg
 
Çme¥aû
 
·uly
;

7263 
M©rix
 
	`surçûLªdm¬ks
(
numLªdm¬ks
, 3, 
NULL
, 
çl£
);

7264 
M©rix
 
	`rg‘Lªdm¬ks
(
numLªdm¬ks
, 3, 
NULL
, 
çl£
);

7266 
cŞ
 = 0;

7267 
numFigu»s
 = 
objeù
->
	`g‘Figu»CouÁ
();

7268 
figu»Id
 = 0; figu»Id < 
numFigu»s
; figureId++) {

7269 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

7270 
n
 = 
figu»
->
	`g‘Lªdm¬kCouÁ
();

7271 
i
 = 0; i < 
n
; i++) {

7272 
VeùÜ3D
 
l
 = 
figu»
->
	`g‘Lªdm¬k
(
i
);

7273 
	`surçûLªdm¬ks
(
cŞ
, 0èğ
l
.
	`g‘X
();

7274 
	`surçûLªdm¬ks
(
cŞ
, 1èğ
l
.
	`g‘Y
();

7275 
	`surçûLªdm¬ks
(
cŞ
, 2èğ
l
.
	`g‘Z
();

7276 ià(
imageLªdm¬ks
[
cŞ
].
coÜds
[0] < 0)

7278 
	`rg‘Lªdm¬ks
(
cŞ
, 0èğ
imageLªdm¬ks
[cŞ].
coÜds
[0];

7279 
	`rg‘Lªdm¬ks
(
cŞ
, 1èğ
imageLªdm¬ks
[cŞ].
coÜds
[1];

7280 
	`rg‘Lªdm¬ks
(
cŞ
, 2èğ
imageLªdm¬ks
[cŞ].
coÜds
[2];

7281 
cŞ
++;

7285 
Lªdm¬kDefÜm©iÚ
 
	`´oüu¡es
(
surçûLªdm¬ks
, 
rg‘Lªdm¬ks
, 
cŞ
);

7288 
	`¡¬tO³¿tiÚ
();

7290 
	`£ËùAÎ
();

7293 
objeù
->
	`sÿËBy
(
´oüu¡es
.
	`g‘B‘a
());

7296 
M©rix
 
	`rÙM©
(
´oüu¡es
.
	`g‘Gamma
());

7298 
m©
[4][4];

7300 
i
 = 0; i < 3; i++)

7302 
j
 = 0; j < 3; j++)

7304 
m©
[
i
][
j
] = 
	`rÙM©
(i, j);

7308 
Qu©
 
qRÙ
;

7309 
qRÙ
.
	`m©rixToQu©
(
m©
);

7312 
objeù
->
	`rÙ©eBy
(
qRÙ
);

7315 
VeùÜ
 
x
 = 
´oüu¡es
.
	`g‘Off£t
();

7317 
VeùÜ3D
 
	`Œªs
(
	`x
(0), x(1), x(2));

7318 
objeù
->
	`Œª¦©eBy
(
Œªs
);

7320 
	`de£ËùAÎ
();

7322 
	`’dO³¿tiÚ
();

7324 
	`mod–N“dsSavšg
(
Œue
);

7325 
£ËùiÚChªged
 = 
Œue
;

7326 
	}
}

7380 
	gP3DCÚŒŞ
::
	$li¡T»eFigu»s
(
M3DFigu»T»eNode
 * 
roÙ
)

7382 
M3DFigu»T»eNode
 * 
chd
;

7383 
M3DFigu»T»eNode
 * 
node
;

7385 ià(
Œ“Figu»s
 !ğ
NULL
)

7386 
d–‘e
 [] 
Œ“Figu»s
;

7387 
Œ“Figu»s
 = 
Ãw
 [
roÙ
->
	`couÁFigu»s
()];

7388 
Œ“Figu»sCouÁ
 = 0;

7390 ià(
roÙ
->
	`g‘Figu»Id
() < 0)

7393 ià(
roÙ
->
	`g‘ChdCouÁ
() == 0) {

7395 
Œ“Figu»s
[
Œ“Figu»sCouÁ
++] = 
roÙ
->
	`g‘Figu»Id
();

7400 
node
 = 
roÙ
;

7401 
node
 !ğ
NULL
)

7404 
Œ“Figu»s
[
Œ“Figu»sCouÁ
++] = 
node
->
	`g‘Figu»Id
();

7407 
chd
 = 
node
->
	`g‘Chd
(0);

7408 ià(
chd
 =ğ
NULL
) {

7410 
chd
 = 
node
->
	`g‘Siblšg
();

7411 
chd
 =ğ
NULL
) {

7412 
node
 =‚ode->
	`g‘P¬’t
();

7413 ià(
node
 =ğ
roÙ
) {

7414 
chd
 = 
NULL
;

7417 
chd
 = 
node
->
	`g‘Siblšg
();

7420 
node
 = 
chd
;

7422 
	}
}

7425 
M3DFigu»T»eNode
 * 
	gP3DCÚŒŞ
::
	$š™ŸlizeO±imiz”T»e
()

7427 
M3DFigu»T»eNode
 * 
roÙ
;

7429 
İtimiz”T»eIndex
 = 0;

7430 
roÙ
 = 
objeù
->
	`g‘Figu»T»eRoÙ
(
İtimiz”T»eIndex
);

7431 ià(
roÙ
 =ğ
NULL
) {

7432 
cout
 << "Figu»»" << 
İtimiz”T»eIndex
 << " contains‚o figures\n";

7433 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_END_STAGE
;

7434  
NULL
;

7438 
	`li¡T»eFigu»s
(
roÙ
);

7439 ià(
Œ“Figu»sCouÁ
 <= 0) {

7441 
cout
 << "Figu»»" << 
İtimiz”T»eIndex
 << " contains‚o figures\n";

7442 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_END_STAGE
;

7443  
NULL
;

7445 
İtimiz”Figu»Id
 = 
Œ“Figu»s
[0];

7448 
cu¼’tPGAO±imiz©iÚS‹p
 = 0;

7450  
roÙ
;

7451 
	}
}

7453 
	gP3DCÚŒŞ
::
	$£ËùT»e
(
M3DFigu»T»eNode
 * 
node
)

7455 
M3DFigu»T»eNode
 * 
chd
;

7456 
M3DFigu»
 * 
figu»
;

7457 
chdCouÁ
, 
i
;

7459 
i
 = 
node
->
	`g‘Figu»Id
();

7460 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
i
);

7461 
figu»
->
	`£Ëù
();

7463 
chdCouÁ
 = 
node
->
	`g‘ChdCouÁ
();

7464 
i
 = 0; i < 
chdCouÁ
; i++)

7466 
chd
 = 
node
->
	`g‘Chd
(
i
);

7467 ià(
chd
 !ğ
NULL
)

7468 
	`£ËùT»e
(
chd
);

7470 
	}
}

7472 
	gP3DCÚŒŞ
::
	$de£ËùT»e
(
M3DFigu»T»eNode
 * 
node
)

7474 
M3DFigu»T»eNode
 * 
chd
;

7475 
M3DFigu»
 * 
figu»
;

7476 
chdCouÁ
, 
i
;

7478 
i
 = 
node
->
	`g‘Figu»Id
();

7479 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
i
);

7480 
figu»
->
	`de£Ëù
();

7482 
chdCouÁ
 = 
node
->
	`g‘ChdCouÁ
();

7483 
i
 = 0; i < 
chdCouÁ
; i++)

7485 
chd
 = 
node
->
	`g‘Chd
(
i
);

7486 ià(
chd
 !ğ
NULL
)

7487 
	`de£ËùT»e
(
chd
);

7489 
	}
}

7491 
	gP3DCÚŒŞ
::
	$toggËT»e
(
M3DFigu»T»eNode
 * 
node
)

7493 
M3DFigu»T»eNode
 * 
chd
;

7494 
M3DFigu»
 * 
figu»
;

7495 
chdCouÁ
, 
i
;

7497 
i
 = 
node
->
	`g‘Figu»Id
();

7498 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
i
);

7499 
figu»
->
	`toggËS–eùed
();

7501 
chdCouÁ
 = 
node
->
	`g‘ChdCouÁ
();

7502 
i
 = 0; i < 
chdCouÁ
; i++)

7504 
chd
 = 
node
->
	`g‘Chd
(
i
);

7505 ià(
chd
 !ğ
NULL
)

7506 
	`toggËT»e
(
chd
);

7508 
	}
}

7510 
	gP3DCÚŒŞ
::
	$£tO±imiz”IÁ’s™yWšdowšg
(
boŞ
 
toggË
)

7512 
İtimizeW™hWšdowšg
 = 
toggË
;

7513 
	}
}

7515 
O±imiz”Sge
 
	gP3DCÚŒŞ
::
	$ÃxtO±imiz”Sge
()

7517 
numT»es
;

7518 
M3DFigu»T»eNode
 * 
figu»T»eRoÙ
;

7521 ià(
objeù
 =ğ
NULL
)

7522  
cu¼’tO±imiz”Sge
;

7524 
numT»es
 = 
objeù
->
	`g‘Figu»T»eCouÁ
();

7526 
cu¼’tO±imiz”Sge
)

7528 
NO_OPTIMIZER_STAGE
:

7529 
OPTIMIZER_SETUP_STAGE
:

7531 
figu»T»eRoÙ
 = 
	`š™ŸlizeO±imiz”T»e
();

7532 ià(
figu»T»eRoÙ
 =ğ
NULL
)

7534 
cu¼’tFigu»Index
 = 0;

7536 ià(
numT»es
 == 1) {

7537 
	`de£ËùAÎ
();

7538 ià(
Œ“Figu»sCouÁ
 > 1) {

7539 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_OBJECT_STAGE
;

7540 
	`toggËT»e
(
figu»T»eRoÙ
);

7543 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_FIGURE_STAGE
;

7544 
	`toggËFigu»
(
İtimiz”Figu»Id
);

7548 
	`£ËùAÎ
();

7549 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_ENSEMBLE_STAGE
;

7551 
cu¼’tPGAO±imiz©iÚS‹p
 = 0;

7554 
OPTIMIZER_ENSEMBLE_STAGE
:

7555 
	`de£ËùAÎ
();

7556 ià(
Œ“Figu»sCouÁ
 > 1) {

7558 
figu»T»eRoÙ
 = 
	`š™ŸlizeO±imiz”T»e
();

7559 ià(
figu»T»eRoÙ
 =ğ
NULL
)

7561 
	`toggËT»e
(
figu»T»eRoÙ
);

7562 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_OBJECT_STAGE
;

7566 #ifdeà
BINARY


7570 
İtimiz”Figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

7572 
İtimiz”Figu»Id
 = 
Œ“Figu»s
[
cu¼’tFigu»Index
];

7574 
	`toggËFigu»
(
İtimiz”Figu»Id
);

7575 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_FIGURE_STAGE
;

7577 
cu¼’tPGAO±imiz©iÚS‹p
++;

7580 
OPTIMIZER_OBJECT_STAGE
:

7582 
İtimiz”Figu»Id
 = 
Œ“Figu»s
[
cu¼’tFigu»Index
];

7583 
	`de£ËùAÎ
();

7584 
	`toggËFigu»
(
İtimiz”Figu»Id
);

7585 ià(
Œ“Figu»sCouÁ
 > 1)

7586 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_MAIN_FIGURE_STAGE
;

7588 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_FIGURE_STAGE
;

7589 
cu¼’tPGAO±imiz©iÚS‹p
++;

7592 
OPTIMIZER_FIGURE_STAGE
:

7593 
OPTIMIZER_MAIN_FIGURE_STAGE
:

7594 
OPTIMIZER_SUBFIGURE_STAGE
:

7595 
	`de£ËùAÎ
();

7596 
	`toggËFigu»
(
İtimiz”Figu»Id
);

7597 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_PRIMITIVE_STAGE
;

7598 
cu¼’tPGAO±imiz©iÚS‹p
++;

7601 
OPTIMIZER_PRIMITIVE_STAGE
:

7603 
	`de£ËùAÎ
();

7607 (è
m©ch
->
	`upd©eDi¡ªûLi¡
(
objeù
, 
İtimiz”Figu»Id
);

7609 
	`toggËFigu»
(
İtimiz”Figu»Id
);

7610 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_SPOKE_STAGE
;

7613 
OPTIMIZER_SPOKE_STAGE
:

7615 
	`de£ËùAÎ
();

7619 (è
m©ch
->
	`upd©eDi¡ªûLi¡
(
objeù
, 
İtimiz”Figu»Id
);

7622 
cu¼’tFigu»Index
++;

7623 ià(
cu¼’tFigu»Index
 < 
Œ“Figu»sCouÁ
) {

7626 
İtimiz”Figu»Id
 = 
Œ“Figu»s
[
cu¼’tFigu»Index
];

7627 
	`toggËFigu»
(
İtimiz”Figu»Id
);

7628 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_SUBFIGURE_STAGE
;

7632 
İtimiz”T»eIndex
++;

7633 ià(
İtimiz”T»eIndex
 < 
objeù
->
	`g‘Figu»T»eCouÁ
())

7636 
figu»T»eRoÙ
 = 
objeù
->
	`g‘Figu»T»eRoÙ
(
İtimiz”T»eIndex
);

7637 ià(
figu»T»eRoÙ
 =ğ
NULL
) {

7639 
cout
 << "Figu»»" << 
İtimiz”T»eIndex
 << " contains‚o figures\n";

7640 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_END_STAGE
;

7644 
	`li¡T»eFigu»s
(
figu»T»eRoÙ
);

7645 ià(
Œ“Figu»sCouÁ
 <= 0) {

7647 
cout
 << "Figu»»" << 
İtimiz”T»eIndex
 << " contains‚o figures\n";

7648 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_END_STAGE
;

7651 
İtimiz”Figu»Id
 = 
Œ“Figu»s
[0];

7652 
cu¼’tFigu»Index
 = 0;

7655 ià(
Œ“Figu»sCouÁ
 > 1) {

7656 
	`toggËT»e
(
figu»T»eRoÙ
);

7657 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_OBJECT_STAGE
;

7660 
	`toggËFigu»
(
İtimiz”Figu»Id
);

7661 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_FIGURE_STAGE
;

7666 
figu»T»eRoÙ
 = 
	`š™ŸlizeO±imiz”T»e
();

7667 ià(
figu»T»eRoÙ
 =ğ
NULL
)

7669 
cu¼’tFigu»Index
 = 0;

7670 
	`toggËFigu»
(
İtimiz”Figu»Id
);

7671 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_BOUNDARY_DISPLACEMENT_STAGE
;

7677 
OPTIMIZER_BOUNDARY_DISPLACEMENT_STAGE
:

7679 
	`de£ËùAÎ
();

7682 (è
m©ch
->
	`upd©eDi¡ªûLi¡
(
objeù
, 
İtimiz”Figu»Id
);

7685 
cu¼’tFigu»Index
++;

7686 ià(
cu¼’tFigu»Index
 < 
Œ“Figu»sCouÁ
) {

7689 
İtimiz”Figu»Id
 = 
Œ“Figu»s
[
cu¼’tFigu»Index
];

7690 
	`toggËFigu»
(
İtimiz”Figu»Id
);

7694 
İtimiz”T»eIndex
++;

7695 ià(
İtimiz”T»eIndex
 < 
objeù
->
	`g‘Figu»T»eCouÁ
())

7698 
figu»T»eRoÙ
 = 
objeù
->
	`g‘Figu»T»eRoÙ
(
İtimiz”T»eIndex
);

7699 ià(
figu»T»eRoÙ
 =ğ
NULL
) {

7701 
cout
 << "Figu»»" << 
İtimiz”T»eIndex
 << " contains‚o figures\n";

7702 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_END_STAGE
;

7706 
	`li¡T»eFigu»s
(
figu»T»eRoÙ
);

7707 ià(
Œ“Figu»sCouÁ
 <= 0) {

7709 
cout
 << "Figu»»" << 
İtimiz”T»eIndex
 << " contains‚o figures\n";

7710 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_END_STAGE
;

7713 
İtimiz”Figu»Id
 = 
Œ“Figu»s
[0];

7714 
cu¼’tFigu»Index
 = 0;

7715 
	`toggËFigu»
(
İtimiz”Figu»Id
);

7719 
cu¼’tO±imiz”Sge
 = 
OPTIMIZER_END_STAGE
;

7723 
OPTIMIZER_END_STAGE
:

7724 
	`ÿnûlO±imiz©iÚ
();

7728 
cu¼’tO±imiz”Sge
 = 
NO_OPTIMIZER_STAGE
;

7732  
cu¼’tO±imiz”Sge
;

7733 
	}
}

7735 
O±imiz”Ba£
 * 
	gP3DCÚŒŞ
::
	$g‘O±imz”
(
O±imiz”Ba£
::
İtimiz”_t
 
ty³
)

7737 
O±imiz”Ba£
 * 
o
;

7738 
ty³
) {

7739 
O±imiz”Ba£
::
Bound¬yDi¥l
:

7740 
o
 = 
vox–SgeO±imiz”
;

7742 
O±imiz”Ba£
::
DefÜm©iÚ
:

7743 
o
 = 
defÜm©iÚO±imiz”
;

7745 
O±imiz”Ba£
::
Spoke
:

7746 
o
 = 
¥okeO±imiz”
;

7748 
O±imiz”Ba£
::
MašFigu»
:

7749 
o
 = 
mašFigu»O±imiz”
;

7751 
O±imiz”Ba£
::
Regi¡¿tiÚ
:

7752 
o
 = 
»gi¡¿tiÚO±imiz”
;

7754 
O±imiz”Ba£
::
Subfigu»
:

7755 
o
 = 
subfigu»O±imiz”
;

7758  
o
;

7759 
	}
}

7761 
	gP3DCÚŒŞ
::
	$ÿnûlO±imiz©iÚ
()

7763 #ifdeà
OPTIMIZATION_VISUALIZER


7764 
glob®LogMªag”
.
	`£tO±imiz”
(
NULL
);

7767 ià(
»gi¡¿tiÚO±imiz”
 !ğ
NULL
) {

7768 
d–‘e
 
»gi¡¿tiÚO±imiz”
;

7769 
»gi¡¿tiÚO±imiz”
 = 
NULL
;

7771 ià(
mašFigu»O±imiz”
 !ğ
NULL
) {

7772 
d–‘e
 
mašFigu»O±imiz”
;

7773 
mašFigu»O±imiz”
 = 
NULL
;

7776 ià(
subfigu»O±imiz”
 !ğ
NULL
) {

7777 
d–‘e
 
subfigu»O±imiz”
;

7778 
subfigu»O±imiz”
 = 
NULL
;

7780 ià(
defÜm©iÚO±imiz”
 !ğ
NULL
) {

7781 
d–‘e
 
defÜm©iÚO±imiz”
;

7782 
defÜm©iÚO±imiz”
 = 
NULL
;

7784 ià(
¥okeO±imiz”
 !ğ
NULL
) {

7785 
d–‘e
 
¥okeO±imiz”
;

7786 
¥okeO±imiz”
 = 
NULL
;

7788 ià(
vox–SgeO±imiz”
 !ğ
NULL
) {

7789 
d–‘e
 
vox–SgeO±imiz”
;

7790 
vox–SgeO±imiz”
 = 
NULL
;

7793 ià(
»cÜdedT¿nsfÜm©iÚ
)

7794 
»cÜdedT¿nsfÜm©iÚ
->
	`£tToId’t™y
();

7796 #iâdeà
BINARY


7797 
hªdPÏûm’tT¿nsfÜm
->
	`£tToId’t™y
();

7799 
cu¼’tO±imiz”Sge
 = 
NO_OPTIMIZER_STAGE
;

7800 
	}
}

7802 
boŞ
 
	gP3DCÚŒŞ
::
	$š™ŸlizeM©ch
(
M©chTy³
 
ty³
, 
surçûLev–
,

7803 * 
‹m¶©eF’ame
, cÚ¡ * 
´ofeF’ame
, 
Image3D
 * 
ŒaššgImage
)

7805 
Image3D
 * 
image
;

7807 #ifdeà
DEBUG


7808 
cout
 << "P3DControl::initializeMatch()\n";

7811 ià(
objeù
 =ğ
NULL
)

7812  
çl£
;

7814 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

7815 ià(
image
 =ğ
NULL
)

7816  
çl£
;

7818 #ifdeà
BINARY


7819 ià(
m©ch
 =ğ
NULL
) {

7820 
m©ch
 = 
Ãw
 
	`M©ch
(
Ïndm¬kObjeù
);

7827 iàĞ
m©ch
 !ğ
NULL
 ) {

7828 
M3DObjeù
* 
sÿËdObjeù
 = 
objeù
->
	`assign
() ;

7829 
m©ch
->
	`£tRefObjeùAá”SÿË
Ğ
sÿËdObjeù
 ) ;

7833 
m©ch
->
	`defšePLi¡s
(
objeù
, 
surçûLev–
);

7835 ià(
m©ch
 =ğ
NULL
)

7836 
m©ch
 = 
Ãw
 
	`M©ch
(
	`isAd­tive
());

7838 
m©ch
->
	`defšePLi¡s
(
objeù
);

7840 ià(
¥e
 !ğ
NULL
)

7841 
m©ch
->
	`£tHi¡og¿m
(
¥e
);

7842 ià(
dqf
 !ğ
NULL
)

7843 
m©ch
->
	`£tDQFM©ch
(
dqf
);

7844 ià(
mp
 !ğ
NULL
) {

7845 
mp
->
loggšgFeName
 = 
‹m¶©eF’ame
;

7846 
m©ch
->
	`£tMuÉiP©ch
(
mp
);

7850 ià(
ŒaššgImage
 !ğ
NULL
)

7851 
ŒaššgImage
->
	`š‹ns™yWšdow
(
image
->
	`g‘MšIÁ’s™yWšdow
(),

7852 
image
->
	`g‘MaxIÁ’s™yWšdow
());

7855 
objeù
->
	`šv”tCÚ¡¿šts
();

7857 #ifdeà
BINARY


7858 ià(! 
m©ch
->
	`š™Ÿlize
(
objeù
, 
image
, 
di¡_m­
, 
Œue
, 
ŒaššgImage
,

7859 
İtimizeW™hWšdowšg
, 
ty³
, 
surçûLev–
, 
‹m¶©eF’ame
, 
´ofeF’ame
))

7860  
çl£
;

7861 
di¡_m­
 = 
NULL
;

7863 ià(! 
m©ch
->
	`š™Ÿlize
(
objeù
, 
image
, 
Œue
, 
ŒaššgImage
, 
İtimizeW™hWšdowšg
,

7864 
ty³
, 
surçûLev–
, 
‹m¶©eF’ame
, 
´ofeF’ame
))

7865  
çl£
;

7868 
	`£tIn™ŸlT¿nsfÜmInM©ch
(
objeùSimT¿nsfÜm
);

7870 ià(
m©chReã»nûObjeù
)

7871 
m©ch
->
	`»£tReã»nûObjeù
(
m©chReã»nûObjeù
);

7873 ià(! 
m©ch
->
	`š™ŸlizeDi¡ªûLi¡s
(
objeù
, 
surçûLev–
))

7874  
çl£
;

7875 ià(! 
m©ch
->
	`š™ŸlizeCÚ¡¿štPoštsLi¡s
(
objeù
, 
Œue
))

7876  
çl£
;

7878  
Œue
;

7879 
	}
}

7881 #iâdeà
BINARY


7883 
	gP3DCÚŒŞ
::
	$š™ŸlizeRegi¡¿tiÚO±imiz”
()

7885 #ifdeà
DEBUG


7886 
cout
 << "P3DControl::initializeRegistrationOptimizer()\n";

7888 ià(
m©ch
 =ğ
NULL
 || 
objeù
 == NULL)

7891 ià(
»gi¡¿tiÚO±imiz”
 !ğ
NULL
)

7892 
d–‘e
 
»gi¡¿tiÚO±imiz”
;

7894 ià(
pgaSts
 && 
	`isAd­tive
()) {

7904 
»gi¡¿tiÚO±imiz”
 = 
Ãw
 
	`M3DAd­tiveRegi¡¿tiÚPGAO±imiz”
(
pgaSts
,

7905 
cu¼’tPGAO±imiz©iÚS‹p
);

7906 #ifdeà
DEBUG


7907 
cout
 << "\tM3DAd­tiveRegi¡¿tiÚPGAO±imiz”(èÿÎed" << 
’dl
;

7908 
cout
 << "\tcu¼’tPGAO±imiz©iÚS‹p: " << 
cu¼’tPGAO±imiz©iÚS‹p
 << 
’dl
;

7912 
»gi¡¿tiÚO±imiz”
 = 
Ãw
 
M3DRegi¡¿tiÚO±imiz”
;

7914 
£ËùiÚChªged
 = 
çl£
;

7916 
	`£tIn™ŸlT¿nsfÜmInM©ch
(
objeùSimT¿nsfÜm
);

7917 ià(
	`isAd­tive
())

7918 
»gi¡¿tiÚO±imiz”
->
	`£tP’®tyWeight
(
»gi¡¿tiÚP’®tyWeight
);

7919 
»gi¡¿tiÚO±imiz”
->
	`š™Ÿlize
(
m©ch
);

7922 ià(
m©chReã»nûObjeù
 !ğ
NULL
)

7923 
m©ch
->
	`»£tReã»nûObjeù
(
m©chReã»nûObjeù
);

7925 
m©ch
->
	`»£tReã»nûObjeù
(
objeù
);

7935 ià(! 
	`isAd­tive
())

7936 ià(
objeùSimT¿nsfÜm
)

7937 
objeùSimT¿nsfÜm
->
	`£tToId’t™y
();

7939 #ifdeà
OPTIMIZATION_VISUALIZER


7940 
glob®LogMªag”
.
	`£tO±imiz”
(
NULL
);

7942 
	}
}

7945 
	gP3DCÚŒŞ
::
	$doRegi¡¿tiÚI‹¿tiÚs
(
numI‹¿tiÚs
)

7947 
š™V®
;

7949 ià(
»gi¡¿tiÚO±imiz”
 =ğ
NULL
 || 
objeù
 == NULL)

7952 
š™V®
 = 
»gi¡¿tiÚO±imiz”
->
	`g‘La¡Be¡V®
();

7954 
»gi¡¿tiÚO±imiz”
->
	`³rfÜmI‹¿tiÚs
(
numI‹¿tiÚs
);

7956 ià(
»gi¡¿tiÚO±imiz”
->
	`g‘La¡Be¡V®
(è< 
š™V®
) {

7957 ià(
	`isAd­tive
()) {

7958 
	`¡¬tO³¿tiÚ
();

7960 ià(
objeù
 !ğ
NULL
)

7961 
d–‘e
 
objeù
;

7963 
objeù
 = 
»gi¡¿tiÚO±imiz”
->
	`g‘La¡Be¡Objeù
()->
	`assign
();

7965 #ifdeà
DEBUG


7966 
cout
 << "\t(Ad­tiveèP3DCÚŒŞ::doRegi¡¿tiÚI‹¿tiÚs()" << 
’dl
;

7967 
VeùÜ
 
x
 = 
»gi¡¿tiÚO±imiz”
->
	`g‘La¡Be¡X
();

7968 
vecSize
 = 
x
.
	`size
();

7969 
i
 = 0; i < 
vecSize
; i++)

7970 
cout
 << 
	`x
(
i
)*
M3DRegi¡¿tiÚProbËm
::
ENSEMBLE_PGA_SCALE_FACTOR
 << " ";

7971 
cout
<<
’dl
;

7976 
M3DObjeù
 *
§vedObjeù
;

7977 
Sim¬™yT¿nsfÜm3D
 
ŒªsfÜm©iÚ
;

7979 
§vedObjeù
 = 
»gi¡¿tiÚO±imiz”
->
	`g‘Reã»nûObjeù
();

7980 ià(
objeù
 =ğ
NULL
 || 
§vedObjeù
 == NULL)

7983 
	`¡¬tO³¿tiÚ
();

7985 (*
objeù
èğ(*
§vedObjeù
);

7987 ià(
objeùSimT¿nsfÜm
)

7988 
ŒªsfÜm©iÚ
 = *
objeùSimT¿nsfÜm
;

7989 
ŒªsfÜm©iÚ
.
	`muÉlyBy
(
»gi¡¿tiÚO±imiz”
->
	`g‘La¡Be¡T¿nsfÜm©iÚ
());

7990 #ifdeà
UNFLIPPED


7991 
objeù
->
	`­¶ySim¬™y
(
ŒªsfÜm©iÚ
, 
	`VeùÜ3D
(0.0, 1.0, 0.0));

7993 
objeù
->
	`­¶ySim¬™y
(
ŒªsfÜm©iÚ
, 
	`VeùÜ3D
(0.0, 0.0, 0.0));

7997 
objeù
->
	`£tModif›d
(
Œue
);

7998 
	`mod–N“dsSavšg
(
Œue
);

8000 
	`’dO³¿tiÚ
();

8002 
	}
}

8006 
	gP3DCÚŒŞ
::
	$g‘La¡Regi¡¿tiÚM©chV®ue
()

8008 ià(
»gi¡¿tiÚO±imiz”
 =ğ
NULL
)

8011  
»gi¡¿tiÚO±imiz”
->
	`g‘La¡Be¡V®
();

8012 
	}
}

8014 
	gP3DCÚŒŞ
::
	$g‘La¡Regi¡¿tiÚP’®tyV®ue
()

8016 ià(
»gi¡¿tiÚO±imiz”
 =ğ
NULL
)

8019  
»gi¡¿tiÚO±imiz”
->
	`g‘La¡P’®ty
();

8020 
	}
}

8022 #iâdeà
BINARY


8024 
	gP3DCÚŒŞ
::
	$£tRegi¡¿tiÚP’®tyWeight
(
w
)

8026 ià(
»gi¡¿tiÚO±imiz”
 !ğ
NULL
)

8027 
»gi¡¿tiÚO±imiz”
->
	`£tP’®tyWeight
(
w
);

8028 ià(
	`isAd­tive
())

8029 
»gi¡¿tiÚP’®tyWeight
 = 
w
;

8030 
	}
}

8034 
boŞ
 
	gP3DCÚŒŞ
::
	$»gi¡¿tiÚO±imiz”IsFšished
()

8036 ià(
»gi¡¿tiÚO±imiz”
 =ğ
NULL
)

8037  
çl£
;

8039  
»gi¡¿tiÚO±imiz”
->
	`isFšished
();

8040 
	}
}

8042 #ifdeà
BINARY


8044 
boŞ
 
	gP3DCÚŒŞ
::
	$š™ŸlizeMašFigu»O±imiz”
(
doSÿË
, cÚ¡ *
pgaF’ame
)

8046 #ifdeà
DEBUG


8047 
cout
 << "P3DControl::initializeMainFigureOptimizer()\n";

8049 ià(! 
m©ch
 || ! 
objeù
)

8050  
çl£
;

8052 ià(
mašFigu»O±imiz”
 !ğ
NULL
)

8053 
d–‘e
 
mašFigu»O±imiz”
;

8056 
boŞ
 
wªtPGA
 = (
	`tunšgWt
(
Figu»Mah®ªobisM©ch
) != 0.0);

8058 ià(
wªtPGA
 )

8061 
ınsSts
 = 
objeù
->
	`g‘CPNSSts
();

8062 ià(
pgaSts
 =ğ
NULL
 && 
ınsSts
 == NULL) {

8064 
cout
 << "IÁ”ÇÈE¼Ü: NØPGA/CPNS sti¡ics" << 
’dl
;

8065  
çl£
;

8067 ià(
ınsSts
 !ğ
NULL
)

8069 
cout
 << "Usšg CPNS Mah®ªobi Sge" << 
’dl
;

8070 
mašFigu»O±imiz”
 = 
Ãw
 
	`M3DSim¬™yCPNSO±imiz”
(
m©ch
, 
ınsSts
);

8074 
cout
 << "Usšg PGA Mah®ªobi Sge" << 
’dl
;

8075 
mašFigu»O±imiz”
 = 
Ãw
 
	`M3DSim¬™yPGAO±imiz”
(
m©ch
, 
pgaSts
);

8079 
mašFigu»O±imiz”
 =

8080 
Ãw
 
	`M3DSim¬™yElÚg©iÚO±imiz”
(
m©ch
, (
doSÿË
 ? 7 : 6));

8081 
m©ch
->
	`£tIn™ŸlT¿nsfÜm
(
objeù
->
	`g‘T¿nsfÜm©iÚ
());

8083 
£ËùiÚChªged
 = 
çl£
;

8085 
	`£tIn™ŸlT¿nsfÜmInM©ch
(
objeùSimT¿nsfÜm
);

8088 ià(! 
mašFigu»O±imiz”
->
	`š™Ÿlize
(
objeù
, 
İtimiz”T»eIndex
))

8090  
çl£
;

8097  
Œue
;

8098 
	}
}

8102 
boŞ
 
	gP3DCÚŒŞ
::
	$š™ŸlizeMašFigu»O±imiz”
(
boŞ
 
rigid
, boŞ 
u£PGA
)

8104 #ifdeà
DEBUG


8105 
cout
 << "P3DControl::initializeMainFigureOptimizer()\n";

8107 ià(
m©ch
 =ğ
NULL
 || 
objeù
 == NULL)

8108  
çl£
;

8110 ià(
mašFigu»O±imiz”
 !ğ
NULL
)

8111 
d–‘e
 
mašFigu»O±imiz”
;

8113 ià(
u£PGA
) {

8117 ià(
cu¼’tPGAO±imiz©iÚS‹p
 == 0) {

8118 ià(
pgaSts
 =ğ
NULL
) {

8120 
cout
 << "IÁ”ÇÈE¼Ü: NØPGA sti¡ics" << 
’dl
;

8121  
çl£
;

8124 
mašFigu»O±imiz”
 = 
Ãw
 
	`M3DSim¬™yPGAO±imiz”
(
m©ch
, 
pgaSts
);

8127 
pgaSts
->
	`£tHªdPÏûm’tT¿nsfÜm
(*
hªdPÏûm’tT¿nsfÜm
);

8128 
hªdPÏûm’tT¿nsfÜm
->
	`£tToId’t™y
();

8130 #ifdeà
DEBUG


8131 
cout
 << "\tM3DSim¬™yPGAO±imiz”(èÿÎed" << 
’dl
;

8134 ià(
cu¼’tPGAO±imiz©iÚS‹p
 >= 1) {

8135 ià(
pgaSts
 =ğ
NULL
) {

8137 
cout
 << "IÁ”ÇÈE¼Ü: NØPGA sti¡ics" << 
’dl
;

8138  
çl£
;

8141 
mašFigu»O±imiz”
 = 
Ãw
 
	`M3DMašFigResiduePGAO±imiz”
(
m©ch
, 
pgaSts
,

8142 
cu¼’tPGAO±imiz©iÚS‹p
);

8144 #ifdeà
DEBUG


8145 
cout
 << "\tM3DMašFigResiduePGAO±imiz”(èÿÎed" << 
’dl
;

8149 
û¼
 << " E¼Ü: unknowÀİtimiz©iÚ s‹p." << 
’dl
;

8150 #ifdeà
DEBUG


8151 
cout
 << "\tcu¼’tPGAO±imiz©iÚS‹p: " << 
cu¼’tPGAO±imiz©iÚS‹p
 << 
’dl
;

8156 
mašFigu»O±imiz”
 = 
Ãw
 
	`M3DSim¬™yElÚg©iÚO±imiz”
(
m©ch
, (
rigid
 ? 6 : 8));

8158 #ifdeà
DEBUG


8159 
cout
 << "\tM3DSim¬™yElÚg©iÚO±imiz”(èÿÎed" << 
’dl
;

8162 
£ËùiÚChªged
 = 
çl£
;

8164 
	`£tIn™ŸlT¿nsfÜmInM©ch
(
objeùSimT¿nsfÜm
);

8166 
mašFigu»O±imiz”
->
	`£tP’®tyWeightsInM©ch
((*è
³ÇÉyNames
, 
³ÇÉyWeights
,

8167 
numP’®tyWeights
);

8170 ià(
u£PGA
) {

8173 ià(
cu¼’tPGAO±imiz©iÚS‹p
 >= 1) {

8174 
M3DObjeù
 * 
»ã»nûObj
 = 
pgaSts
->
	`g‘L©e¡ObjPŒ
()->
	`assign
();

8177 ià(! 
mašFigu»O±imiz”
->
	`š™Ÿlize
(
»ã»nûObj
, 
İtimiz”T»eIndex
))

8178  
çl£
;

8181 ià(
pgaMod–FeName
 !ğ
NULL
) {

8182 
cout
 << "W¬nšg: CÚsid”šg mod– " << 
pgaMod–FeName


8183 << "Øb¨»sidumod–" << 
’dl
;

8184 
M3DObjeù
 * 
m—nResidue
 = 
pgaSts
->
	`g‘L©e¡ObjPŒ
()->
	`assign
();

8185 ià(! 
mašFigu»O±imiz”
->
	`£tAddToResidueObjeù
(
objeù
->
	`assign
()) )

8186  
çl£
;

8187 ià(! 
mašFigu»O±imiz”
->
	`š™Ÿlize
(
m—nResidue
, 
İtimiz”T»eIndex
))

8188  
çl£
;

8191 ià(! 
mašFigu»O±imiz”
->
	`š™Ÿlize
(
objeù
, 
İtimiz”T»eIndex
))

8192  
çl£
;

8199 ià(
objeù
 !ğ
NULL
)

8200 
d–‘e
 
objeù
;

8202 
objeù
 = 
mašFigu»O±imiz”
->
	`g‘La¡Be¡Objeù
()->
	`assign
();

8206 ià(! 
mašFigu»O±imiz”
->
	`š™Ÿlize
(
objeù
, 
İtimiz”T»eIndex
))

8207  
çl£
;

8213 ià(
m©chReã»nûObjeù
)

8214 
m©ch
->
	`»£tReã»nûObjeù
(
m©chReã»nûObjeù
);

8216 #ifdeà
OPTIMIZATION_VISUALIZER


8217 
glob®LogMªag”
.
	`£tO±imiz”
(
mašFigu»O±imiz”
);

8219  
Œue
;

8220 
	}
}

8225 
	gP3DCÚŒŞ
::
	$doMašFigu»I‹¿tiÚs
(
numI‹¿tiÚs
, 
boŞ
 
v”bo£
)

8227 
Œ“Index
;

8228 
figu»Id
, 
Ën
;

8229 
M3DFigu»T»eNode
 * 
Œ“RoÙ
;

8230 
š™V®
;

8232 ià(
objeù
 =ğ
NULL
)

8235 ià(
mašFigu»O±imiz”
 =ğ
NULL
)

8239 cÚ¡ * 
skFigs
 = 
	`tunšgLi¡
(
Figu»SkFigu»s
, 
Ën
);

8241 
i
 = 0; i < 
Ën
; i++)

8242 ià(
skFigs
[
i
] =ğ
İtimiz”Figu»Id
) {

8243 
cout
 << "Figu»‚umb” " << 
İtimiz”Figu»Id
;

8244 
M3DFigu»
 * 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
İtimiz”Figu»Id
);

8245 cÚ¡ * 
Çme
 = 
figu»
->
	`g‘Name
();

8246 ià(
Çme
 !ğ
NULL
)

8247 
cout
 << " (" << 
Çme
 << ')';

8248 
cout
 << " sk³d" << 
’dl
;

8249 
mašFigu»O±imiz”
->
	`skSge
();

8253 
š™V®
 = 
mašFigu»O±imiz”
->
	`g‘La¡Be¡V®
();

8255 
mašFigu»O±imiz”
->
	`³rfÜmI‹¿tiÚs
(
numI‹¿tiÚs
);

8257 
Œ“Index
 = 
mašFigu»O±imiz”
->
	`g‘T»eIndex
();

8258 
Œ“RoÙ
 = 
objeù
->
	`g‘Figu»T»eRoÙ
(
Œ“Index
);

8259 ià(
Œ“RoÙ
 =ğ
NULL
)

8262 
figu»Id
 = 
Œ“RoÙ
->
	`g‘Figu»Id
();

8264 ià(
v”bo£
) {

8265 
cout
 << "Figu»‚umb” " << 
figu»Id
;

8266 
M3DFigu»
 * 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

8267 cÚ¡ * 
Çme
 = 
figu»
->
	`g‘Name
();

8268 ià(
Çme
 !ğ
NULL
)

8269 
cout
 << " (" << 
Çme
 << ")\n";

8271 
cout
 << '\n';

8273 #ifdeà
DEBUG


8274 
cout
 << "figu»Id iÀP3DCÚŒŞ::doMašFigu»I‹¿tiÚs(èğ" << 
figu»Id
 << 
’dl
;

8284 
	`¡¬tO³¿tiÚ
();

8286 ià(
objeù
 !ğ
NULL
)

8287 
d–‘e
 
objeù
;

8289 
objeù
 = 
mašFigu»O±imiz”
->
	`g‘La¡Be¡Objeù
()->
	`assign
();

8291 #ifdeà
DEBUG


8292 
cout
 << "\tP3DCÚŒŞ::doMašFigu»I‹¿tiÚs()" << 
’dl
;

8293 
VeùÜ
 
x
 = 
mašFigu»O±imiz”
->
	`g‘La¡Be¡X
();

8294 
vecSize
 = 
x
.
	`size
();

8295 
j
 = 0; j < 
vecSize
; j++)

8296 
cout
 << 
	`x
(
j
)*
	`tunšgWt
(
Figu»PGAFaùÜ
) << '\t';

8297 
cout
 << 
’dl
;

8300 
M3DFigu»
 * 
figu»
 =

8301 
mašFigu»O±imiz”
->
	`g‘Reã»nûObjeù
()->
	`g‘Figu»PŒ
(
figu»Id
);

8303 
M3DFigu»T»eNode
 * 
figu»T»eNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

8305 
i
 = 0;

8306 
M3DFigu»T»eNode
 * 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

8307 
subFigNode
 !ğ
NULL
) {

8308 
subfigu»T¿nsfÜm
.
	`š™
(
objeù
, 
subFigNode
);

8310 
subfigu»T¿nsfÜm
.
	`upd©eSubfigu»
(
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>(
figu»
));

8311 
i
++;

8312 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

8315 
objeù
->
	`£tModif›d
(
Œue
);

8316 
	`mod–N“dsSavšg
(
Œue
);

8318 
	`’dO³¿tiÚ
();

8320 
	}
}

8322 
boŞ
 
	gP3DCÚŒŞ
::
	$mašFigu»SgeSk³d
()

8324 ià(
mašFigu»O±imiz”
 =ğ
NULL
)

8325  
Œue
;

8327  
mašFigu»O±imiz”
->
	`¡ageSk³d
();

8328 
	}
}

8330 
	gP3DCÚŒŞ
::
	$g‘La¡MašFigu»ObjeùiveFunùiÚV®ue
()

8332 ià(
mašFigu»O±imiz”
 =ğ
NULL
)

8335  
mašFigu»O±imiz”
->
	`g‘La¡Be¡V®
();

8336 
	}
}

8338 
	gP3DCÚŒŞ
::
	$g‘La¡MašFigu»Geom‘ricM©chV®ue
()

8340 ià(
mašFigu»O±imiz”
 =ğ
NULL
)

8343  
mašFigu»O±imiz”
->
	`g‘La¡P’®ty
();

8344 
	}
}

8346 #iâdeà
BINARY


8349 
	gP3DCÚŒŞ
::
	$ş—rP’®tyWeights
() {

8350 ià(
³ÇÉyWeights
 !ğ
NULL
) {

8351 
d–‘e
 [] 
³ÇÉyWeights
;

8352 
³ÇÉyWeights
 = 
NULL
;

8353 
d–‘e
 [] 
³ÇÉyNames
;

8354 
³ÇÉyNames
 = 
NULL
;

8356 
numP’®tyWeights
 = 0;

8357 
	}
}

8360 
	gP3DCÚŒŞ
::
	$£tMašFigu»P’®tyWeight
(
gpTuÃ_t
 
tunšgP¬am
, 
w
)

8362 ià(
³ÇÉyWeights
 =ğ
NULL
) {

8363 
³ÇÉyWeights
 = 
Ãw
 [
MAX_NUM_FIG_MATCH_RESULTS
];

8364 
³ÇÉyNames
 = 
Ãw
 
gpTuÃ_t
[
MAX_NUM_FIG_MATCH_RESULTS
];

8366 ià(
numP’®tyWeights
 >ğ
MAX_NUM_FIG_MATCH_RESULTS
) {

8367 
cout
 << "Error:oo many…enalty weights\n";

8370 
³ÇÉyWeights
[
numP’®tyWeights
] = 
w
;

8371 
³ÇÉyNames
[
numP’®tyWeights
++] = 
tunšgP¬am
;

8372 
	}
}

8376 
boŞ
 
	gP3DCÚŒŞ
::
	$mašFigu»O±imiz”IsFšished
()

8378 ià(
mašFigu»O±imiz”
 =ğ
NULL
)

8379  
çl£
;

8381  
mašFigu»O±imiz”
->
	`isFšished
();

8382 
	}
}

8384 #iâdeà
BINARY


8386 
	gP3DCÚŒŞ
::
	$š™ŸlizeSubfigu»O±imiz”
()

8388 ià(
m©ch
 =ğ
NULL
 || 
objeù
 == NULL)

8391 ià(
subfigu»O±imiz”
 !ğ
NULL
)

8392 
d–‘e
 
subfigu»O±imiz”
;

8394 
subfigu»O±imiz”
 = 
Ãw
 
M3DSubfigu»O±imiz”
;

8395 
£ËùiÚChªged
 = 
çl£
;

8397 
	`£tIn™ŸlT¿nsfÜmInM©ch
(
objeùSimT¿nsfÜm
);

8399 
subfigu»O±imiz”
->
	`š™Ÿlize
(
m©ch
, 
objeù
, 
İtimiz”Figu»Id
);

8401 if(
m©chReã»nûObjeù
)

8402 
m©ch
->
	`»£tReã»nûObjeù
(
m©chReã»nûObjeù
);

8404 #ifdeà
OPTIMIZATION_VISUALIZER


8405 
glob®LogMªag”
.
	`£tO±imiz”
(
NULL
);

8407 
	}
}

8410 
	gP3DCÚŒŞ
::
	$doSubfigu»I‹¿tiÚs
(
numI‹¿tiÚs
)

8412 
M3DFigu»T»eNode
 * 
Œ“Node
;

8413 
š™V®
;

8414 
VeùÜ
 
x
;

8415 
M3DObjeù
 * 
§vedObjeù
;

8416 
M3DSubfigu»T¿nsfÜm©iÚ
 
ŒªsfÜm
;

8419 ià(
objeù
 =ğ
NULL
)

8422 ià(
subfigu»O±imiz”
 =ğ
NULL
)

8425 
š™V®
 = 
subfigu»O±imiz”
->
	`g‘La¡Be¡V®
();

8427 
subfigu»O±imiz”
->
	`³rfÜmI‹¿tiÚs
(
numI‹¿tiÚs
);

8429 ià(
subfigu»O±imiz”
->
	`g‘La¡Be¡V®
(è< 
š™V®
) {

8430 
x
 = 
subfigu»O±imiz”
->
	`g‘La¡Be¡X
();

8432 #ifdeà
DEBUG


8434 
cout
 << "------------------------------------" << 
’dl
;

8435 
dex
=0; dex<
x
.
	`size
(); dex++)

8436 if(
dex
>=3 && dex<=4)

8437 
cout
 << 
	`pow
(
LOG_BASE
, 
	`x
(
dex
)) << ", ";

8439 
cout
 << 
	`x
(
dex
) << ", ";

8440 
cout
 << "\n------------------------------------" << 
’dl
;

8443 
§vedObjeù
 = 
subfigu»O±imiz”
->
	`g‘Reã»nûObjeù
();

8444 ià(
§vedObjeù
 =ğ
NULL
)

8447 
	`¡¬tO³¿tiÚ
();

8449 ià(
objeù
 !ğ
NULL
)

8450 
d–‘e
 
objeù
;

8452 
objeù
 = 
§vedObjeù
->
	`assign
();

8454 
Œ“Node
 = 
objeù
->
	`g‘Figu»T»eNode
(
İtimiz”Figu»Id
);

8455 ià(
Œ“Node
 =ğ
NULL
)

8457 
ŒªsfÜm
.
	`š™
(
objeù
, 
Œ“Node
);

8459 
ŒªsfÜm
.
	`Œª¦©e
(
M3DSubfigu»ProbËm
::
SUB_TRANSLATION_FACTOR
*
	`x
(0), \

8460 
M3DSubfigu»ProbËm
::
SUB_TRANSLATION_FACTOR
*
	`x
(1));

8461 
ŒªsfÜm
.
	`rÙ©e
(
M3DSubfigu»ProbËm
::
SUB_ROTATION_FACTOR
*
	`x
(2));

8462 
ŒªsfÜm
.
	`wid’
(
	`pow
(
LOG_BASE
, 
M3DSubfigu»ProbËm
::
SUB_WIDEN_FACTOR
*
	`x
(3)));

8463 
ŒªsfÜm
.
	`–Úg©e
(
	`pow
(
LOG_BASE
, 
M3DSubfigu»ProbËm
::
SUB_ELONGATE_FACTOR
*
	`x
(4)));

8466 
objeù
->
	`£tModif›d
(
Œue
);

8467 
	`mod–N“dsSavšg
(
Œue
);

8469 
	`’dO³¿tiÚ
();

8471 
	}
}

8473 
	gP3DCÚŒŞ
::
	$g‘La¡Subfigu»M©chV®ue
()

8475 ià(
subfigu»O±imiz”
 =ğ
NULL
)

8478  
subfigu»O±imiz”
->
	`g‘La¡Be¡V®
();

8479 
	}
}

8481 
boŞ
 
	gP3DCÚŒŞ
::
	$subfigu»O±imiz”IsFšished
()

8483 ià(
subfigu»O±imiz”
 =ğ
NULL
)

8484  
çl£
;

8486  
subfigu»O±imiz”
->
	`isFšished
();

8487 
	}
}

8495 
boŞ
 
	gP3DCÚŒŞ
::
	$š™ŸlizeDefÜm©iÚO±imiz”
(
­pID
)

8497 ià(
m©ch
 =ğ
NULL
) {

8498 
cout
 << "Error: No Match class!\n";

8499  
çl£
;

8502 
defÜm©iÚObjFunc
 = 0.0;

8503 
defÜm©iÚGeomP’®ty
 = 0.0;

8504 ià(
defÜm©iÚO±imiz”
 =ğ
NULL
)

8505 
defÜm©iÚO±imiz”
 = 
Ãw
 
	`M3DDefÜm©iÚO±imiz”
(
­pID
);

8506 
£ËùiÚChªged
 = 
çl£
;

8508 #iâdeà
BINARY


8509 ià(! 
defÜm©iÚO±imiz”
->
	`š™Ÿlize
(
m©ch
, 
objeù
)) {

8510 
cout
 << "Error: Unableo initialize deformation optimizer\n";

8511  
çl£
;

8514 
defÜm©iÚO±imiz”
->
	`£tP’®tyWeightsInM©ch
((*è
³ÇÉyNames
, 
³ÇÉyWeights
,

8515 
numP’®tyWeights
);

8519 
boŞ
 
wªtPGA
 = (
	`tunšgWt
(
AtomMah®ªobisM©ch
) != 0.0);

8520 ià(
wªtPGA
) {

8521 ià(
©omPgaSts
 =ğ
NULL
) {

8522 
cout
 << "Error:‚o‡tom PGA data‡vailable; ignoring AtomMahalanobisMatch"

8523 << 
’dl
;

8524 
wªtPGA
 = 
çl£
;

8528 ià(
wªtPGA
) {

8529 
defÜm©iÚO±imiz”
->
	`š™Ÿlize
(
m©ch
, 
objeù
);

8530 
figu»Id
 = (è
	`tunšgWt
(
BpFigu»Id
);

8531 
defÜm©iÚO±imiz”
->
	`š™ŸlizeAtomPGASge
(
©omPgaSts
,
figu»Id
);

8535 
defÜm©iÚO±imiz”
->
	`š™Ÿlize
(
m©ch
, 
objeù
);

8539 ià(
m©chReã»nûObjeù
)

8540 
m©ch
->
	`»£tReã»nûObjeù
(
m©chReã»nûObjeù
);

8542 #ifdeà
OPTIMIZATION_VISUALIZER


8543 
glob®LogMªag”
.
	`£tO±imiz”
(
NULL
);

8546  
Œue
;

8547 
	}
}

8549 
	gP3DCÚŒŞ
::
	$»£tDefÜm©iÚO±imiz”
()

8551 ià(
m©ch
 =ğ
NULL
)

8554 
defÜm©iÚObjFunc
 = 0.0;

8555 
defÜm©iÚGeomP’®ty
 = 0.0;

8556 
£ËùiÚChªged
 = 
çl£
;

8558 ià(
defÜm©iÚO±imiz”
 =ğ
NULL
)

8559 
defÜm©iÚO±imiz”
 = 
Ãw
 
M3DDefÜm©iÚO±imiz”
;

8560 
defÜm©iÚO±imiz”
->
	`»£t
(
m©ch
, 
objeù
);

8562 ià(
m©chReã»nûObjeù
)

8563 
m©ch
->
	`»£tReã»nûObjeù
(
m©chReã»nûObjeù
);

8564 
	}
}

8567 
boŞ
 
	gP3DCÚŒŞ
::
	$doDefÜm©iÚI‹¿tiÚs
(
figu»Id
, 
boŞ
 
´ev›w
, boŞ 
v”bos™y
)

8569 
Image3D
 * 
image
;

8570 
boŞ
 
»t
;

8572 ià(
objeù
 =ğ
NULL
)

8573  
çl£
;

8575 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

8576 ià(
image
 =ğ
NULL
)

8577  
çl£
;

8579 if(
defÜm©iÚO±imiz”
 =ğ
NULL
) {

8580 
cout
 << "NULL optimizer\n";

8581  
çl£
;

8583 #iâdeà
BINARY


8584 ià(
£ËùiÚChªged
) {

8590 
cout
 << "Thİtimiz” mu¡ b»£t" << 
’dl
;

8591  
çl£
;

8595 ià(
´ev›w
) {

8596  
defÜm©iÚO±imiz”
->
	`³rfÜmI‹¿tiÚs
(
figu»Id
, 
Œue
, 
çl£
);

8599 
	`¡¬tO³¿tiÚ
();

8601 
»t
 = 
defÜm©iÚO±imiz”
->
	`³rfÜmI‹¿tiÚs
(
figu»Id
, 
çl£
, 
v”bos™y
);

8602 ià(
»t
) {

8609 ià(
defÜm©iÚObjFunc
 !ğ
defÜm©iÚO±imiz”
->
	`g‘La¡Be¡V®
()

8610 || 
defÜm©iÚGeomP’®ty
 !ğ
defÜm©iÚO±imiz”
->
	`g‘La¡P’®ty
())

8611 
defÜm©iÚO±imiz”
->
	`»adyNextRun
();

8612 
defÜm©iÚObjFunc
 = 
defÜm©iÚO±imiz”
->
	`g‘La¡Be¡V®
();

8613 
defÜm©iÚGeomP’®ty
 = 
defÜm©iÚO±imiz”
->
	`g‘La¡P’®ty
();

8616 ià(
defÜm©iÚO±imiz”
->
	`g‘Cªdid©eObjeù
(è!ğ
NULL
)

8618 (*
objeù
èğ(*(
defÜm©iÚO±imiz”
->
	`g‘Cªdid©eObjeù
()));

8620 
M3DFigu»
 * 
figu»
 = 
defÜm©iÚO±imiz”
->
	`g‘Reã»nûObjeù
()->
	`g‘Figu»PŒ
(
figu»Id
);

8622 
M3DFigu»T»eNode
 * 
figu»T»eNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

8624 
i
 = 0;

8625 
M3DFigu»T»eNode
 * 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

8626 
subFigNode
 !ğ
NULL
)

8628 
subfigu»T¿nsfÜm
.
	`š™
(
objeù
, 
subFigNode
);

8630 
subfigu»T¿nsfÜm
.
	`upd©eSubfigu»
(
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>(
figu»
));

8631 
i
++;

8632 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

8636 
objeù
->
	`£tModif›d
(
Œue
);

8637 
	`mod–N“dsSavšg
(
Œue
);

8638 
	`’dO³¿tiÚ
();

8639  
»t
;

8640 
	}
}

8642 
	gP3DCÚŒŞ
::
	$g‘La¡DefÜm©iÚObjeùiveFunùiÚV®ue
(
boŞ
 
´ev›w
)

8644 ià(
defÜm©iÚO±imiz”
 =ğ
NULL
)

8647  
defÜm©iÚO±imiz”
->
	`g‘La¡Be¡V®
(
´ev›w
);

8648 
	}
}

8650 
	gP3DCÚŒŞ
::
	$g‘La¡DefÜm©iÚGeom‘ricM©chV®ue
()

8652 ià(
defÜm©iÚO±imiz”
 =ğ
NULL
)

8655  
defÜm©iÚO±imiz”
->
	`g‘La¡P’®ty
();

8656 
	}
}

8659 #iâdeà
BINARY


8663 
	gP3DCÚŒŞ
::
	$£tDefÜm©iÚP’®tyWeight
(
gpTuÃ_t
 
tunšgP¬am
, 
w
)

8665 ià(
³ÇÉyWeights
 =ğ
NULL
) {

8666 
³ÇÉyWeights
 = 
Ãw
 [
MAX_NUM_ATOM_MATCH_RESULTS
];

8667 
³ÇÉyNames
 = 
Ãw
 
gpTuÃ_t
[
MAX_NUM_ATOM_MATCH_RESULTS
];

8669 ià(
numP’®tyWeights
 >ğ
MAX_NUM_ATOM_MATCH_RESULTS
) {

8670 
cout
 << "Error:oo many…enalty weights\n";

8673 
³ÇÉyWeights
[
numP’®tyWeights
] = 
w
;

8674 
³ÇÉyNames
[
numP’®tyWeights
++] = 
tunšgP¬am
;

8675 
	}
}

8685 
boŞ
 
	gP3DCÚŒŞ
::
	$š™ŸlizeSR•O±imiz”
(
­pID
)

8687 ià(
m©ch
 =ğ
NULL
) {

8688 
cout
 << "Error: No Match class!\n";

8689  
çl£
;

8692 
sR•ObjFunc
 = 0.0;

8693 
sR•GeomP’®ty
 = 0.0;

8694 ià(
sR•O±imiz”
 =ğ
NULL
)

8695 
sR•O±imiz”
 = 
Ãw
 
	`M3DSR•O±imiz”
(
­pID
);

8696 
£ËùiÚChªged
 = 
çl£
;

8698 #iâdeà
BINARY


8699 ià(! 
sR•O±imiz”
->
	`š™Ÿlize
(
m©ch
, 
objeù
)) {

8700 
cout
 << "Error: Unableo initialize SRep optimizer\n";

8701  
çl£
;

8704 
sR•O±imiz”
->
	`£tP’®tyWeightsInM©ch
((*è
³ÇÉyNames
, 
³ÇÉyWeights
,

8705 
numP’®tyWeights
);

8709 
boŞ
 
wªtPGA
 = 
çl£
 ;

8711 
sR•O±imiz”
->
	`š™Ÿlize
(
m©ch
, 
objeù
);

8715 ià(
m©chReã»nûObjeù
)

8716 
m©ch
->
	`»£tReã»nûObjeù
(
m©chReã»nûObjeù
);

8718 #ifdeà
OPTIMIZATION_VISUALIZER


8719 
glob®LogMªag”
.
	`£tO±imiz”
(
NULL
);

8722  
Œue
;

8723 
	}
}

8725 
	gP3DCÚŒŞ
::
	$»£tSR•O±imiz”
()

8727 ià(
m©ch
 =ğ
NULL
)

8730 
sR•ObjFunc
 = 0.0;

8731 
sR•GeomP’®ty
 = 0.0;

8732 
£ËùiÚChªged
 = 
çl£
;

8734 ià(
sR•O±imiz”
 =ğ
NULL
)

8735 
sR•O±imiz”
 = 
Ãw
 
M3DSR•O±imiz”
;

8736 
sR•O±imiz”
->
	`»£t
(
m©ch
, 
objeù
);

8738 ià(
m©chReã»nûObjeù
)

8739 
m©ch
->
	`»£tReã»nûObjeù
(
m©chReã»nûObjeù
);

8740 
	}
}

8743 
boŞ
 
	gP3DCÚŒŞ
::
	$doSR•I‹¿tiÚs
(
figu»Id
, 
boŞ
 
´ev›w
, boŞ 
v”bos™y
)

8745 
Image3D
 * 
image
;

8746 
boŞ
 
»t
;

8748 ià(
objeù
 =ğ
NULL
)

8749  
çl£
;

8751 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

8752 ià(
image
 =ğ
NULL
)

8753  
çl£
;

8755 if(
sR•O±imiz”
 =ğ
NULL
) {

8756 
cout
 << "NULL optimizer\n";

8757  
çl£
;

8759 #iâdeà
BINARY


8760 ià(
£ËùiÚChªged
) {

8766 
cout
 << "Thİtimiz” mu¡ b»£t" << 
’dl
;

8767  
çl£
;

8771 ià(
´ev›w
) {

8772  
sR•O±imiz”
->
	`³rfÜmI‹¿tiÚs
(
figu»Id
, 
Œue
, 
çl£
);

8775 
	`¡¬tO³¿tiÚ
();

8777 
»t
 = 
sR•O±imiz”
->
	`³rfÜmI‹¿tiÚs
(
figu»Id
, 
çl£
, 
v”bos™y
);

8778 ià(
»t
) {

8785 ià(
sR•ObjFunc
 !ğ
sR•O±imiz”
->
	`g‘La¡Be¡V®
()

8786 || 
sR•GeomP’®ty
 !ğ
sR•O±imiz”
->
	`g‘La¡P’®ty
())

8787 
sR•O±imiz”
->
	`»adyNextRun
();

8788 
sR•ObjFunc
 = 
sR•O±imiz”
->
	`g‘La¡Be¡V®
();

8789 
sR•GeomP’®ty
 = 
sR•O±imiz”
->
	`g‘La¡P’®ty
();

8792 ià(
sR•O±imiz”
->
	`g‘Cªdid©eObjeù
(è!ğ
NULL
)

8794 (*
objeù
èğ(*(
sR•O±imiz”
->
	`g‘Cªdid©eObjeù
()));

8796 
M3DFigu»
 * 
figu»
 = 
sR•O±imiz”
->
	`g‘Reã»nûObjeù
()->
	`g‘Figu»PŒ
(
figu»Id
);

8798 
M3DFigu»T»eNode
 * 
figu»T»eNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

8800 
i
 = 0;

8801 
M3DFigu»T»eNode
 * 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

8802 
subFigNode
 !ğ
NULL
)

8804 
subfigu»T¿nsfÜm
.
	`š™
(
objeù
, 
subFigNode
);

8806 
subfigu»T¿nsfÜm
.
	`upd©eSubfigu»
(
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>(
figu»
));

8807 
i
++;

8808 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

8812 
objeù
->
	`£tModif›d
(
Œue
);

8813 
	`mod–N“dsSavšg
(
Œue
);

8814 
	`’dO³¿tiÚ
();

8815  
»t
;

8816 
	}
}

8818 
	gP3DCÚŒŞ
::
	$g‘La¡SR•ObjeùiveFunùiÚV®ue
(
boŞ
 
´ev›w
)

8820 ià(
sR•O±imiz”
 =ğ
NULL
)

8823  
sR•O±imiz”
->
	`g‘La¡Be¡V®
(
´ev›w
);

8824 
	}
}

8826 
	gP3DCÚŒŞ
::
	$g‘La¡SR•Geom‘ricM©chV®ue
()

8828 ià(
sR•O±imiz”
 =ğ
NULL
)

8831  
sR•O±imiz”
->
	`g‘La¡P’®ty
();

8832 
	}
}

8842 
boŞ
 
	gP3DCÚŒŞ
::
	$š™ŸlizeSpokeO±imiz”
(
­pID
)

8844 ià(
m©ch
 =ğ
NULL
) {

8845 
cout
 << "Error: No Match class!\n";

8846  
çl£
;

8849 
¥okeObjFunc
 = 0.0;

8850 
¥okeGeomP’®ty
 = 0.0;

8851 ifĞ
¥okeO±imiz”
 =ğ
NULL
 ) {

8852 
¥okeO±imiz”
 = 
Ãw
 
	`M3DSpokeO±imiz”
(
­pID
);

8854 
£ËùiÚChªged
 = 
çl£
;

8856 #iâdeà
BINARY


8857 ià(! 
¥okeO±imiz”
->
	`š™Ÿlize
(
m©ch
, 
objeù
)) {

8858 
cout
 << "Error: Unableo initialize spoke optimizer\n";

8859  
çl£
;

8862 
¥okeO±imiz”
->
	`£tP’®tyWeightsInM©ch
((*è
³ÇÉyNames
, 
³ÇÉyWeights
,

8863 
numP’®tyWeights
);

8867 
boŞ
 
wªtPGA
 = (
	`tunšgWt
(
SpokeMah®ªobisM©ch
) != 0.0);

8868 ià(
wªtPGA
) {

8869 ià(
¥okePgaSts
 =ğ
NULL
) {

8870 
cout
 << "Error:‚o spoke PGA data‡vailable; ignoring SpokeMahalanobisMatch"

8871 << 
’dl
;

8872 
wªtPGA
 = 
çl£
;

8894 
¥okeO±imiz”
->
	`š™Ÿlize
(
m©ch
, 
objeù
);

8898 ià(
m©chReã»nûObjeù
)

8899 
m©ch
->
	`»£tReã»nûObjeù
(
m©chReã»nûObjeù
);

8901 #ifdeà
OPTIMIZATION_VISUALIZER


8902 
glob®LogMªag”
.
	`£tO±imiz”
(
NULL
);

8905  
Œue
;

8906 
	}
}

8908 
	gP3DCÚŒŞ
::
	$»£tSpokeO±imiz”
()

8910 ià(
m©ch
 =ğ
NULL
)

8913 
¥okeObjFunc
 = 0.0;

8914 
¥okeGeomP’®ty
 = 0.0;

8915 
£ËùiÚChªged
 = 
çl£
;

8917 ià(
¥okeO±imiz”
 =ğ
NULL
)

8918 
¥okeO±imiz”
 = 
Ãw
 
M3DSpokeO±imiz”
;

8919 
¥okeO±imiz”
->
	`»£t
(
m©ch
, 
objeù
);

8921 ià(
m©chReã»nûObjeù
)

8922 
m©ch
->
	`»£tReã»nûObjeù
(
m©chReã»nûObjeù
);

8923 
	}
}

8926 
boŞ
 
	gP3DCÚŒŞ
::
	$doSpokeI‹¿tiÚs
(
figu»Id
, 
boŞ
 
´ev›w
, boŞ 
v”bos™y
)

8928 
Image3D
 * 
image
;

8929 
boŞ
 
»t
;

8931 ià(
objeù
 =ğ
NULL
)

8932  
çl£
;

8934 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

8935 ià(
image
 =ğ
NULL
)

8936  
çl£
;

8938 ifĞ
¥okeO±imiz”
 =ğ
NULL
 ) {

8939 
cout
 << "NULL optimizer\n";

8940  
çl£
;

8942 #iâdeà
BINARY


8943 ià(
£ËùiÚChªged
) {

8949 
cout
 << "Thİtimiz” mu¡ b»£t" << 
’dl
;

8950  
çl£
;

8954 ià(
´ev›w
) {

8955  
¥okeO±imiz”
->
	`³rfÜmI‹¿tiÚs
(
figu»Id
, 
Œue
, 
çl£
);

8958 
	`¡¬tO³¿tiÚ
();

8960 
»t
 = 
¥okeO±imiz”
->
	`³rfÜmI‹¿tiÚs
(
figu»Id
, 
çl£
, 
v”bos™y
);

8961 ià(
»t
) {

8968 ià(
¥okeObjFunc
 !ğ
¥okeO±imiz”
->
	`g‘La¡Be¡V®
()

8969 || 
¥okeGeomP’®ty
 !ğ
¥okeO±imiz”
->
	`g‘La¡P’®ty
())

8970 
¥okeO±imiz”
->
	`»adyNextRun
();

8971 
¥okeObjFunc
 = 
¥okeO±imiz”
->
	`g‘La¡Be¡V®
();

8972 
¥okeGeomP’®ty
 = 
¥okeO±imiz”
->
	`g‘La¡P’®ty
();

8975 ià(
¥okeO±imiz”
->
	`g‘Cªdid©eObjeù
(è!ğ
NULL
)

8977 (*
objeù
èğ(*(
¥okeO±imiz”
->
	`g‘Cªdid©eObjeù
()));

8979 
M3DFigu»
 * 
figu»
 = 
¥okeO±imiz”
->
	`g‘Reã»nûObjeù
()->
	`g‘Figu»PŒ
(
figu»Id
);

8981 
M3DFigu»T»eNode
 * 
figu»T»eNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

8983 
i
 = 0;

8984 
M3DFigu»T»eNode
 * 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

8985 
subFigNode
 !ğ
NULL
)

8987 
subfigu»T¿nsfÜm
.
	`š™
(
objeù
, 
subFigNode
);

8989 
subfigu»T¿nsfÜm
.
	`upd©eSubfigu»
(
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>(
figu»
));

8990 
i
++;

8991 
subFigNode
 = 
figu»T»eNode
->
	`g‘Chd
(
i
);

8994 
objeù
->
	`£tModif›d
(
Œue
);

8995 
	`mod–N“dsSavšg
(
Œue
);

8996 
	`’dO³¿tiÚ
();

8997  
»t
;

8998 
	}
}

9000 
	gP3DCÚŒŞ
::
	$g‘La¡SpokeObjeùiveFunùiÚV®ue
(
boŞ
 
´ev›w
)

9002 ià(
¥okeO±imiz”
 =ğ
NULL
)

9005  
¥okeO±imiz”
->
	`g‘La¡Be¡V®
(
´ev›w
);

9006 
	}
}

9008 
	gP3DCÚŒŞ
::
	$g‘La¡SpokeGeom‘ricM©chV®ue
()

9010 ià(
¥okeO±imiz”
 =ğ
NULL
)

9013  
¥okeO±imiz”
->
	`g‘La¡P’®ty
();

9014 
	}
}

9016 #iâdeà
BINARY


9020 
	gP3DCÚŒŞ
::
	$£tSpokeP’®tyWeight
(
gpTuÃ_t
 
tunšgP¬am
, 
w
)

9022 ià(
³ÇÉyWeights
 =ğ
NULL
) {

9023 
³ÇÉyWeights
 = 
Ãw
 [
MAX_NUM_ATOM_MATCH_RESULTS
];

9024 
³ÇÉyNames
 = 
Ãw
 
gpTuÃ_t
[
MAX_NUM_ATOM_MATCH_RESULTS
];

9026 ià(
numP’®tyWeights
 >ğ
MAX_NUM_ATOM_MATCH_RESULTS
) {

9027 
cout
 << "Error:oo many…enalty weights\n";

9030 
³ÇÉyWeights
[
numP’®tyWeights
] = 
w
;

9031 
³ÇÉyNames
[
numP’®tyWeights
++] = 
tunšgP¬am
;

9032 
	}
}

9041 
boŞ
 
	gP3DCÚŒŞ
::
	$š™ŸlizeVox–O±imiz”
(
surçûLev–
)

9043 #ifdeà
DEBUG


9044 
cout
 << "P3DControl::initializeVoxelOptimizer()\n";

9046 ià(
m©ch
 =ğ
NULL
 || 
objeù
 == NULL)

9047  
çl£
;

9049 ià(
vox–SgeO±imiz”
 =ğ
NULL
)

9050 
vox–SgeO±imiz”
 = 
Ãw
 
M3DVox–O±imiz”
;

9051 
£ËùiÚChªged
 = 
çl£
;

9053  
vox–SgeO±imiz”
->

9054 #ifdeà
BINARY


9055 
	`š™Ÿlize
(
m©ch
, 
objeù
, 
İtimiz”Figu»Id
, 
surçûLev–
);

9057 
	`š™Ÿlize
(
m©ch
, 
objeù
, 
İtimiz”Figu»Id
, 
surçûLev–
, 
İtimizeW™hWšdowšg
);

9060 #ifdeà
OPTIMIZATION_VISUALIZER


9061 
glob®LogMªag”
.
	`£tO±imiz”
(
NULL
);

9063 
	}
}

9066 
	gP3DCÚŒŞ
::
	$doVox–I‹¿tiÚs
(
numI‹¿tiÚs
, 
boŞ
 
´ev›w
)

9068 
Image3D
 * 
image
;

9070 ià(
objeù
 =ğ
NULL
) {

9071 
cout
 << "NULL objeù." << 
’dl
;

9075 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

9076 ià(
image
 =ğ
NULL
) {

9077 
cout
 << "NULL image." << 
’dl
;

9081 ià(
vox–SgeO±imiz”
 =ğ
NULL
) {

9082 
cout
 << "NULL o±imiz”." << 
’dl
;

9086 ià(! 
´ev›w
)

9087 
	`¡¬tO³¿tiÚ
();

9089 
vox–SgeO±imiz”
->
	`³rfÜmI‹¿tiÚs
(
numI‹¿tiÚs
);

9090 ià(
´ev›w
)

9093 ià(
vox–SgeO±imiz”
->
	`g‘T¬g‘Objeù
(è!ğ
NULL
) {

9094 (*
objeù
èğ(*(
vox–SgeO±imiz”
->
	`g‘T¬g‘Objeù
()));

9096 
objeù
->
	`£tModif›d
(
Œue
);

9097 
	`mod–N“dsSavšg
(
Œue
);

9100 
	`’dO³¿tiÚ
();

9101 
	}
}

9103 
	gP3DCÚŒŞ
::
	$£tVox–P’®tyWeight
(
w
)

9105 ià(
vox–SgeO±imiz”
 =ğ
NULL
)

9106 
vox–SgeO±imiz”
 = 
Ãw
 
M3DVox–O±imiz”
;

9108 
vox–SgeO±imiz”
->
	`£tP’®tyWeight
(
w
);

9109 
	}
}

9111 
	gP3DCÚŒŞ
::
	$£tVox–CÚ¡¿štsP’®tyWeight
(
w
)

9113 ià(
vox–SgeO±imiz”
 =ğ
NULL
)

9114 
vox–SgeO±imiz”
 = 
Ãw
 
M3DVox–O±imiz”
;

9116 
vox–SgeO±imiz”
->
	`£tCÚ¡¿štsP’®tyWeight
(
w
);

9117 
	}
}

9119 
	gP3DCÚŒŞ
::
	$g‘La¡Vox–M©chV®ue
()

9121 ià(
vox–SgeO±imiz”
 =ğ
NULL
)

9124  
vox–SgeO±imiz”
->
	`g‘La¡M©chV®ue
();

9125 
	}
}

9127 
	gP3DCÚŒŞ
::
	$g‘La¡Vox–P’®tyV®ue
()

9129 ià(
vox–SgeO±imiz”
 =ğ
NULL
)

9132  
vox–SgeO±imiz”
->
	`g‘La¡P’®ty
();

9133 
	}
}

9135 
	gP3DCÚŒŞ
::
	$g‘La¡Vox–ObjeùiveFunùiÚV®ue
()

9137 ià(
vox–SgeO±imiz”
 =ğ
NULL
)

9140  
vox–SgeO±imiz”
->
	`g‘La¡ObjeùiveFunùiÚV®ue
();

9141 
	}
}

9143 
boŞ
 
	gP3DCÚŒŞ
::
	$vox–SgeO±imiz”IsFšished
()

9145 ià(
vox–SgeO±imiz”
 =ğ
NULL
)

9146  
çl£
;

9148  
vox–SgeO±imiz”
->
	`isFšished
();

9149 
	}
}

9153 
	gP3DCÚŒŞ
::
	$£tIÁ’s™yWšdow
(
mš
, 
max
)

9155 
Image3D
 * 
image
;

9157 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

9158 if(
image
 =ğ
NULL
)

9161 
imagePÏÃs
.
	`£tIÁ’s™yWšdow
(
mš
, 
max
);

9162 
image
->
	`š‹ns™yWšdow
(
mš
, 
max
);

9163 
	}
}

9165 
	gP3DCÚŒŞ
::
	$g‘IÁ’s™yWšdow
(& 
mš
, & 
max
)

9167 
Image3D
 * 
image
;

9169 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

9170 if(
image
 =ğ
NULL
) {

9171 
mš
 = 1.0;

9172 
max
 = -1.0;

9176 
mš
 = 
image
->
	`g‘MšIÁ’s™yWšdow
();

9177 
max
 = 
image
->
	`g‘MaxIÁ’s™yWšdow
();

9178 
	}
}

9186 
boŞ
 
	gP3DCÚŒŞ
::
	$©chSubfigu»
(
·»ÁId
, 
chdId
,

9187 
M3DFigu»T»eNode
::
Subfigu»A‰achm’t_t
 
mode
)

9189 
M3DFigu»T»eNode
 * 
Œ“Node
;

9190 
M3DFigu»
 * 
·»ÁFigu»
;

9191 
M3DQuadFigu»
 * 
chdFigu»
;

9192 
M3DPrim™ive
 * 
´im™ive
;

9193 
M3DPrim™iveLškInfo
 * 
lšk
;

9194 
VeùÜ3D
 
figCoÜd
;

9195 
u
, 
v
, 
t
;

9196 
i
, 
row
, 
cŞ
;

9198 cÚ¡ 
ATTACH_MEDIAL_SUBDIVISIONS
 = 6;

9201 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

9202  
çl£
;

9204 if(
objeù
 =ğ
NULL
)

9205  
çl£
;

9208 
·»ÁFigu»
 = 
objeù
->
	`g‘Figu»PŒ
(
·»ÁId
);

9209 
chdFigu»
 = 
dyÇmic_ÿ¡
<
M3DQuadFigu»
*>(
objeù
->
	`g‘Figu»PŒ
(
chdId
));

9210 if(
·»ÁFigu»
 =ğ
NULL
 || 
chdFigu»
 == NULL)

9211  
çl£
;

9213 
İ_couÁ
 = 
	`¡¬tO³¿tiÚ
();

9215 
Œ“Node
 = 
objeù
->
	`g‘Figu»T»eNode
(
chdId
);

9216 
Œ“Node
->
	`£tA‰achm’tMode
(
mode
);

9218 
i
 = 
Œ“Node
->
	`g‘LškCouÁ
() - 1; i >= 0; i--)

9219 
Œ“Node
->
	`»moveLšk
(
i
);

9221 ià(
Œ“Node
->
	`g‘BËndAmouÁ
() == 0.0)

9222 
Œ“Node
->
	`£tBËndAmouÁ
(0.5);

9223 ià(
Œ“Node
->
	`g‘BËndEx‹Á
() == 0.0)

9224 
Œ“Node
->
	`£tBËndEx‹Á
(0.5);

9229 
row
 = 
chdFigu»
->
	`rowS–eùed
();

9230 ià(
row
 < 0) {

9232 
cŞ
 = 
chdFigu»
->
	`cŞumnS–eùed
();

9233 ià(
cŞ
 < 0) {

9235  
çl£
;

9238 ià(
cŞ
 != 0) {

9240 
chdFigu»
->
	`»v”£Rows
();

9241 
chdFigu»
->
	`»v”£CŞumns
();

9246 
j
;

9247 
M3DQuadFigu»
 * 
ÃwChdFigu»
 =

9248 
Ãw
 
	`M3DQuadFigu»
(
chdFigu»
->
	`g‘CŞumnCouÁ
(), chdFigu»->
	`g‘RowCouÁ
());

9249 
M3DQuadFigu»
 * 
ŞdChdFigu»
 = (M3DQuadFigu» *)(
chdFigu»
->
	`şÚe
());

9251 ià(
row
 == 0) {

9257 
i
=0; i<
ÃwChdFigu»
->
	`g‘RowCouÁ
(); i++)

9258 
j
=0; j<
ÃwChdFigu»
->
	`g‘CŞumnCouÁ
(); j++)

9259 
ÃwChdFigu»
->
	`£tPrim™ivePŒ
(
i
, 
j
,

9260 
ŞdChdFigu»
->
	`g‘Prim™ivePŒ
(
j
, 
chdFigu»
->
	`g‘CŞumnCouÁ
()-1-
i
));

9265 
i
=0; i<
ÃwChdFigu»
->
	`g‘RowCouÁ
(); i++)

9266 
j
=0; j<
ÃwChdFigu»
->
	`g‘CŞumnCouÁ
(); j++)

9267 
ÃwChdFigu»
->
	`£tPrim™ivePŒ
(
i
, 
j
,

9268 
ŞdChdFigu»
->
	`g‘Prim™ivePŒ
(
chdFigu»
->
	`g‘RowCouÁ
()-1-
j
, 
i
));

9271 *
chdFigu»
 = *
ÃwChdFigu»
;

9273 
d–‘e
 
ŞdChdFigu»
;

9279 
Xã¾i¡
 * 
xãrLi¡
 = 
	`cÚv”tM3DtoXãr
(
·»ÁFigu»
);

9281 
Th®lCode
::
Poši¡_£rv”2
 
pLi¡
;

9282 
pLi¡
.
	`š™
(
xãrLi¡
);

9283 
pLi¡
.
	`Compu‹SubdivBound¬yTes
(
ATTACH_MEDIAL_SUBDIVISIONS
);

9287 
lškId
 = 0,

9288 
lškNum
 = 0,

9289 
rowNum
 = 
chdFigu»
->
	`g‘RowCouÁ
(),

9290 
cŞNum
 = 
chdFigu»
->
	`g‘CŞumnCouÁ
();

9291 
VeùÜ3D
 * 
shiás
;

9292 * 
lškRows
,

9293 * 
lškCŞs
;

9294 
lškNum
 = 
chdFigu»
->
	`numb”S–eùed
();

9295 
shiás
 = 
Ãw
 
VeùÜ3D
[
lškNum
];

9296 
lškCŞs
 = 
Ãw
 [
lškNum
];

9297 
lškRows
 = 
Ãw
 [
lškNum
];

9300 
i
 = 0; i < 
chdFigu»
->
	`g‘Prim™iveCouÁ
(); i++)

9302 
Bpošt
 
B²t
;

9303 
di¡
;

9304 
boŞ
 
outside
;

9305 
VeùÜ3D
 
pos
;

9307 
´im™ive
 = 
chdFigu»
->
	`g‘Prim™ivePŒ
(
i
);

9309 ià(
´im™ive
 =ğ
NULL
)

9312 ià(
´im™ive
->
	`isS–eùed
()) {

9313 
pos
 = 
´im™ive
->
	`g‘X
();

9314 ià(! 
pLi¡
.
	`subdivN—rSurçû
(
pos
.
	`g‘X
(),…os.
	`g‘Y
(),…os.
	`g‘Z
(), &
B²t
, &
di¡
, &
outside
)) {

9315 
cout
 << "E¼Ü iÀcomputšg figu¿ÈcoÜdš©es: cªnÙ…”fÜm‡‰achm’t" << 
’dl
;

9317 
İ_couÁ
 = 
	`’dO³¿tiÚ
() - op_count;

9318 
	`»£tO³¿tiÚs
(
İ_couÁ
);

9319  
çl£
;

9321 
u
 = 
B²t
.u;

9322 
v
 = 
B²t
.v;

9323 
t
 = 
B²t
.t;

9324 
pos
 = 
	`VeùÜ3D
(
B²t
.
²t
[0], Bpnt.pnt[1], Bpnt.pnt[2]);

9326 
VeùÜ3D
 
shiá
 = 
pos
 - 
´im™ive
->
	`g‘X
();

9327 ià(
glob®V”bos™y
 >= 1) {

9328 
cout
 << "T¿n¦©šg Prim™iv" << 
i
 << "‡t ";

9329 
cout
 << "u: " << 
u
 << ", v: " << 
v
 << ",: " << 
t
 << " by \n\t";

9330 
shiá
.
	`´št
();

9332 
´im™ive
->
	`Œª¦©eBy
(
shiá
);

9333 
´im™ive
->
	`toggËHšge
(
Œue
);

9334 
lšk
 = 
Ãw
 
M3DPrim™iveLškInfo
;

9335 
lšk
->
´im™iveId
 = 
i
;

9336 
lšk
->
u
 = u;

9337 
lšk
->
v
 = v;

9338 
lšk
->
t
 =;

9339 
Œ“Node
->
	`addLšk
(
lšk
);

9341 
shiás
[
lškId
] = 
shiá
;

9342 
chdFigu»
->
	`figu¿lCoÜdš©es
(
i
, 
lškRows
[
lškId
], 
lškCŞs
[linkId]);

9343 
lškId
++;

9347 ià(
lškId
 !ğ
lškNum
) {

9349 
İ_couÁ
 = 
	`’dO³¿tiÚ
() - op_count;

9350 
	`»£tO³¿tiÚs
(
İ_couÁ
);

9351 
cout
 << "T¿n¦©iÚ disÿrded; figu»‚Ù‡‰ached" << 
’dl
;

9352 
	`b“p
();

9353  
çl£
;

9357 
i
 = 0; i < 
chdFigu»
->
	`g‘Prim™iveCouÁ
(); i++) {

9358 
´im™ive
 = 
chdFigu»
->
	`g‘Prim™ivePŒ
(
i
);

9360 ià(
´im™ive
 =ğ
NULL
)

9363 ià(
´im™ive
->
	`isS–eùed
()) {

9366 
rowDex
, 
cŞDex
;

9367 
chdFigu»
->
	`figu¿lCoÜdš©es
(
i
, 
rowDex
, 
cŞDex
);

9370 
j
;

9371 
j
=0; j<
lškNum
; j++) {

9372 ià(
rowDex
 =ğ
lškRows
[
j
])

9376 ià(
j
 >ğ
lškNum
) {

9378 
İ_couÁ
 = 
	`’dO³¿tiÚ
() - op_count;

9379 
	`»£tO³¿tiÚs
(
İ_couÁ
);

9380 
cout
 << "T¿n¦©iÚ disÿrded; figu»‚Ù‡‰ached" << 
’dl
;

9381 
	`b“p
();

9382  
çl£
;

9385 
¿tio
;

9386 ià(
lškCŞs
[
j
] == 0) {

9387 ià(
glob®V”bos™y
 >= 1) {

9388 
cout
 << "T¿n¦©šg Prim™iv" << 
i
 << " by \n\t";

9389 
shiás
[
j
].
	`´št
();

9392 
¿tio
 = 1.0 - 1.0*
cŞDex
/(
cŞNum
-1);

9393 
´im™ive
->
	`Œª¦©eBy
(
shiás
[
j
] * 
¿tio
);

9396 ià(
glob®V”bos™y
 >= 1) {

9397 
cout
 << "T¿n¦©šg Prim™iv" << 
i
 << " by \n\t";

9398 
shiás
[
j
].
	`´št
();

9401 
¿tio
 = 1.0*
cŞDex
/(
cŞNum
-1);

9402 
´im™ive
->
	`Œª¦©eBy
(
shiás
[
j
] * 
¿tio
);

9407 
d–‘e
 []
shiás
;

9408 
d–‘e
 []
lškCŞs
;

9409 
d–‘e
 []
lškRows
;

9411 ià(
objeù
->
	`©chFigu»T»eNode
(
Œ“Node
, 
·»ÁId
)) {

9412 
	`’dO³¿tiÚ
();

9413 ià(
glob®V”bos™y
 >= 0)

9414 
cout
 << "A‰ached figu» " << 
objeù
->
	`g‘Figu»Index
(
chdFigu»
) << "o figure "

9415 << 
objeù
->
	`g‘Figu»Index
(
·»ÁFigu»
è<< 
’dl
;

9417 
m¬kedPrim™iveId
 = 
INVALID_PRIMITIVE_ID
;

9418 
	`mod–N“dsSavšg
(
Œue
);

9419 
£ËùiÚChªged
 = 
Œue
;

9423 
İ_couÁ
 = 
	`’dO³¿tiÚ
() - op_count;

9424 
	`»£tO³¿tiÚs
(
İ_couÁ
);

9425 
cout
 << "T¿n¦©iÚ disÿrded; figu»‚Ù‡‰ached" << 
’dl
;

9426 
	`b“p
();

9427  
çl£
;

9429  
Œue
;

9430 
	}
}

9432 
boŞ
 
	gP3DCÚŒŞ
::
	$d‘achSubfigu»
(
figu»Id
)

9434 
M3DFigu»T»eNode
 * 
Œ“Node
;

9435 
M3DFigu»
 * 
figu»
;

9436 
boŞ
 
»t
;

9438 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

9439  
çl£
;

9441 if(
objeù
 =ğ
NULL
)

9442  
çl£
;

9444 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

9445 if(
figu»
 =ğ
NULL
)

9446  
çl£
;

9448 
	`£tEd™šgMode
(
NO_EDITING_MODE
);

9450 (è
	`¡¬tO³¿tiÚ
();

9451 
Œ“Node
 = 
objeù
->
	`d‘achFigu»T»eNode
(
figu»Id
);

9452 
	`’dO³¿tiÚ
();

9454 ià(
Œ“Node
 !ğ
NULL
) {

9455 ià(
glob®V”bos™y
 >= 0)

9456 
cout
 << "D‘ached subfigu» " << 
figu»Id
 << 
’dl
;

9457 
»t
 = 
Œue
;

9460 
cout
 << "Subfigu» could‚Ù bd‘ached" << 
’dl
;

9461 
»t
 = 
çl£
;

9464 
	`mod–N“dsSavšg
(
Œue
);

9465 
£ËùiÚChªged
 = 
Œue
;

9466 
	`£tEd™šgMode
(
ANY_EDITING_MODE
);

9467  
»t
;

9468 
	}
}

9470 
	gP3DCÚŒŞ
::
	$š™ŸlizeSubfigu»T¿nsfÜm©iÚ
()

9472 
figu»Id
,

9473 
´imId
;

9475 
M3DFigu»T»eNode
 * 
figu»T»eNode
;

9477 if(
objeù
 =ğ
NULL
)

9480 
	`g‘R–©iveM¬kedPrim™iveId
(
figu»Id
, 
´imId
);

9481 ià(
figu»Id
 < 0)

9483 
figu»T»eNode
 = 
objeù
->
	`g‘Figu»T»eNode
(
figu»Id
);

9484 if(
figu»T»eNode
 =ğ
NULL
)

9487 
subfigu»T¿nsfÜm
.
	`š™
(
objeù
, 
figu»T»eNode
);

9488 
	}
}

9490 
	gP3DCÚŒŞ
::
	$Œª¦©eSubfigu»
(
u
, 
v
)

9492 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

9495 
subfigu»T¿nsfÜm
.
	`Œª¦©e
(
u
, 
v
);

9497 
	`mod–N“dsSavšg
(
Œue
);

9498 
£ËùiÚChªged
 = 
Œue
;

9499 
	}
}

9501 
	gP3DCÚŒŞ
::
	$rÙ©eSubfigu»
(
ªgË
)

9503 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

9506 
subfigu»T¿nsfÜm
.
	`rÙ©e
(
ªgË
);

9508 
	`mod–N“dsSavšg
(
Œue
);

9509 
£ËùiÚChªged
 = 
Œue
;

9510 
	}
}

9512 
	gP3DCÚŒŞ
::
	$sÿËSubfigu»
(
sÿË
)

9514 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

9517 
subfigu»T¿nsfÜm
.
	`wid’
(
sÿË
);

9519 
	`mod–N“dsSavšg
(
Œue
);

9520 
£ËùiÚChªged
 = 
Œue
;

9521 
	}
}

9523 
	gP3DCÚŒŞ
::
	$–Úg©eSubfigu»
(
–Úg©iÚ
)

9525 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

9528 
subfigu»T¿nsfÜm
.
	`–Úg©e
(
–Úg©iÚ
);

9530 
	`mod–N“dsSavšg
(
Œue
);

9531 
£ËùiÚChªged
 = 
Œue
;

9532 
	}
}

9534 
	gP3DCÚŒŞ
::
	$hšgeSubfigu»
(
ªgË
)

9536 if(
ed™šgMode
 !ğ
ANY_EDITING_MODE
)

9539 
subfigu»T¿nsfÜm
.
	`hšge
(
ªgË
);

9541 
	`mod–N“dsSavšg
(
Œue
);

9542 
£ËùiÚChªged
 = 
Œue
;

9543 
	}
}

9545 
boŞ
 
	gP3DCÚŒŞ
::
	$haveMod–
()

9547 ià(
objeù
 =ğ
NULL
)

9548  
çl£
;

9550  
Œue
;

9551 
	}
}

9553 
boŞ
 
	gP3DCÚŒŞ
::
	$haveImage
()

9555 
Image3D
 * 
image
;

9557 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

9558 ià(
image
 =ğ
NULL
)

9559  
çl£
;

9561  
Œue
;

9562 
	}
}

9564 
	gP3DCÚŒŞ
::
	$gaussBlur
()

9566 
Image3D
 * 
image
;

9567 
ImageRe§m¶e3D
 
»§m¶”
;

9568 
GaussŸnBlur3D
 
gBlur
;

9570 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

9572 ià(
image
 =ğ
NULL
)

9575 
gBlur
.
	`blur
(*
image
, 1.0, 7);

9577 
blu¼ed
 = 
Œue
;

9578 
imagePÏÃsChªged
 = 
Œue
;

9579 
	}
}

9582 
	gP3DCÚŒŞ
::
	$ÿlcMaxEx‹Á
(cÚ¡ * 
imageFe
)

9584 ià(! 
	`lßdImage
(
imageFe
, 
çl£
, f®£, 
Œue
))

9587 
Image3D
 * 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

9588 ià(! 
image
)

9591  
image
->
	`maxEx‹Á
();

9592 
	}
}

9594 #ifdeà
BINARY


9597 
	gP3DCÚŒŞ
::
	$»§m¶eImageUn™Cubic
(
maxEx‹Á
)

9599 
Image3D
 *
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

9600 ià(! 
image
)

9604 
ImageRe§m¶e3D
 
»§m¶”
;

9605 
»§m¶”
.
	`isÙrİicSam¶e
(*
image
, 
	`tunšgWt
(
BpVox–S·cšg
));

9610 
»§m¶”
.
	`cubeSam¶e
(*
image
, 
maxEx‹Á
);

9611 
imagePÏÃsChªged
 = 
Œue
;

9612 
	}
}

9615 
	gP3DCÚŒŞ
::
	$»§m¶eImage
()

9617 
Image3D
 *
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

9618 ià(! 
image
)

9622 
ImageRe§m¶e3D
 
»§m¶”
;

9623 
»§m¶”
.
	`isÙrİicSam¶e
(*
image
, 
	`tunšgWt
(
BpVox–S·cšg
));

9625 
imagePÏÃsChªged
 = 
Œue
;

9626 
	}
}

9629 
boŞ
 
	gP3DCÚŒŞ
::
	$di¡M­
(cÚ¡ *
f’ame
)

9631 
Image3D
 * 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

9632 if(
image
 =ğ
NULL
)

9633  
çl£
;

9635 
ImageDi¡ªûM­
 * 
bš¬yDi¡ªûM­
;

9637 #ià
NEW_DM_CODE


9639 
Image3D
 * 
‹mpImage
 = 
Ãw
 Image3D;

9640 
VeùÜ3D
 
Üigš
 = 
image
->
	`g‘WÜldOrigš
();

9641 
G»yV®ue
 * 
vox–s
 = 
Ãw
 G»yV®ue[
image
->
	`g‘Vox–CouÁ
()];

9642 
	`memıy
(
vox–s
, 
image
->
	`g‘Vox–s
(), image->
	`g‘Vox–CouÁ
()*(
G»yV®ue
));

9643 
‹mpImage
->
	`£tVox–s
(
vox–s
, 
image
->
	`g‘XDim
(), image->
	`g‘YDim
(), image->
	`g‘ZDim
());

9644 
‹mpImage
->
	`£tS·cšgAndOrigš
(
image
->
	`g‘XS·cšg
(), image->
	`g‘YS·cšg
(),

9645 
image
->
	`g‘ZS·cšg
(), &
Üigš
);

9646 
‹mpImage
->
	`pushImageIsScked
(
image
->
	`g‘IsImageScked
(), image->
	`g‘SckedMask
());

9649 
bš¬yDi¡ªûM­
 = 
Ãw
 
	`ImageDi¡ªûM­
(
‹mpImage
);

9653 
bš¬yDi¡ªûM­
 = 
Ãw
 
	`ImageDi¡ªûM­
(
image
);

9655 (è
bš¬yDi¡ªûM­
->
	`ü—‹M­
();

9656 cÚ¡ * 
m­_size
 = 
bš¬yDi¡ªûM­
->
	`g‘M­Size
();

9657 cÚ¡ * 
m­_¥acšg
 = 
bš¬yDi¡ªûM­
->
	`g‘M­S·cšg
();

9658 ià(
m­_size
[0] <= 0) {

9659 
cout
 << "E¼Ü: Imagdi¡ªû m­_sizoà0!" << 
’dl
;

9660  
çl£
;

9662 ià(
bš¬yDi¡ªûM­
->
	`¡©us
(è=ğ
çl£
) {

9663 
cout
 << "E¼Ü: NØimagdi¡ªû m­!" << 
’dl
;

9664  
çl£
;

9666 #ià
NEW_DM_CODE


9667 
d–‘e
 
‹mpImage
;

9671 
	`£tDi¡M­PŒ
(
bš¬yDi¡ªûM­
);

9673 
Image3D
 * 
im
 = 
bš¬yDi¡ªûM­
->
İ”©Ü
 Image3D *();

9679 ià(
f’ame
 && *filename) {

9680 
G»yV®ue
 
maxg
, 
mšg
;

9683 
	`ÿlc_š‹ns™y_¿nge
(*
im
, 
maxg
, 
mšg
);

9685 ià(
glob®V”bos™y
 > -1)

9686 
cout
 << "Savšg di¡ªû m­ " << 
f’ame


9687 << " w™h„ªg" << 
mšg
 << " .. " << 
maxg
 << 
’dl
;

9688 
	`§veImage
(
f’ame
, 
im
, 
mšg
, 
maxg
);

9692 
d–‘e
 
im
;

9695  
Œue
;

9696 
	}
}

9701 
	gP3DCÚŒŞ
::
	$ouutHi¡og¿m
(cÚ¡ * 
f’ame
)

9703 
Image3D
 * 
image
;

9704 
FILE
 * 
å
;

9705 
G»yV®ue
 * 
d©aPŒ
;

9706 
size
;

9707 * 
hi¡og¿m
;

9708 
i
;

9710 
image
 = 
imagePÏÃs
.
	`g‘ImagePŒ
();

9712 if(
image
 =ğ
NULL
)

9715 
å
 = 
	`fİ’
(
f’ame
, "wb");

9716 if(
å
 =ğ
NULL
)

9719 
d©aPŒ
 = 
image
->
	`g‘Vox–s
();

9720 
size
 = 
image
->
	`g‘XDim
(è* image->
	`g‘YDim
(è* image->
	`g‘ZDim
();

9722 
hi¡og¿m
 = 
Ãw
 [
MAX_GREY_VALUE
 - 
MIN_GREY_VALUE
 + 1];

9723 if(
hi¡og¿m
 =ğ
NULL
)

9726 
	`mem£t
(
hi¡og¿m
, 0, (è* (
MAX_GREY_VALUE
 - 
MIN_GREY_VALUE
 + 1));

9727 
i
 = 0; i < 
size
; i++)

9729 
hi¡og¿m
[*
d©aPŒ
]++;

9730 
d©aPŒ
++;

9733 
i
 = 
MIN_GREY_VALUE
; i <ğ
MAX_GREY_VALUE
; i++)

9734 
	`årštf
(
å
, "%f\t%d\n", ()
i
/()(
MAX_GREY_VALUE
 - 
MIN_GREY_VALUE
), 
hi¡og¿m
[i]);

9736 
	`fşo£
(
å
);

9737 ià(
glob®V”bos™y
 >= 0)

9738 
cout
 << "WrÙhi¡Üg¿mØf" << 
f’ame
 << 
’dl
;

9739 
d–‘e
 [] 
hi¡og¿m
;

9740 
	}
}

9742 
	gP3DCÚŒŞ
::
	$»cÜdT¿nsfÜm©iÚ
()

9744 if(
objeù
 =ğ
NULL
 || 
»cÜdšgT¿nsfÜm©iÚ
)

9747 
»cÜdšgT¿nsfÜm©iÚ
 = 
Œue
;

9749 if(
»ã»nûObjeù
 =ğ
NULL
)

9750 
»ã»nûObjeù
 = 
Ãw
 
	`M3DObjeù
();

9752 
objeù
->
	`£Ëù
();

9753 (*
»ã»nûObjeù
èğ(*
objeù
);

9754 
	`®lowS–eùiÚ
(
çl£
);

9755 
	`£tEd™šgMode
(
SIMILARITY_ONLY_EDITING_MODE
);

9757 ià(
»cÜdedT¿nsfÜm©iÚ
 =ğ
NULL
)

9758 
»cÜdedT¿nsfÜm©iÚ
 = 
Ãw
 
Sim¬™yT¿nsfÜm3D
;

9760 #ifdeà
AE2_BUILD


9764 
»cÜdedT¿nsfÜm©iÚ
->
	`£tToId’t™y
();

9766 
	}
}

9768 
	gP3DCÚŒŞ
::
	$¡İRecÜdšgT¿nsfÜm©iÚ
()

9770 if(
objeù
 =ğ
NULL
 || 
»ã»nûObjeù
 == NULL ||

9771 !
»cÜdšgT¿nsfÜm©iÚ
)

9774 
»cÜdšgT¿nsfÜm©iÚ
 = 
çl£
;

9775 
	`®lowS–eùiÚ
(
Œue
);

9776 
	`£tEd™šgMode
(
ANY_EDITING_MODE
);

9778 
d–‘e
 
objeùSimT¿nsfÜm
;

9779 
objeùSimT¿nsfÜm
 = 
Ãw
 
	`Sim¬™yT¿nsfÜm3D
(*
»cÜdedT¿nsfÜm©iÚ
);

9780 
	}
}

9782 
	gP3DCÚŒŞ
::
	$­¶yRecÜdedT¿nsfÜm©iÚ
()

9784 if(
objeù
 =ğ
NULL
)

9787 ià(
»cÜdedT¿nsfÜm©iÚ
 =ğ
NULL
)

9788 
»cÜdedT¿nsfÜm©iÚ
 = 
Ãw
 
Sim¬™yT¿nsfÜm3D
;

9789 ià(
objeùSimT¿nsfÜm
)

9790 *
»cÜdedT¿nsfÜm©iÚ
 = *
objeùSimT¿nsfÜm
;

9792 #ifdeà
UNFLIPPED


9793 
objeù
->
	`­¶ySim¬™y
(*
»cÜdedT¿nsfÜm©iÚ
, 
	`VeùÜ3D
(0.0, 1.0, 0.0));

9795 
objeù
->
	`­¶ySim¬™y
(*
»cÜdedT¿nsfÜm©iÚ
, 
	`VeùÜ3D
(0.0, 0.0, 0.0));

9797 
	`mod–N“dsSavšg
(
Œue
);

9798 
£ËùiÚChªged
 = 
Œue
;

9799 
	}
}

9801 
	gP3DCÚŒŞ
::
	$»£tT¿nsfÜm©iÚ
()

9803 if(
»ã»nûObjeù
 =ğ
NULL
)

9806 (*
objeù
èğ(*
»ã»nûObjeù
);

9808 
	`mod–N“dsSavšg
(
Œue
);

9809 
	}
}

9813 
boŞ
 
	gP3DCÚŒŞ
::
	$haveCPNS
() {

9814 ifĞ
ınsSts
 !ğ
NULL
 )

9815 Ğ
Œue
 ) ;

9817 Ğ
çl£
 ) ;

9819 
	}
}

9821 
boŞ
 
	gP3DCÚŒŞ
::
ınsDefÜm
(
¡d
::
veùÜ
<> & 
v®s
)

9824 
nEig’modes
 = 
ınsSts
->
g‘NEig’Modes
() ;

9826 * 
	gscÜes
 = 
Ãw
 [ 
ınsSts
->
g‘NEig’Modes
() ] ;

9828  
	gi
 = 0 ; i < 
	gınsSts
->
g‘NEig’Modes
() ; i++ )

9829 
	gscÜes
[
i
] = 0.0 ;

9831  
	gi
 = 0 ; i < 
	gv®s
.
size
() ; i++ )

9832 
	gscÜes
[
i
] = 
v®s
[i] ;

9834 
M3DObjeù
 * 
	gÃwObjeù
 = 
ınsSts
->
eig’modeDefÜmM—n
Ğ
scÜes
, 
objeù
, 
nEig’modes
 ) ;

9836 iàĞ
	gÃwObjeù
 =ğ
NULL
 )

9837  
çl£
;

9839 ià(
	gobjeù
)

9840 
d–‘e
 
	gobjeù
;

9843 
	gobjeù
 = 
ÃwObjeù
->
assign
();

9847 
d–‘e
 
	gÃwObjeù
 ;

9848 
	gd–‘e
 [] 
	gscÜes
 ;

9850  
	gŒue
 ;

9855 
	gP3DCÚŒŞ
::
	$»£tCPNSSge
() {

9857 ià(
objeù
) {

9858 
objeù
->
	`»¡Üe
();

9859 
	`mod–IsSaved
();

9861 
	}
}

9868 #iâdeà
BINARY


9869 
	gP3DCÚŒŞ
::
	$ş—rPGA
()

9871 
pgaSts
->
	`ş—r
();

9872 
	}
}

9875 
boŞ
 
	gP3DCÚŒŞ
::
	$havePGA
()

9877  (
	`haveFigu»PGA
(è|| 
	`havePrim™ivePGA
());

9879 
	}
}

9881 
boŞ
 
	gP3DCÚŒŞ
::
	$haveFigu»PGA
()

9883 ià(
pgaSts
 =ğ
NULL
 )

9884  
çl£
;

9886 ià(
pgaSts
 !ğ
NULL
){

9887 ià(
pgaSts
->
	`g‘NumOfPGS‘s
() > 0 )

9888  
Œue
;

9891  
çl£
;

9892 
	}
}

9895 
boŞ
 
	gP3DCÚŒŞ
::
	$havePrim™ivePGA
()

9897 ià(
©omPgaSts
 =ğ
NULL
)

9898  
çl£
;

9900 ià(
©omPgaSts
->
	`g‘PGD©aPŒ
(0,0)->
numPGs
 > 0)

9901  
Œue
;

9903  
çl£
;

9904 
	}
}

9906 
	gP3DCÚŒŞ
::
	$»£tResiduePGASge
()

9908 #ifdeà
DEBUG


9909 
cout
 << "P3DControl::resetResiduePGAStage()\n";

9911 
»siduePGASge
 = 0;

9912 ià(
pgaSts
 !ğ
NULL
)

9913 
pgaSts
->
	`»£tObjsToM—n
();

9914 ià(
objeù
) {

9915 
objeù
->
	`»¡Üe
();

9916 
	`mod–IsSaved
();

9918 
	}
}

9920 
	gP3DCÚŒŞ
::
	$g‘ResiduePGASge
()

9922  
»siduePGASge
;

9923 
	}
}

9925 
	gP3DCÚŒŞ
::
	$£tResiduePGASge
(
d•th
)

9927 #ifdeà
BINARY


9928 
cout
 << "E¼Ü: P3DCÚŒŞ::£tResiduePGASgÿÎed" << 
’dl
;

9930 #ifdeà
DEBUG


9931 
cout
 << "P3DCÚŒŞ::£tResiduePGASge(" << 
d•th
 << ")\n";

9933 ià(
d•th
 >ğ
pgaSts
->
	`g‘NumOfPGS‘s
() || depth < 0) {

9934 ià(
objeù
) {

9935 
objeù
->
	`»¡Üe
();

9936 
	`mod–IsSaved
();

9938 
	`»£tResiduePGASge
();

9941 
»siduePGASge
 = 
d•th
;

9943 
	}
}

9945 * 
	gP3DCÚŒŞ
::
	$g‘ResiduePGASgeName
()

9947 
PGS‘
 * 
pgS‘
 = 
pgaSts
->
	`g‘PGS‘PŒ
(
»siduePGASge
);

9950 ià(
pgS‘
->
Çme
 =ğ
NULL
)

9952 
pgS‘
->
Çme
 = 
Ãw
 [50];

9953 
	`¡rıy
(
pgS‘
->
Çme
, "Level : ");

9954 
buf
[10];

9955 
	`¥rštf
(
buf
, "%d", 
»siduePGASge
 + 1);

9956 
	`¡rÿt
(
pgS‘
->
Çme
, 
buf
);

9958  
pgS‘
->
Çme
;

9959 
	}
}

9961 
boŞ
 
	gP3DCÚŒŞ
::
	$­¶yM—nResidue
()

9963 ià(
objeù
)

9964 
d–‘e
 
objeù
;

9965 ià(
pgaSts
 !ğ
NULL
){

9966 
objeù
 = 
pgaSts
->
	`g‘L©e¡ObjPŒ
()->
	`assign
();

9968 #ifdeà
DEBUG


9969 
cout
 << "­¶yM—nResidu:„esiudePGASg" << 
»siduePGASge
 << 
’dl
;

9972 
boŞ
 
»tV®
 = 
pgaSts
->
	`­¶yM—nResidue
(
objeù
, 
»siduePGASge
);

9973 ià(! 
»tV®
) {

9974 
cout
 << "check :…gaSts.­¶yM—nResidue()" << 
’dl
;

9976  
»tV®
;

9978 ià(
©omPgaSts
 !ğ
NULL
){

9979 
objeù
 = 
©omPgaSts
->
	`g‘AlignReã»nûObj
()->
	`assign
();

9980 
	`mod–N“dsSavšg
(
Œue
);

9981  
Œue
;

9984 
	`mod–N“dsSavšg
(
Œue
);

9986  
çl£
;

9987 
	}
}

9989 #iâdeà
BINARY


9990 
	gP3DCÚŒŞ
::
	$š™PGA
()

9992 ià(
objeù
 =ğ
NULL
)

9995 ià(
pgaSts
 !ğ
NULL
) {

9998 
pgaSts
->
	`£tHªdPÏûm’tT¿nsfÜm
(*
hªdPÏûm’tT¿nsfÜm
);

10000 #ifdeà
DEBUG


10001 
cout
 << "\nHandPlacement in P3DControl::initPGA()\n";

10002 
hªdPÏûm’tT¿nsfÜm
->
	`g‘T¿n¦©iÚ
().
	`´št
();

10003 
hªdPÏûm’tT¿nsfÜm
->
	`g‘RÙ©iÚ
().
	`´št
();

10004 
cout
 << "sÿË " << 
hªdPÏûm’tT¿nsfÜm
->
	`g‘SÿË
(è<< 
’dl
;

10008 
	}
}

10011 
boŞ
 
	gP3DCÚŒŞ
::
	$»adPGAFe
(cÚ¡ * 
f’ame
)

10013 
M3DObjeùFe
 
objeùFe
;

10014 
M3DObjeù
 * 
PGA_objeù
;

10016 ià(
f’ame
 =ğ
NULL
)

10017  
çl£
;

10019 
PGA_objeù
 = 
objeùFe
.
	`»ad
(
f’ame
);

10020 ià(
PGA_objeù
 =ğ
NULL
)

10021  
çl£
;

10023 
M3DPGASts
 * 
ps
 = 
PGA_objeù
->
	`g‘PGASts
();

10024 ià(
ps
 =ğ
NULL
)

10025  
çl£
;

10026 
pgaSts
 = 
Ãw
 
	`M3DPGASts
(*
ps
);

10028 
d–‘e
 
PGA_objeù
;

10030 
objeù
->
	`£tPGASts
(
pgaSts
);

10031 ià(
pgaSts
 !ğ
NULL
) {

10032 
objeù
->
	`»¡Üe
();

10033 
pgaSts
->
	`£tM—nObj
(
objeù
->
	`lßdedObjeù
());

10034 
pgaSts
->
	`»£tObjsToM—n
();

10037 ià(
	`isAd­tive
())

10038 
pgaSts
->
	`cÚv”tM—nDiff
();

10040 
pgaSts
->
	`»sÿË
();

10042 
	`mod–IsSaved
();

10045  
Œue
;

10046 
	}
}

10056 
boŞ
 
	gP3DCÚŒŞ
::
pgaDefÜm
(
¡d
::
veùÜ
<> & 
v®s
)

10058 
boŞ
 
»tV®
;

10060 #ifdeà
BINARY


10062 ià(
	g©omPgaSts
 !ğ
NULL
) {

10063 
»tV®
 = 
pgaDefÜmAtom
(
v®s
);

10064  
	g»tV®
;

10067 
	gcout
<<"nØ©om PGA!"<<
	g’dl
;

10072 ià(
	gobjeù
)

10073 
d–‘e
 
	gobjeù
;

10076 
M3DObjeù
 * 
	gš‹rmedObjeù
 = 
pgaSts
->
g‘IÁ”medObjPŒ
();

10077 ià(
	gš‹rmedObjeù
 =ğ
NULL
)

10078  
çl£
;

10079 
	gobjeù
 = 
š‹rmedObjeù
->
assign
();

10081 
	g»tV®
 = 
pgaSts
->
doPGADefÜm
(
objeù
, 
v®s
, 
»siduePGASge
, 
Œue
);

10082 ià(! 
	g»tV®
)

10083  
	g»tV®
;

10085 
mod–N“dsSavšg
(
Œue
);

10087  
	g»tV®
;

10091 
boŞ
 
	gP3DCÚŒŞ
::
pgaDefÜmAtom
(
¡d
::
veùÜ
<> & 
v®s
)

10093 
i
, 
	gj
, 
	gfigId
,
	g©omId
;

10094 
M3DPrim™ive
 * 
	g£ËùAtom
;

10095 
	g©omId
 = 0;

10096 
	gnumPrim™ives
;

10098 
M3DObjeù
 * 
	gš‹rmedObjeù
 = 
©omPgaSts
->
g‘AlignReã»nûObj
();

10100 ià(
	gš‹rmedObjeù
 =ğ
NULL
)

10101  
çl£
;

10104 
	gnumFigs
 = 
objeù
 ->
g‘Figu»CouÁ
();

10105 
	gj
 = 0;j < 
	gnumFigs
; j++ ){

10107 
	gnumPrim™ives
 = 
objeù
->
g‘Figu»PŒ
(
j
)->
g‘Prim™iveCouÁ
();

10109 
	gi
 = 0; i < 
	gnumPrim™ives
; i++) {

10111 
	g£ËùAtom
 = 
objeù
->
g‘Figu»PŒ
(
j
)->
g‘Prim™ivePŒ
(
i
);

10113 ià(
	g£ËùAtom
->
isS–eùed
()) {

10114 
	g©omId
 = 
i
;

10115 
	gfigId
 = 
j
;

10116 
	gi
 = 
numPrim™ives
;

10117 
	gj
 = 
numFigs
;

10123 
	gobjeù
 = 
š‹rmedObjeù
->
assign
();

10124 
M3DDefÜm©iÚO±imiz”
 * 
	gdefÜmOp
 = 
Ãw
 M3DDeformationOptimizer;

10125 
	gdefÜmOp
->
š™ŸlizeAtomPGASge
Ğ
©omPgaSts
, 
figId
, 
objeù
);

10127 
VeùÜ
 
	g‹mpV®
;

10128 
	g‹mpV®
.
£tSize
(
v®s
.
size
());

10130 
	gi
 = 0; i < 
	gv®s
.
size
(); i++){

10131 
‹mpV®
(
i
èğ
v®s
[i];

10136 
M3DFigu»
 * 
	gcu¼FigPŒ
 = 
objeù
->
g‘Figu»PŒ
(
figId
);

10137 
M3DPrim™ive
 * 
	g»adyToDefÜmAtom
 = (
©omPgaSts
->
g‘D–M—nPrim™ivePŒ
(
figId
,
©omId
))->
cİyPŒ
();

10139 
M3DPrim™ive
 * 
	gÃwPrim
 = 
»adyToDefÜmAtom
->
cİyPŒ
();

10140 
	g©omPgaSts
->
doPGADefÜm
(
ÃwPrim
, 
‹mpV®
, 
figId
, 
©omId
, 
»adyToDefÜmAtom
);

10142 
M3DFigu»
 * 
	g®ignReã»nûFigu»PŒ
 = 
š‹rmedObjeù
->
g‘Figu»PŒ
(
figId
);

10143 
	gdefÜmOp
->
addDiffToPrim™ive
(
cu¼FigPŒ
,
©omId
, 
®ignReã»nûFigu»PŒ
,
»adyToDefÜmAtom
);

10150 
d–‘e
 
	gÃwPrim
;

10152 
	gobjeù
->
de£Ëù
();

10153 
	gobjeù
->
g‘Figu»PŒ
(
figId
)->
g‘Prim™ivePŒ
(
©omId
)->
£Ëù
();

10156 
mod–N“dsSavšg
(
Œue
);

10158  
	gŒue
;

10167 #iâdeà
BINARY


10169 #ifdeà
PCA_VISUALIZER


10171 
boŞ
 
	gP3DCÚŒŞ
::
	$š™PCA_DefÜm
()

10173 ià(
auxTeS‘
 =ğ
NULL
)

10174  
çl£
;

10175 ià(
pÿ
 =ğ
NULL
)

10176  
çl£
;

10177 ià(
pÿ
->
	`¡©us
(è=ğ
çl£
)

10178  
çl£
;

10180 
pÿ
->
	`£tM—nPCA
((
BYU
 *è
auxTeS‘
);

10181  
Œue
;

10182 
	}
}

10184 
boŞ
 
	gP3DCÚŒŞ
::
pÿDefÜm
(
¡d
::
veùÜ
<> & 
v®s
)

10186 ià(
auxTeS‘
 =ğ
NULL
) {

10187 
cout
 << "Mean PCA file is‚ot†oaded\n";

10188  
	gçl£
;

10191 ià(
	gpÿ
 =ğ
NULL
) {

10192 
cout
 << "PCA„esidue file is‚ot†oaded\n";

10193  
	gçl£
;

10196 ià(! 
	gpÿ
->
pÿDefÜm
((
BYU
*è
auxTeS‘
, 
v®s
)) {

10197 
	gcout
 << "PCA deformation failed\n";

10198  
	gçl£
;

10201  
	gŒue
;

10204 
boŞ
 
	gP3DCÚŒŞ
::
	$lßdPCA_Fe
(cÚ¡ * 
f’ame
)

10206 ià(
pÿ
 !ğ
NULL
)

10207 
d–‘e
 
pÿ
;

10208 
pÿ
 = 
Ãw
 
PCA
;

10210 ià(
pÿ
->
	`»adPCAfe
(
f’ame
))

10211  
Œue
;

10213  
çl£
;

10214 
	}
}

10225 
	gP3DCÚŒŞ
::
	$¡¬tMod–TeSlideShow
()

10227 
¦ideShowSavedObjeù
 = 
objeù
;

10228 
objeù
 = 
NULL
;

10230 
¦ideShowSavedTeS‘
 = 
teS‘
;

10231 
teS‘
 = 
NULL
;

10233 
¦ideShowSavedEd™šgMode
 = 
ed™šgMode
;

10237 
šSlideShow
 = 
Œue
;

10238 
	}
}

10240 
	gP3DCÚŒŞ
::
	$addMod–SlideShow
(cÚ¡ * 
f’ame
)

10242 
M3DObjeùFe
 
objFe
;

10244 
mod–SlideShow
.
	`push_back
(
objFe
.
	`»ad
(
f’ame
));

10245 
	}
}

10247 
	gP3DCÚŒŞ
::
	$»moveMod–SlideShow
(
mod–Numb”
)

10249 if(
mod–Numb”
 >ğ0 && mod–Numb” < 
mod–SlideShow
.
	`size
())

10250 
mod–SlideShow
.
	`”a£
(mod–SlideShow.
	`begš
(è+ 
mod–Numb”
);

10251 
	}
}

10253 
	gP3DCÚŒŞ
::
	$moveUpMod–SlideShow
(
mod–Numb”
)

10255 
M3DObjeù
 * 
‹mpObj
;

10257 if(
mod–Numb”
 > 0 && mod–Numb” < 
mod–SlideShow
.
	`size
())

10259 
‹mpObj
 = 
mod–SlideShow
[
mod–Numb”
];

10260 
mod–SlideShow
[
mod–Numb”
] = modelSlideShow[modelNumber - 1];

10261 
mod–SlideShow
[
mod–Numb”
 - 1] = 
‹mpObj
;

10263 
	}
}

10265 
	gP3DCÚŒŞ
::
	$moveDownMod–SlideShow
(
mod–Numb”
)

10267 
M3DObjeù
 * 
‹mpObj
;

10269 if(
mod–Numb”
 >ğ0 && mod–Numb” < 
mod–SlideShow
.
	`size
() - 1)

10271 
‹mpObj
 = 
mod–SlideShow
[
mod–Numb”
];

10272 
mod–SlideShow
[
mod–Numb”
] = modelSlideShow[modelNumber + 1];

10273 
mod–SlideShow
[
mod–Numb”
 + 1] = 
‹mpObj
;

10275 
	}
}

10277 
	gP3DCÚŒŞ
::
	$ş—rMod–SlideShow
()

10279 
i
;

10281 
i
 = 0; i < 
mod–SlideShow
.
	`size
(); i++)

10282 
d–‘e
 
mod–SlideShow
[
i
];

10284 
mod–SlideShow
.
	`ş—r
();

10285 
objeù
 = 
NULL
;

10286 
	}
}

10288 
	gP3DCÚŒŞ
::
	$chªgeMod–SlideShow
(
numb”
)

10290 if(
numb”
 >ğ0 &&‚umb” < 
mod–SlideShow
.
	`size
())

10291 
objeù
 = 
mod–SlideShow
[
numb”
];

10292 
	}
}

10294 
	gP3DCÚŒŞ
::
	$qu™Mod–SlideShow
()

10296 
objeù
 = 
¦ideShowSavedObjeù
;

10297 
¦ideShowSavedObjeù
 = 
NULL
;

10298 
	`qu™TeSlideShow
();

10302 
	}
}

10308 
	gP3DCÚŒŞ
::
	$addTeSlideShow
(cÚ¡ * 
f’ame
)

10310 
TeS‘
 *
t
 = 
Ãw
 
	`TeS‘
(
f’ame
);

10311 
teSlideShow
.
	`push_back
(
t
);

10312 
	}
}

10314 
	gP3DCÚŒŞ
::
	$»moveTeSlideShow
(
teNumb”
)

10316 if(
teNumb”
 >ğ0 &&eNumb” < 
teSlideShow
.
	`size
())

10317 
teSlideShow
.
	`”a£
ÑeSlideShow.
	`begš
(è+ 
teNumb”
);

10318 
	}
}

10320 
	gP3DCÚŒŞ
::
	$moveUpTeSlideShow
(
teNumb”
)

10322 
TeS‘
* 
‹mpObj
;

10324 if(
teNumb”
 > 0 &&eNumb” < 
teSlideShow
.
	`size
())

10326 
‹mpObj
 = 
teSlideShow
[
teNumb”
];

10327 
teSlideShow
[
teNumb”
] =ileSlideShow[tileNumber - 1];

10328 
teSlideShow
[
teNumb”
 - 1] = 
‹mpObj
;

10330 
	}
}

10332 
	gP3DCÚŒŞ
::
	$moveDownTeSlideShow
(
teNumb”
)

10334 
TeS‘
* 
‹mpObj
;

10336 if(
teNumb”
 >ğ0 &&eNumb” < 
teSlideShow
.
	`size
() - 1)

10338 
‹mpObj
 = 
teSlideShow
[
teNumb”
];

10339 
teSlideShow
[
teNumb”
] =ileSlideShow[tileNumber + 1];

10340 
teSlideShow
[
teNumb”
 + 1] = 
‹mpObj
;

10342 
	}
}

10344 
	gP3DCÚŒŞ
::
	$ş—rTeSlideShow
()

10346 
i
;

10348 
i
 = 0; i < 
teSlideShow
.
	`size
(); i++)

10349 
d–‘e
 
teSlideShow
[
i
];

10351 
teSlideShow
.
	`ş—r
();

10352 
teS‘
 = 
NULL
;

10353 
	}
}

10355 
	gP3DCÚŒŞ
::
	$chªgeTeSlideShow
(
numb”
)

10357 if(
numb”
 >ğ0 &&‚umb” < 
teSlideShow
.
	`size
())

10358 
teS‘
 = 
teSlideShow
[
numb”
];

10359 
	}
}

10361 
	gP3DCÚŒŞ
::
	$qu™TeSlideShow
()

10363 
teS‘
 = 
¦ideShowSavedTeS‘
;

10364 
¦ideShowSavedTeS‘
 = 
NULL
;

10365 
šSlideShow
 = 
çl£
;

10366 
	}
}

10370 #iâdeà
PRODUCTION_VERSION


10372 #iâdeà
BINARY


10373 
	gP3DCÚŒŞ
::
	$‹¡CÚ¡¿štsP’®ty
(
figu»Id
)

10375 if(
objeù
 =ğ
NULL
)

10377 
û¼
 << "Objeù i NULL" << 
’dl
;

10380 if(
figu»Id
 < 0 || figu»Id >ğ
objeù
->
	`g‘Figu»CouÁ
())

10382 
û¼
 << "Inv®id Figu»" << 
’dl
;

10385 ià(
m©ch
 =ğ
NULL
) {

10386 
û¼
 << "M©ch i NULL" << 
’dl
;

10389  
m©ch
->
	`compu‹CÚ¡¿štsP’®ty
(*
objeù
, 
figu»Id
);

10390 
	}
}

10392 
	gP3DCÚŒŞ
::
	$‹¡Seu¿t
(
figu»Id
, 
Ëv–
) {

10393 if(
objeù
 =ğ
NULL
)

10395 
û¼
 << "Objeù i NULL" << 
’dl
;

10399 if(
figu»Id
 < 0 || figu»Id >ğ
objeù
->
	`g‘Figu»CouÁ
())

10401 
û¼
 << "Inv®id Figu»" << 
’dl
;

10405 
M3DFigu»
 * 
figu»
 = 
objeù
->
	`g‘Figu»PŒ
(
figu»Id
);

10406 if(
m©ch
 =ğ
NULL
)

10407 
m©ch
 = 
Ãw
 
M©ch
;

10408 
m©ch
->
	`‹¡Seu¿t
(
figu»
, 
Ëv–
);

10409 
	}
}

10414 
	gP3DCÚŒŞ
::
	$machšeBy‹Ord”
() const

10416  
	`ıuBy‹Ord”
();

10417 
	}
}

10426 
boŞ
 
	gP3DCÚŒŞ
::
	$isAd­tive
()

10428 ià(
objeù
 =ğ
NULL
)

10429  
çl£
;

10431 ià(
objeù
->
	`isAd­tive
())

10432  
Œue
;

10434  
çl£
;

10435 
	}
}

10437 #ifdeà
AE2_BUILD


10439 
	gP3DCÚŒŞ
::
	$addAÇ¡ruù
(
AÇ¡ruù3D
 * 
a
)

10441 ià(
ªaLi¡
 =ğ
NULL
)

10442 
ªaLi¡
 = 
Ãw
 
AÇ¡ruùLi¡
;

10443 
ªaLi¡
->
	`addAÇ¡ruù
(
a
);

10444 
	}
}

10446 
boŞ
 
	gP3DCÚŒŞ
::
	$cÚv”tAÇ¡ruùCoÜds
()

10448 ià(
ªaLi¡
 =ğ
NULL
)

10449  
çl£
;

10451 
Image3D
 * 
im
 = 
	`g‘ImagePŒ
();

10452 ià(
im
 =ğ
NULL
)

10453  
çl£
;

10455  
ªaLi¡
->
	`cÚv”tAÇ¡ruùCoÜds
(
im
);

10456 
	}
}

10458 
	gP3DCÚŒŞ
::
	$ş—rAÇ¡ruùLi¡
()

10460 
d–‘e
 
ªaLi¡
;

10461 
ªaLi¡
 = 
NULL
;

10462 
	}
}

10466 
boŞ
 
	gP3DCÚŒŞ
::
	$®ign
(cÚ¡ * 
poštsFe
, cÚ¡ * 
mod–Fe
,

10467 cÚ¡ * 
imageFe
, 
şo£Ãss
, 
boŞ
 
pgaOÆy
,

10468 
boŞ
 
sÿËOÆy
, boŞ 
sÿËT¿nsOÆy
, cÚ¡ * 
ouutT¿nsfÜm
)

10470 
M3DObjeù
 * 
mod–
;

10471 
Image3D
 * 
image
;

10472 
Image3D
 * 
img
;

10474 ià(! 
poštsFe
 ||…ointsFile[0] == '\0') {

10475 
cout
 << "UÇbËØ®ign;‚Øpošt fwa ´ovided" << 
’dl
;

10476  
çl£
;

10479 ià(
mod–Fe
 =ğ
NULL
) {

10480 ià(
objeù
 =ğ
NULL
) {

10481 
cout
 << "UÇbËØ®igÀw™houˆ¨mod–" << 
’dl
;

10482  
çl£
;

10484 
mod–
 = 
objeù
;

10487 ià(! 
	`»ad
(
mod–Fe
)) {

10488 
cout
 << "E¼Ü: UÇbËØlßd mod–: " << 
mod–Fe
 << '\n';

10489  
çl£
;

10492 
mod–
 = 
objeù
;

10493 ià(
glob®V”bos™y
 > -1)

10494 
cout
 << "Lßded mod– " << 
mod–Fe
 << '\n';

10498 
image
 = 
	`g‘ImagePŒ
();

10499 ià(
imageFe
 =ğ
NULL
) {

10500 ià(
image
 =ğ
NULL
) {

10501 
cout
 << "UÇbËØ®igÀw™houˆª image" << 
’dl
;

10502  
çl£
;

10504 
img
 = 
image
;

10507 ià(! 
	`lßdImage
(
imageFe
)) {

10508 
cout
 << "E¼Ü: UÇbËØlßd image: " << 
imageFe
 << '\n';

10509  
çl£
;

10512 
image
 = 
	`g‘ImagePŒ
();

10513 
img
 = 
image
;

10514 ià(
glob®V”bos™y
 > -1)

10515 
cout
 << "Lßded imag" << 
imageFe
 << '\n';

10519 
Üd”
 = 0;

10520 ià(
sÿËOÆy
 || 
sÿËT¿nsOÆy
)

10521 
Üd”
 = -1;

10522 #ifdeà
FAST_ALIGNMENT


10523 
F™UÆab–edPošts
 
	`®ign
(2, 0, 
Üd”
, 
şo£Ãss
, 1.0e-1, 1.0e-1);

10525 
F™UÆab–edPošts
 
	`®ign
(2, 0, 
Üd”
, 
şo£Ãss
, 1.0e-4, 1.0e-5);

10534 
F™UÆab–edPošts
::
PoštF™Ty³
 
ty³
 = F™UÆab–edPošts::
SimPGA
;

10535 #ifdeà
FAST_ALIGNMENT


10536 
ty³
 = 
F™UÆab–edPošts
::
T¿ns
;

10538 ià(
pgaOÆy
)

10539 
ty³
 = 
F™UÆab–edPošts
::
PGA
;

10540 ià(
sÿËOÆy
)

10541 
ty³
 = 
F™UÆab–edPošts
::
SÿË
;

10542 ià(
sÿËT¿nsOÆy
)

10543 
ty³
 = 
F™UÆab–edPošts
::
SÿËT¿ns
;

10545 ià(! 
®ign
.
	`f™
(
mod–
, 
poštsFe
, 
img
, 
ty³
)) {

10546 
cout
 << "Alignm’ˆoàmod– " << 
mod–FeName
 << " faed" << 
’dl
;

10547  
çl£
;

10550 
cout
 << "AligÃd mod– " << 
mod–FeName
 << 
’dl
;

10552 
mod–
 = 
®ign
.
	`»suÉ
();

10553 
	`ÃwMod–
(
mod–
);

10555 ià(
ouutT¿nsfÜm
 !ğ
NULL
) {

10556 
Sim¬™yT¿nsfÜm3D
 
¶aûm’tSim
;

10557 
®ign
.
	`»suÉ
(
¶aûm’tSim
);

10558 
¶aûm’tSim
.
	`wr™eSim¬™y
(
ouutT¿nsfÜm
);

10559 
cout
 << "Saved¿nsfÜm©iÚ " << 
ouutT¿nsfÜm
 << 
’dl
;

10562  
Œue
;

10563 
	}
}

	@P3DUndoList.cpp

1 
	~"P3DUndoLi¡.h
"

3 
	gP3DUndoLi¡
::
	$P3DUndoLi¡
(
_maxLev–
)

6 ià(
_maxLev–
 > 1)

7 
maxLev–
 = 
_maxLev–
;

9 
maxLev–
 = 1;

10 
	}
}

12 
	gP3DUndoLi¡
::~
	$P3DUndoLi¡
()

14 
	`ş—rRedoLi¡
();

15 
	`ş—rUndoLi¡
();

16 
	}
}

18 
	gP3DUndoLi¡
::
	$addUndo
(
M3DObjeù
 * 
objPŒ
, 
m¬kedPrim™iveId
)

20 
mod–_t
 
mod–
;

22 if(
objPŒ
 =ğ
NULL
)

26 
	`ş—rRedoLi¡
();

29 if(
undoObjLi¡
.
	`size
(è>ğ
maxLev–
)

31 
mod–
 = 
undoObjLi¡
.
	`back
();

32 if(
mod–
.
objeù
 !ğ
NULL
)

33 
d–‘e
 
mod–
.
objeù
;

34 
undoObjLi¡
.
	`pİ_back
();

38 
mod–
.
objeù
 = 
objPŒ
->
	`şÚe
();

39 
mod–
.
m¬kedPrim™ive
 = 
m¬kedPrim™iveId
;

42 
undoObjLi¡
.
	`push_äÚt
(
mod–
);

43 
	}
}

45 
M3DObjeù
 * 
	gP3DUndoLi¡
::
	$undoObjeù
(
M3DObjeù
 * 
objPŒ
, & 
m¬kedPrim™iveId
)

47 
mod–_t
 
mod–
;

51 if(
undoObjLi¡
.
	`em±y
(è|| 
objPŒ
 =ğ
NULL
)

52  
objPŒ
;

55 
mod–
.
m¬kedPrim™ive
 = 
m¬kedPrim™iveId
;

56 
mod–
.
objeù
 = 
objPŒ
;

57 
»doObjLi¡
.
	`push_äÚt
(
mod–
);

60 
mod–
 = 
undoObjLi¡
.
	`äÚt
();

63 
undoObjLi¡
.
	`pİ_äÚt
();

65 
m¬kedPrim™iveId
 = 
mod–
.
m¬kedPrim™ive
;

66  
mod–
.
objeù
;

67 
	}
}

69 
M3DObjeù
 * 
	gP3DUndoLi¡
::
	$d–‘eUndo
(& 
m¬kedPrim™iveId
)

72 if(
undoObjLi¡
.
	`em±y
())

73  
NULL
;

76 
mod–_t
 
mod–
 = 
undoObjLi¡
.
	`äÚt
();

79 
undoObjLi¡
.
	`pİ_äÚt
();

81 
m¬kedPrim™iveId
 = 
mod–
.
m¬kedPrim™ive
;

82  
mod–
.
objeù
;

83 
	}
}

85 
M3DObjeù
 * 
	gP3DUndoLi¡
::
	$»doObjeù
(
M3DObjeù
 * 
objPŒ
, & 
m¬kedPrim™iveId
)

87 
mod–_t
 
mod–
;

91 if(
»doObjLi¡
.
	`em±y
(è|| 
objPŒ
 =ğ
NULL
)

92  
objPŒ
;

95 
mod–
.
m¬kedPrim™ive
 = 
m¬kedPrim™iveId
;

96 
mod–
.
objeù
 = 
objPŒ
;

97 
undoObjLi¡
.
	`push_äÚt
(
mod–
);

100 
mod–
 = 
»doObjLi¡
.
	`äÚt
();

101 
»doObjLi¡
.
	`pİ_äÚt
();

103 
m¬kedPrim™iveId
 = 
mod–
.
m¬kedPrim™ive
;

104  
mod–
.
objeù
;

105 
	}
}

107 
	gP3DUndoLi¡
::
	$ş—rRedoLi¡
()

109 
size
 = 
»doObjLi¡
.
	`size
();

110 
i
;

112 
mod–_t
 
mod–
;

114 
i
 = 0; i < 
size
; i++)

116 
mod–
 = 
»doObjLi¡
.
	`back
();

117 if(
mod–
.
objeù
 !ğ
NULL
)

118 
d–‘e
 
mod–
.
objeù
;

120 
»doObjLi¡
.
	`pİ_back
();

122 
	}
}

124 
	gP3DUndoLi¡
::
	$ş—rUndoLi¡
()

126 
size
 = 
undoObjLi¡
.
	`size
();

127 
i
;

129 
mod–_t
 
mod–
;

131 
i
 = 0; i < 
size
; i++)

133 
mod–
 = 
undoObjLi¡
.
	`back
();

134 if(
mod–
.
objeù
 !ğ
NULL
)

135 
d–‘e
 
mod–
.
objeù
;

137 
undoObjLi¡
.
	`pİ_back
();

139 
	}
}

	@PCA.cpp

1 
	~"glob®BudP¬ms.h
"

2 #ifdeà
PCA_VISUALIZER


5 #ifdeà
WIN32


6 
	~<wšdows.h
>

8 
	~<¡dio.h
>

9 
	~<io¡»am
>

10 
	~<sys/¡©.h
>

11 
	~"BYU.h
"

12 
	~"PCA.h
"

15 #iâdeà
S_ISREG


16 
	#S_ISREG
(
m
è(((
S_IFREG
 & mè!ğ0è? 
Œue
 : 
çl£
)

	)

19 
usšg
 
Çme¥aû
 
	g¡d
;

22 
	gPCA
::
	$PCA
()

24 
nModes
 = 0;

25 
nV”ts
 = 0;

26 
m—nV”tiûs
 = 
NULL
;

27 
modes
 = 
NULL
;

28 
	}
}

30 
	gPCA
::~
	$PCA
()

32 ià(
m—nV”tiûs
 !ğ
NULL
)

33 
d–‘e
 
m—nV”tiûs
;

34 
	`ş—rModes
();

35 
	}
}

37 
	gPCA
::
	$ş—rModes
()

39 ià(
modes
 !ğ
NULL
)

40 
d–‘e
 [] 
modes
;

41 
modes
 = 
NULL
;

42 
	}
}

44 
	gPCA
::
	$£tM—nPCA
(cÚ¡ 
BYU
 * 
byu
)

46 
numM—nV”tiûs
 = 
byu
->
	`v”‹xCouÁ
();

47 
m—nV”tiûs
 = 
Ãw
 [3*
numM—nV”tiûs
];

48 
i
 = 0; i < 3*
numM—nV”tiûs
; i++)

49 
m—nV”tiûs
[
i
] = 
byu
->
	`v”‹xLi¡
()[i];

50 
	}
}

52 
boŞ
 
	gPCA
::
	$»adPCAfe
(cÚ¡ *
f’ame
)

54 
¡©
 
buf
;

55 
i
, 
j
;

56 
FILE
 *
å
;

58 ià(
f’ame
 =ğ
NULL
)

59  
çl£
;

61 ià(
	`¡©
(
f’ame
, &
buf
è!ğ0 || 
	`S_ISREG
(buf.
¡_mode
è=ğ
çl£
) {

62 
cout
 << "Not‡ valid file.\n";

63  
çl£
;

67 
å
 = 
	`fİ’
(
f’ame
, "r");

68 ià(
å
 =ğ
NULL
)

69  
çl£
;

71 
	`ş—rModes
();

73 
cout
 << "Lßdšg PCA fe: " << 
f’ame
 <<'\n';

76 
	`fsÿnf
(
å
, "%d %d\n", &
nV”ts
, &
nModes
);

78 ià(
nV”ts
 =ğ0 || 
nModes
 == 0) {

79 
cout
 << "File containedƒither‚o vertices or‚o‚umber of modes. \n";

80 
	`fşo£
(
å
);

81  
çl£
;

84 
modes
 = 
Ãw
 [(3*
nV”ts
)*
nModes
];

86 
i
 = 0; i < (3*
nV”ts
)*
nModes
 ; i++)

87 
modes
[
i
] = 0.0;

89 
i
 = 0; i < 
nModes
 ; i++) {

90 
j
 = 
i
*
nV”ts
; j < (i+1)*nVerts ; j++) {

91 
	`fsÿnf
(
å
, "%à%à%f\n", &
modes
[3*
j
], &modes[3*j+1], &modes[3*j+2]);

95 ià(
å
 !ğ
NULL
) {

96 
	`fşo£
(
å
);

97  
Œue
;

100 
cout
 << "Not‡ valid file.\n";

101  
çl£
;

103 
	}
}

105 
boŞ
 
	gPCA
::
pÿDefÜm
(
BYU
 * 
byu
, 
¡d
::
veùÜ
<> & 
v®s
)

107 
i
,
	gj
;

109 ià(
	gbyu
 =ğ
NULL
) {

110 
cout
 << "NULL byu object is…assed.\n";

111  
	gçl£
;

114 ià(
	gm—nV”tiûs
 =ğ
NULL
) {

115 
cout
 << "PCA file is‚ot†oaded.\n";

116  
	gçl£
;

119 ià(
	gnModes
 > 
	gv®s
.
size
()) {

120 
	gi
 = 
v®s
.
size
(è; i < 
	gnModes
 ; i++)

121 
	gv®s
.
push_back
(0.0);

124 *
	gvec
 = 
Ãw
 [3*
nV”ts
];

125 
	gi
 = 0 ; i < 3*
	gnV”ts
 ; i++) {

126 
	gvec
[
i
] = 0.0;

129 
	gi
 = 0 ; i < 
	gnModes
 ; i++) {

130 
	gj
 =0 ; j < 3*
	gnV”ts
 ; j++)

131 
	gvec
[
j
] +ğ
v®s
[
i
]*
modes
[j+i*3*
nV”ts
];

134 ià(
	gnV”ts
 !ğ
byu
->
v”‹xCouÁ
(è|| 
nV”ts
 !ğ
numM—nV”tiûs
) {

135 
cout
 << "BYU object‡nd meanBYU do‚ot havehe same‚umber of vertices. \n";

136 ià(
	gvec
)

137 
	gd–‘e
 [] 
	gvec
;

138  
	gçl£
;

141 * 
	gv”ts
 = (*è
byu
->
v”‹xLi¡
();

142 
	gi
 = 0; i <3*
	gnV”ts
 ; i++) {

143 
	gv”ts
[
i
] = 
m—nV”tiûs
[i] + 
vec
[i];

149 ià(
	gvec
)

150 
	gd–‘e
 [] 
	gvec
;

151  
	gŒue
;

	@Trackball.cpp

1 
	~"T¿ckb®l.h
"

5 
	gT¿ckb®l
::
	$T¿ckb®l
(
width
, 
height
è: 
	$rÙQu©
()

7 
cÚŒŞ
 = 
NULL
;

8 
ŒackMode
 = 
NONE
;

10 
dT¿ns
.
	`£t
(0.0, 0.0, 0.0);

11 
cu¼SÿË
 = 1.0f;

12 
dSÿË
 = 0.0f;

14 
v›wWidth
 = 
width
;

15 
v›wHeight
 = 
height
;

17 
ÿnRÙ©e
 = 
Œue
;

18 
rÙ©iÚTy³
 = 
ROTATE_3D
;

19 
	}
}

21 
	gT¿ckb®l
::
	$£tMode
(
T¿ckMode
 
mode
)

23 #ifdeà
DEBUG


24 
cout
 << "T¿ckb®Èmod£ˆtØ" << 
mode
 << 
’dl
;

26 
ŒackMode
 = 
mode
;

27 
	}
}

30 
	gT¿ckb®l
::
	$»£t
(* 
ŒªsM©
)

32 
i
, 
j
;

33 
i
 = 0; i < 4; i++)

35 
j
 = 0; j < 4; j++)

37 
ŒªsfÜmM©rix
[
i
][
j
] = *
ŒªsM©
;

38 
cu¼M©rix
[
i
][
j
] = *
ŒªsM©
;

39 
ŒªsM©
++;

43 
rÙQu©
 = 
	`Qu©
();

46 
VeùÜ3D
 
	`‹¡
(
ŒªsfÜmM©rix
[0][0],ransformMatrix[1][0],ransformMatrix[2][0]);

47 
cu¼SÿË
 = (è
‹¡
.
	`nÜm
();

49 
dSÿË
 = 0.0f;

50 
dT¿ns
.
	`£t
(0.0, 0.0, 0.0);

51 
ŒackMode
 = 
NONE
;

52 
	}
}

54 
	gT¿ckb®l
::
	$mou£Ev’t
(cÚ¡ 
Mou£Ev’tSŒuù
 & 
mou£
)

56 
VeùÜ3D
 
objT¿ns
;

57 
objSÿË
;

58 
Qu©
 
objQu©
;

59 
VeùÜ3D
 
objCOG
;

60 
M3DObjeù
 * 
objeù
;

61 
TeS‘
 *
teS‘
;

64 ià(
mou£
.
ty³
 =ğ
MOUSE_PUSH
)

66 
	`d‘”mšeMode
(
mou£
);

68 ià(
cÚŒŞ
 !ğ
NULL
)

70 ià(
ŒackMode
 =ğ
OBJECT_ROTATE
 ||¿ckMod=ğ
OBJECT_TRANSLATE
 ||

71 
ŒackMode
 =ğ
OBJECT_SCALE
 ||¿ckMod=ğ
OBJECT_PIROUETTE
)

72 
cÚŒŞ
->
	`¡¬tO³¿tiÚ
();

76 
cu¼Mou£X
 = 
Ï¡Mou£X
 = 
mou£
.
x
;

77 
cu¼Mou£Y
 = 
Ï¡Mou£Y
 = 
mou£
.
y
;

79 
rÙQu©
 = 
	`Qu©
();

80 
dT¿ns
.
	`£t
(0.0, 0.0, 0.0);

81 
dSÿË
 = 0.0f;

82 #ifdeà
DEBUG


83 
cout
 << "mou£Ev’t:…ush - modğ" << 
ŒackMode
 << 
’dl
;

87 ià(
mou£
.
ty³
 =ğ
MOUSE_DRAG
)

89 
cu¼Mou£X
 = 
mou£
.
x
;

90 
cu¼Mou£Y
 = 
mou£
.
y
;

92 
ŒackMode
)

94 
VIEW_ROTATE
:

95 
	`rÙ©e3D
(
rÙQu©
,

96 (2.0 * 
Ï¡Mou£X
 / 
mou£
.
width
) - 1.0,

97 1.0 - (2.0 * 
Ï¡Mou£Y
 / 
mou£
.
height
),

98 (2.0 * 
cu¼Mou£X
 / 
mou£
.
width
) - 1.0,

99 1.0 - (2.0 * 
cu¼Mou£Y
 / 
mou£
.
height
));

101 
Ï¡Mou£X
 = 
cu¼Mou£X
;

102 
Ï¡Mou£Y
 = 
cu¼Mou£Y
;

106 
VIEW_TRANSLATE
:

107 
dT¿ns
.
	`£t
(
v›wWidth
 * (
cu¼Mou£X
 - 
Ï¡Mou£X
è/ 
mou£
.
width
,

108 -
v›wHeight
 * (
cu¼Mou£Y
 - 
Ï¡Mou£Y
è/ 
mou£
.
height
,

111 
Ï¡Mou£X
 = 
cu¼Mou£X
;

112 
Ï¡Mou£Y
 = 
cu¼Mou£Y
;

116 
VIEW_SCALE
:

117 
dSÿË
 = 
SCALE_FACTOR
 * (
cu¼Mou£Y
 - 
Ï¡Mou£Y
è/ 
mou£
.
height
;

119 
Ï¡Mou£Y
 = 
cu¼Mou£Y
;

123 
OBJECT_ROTATE
:

124 ià(
cÚŒŞ
 =ğ
NULL
)

127 
objeù
 = 
cÚŒŞ
->
	`g‘ObjeùPŒ
();

128 
teS‘
 = 
cÚŒŞ
->
	`g‘TeS‘PŒ
();

129 ià(
objeù
 || 
teS‘
) {

130 ià(
rÙ©iÚTy³
 =ğ
ROTATE_3D
) {

131 
objCOG
 = 
objeù
 ? objeù->
	`g‘COG
(è: 
teS‘
->getCOG();

132 
objCOG
.
	`muÉByM©rix4
(&(
ŒªsfÜmM©rix
[0][0]));

134 
	`rÙ©e3D
(
objQu©
,

135 (2.0 * 
Ï¡Mou£X
 / 
mou£
.
width
è- 1.0 - 
objCOG
.
	`g‘X
(),

136 1.0 - (2.0 * 
Ï¡Mou£Y
 / 
mou£
.
height
è- 
objCOG
.
	`g‘Y
(),

137 (2.0 * 
cu¼Mou£X
 / 
mou£
.
width
è- 1.0 - 
objCOG
.
	`g‘X
(),

138 1.0 - (2.0 * 
cu¼Mou£Y
 / 
mou£
.
height
è- 
objCOG
.
	`g‘Y
());

141 
	`rÙ©e2D
(
objQu©
,

142 ()(
cu¼Mou£X
 - 
Ï¡Mou£X
è/ (è
mou£
.
width
);

145 
	`rÙ©eObjeù
(
objQu©
.
	`cÚj
());

146 
	`rÙ©eTeS‘
(
objQu©
.
	`cÚj
());

148 
Ï¡Mou£X
 = 
cu¼Mou£X
;

149 
Ï¡Mou£Y
 = 
cu¼Mou£Y
;

154 
OBJECT_PIROUETTE
:

155 ià(
cÚŒŞ
 =ğ
NULL
)

158 
teS‘
 = 
cÚŒŞ
->
	`g‘TeS‘PŒ
();

159 ià(
teS‘
) {

160 if(
rÙ©iÚTy³
 =ğ
ROTATE_3D
) {

161 
objCOG
 = 
teS‘
->
	`g‘COG
();

162 
objCOG
.
	`muÉByM©rix4
(&(
ŒªsfÜmM©rix
[0][0]));

164 
	`rÙ©e3D
(
objQu©
,

165 (2.0 * 
Ï¡Mou£X
 / 
mou£
.
width
è- 1.0 - 
objCOG
.
	`g‘X
(),

166 1.0 - (2.0 * 
Ï¡Mou£Y
 / 
mou£
.
height
è- 
objCOG
.
	`g‘Y
(),

167 (2.0 * 
cu¼Mou£X
 / 
mou£
.
width
è- 1.0 - 
objCOG
.
	`g‘X
(),

168 1.0 - (2.0 * 
cu¼Mou£Y
 / 
mou£
.
height
è- 
objCOG
.
	`g‘Y
());

171 
	`rÙ©e2D
(
objQu©
,

172 ()(
cu¼Mou£X
 - 
Ï¡Mou£X
è/ (è
mou£
.
width
);

175 
	`pœou‘‹TeS‘
(
objQu©
.
	`cÚj
());

177 
Ï¡Mou£X
 = 
cu¼Mou£X
;

178 
Ï¡Mou£Y
 = 
cu¼Mou£Y
;

184 
OBJECT_TRANSLATE
:

185 ià(
cÚŒŞ
 =ğ
NULL
)

188 
objT¿ns
.
	`£t
(
v›wWidth
 * (
cu¼Mou£X
 - 
Ï¡Mou£X
è/ 
mou£
.
width
,

189 -
v›wHeight
 * (
cu¼Mou£Y
 - 
Ï¡Mou£Y
è/ 
mou£
.
height
,

192 
	`Œª¦©eObjeù
(
objT¿ns
);

194 
Ï¡Mou£X
 = 
cu¼Mou£X
;

195 
Ï¡Mou£Y
 = 
cu¼Mou£Y
;

199 
OBJECT_SCALE
:

200 ià(
cÚŒŞ
 =ğ
NULL
)

203 
objSÿË
 = 
SCALE_FACTOR
 * (
cu¼Mou£Y
 - 
Ï¡Mou£Y
è/ 
mou£
.
height
;

204 
cÚŒŞ
->
	`sÿË
(1.0 + 
objSÿË
);

206 
Ï¡Mou£Y
 = 
cu¼Mou£Y
;

210 
OBJECT_SCALE_WIDTH
:

211 ià(
cÚŒŞ
 =ğ
NULL
)

214 
objSÿË
 = 
SCALE_FACTOR
 * (
cu¼Mou£Y
 - 
Ï¡Mou£Y
è/ 
mou£
.
height
;

215 
cÚŒŞ
->
	`sÿËWidth
(1.0 + 
objSÿË
);

217 
Ï¡Mou£Y
 = 
cu¼Mou£Y
;

224 #ifdeà
BINARY


225 #ifdeà
DEBUG


226 
objeù
 = 
cÚŒŞ
->
	`g‘ObjeùPŒ
();

228 ià(
objeù
)

229 
cout
 << "REGU="

230 << 
objeù
->
	`di¡2FromAveOfNeighbÜs
(

231 (
PrimNeighbÜhoodDeâ
è(è
	`tunšgWt
(
BpAtomNeighbÜhood
),

233 (
Di¡ªûTy³
è(è
	`tunšgWt
(
BpAtomDi¡ªûTy³
))

234 << 
’dl
;

238 #ifdeà
DEBUG


239 
cout
 << "mou£Ev’t: d¿g - modğ" << 
ŒackMode
 << 
’dl
;

243 ià(
mou£
.
ty³
 =ğ
MOUSE_RELEASE
)

245 #ifdeà
DEBUG


246 
cout
 << "mou£Ev’t:„–—£ - modğ" << 
ŒackMode
 << 
’dl
;

248 ià(
cÚŒŞ
 !ğ
NULL
) {

249 ià(
ŒackMode
 =ğ
OBJECT_ROTATE
 ||¿ckMod=ğ
OBJECT_TRANSLATE


250 || 
ŒackMode
 =ğ
OBJECT_SCALE
)

252 
cÚŒŞ
->
	`’dO³¿tiÚ
();

255 
ŒackMode
 = 
NONE
;

257 
	}
}

259 #ifdeà
AE2_BUILD


261 
	gT¿ckb®l
::
	$kbEv’t
(cÚ¡ 
KBT¿nsfÜm©iÚSŒuù
 & 
kb
)

263 
VeùÜ3D
 
objT¿ns
;

264 
objSÿË
;

265 
Qu©
 
objQu©
;

266 
VeùÜ3D
 
objCOG
;

267 
M3DObjeù
 * 
objeù
;

268 
TeS‘
 *
teS‘
;

270 ià(
cÚŒŞ
 =ğ
NULL
)

274 
cu¼Mou£X
 = 
Ï¡Mou£X
 + 
kb
.
x
;

275 
cu¼Mou£Y
 = 
Ï¡Mou£Y
 + 
kb
.
y
;

277 
kb
.
ty³
)

279 
KB_ROTATE
:

280 
objeù
 = 
cÚŒŞ
->
	`g‘ObjeùPŒ
();

281 
teS‘
 = 
cÚŒŞ
->
	`g‘TeS‘PŒ
();

282 ià(
objeù
 || 
teS‘
) {

283 ià(
rÙ©iÚTy³
 =ğ
ROTATE_3D
) {

284 
objCOG
 = 
objeù
 ? objeù->
	`g‘COG
(è: 
teS‘
->getCOG();

285 
objCOG
.
	`muÉByM©rix4
(&(
ŒªsfÜmM©rix
[0][0]));

287 
	`rÙ©e3D
(
objQu©
,

288 (2.0 * 
Ï¡Mou£X
 / 
kb
.
width
è- 1.0 - 
objCOG
.
	`g‘X
(),

289 1.0 - (2.0 * 
Ï¡Mou£Y
 / 
kb
.
height
è- 
objCOG
.
	`g‘Y
(),

290 (2.0 * 
cu¼Mou£X
 / 
kb
.
width
è- 1.0 - 
objCOG
.
	`g‘X
(),

291 1.0 - (2.0 * 
cu¼Mou£Y
 / 
kb
.
height
è- 
objCOG
.
	`g‘Y
());

294 
	`rÙ©e2D
(
objQu©
,

295 ()(
cu¼Mou£X
 - 
Ï¡Mou£X
è/ (è
kb
.
width
);

298 
	`rÙ©eObjeù
(
objQu©
.
	`cÚj
());

299 
	`rÙ©eTeS‘
(
objQu©
.
	`cÚj
());

301 
Ï¡Mou£X
 = 
cu¼Mou£X
;

302 
Ï¡Mou£Y
 = 
cu¼Mou£Y
;

307 
KB_TRANSLATE
:

308 
objT¿ns
.
	`£t
(
v›wWidth
 * (
cu¼Mou£X
 - 
Ï¡Mou£X
è/ 
kb
.
width
,

309 -
v›wHeight
 * (
cu¼Mou£Y
 - 
Ï¡Mou£Y
è/ 
kb
.
height
,

312 
	`Œª¦©eObjeù
(
objT¿ns
);

314 
Ï¡Mou£X
 = 
cu¼Mou£X
;

315 
Ï¡Mou£Y
 = 
cu¼Mou£Y
;

319 
KB_SCALE
:

321 
objSÿË
 = 
SCALE_FACTOR
 * (
cu¼Mou£Y
 - 
Ï¡Mou£Y
è/ 
kb
.
height
;

322 
cÚŒŞ
->
	`sÿË
(1.0 + 
objSÿË
);

324 
Ï¡Mou£Y
 = 
cu¼Mou£Y
;

330 #ifdeà
DEBUG


331 
cout
 << "kbEv’t: kbƒv’ˆty³ = " << 
kb
.
ty³
 << 
’dl
;

333 
	}
}

337 
	gT¿ckb®l
::
	$doV›wT¿nsfÜm
()

339 
rÙM©rix
[4][4];

341 if(
ŒackMode
 =ğ
VIEW_SCALE
)

343 
Ï¡SÿË
 = 
cu¼SÿË
;

344 
cu¼SÿË
 *ğ(1.0à+ 
dSÿË
);

347 if(
cu¼SÿË
 > 
MAX_SCALE
)

350 
dSÿË
 = (
MAX_SCALE
 / 
Ï¡SÿË
) - 1.0f;

351 
cu¼SÿË
 = 
MAX_SCALE
;

354 if(
cu¼SÿË
 < 
MIN_SCALE
)

357 
dSÿË
 = (
MIN_SCALE
 / 
Ï¡SÿË
) - 1.0f;

358 
cu¼SÿË
 = 
MIN_SCALE
;

361 
	`glSÿËf
(1.0à+ 
dSÿË
, 1.0f + dScale, 1.0f + dScale);

364 if(
ŒackMode
 =ğ
VIEW_TRANSLATE
)

365 
	`glT¿n¦©ed
(
dT¿ns
.
	`g‘X
(), dT¿ns.
	`g‘Y
(), dT¿ns.
	`g‘Z
());

367 if(
ŒackMode
 =ğ
VIEW_ROTATE
)

369 
rÙQu©
.
	`budRÙM©rix
(&(
rÙM©rix
[0][0]));

370 
	`glMuÉM©rixd
(&(
rÙM©rix
[0][0]));

373 
	`glMuÉM©rixf
(&(
ŒªsfÜmM©rix
[0][0]));

375 if(
ŒackMode
 !ğ
NONE
)

376 
	`glG‘Flßtv
(
GL_MODELVIEW_MATRIX
, &(
ŒªsfÜmM©rix
[0][0]));

378 
	`glG‘Flßtv
(
GL_MODELVIEW_MATRIX
, &(
cu¼M©rix
[0][0]));

379 
	}
}

382 
	gT¿ckb®l
::
	$Œª¦©e
(
x
, 
y
, 
z
)

384 
	`glT¿n¦©ed
(
x
, 
y
, 
z
);

385 
	`glG‘Flßtv
(
GL_MODELVIEW_MATRIX
, &(
cu¼M©rix
[0][0]));

386 
	}
}

389 
	gT¿ckb®l
::
	$rÙ©e
(
ªgË
, 
x
, 
y
, 
z
)

391 
	`glRÙ©ed
(
ªgË
, 
x
, 
y
, 
z
);

392 
	`glG‘Flßtv
(
GL_MODELVIEW_MATRIX
, &(
cu¼M©rix
[0][0]));

393 
	}
}

396 
	gT¿ckb®l
::
	$muÉM©rix
(* 
m©
)

398 
	`glMuÉM©rixd
(
m©
);

399 
	`glG‘Flßtv
(
GL_MODELVIEW_MATRIX
, &(
cu¼M©rix
[0][0]));

400 
	}
}

403 
	gT¿ckb®l
::
	$Œª¦©eV›w
(
x
, 
y
, 
z
)

405 
	`glT¿n¦©ed
(
x
, 
y
, 
z
);

406 
	`glG‘Flßtv
(
GL_MODELVIEW_MATRIX
, &(
ŒªsfÜmM©rix
[0][0]));

407 
	}
}

410 
	gT¿ckb®l
::
	$rÙ©eV›w
(
ªgË
, 
x
, 
y
, 
z
)

412 
	`glRÙ©ed
(
ªgË
, 
x
, 
y
, 
z
);

413 
	`glG‘Flßtv
(
GL_MODELVIEW_MATRIX
, &(
ŒªsfÜmM©rix
[0][0]));

414 
	}
}

416 
	gT¿ckb®l
::
	$d‘”mšeMode
(cÚ¡ 
Mou£Ev’tSŒuù
 & 
mou£
)

418 #ifdeà
DEBUG


419 
cout
 << "Mou£ modif›rs: " << 
mou£
.
modif›rs
 << " = "

420 << ((
mou£
.
modif›rs
 & 
ALT_KEY
) ? "ALT " : "")

421 << ((
mou£
.
modif›rs
 & 
META_KEY
) ? "META " : "")

422 << ((
mou£
.
modif›rs
 & 
CTRL_KEY
) ? "CTRL " : "")

423 << ((
mou£
.
modif›rs
 & 
SHIFT_KEY
è? "SHIFT " : ""è<< 
’dl
;

427 if((
mou£
.
bu‰Ú
 =ğ1è&& (mou£.
modif›rs
 =ğ
NO_KEY
è&& 
ÿnRÙ©e
)

428 
ŒackMode
 = 
VIEW_ROTATE
;

431 if((
mou£
.
bu‰Ú
 =ğ2è&& (mou£.
modif›rs
 =ğ
NO_KEY
))

432 
ŒackMode
 = 
VIEW_TRANSLATE
;

435 if((
mou£
.
bu‰Ú
 =ğ1è&& (mou£.
modif›rs
 =ğ
SHIFT_KEY
))

436 
ŒackMode
 = 
VIEW_TRANSLATE
;

439 if((
mou£
.
bu‰Ú
 =ğ3è&& (mou£.
modif›rs
 =ğ
NO_KEY
))

440 
ŒackMode
 = 
VIEW_SCALE
;

443 if((
mou£
.
bu‰Ú
 =ğ1è&& (mou£.
modif›rs
 =ğ
ALT_KEY
 || mou£.modif›r =ğ
META_KEY


444 || 
mou£
.
modif›rs
 =ğ(
SHIFT_KEY
 | 
CTRL_KEY
)))

445 
ŒackMode
 = 
OBJECT_ROTATE
;

448 if((
mou£
.
bu‰Ú
 =ğ1è&& (mou£.
modif›rs
 =ğ(
SHIFT_KEY
 | 
ALT_KEY
)

449 || 
mou£
.
modif›rs
 =ğ(
SHIFT_KEY
 | 
META_KEY
)))

450 
ŒackMode
 = 
OBJECT_PIROUETTE
;

453 if((
mou£
.
bu‰Ú
 =ğ2è&& (mou£.
modif›rs
 =ğ
ALT_KEY
 || mou£.modif›r =ğ
META_KEY


454 || 
mou£
.
modif›rs
 =ğ(
SHIFT_KEY
 | 
CTRL_KEY
)))

455 
ŒackMode
 = 
OBJECT_TRANSLATE
;

458 if((
mou£
.
bu‰Ú
 =ğ1è&& (mou£.
modif›rs
 =ğ(
SHIFT_KEY
 | 
ALT_KEY
)

459 || 
mou£
.
modif›rs
 =ğ(
SHIFT_KEY
 | 
ALT_KEY
)))

460 
ŒackMode
 = 
OBJECT_TRANSLATE
;

463 if((
mou£
.
bu‰Ú
 =ğ3è&& (mou£.
modif›rs
 =ğ
ALT_KEY
 || mou£.modif›r =ğ
META_KEY


464 || 
mou£
.
modif›rs
 =ğ(
SHIFT_KEY
 | 
CTRL_KEY
)))

465 
ŒackMode
 = 
OBJECT_SCALE
;

468 if((
mou£
.
bu‰Ú
 =ğ3è&& (mou£.
modif›rs
 =ğ(
SHIFT_KEY
 | 
ALT_KEY
)

469 || 
mou£
.
modif›rs
 =ğ(
SHIFT_KEY
 | 
META_KEY
)))

470 
ŒackMode
 = 
OBJECT_SCALE_WIDTH
;

473 
ŒackMode
 = 
NONE
;

474 
	}
}

478 
	$´ojeùToSph”e
(
r
, 
x
, 
y
)

480 
di¡Squ¬ed
, 
z
;

482 
di¡Squ¬ed
 = (
x
 * xè+ (
y
 * y);

485 if(
di¡Squ¬ed
 < ((
r
 *„) / 2.0))

486 
z
 = 
	`sq¹
((
r
 *„è- 
di¡Squ¬ed
);

490 
z
 = (
r
 *„è/ (2.0 * 
	`sq¹
(
di¡Squ¬ed
));

492  
z
;

493 
	}
}

496 
	gT¿ckb®l
::
	$rÙ©e3D
(
Qu©
 &
q
, 
p1x
, 
p1y
, 
p2x
, 
p2y
)

499 if((
p1x
 =ğ
p2x
è&& (
p1y
 =ğ
p2y
))

501 
q
 = 
	`Qu©
();

505 
VeùÜ3D
 
axis
;

506 
th‘a
;

509 
VeùÜ3D
 
	`p1
 (
p1x
, 
p1y
, 
	`´ojeùToSph”e
(
TRACKBALLSIZE
,…1x,…1y)),

510 
	`p2
 (
p2x
, 
p2y
, 
	`´ojeùToSph”e
(
TRACKBALLSIZE
,…2x,…2y));

512 
axis
 = 
p2
.
	`üoss
(
p1
);

515 
t
 = (
p1
 - 
p2
).
	`nÜm
(è/ (2.0 * 
TRACKBALLSIZE
);

518 if(
t
 > 1.0)

519 
t
 = 1.0;

520 if(
t
 < -1.0)

521 
t
 = -1.0;

523 
th‘a
 = 2.0 * 
	`asš
(
t
);

526 
q
.
	`£tAxisAngË
(
axis
, 
th‘a
);

527 
	}
}

530 
	gT¿ckb®l
::
	$rÙ©e2D
(
Qu©
 &
q
, 
d–x
)

532 ià(
d–x
 == 0.0)

536 
švSÿË
 = 1.0 / 
cu¼SÿË
;

537 
sÿËFaù
 = 
švSÿË
 * invScale;

543 
švRÙM©
[2][3];

545 
švRÙM©
[0][0] = 
cu¼M©rix
[0][0] * 
sÿËFaù
;

546 
švRÙM©
[0][1] = 
cu¼M©rix
[1][0] * 
sÿËFaù
;

547 
švRÙM©
[0][2] = 
cu¼M©rix
[2][0] * 
sÿËFaù
;

549 
švRÙM©
[1][0] = 
cu¼M©rix
[0][1] * 
sÿËFaù
;

550 
švRÙM©
[1][1] = 
cu¼M©rix
[1][1] * 
sÿËFaù
;

551 
švRÙM©
[1][2] = 
cu¼M©rix
[2][1] * 
sÿËFaù
;

553 
VeùÜ3D
 
	`ÃwX
 (&(
švRÙM©
[0][0])),

554 
	`ÃwY
 (&(
švRÙM©
[1][0]));

557 
VeùÜ3D
 
nÜm®
 = 
ÃwX
.
	`üoss
(
ÃwY
);

559 ià(
d–x
 > 1.0)

560 
d–x
 = 1.0;

561 ià(
d–x
 < -1.0)

562 
d–x
 = -1.0;

564 
q
.
	`£tAxisAngË
(
nÜm®
, 
d–x
 * 
R_TWO_PI
);

565 
	}
}

570 
	gT¿ckb®l
::
	$Œª¦©eObjeù
(cÚ¡ 
VeùÜ3D
 &
Œªs
)

572 if(
cÚŒŞ
 =ğ
NULL
)

576 
švSÿË
 = 1.0 / 
cu¼SÿË
;

577 
sÿËFaù
 = 
švSÿË
 * invScale;

583 
švRÙM©
[2][3];

585 
švRÙM©
[0][0] = 
cu¼M©rix
[0][0] * 
sÿËFaù
;

586 
švRÙM©
[0][1] = 
cu¼M©rix
[1][0] * 
sÿËFaù
;

587 
švRÙM©
[0][2] = 
cu¼M©rix
[2][0] * 
sÿËFaù
;

589 
švRÙM©
[1][0] = 
cu¼M©rix
[0][1] * 
sÿËFaù
;

590 
švRÙM©
[1][1] = 
cu¼M©rix
[1][1] * 
sÿËFaù
;

591 
švRÙM©
[1][2] = 
cu¼M©rix
[2][1] * 
sÿËFaù
;

593 
VeùÜ3D
 
	`ÃwX
 (&(
švRÙM©
[0][0])),

594 
	`ÃwY
 (&(
švRÙM©
[1][0]));

596 
VeùÜ3D
 
fš®T¿ns
 = 
ÃwX
 * 
Œªs
.
	`g‘X
(è+ 
ÃwY
 *¿ns.
	`g‘Y
();

599 
cÚŒŞ
->
	`Œª¦©e
(
fš®T¿ns
);

600 
	}
}

603 
	gT¿ckb®l
::
	$rÙ©eObjeù
(
Qu©
 
objQu©
)

605 if(
cÚŒŞ
 =ğ
NULL
)

608 
n
 = 
objQu©
.
	`nÜm
();

610 
švSÿË
 = 1.0 / 
cu¼SÿË
;

611 
VeùÜ3D
 
axis
 = 
objQu©
.
	`g‘VeùÜ
();

614 if(
axis
 *‡xis == 0)

617 
axis
.
	`nÜm®ize
();

619 
VeùÜ3D
 
ŞdAxis
 = 
axis
;

622 
axis
.
	`£tX
(
ŒªsfÜmM©rix
[0][0] * 
ŞdAxis
.
	`g‘X
() +

623 
ŒªsfÜmM©rix
[0][1] * 
ŞdAxis
.
	`g‘Y
() +

624 
ŒªsfÜmM©rix
[0][2] * 
ŞdAxis
.
	`g‘Z
());

626 
axis
.
	`£tY
(
ŒªsfÜmM©rix
[1][0] * 
ŞdAxis
.
	`g‘X
() +

627 
ŒªsfÜmM©rix
[1][1] * 
ŞdAxis
.
	`g‘Y
() +

628 
ŒªsfÜmM©rix
[1][2] * 
ŞdAxis
.
	`g‘Z
());

630 
axis
.
	`£tZ
(
ŒªsfÜmM©rix
[2][0] * 
ŞdAxis
.
	`g‘X
() +

631 
ŒªsfÜmM©rix
[2][1] * 
ŞdAxis
.
	`g‘Y
() +

632 
ŒªsfÜmM©rix
[2][2] * 
ŞdAxis
.
	`g‘Z
());

635 
axis
 *ğ
švSÿË
;

637 
h®fAngË
 = 
	`acos
(
objQu©
.
	`g‘W
());

638 
sšH®fAngË
 = 
	`sš
(
h®fAngË
);

640 
objQu©
.
	`£tX
(
axis
.
	`g‘X
(è* 
sšH®fAngË
);

641 
objQu©
.
	`£tY
(
axis
.
	`g‘Y
(è* 
sšH®fAngË
);

642 
objQu©
.
	`£tZ
(
axis
.
	`g‘Z
(è* 
sšH®fAngË
);

645 
cÚŒŞ
->
	`rÙ©e
(
objQu©
);

646 
	}
}

651 
	gT¿ckb®l
::
	$rÙ©eTeS‘
(
Qu©
 
objQu©
)

653 if(
cÚŒŞ
 =ğ
NULL
)

656 
n
 = 
objQu©
.
	`nÜm
();

658 
švSÿË
 = 1.0 / 
cu¼SÿË
;

659 
VeùÜ3D
 
axis
 = 
objQu©
.
	`g‘VeùÜ
();

662 if(
axis
 *‡xis == 0)

665 
axis
.
	`nÜm®ize
();

667 
VeùÜ3D
 
ŞdAxis
 = 
axis
;

670 
axis
.
	`£tX
(
ŒªsfÜmM©rix
[0][0] * 
ŞdAxis
.
	`g‘X
() +

671 
ŒªsfÜmM©rix
[0][1] * 
ŞdAxis
.
	`g‘Y
() +

672 
ŒªsfÜmM©rix
[0][2] * 
ŞdAxis
.
	`g‘Z
());

674 
axis
.
	`£tY
(
ŒªsfÜmM©rix
[1][0] * 
ŞdAxis
.
	`g‘X
() +

675 
ŒªsfÜmM©rix
[1][1] * 
ŞdAxis
.
	`g‘Y
() +

676 
ŒªsfÜmM©rix
[1][2] * 
ŞdAxis
.
	`g‘Z
());

678 
axis
.
	`£tZ
(
ŒªsfÜmM©rix
[2][0] * 
ŞdAxis
.
	`g‘X
() +

679 
ŒªsfÜmM©rix
[2][1] * 
ŞdAxis
.
	`g‘Y
() +

680 
ŒªsfÜmM©rix
[2][2] * 
ŞdAxis
.
	`g‘Z
());

683 
axis
 *ğ
švSÿË
;

685 
h®fAngË
 = 
	`acos
(
objQu©
.
	`g‘W
());

686 
sšH®fAngË
 = 
	`sš
(
h®fAngË
);

688 
objQu©
.
	`£tX
(
axis
.
	`g‘X
(è* 
sšH®fAngË
);

689 
objQu©
.
	`£tY
(
axis
.
	`g‘Y
(è* 
sšH®fAngË
);

690 
objQu©
.
	`£tZ
(
axis
.
	`g‘Z
(è* 
sšH®fAngË
);

693 
cÚŒŞ
->
	`rÙ©eTeS‘
(
objQu©
);

694 
	}
}

699 
	gT¿ckb®l
::
	$pœou‘‹TeS‘
(
Qu©
 
objQu©
)

701 if(
cÚŒŞ
 =ğ
NULL
)

704 
n
 = 
objQu©
.
	`nÜm
();

706 
švSÿË
 = 1.0 / 
cu¼SÿË
;

707 
VeùÜ3D
 
axis
 = 
objQu©
.
	`g‘VeùÜ
();

710 if(
axis
 *‡xis == 0)

713 
axis
.
	`nÜm®ize
();

715 
VeùÜ3D
 
ŞdAxis
 = 
axis
;

718 
axis
.
	`£tX
(
ŒªsfÜmM©rix
[0][0] * 
ŞdAxis
.
	`g‘X
() +

719 
ŒªsfÜmM©rix
[0][1] * 
ŞdAxis
.
	`g‘Y
() +

720 
ŒªsfÜmM©rix
[0][2] * 
ŞdAxis
.
	`g‘Z
());

722 
axis
.
	`£tY
(
ŒªsfÜmM©rix
[1][0] * 
ŞdAxis
.
	`g‘X
() +

723 
ŒªsfÜmM©rix
[1][1] * 
ŞdAxis
.
	`g‘Y
() +

724 
ŒªsfÜmM©rix
[1][2] * 
ŞdAxis
.
	`g‘Z
());

726 
axis
.
	`£tZ
(
ŒªsfÜmM©rix
[2][0] * 
ŞdAxis
.
	`g‘X
() +

727 
ŒªsfÜmM©rix
[2][1] * 
ŞdAxis
.
	`g‘Y
() +

728 
ŒªsfÜmM©rix
[2][2] * 
ŞdAxis
.
	`g‘Z
());

731 
axis
 *ğ
švSÿË
;

733 
h®fAngË
 = 
	`acos
(
objQu©
.
	`g‘W
());

734 
sšH®fAngË
 = 
	`sš
(
h®fAngË
);

736 
objQu©
.
	`£tX
(
axis
.
	`g‘X
(è* 
sšH®fAngË
);

737 
objQu©
.
	`£tY
(
axis
.
	`g‘Y
(è* 
sšH®fAngË
);

738 
objQu©
.
	`£tZ
(
axis
.
	`g‘Z
(è* 
sšH®fAngË
);

741 
cÚŒŞ
->
	`pœou‘‹TeS‘
(
objQu©
);

742 
	}
}

744 
	gT¿ckb®l
::
	$´štM©rix
() const

746 
i
, 
j
;

747 
i
 = 0; i < 4; i++) {

748 
j
 = 0; j < 3; j++)

749 
cout
 << 
ŒªsfÜmM©rix
[
j
][
i
] << ", ";

750 
cout
 << 
ŒªsfÜmM©rix
[3][
i
] << '\n';

752 
cout
 << 
æush
;

753 
	}
}

755 cÚ¡ *
	gÇmes
[] = {

761 cÚ¡ * 
	gT¿ckb®l
::
	$g‘Mou£Mode
() const

763  
Çmes
[(è
ŒackMode
];

764 
	}
}

	@readOldObjectFile.cpp

1 
	~<¡d¬g.h
>

2 
	~"M3DObjeù.h
"

3 
	~"M3DQuadFigu».h
"

4 
	~"Regi¡ry.h
"

6 
M3DPrim™ive
 * 
	$»adPrim™ive
(
Regi¡ry
 &
»g
, * 
»gSŒ
, ...)

8 
ÃwSŒ
[1024];

10 
va_li¡
 
v®
;

11 
	`va_¡¬t
(
v®
, 
»gSŒ
);

12 
	`v¥rštf
(
ÃwSŒ
, 
»gSŒ
, 
v®
);

13 
	`va_’d
(
v®
);

15 
	`¡rÿt
(
ÃwSŒ
, ".%s");

17 
x
, 
y
, 
z
, 
r
, 
th‘a
;

18 
Qu©
 
q
;

19 
boŞ
 
£Ëùed
;

21 
M3DPrim™ive
 * 
´im
;

23 
x
 = 
»g
.
	`g‘DoubËV®ue
(
ÃwSŒ
, 0.0, "x");

24 
y
 = 
»g
.
	`g‘DoubËV®ue
(
ÃwSŒ
, 0.0, "y");

25 
z
 = 
»g
.
	`g‘DoubËV®ue
(
ÃwSŒ
, 0.0, "z");

26 
r
 = 
»g
.
	`g‘DoubËV®ue
(
ÃwSŒ
, 0.0, "r");

27 
q
.
	`£tX
(
»g
.
	`g‘DoubËV®ue
(
ÃwSŒ
, 0.0, "qx"));

28 
q
.
	`£tY
(
»g
.
	`g‘DoubËV®ue
(
ÃwSŒ
, 0.0, "qy"));

29 
q
.
	`£tZ
(
»g
.
	`g‘DoubËV®ue
(
ÃwSŒ
, 0.0, "qz"));

30 
q
.
	`£tW
(
»g
.
	`g‘DoubËV®ue
(
ÃwSŒ
, 0.0, "qw"));

31 
th‘a
 = 
»g
.
	`g‘DoubËV®ue
(
ÃwSŒ
, 0.0, "th‘a"è* 
R_DEGREES_TO_RADIANS
;

32 
£Ëùed
 = 
»g
.
	`g‘BoŞ—nV®ue
(
ÃwSŒ
, 0, "selected");

34 if(
th‘a
 > 
R_HALF_PI
)

37 
th‘a
 = 
R_PI
 -heta;

40 
Qu©
 
rÙQ
;

41 
rÙQ
.
	`£tAxisAngË
(
	`VeùÜ3D
(0.0, 1.0, 0.0), 
R_PI
);

43 
q
 = q * 
rÙQ
;

46 
´im
 = 
Ãw
 
	`M3DQuadPrim™ive
(
x
, 
y
, 
z
, 
r
, 
q
, 
th‘a
);

48 if(
£Ëùed
)

49 
´im
->
	`£Ëù
();

51  
´im
;

52 
	}
}

54 
M3DObjeù
 * 
	$»adOldObjeùFe
(cÚ¡ * 
f’ame
)

56 
Regi¡ry
 
»g
;

57 
M3DObjeù
 * 
objeù
;

58 
M3DQuadFigu»
 * 
fig
;

59 
M3DPrim™ive
 * 
´im
;

61 
figcouÁ
;

62 
¦iûcouÁ
;

63 
´imcouÁ
;

64 
i
, 
j
, 
k
;

66 
cŞÜ
[3];

68 
–Úg©iÚ
;

70 
Œy
 {

71 
»g
.
	`»adFromFe
(
f’ame
);

73 
	`ÿtch
 (
RExû±iÚ
 
exı
) {

74 
exı
.
	`´št
(
¡d
::
cout
);

75  
NULL
;

78 
objeù
 = 
Ãw
 
M3DObjeù
;

80 
figcouÁ
 = 
»g
.
	`g‘IÁV®ue
("model.figureCount", 0);

81 
i
 = 0; i < 
figcouÁ
; i++)

83 
¦iûcouÁ
 = 
»g
.
	`g‘IÁV®ue
("mod–.figu»[%d].¦iûCouÁ", 0, 
i
);

84 
´imcouÁ
 = 
»g
.
	`g‘IÁV®ue
("mod–.figu»[%d].¦iû[0].´im™iveCouÁ", 0, 
i
);

86 
fig
 = 
Ãw
 
	`M3DQuadFigu»
(
¦iûcouÁ
, 
´imcouÁ
);

88 
cŞÜ
[0] = 
»g
.
	`g‘DoubËV®ue
("mod–.figu»[%d].cŞÜ.»d", 
DEFAULT_FIGURE_COLOR
[0], 
i
);

89 
cŞÜ
[1] = 
»g
.
	`g‘DoubËV®ue
("mod–.figu»[%d].cŞÜ.g»’", 
DEFAULT_FIGURE_COLOR
[1], 
i
);

90 
cŞÜ
[2] = 
»g
.
	`g‘DoubËV®ue
("mod–.figu»[%d].cŞÜ.blue", 
DEFAULT_FIGURE_COLOR
[2], 
i
);

92 
fig
->
	`£tCŞÜ
(&(
cŞÜ
[0]));

94 
j
 = 0; j < 
¦iûcouÁ
; j++)

96 
´imcouÁ
 = 
»g
.
	`g‘IÁV®ue
("mod–.figu»[%d].¦iû[%d].´im™iveCouÁ", 0,
i
,
j
);

97 
k
 = 0; k < 
´imcouÁ
; k++)

99 
´im
 = 
	`»adPrim™ive
(
»g
, "mod–.figu»[%d].¦iû[%d].´im™ive[%d]", 
i
, 
j
, 
k
);

100 if(
j
 =ğ0 || j =ğ
¦iûcouÁ
 - 1 || 
k
 =ğ0 || k =ğ
´imcouÁ
 - 1)

102 
–Úg©iÚ
 = 
»g
.
	`g‘DoubËV®ue
("mod–.figu»[%d].¦iû[%d].´im™ive[%d].®pha", 1.0, 
i
, 
j
, 
k
);

104 
¡d
::
cout
 << 
__FILE__
 << ":" << 
__LINE__
 << ": codmighˆb»ak." << std::
’dl
;

105 
´im
 = 
Ãw
 
	`M3DQuadEndPrim™ive
Õrim->
	`g‘X
(),…rim->
	`g‘R
(),

106 
´im
->
	`g‘Q
(),´im->
	`g‘Th‘a
(), 
–Úg©iÚ
);

109 
fig
->
	`£tPrim™ivePŒ
(
j
, 
k
, 
´im
);

112 
fig
->
	`£tModif›d
(
Œue
);

115 
objeù
->
	`addFigu»
(
fig
);

118  
objeù
;

119 
	}
}

	@/usr/include/errno.h

22 #iâdef 
_ERRNO_H


26 #iâdef 
__Ãed_Em©h


27 
	#_ERRNO_H
 1

	)

28 
	~<ã©u»s.h
>

31 
	g__BEGIN_DECLS


35 
	~<b™s/”ºo.h
>

36 #undeà
__Ãed_Em©h


38 #ifdef 
_ERRNO_H


45 #iâdef 
”ºo


46 
”ºo
;

49 #ifdeà
__USE_GNU


54 *
´og¿m_švoÿtiÚ_Çme
, *
´og¿m_švoÿtiÚ_shÜt_Çme
;

58 
	g__END_DECLS


66 #ià
defšed
 
__USE_GNU
 || defšed 
__Ãed_”rÜ_t


67 #iâdeà
__”rÜ_t_defšed


68 
	t”rÜ_t
;

69 
	#__”rÜ_t_defšed
 1

	)

71 #undeà
__Ãed_”rÜ_t


	@/usr/include/limits.h

22 #iâdeà
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	~<ã©u»s.h
>

31 
	#MB_LEN_MAX
 16

	)

36 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

41 #iâdeà
_LIMITS_H


42 
	#_LIMITS_H
 1

	)

44 
	~<b™s/wÜdsize.h
>

53 
	#CHAR_BIT
 8

	)

56 
	#SCHAR_MIN
 (-128)

	)

57 
	#SCHAR_MAX
 127

	)

60 
	#UCHAR_MAX
 255

	)

63 #ifdeà
__CHAR_UNSIGNED__


64 
	#CHAR_MIN
 0

	)

65 
	#CHAR_MAX
 
UCHAR_MAX


	)

67 
	#CHAR_MIN
 
SCHAR_MIN


	)

68 
	#CHAR_MAX
 
SCHAR_MAX


	)

72 
	#SHRT_MIN
 (-32768)

	)

73 
	#SHRT_MAX
 32767

	)

76 
	#USHRT_MAX
 65535

	)

79 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

80 
	#INT_MAX
 2147483647

	)

83 
	#UINT_MAX
 4294967295U

	)

86 #ià
__WORDSIZE
 == 64

87 
	#LONG_MAX
 9223372036854775807L

	)

89 
	#LONG_MAX
 2147483647L

	)

91 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

94 #ià
__WORDSIZE
 == 64

95 
	#ULONG_MAX
 18446744073709551615UL

	)

97 
	#ULONG_MAX
 4294967295UL

	)

100 #ifdeà
__USE_ISOC99


103 
	#LLONG_MAX
 9223372036854775807LL

	)

104 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

107 
	#ULLONG_MAX
 18446744073709551615ULL

	)

121 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


123 #šşude_Ãxˆ<
lim™s
.
h
>

129 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


130 #iâdeà
LLONG_MIN


131 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

133 #iâdeà
LLONG_MAX


134 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

136 #iâdeà
ULLONG_MAX


137 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

141 #ifdef 
__USE_POSIX


143 
	~<b™s/posix1_lim.h
>

146 #ifdef 
__USE_POSIX2


147 
	~<b™s/posix2_lim.h
>

150 #ifdef 
__USE_XOPEN


151 
	~<b™s/xİ’_lim.h
>

	@/usr/include/math.h

23 #iâdef 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


32 
	~<b™s/huge_v®.h
>

33 #ifdeà
__USE_ISOC99


34 
	~<b™s/huge_v®f.h
>

35 
	~<b™s/huge_v®l.h
>

38 
	~<b™s/šf.h
>

41 
	~<b™s/Çn.h
>

45 
	~<b™s/m©hdef.h
>

52 
	#__MATHCALL
(
funùiÚ
,
suffix
, 
¬gs
) \

53 
	`__MATHDECL
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
)

	)

54 
	#__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

55 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
); \

56 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
)

	)

57 
	#__MATHCALLX
(
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

58 
	`__MATHDECLX
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
)

	)

59 
	#__MATHDECLX
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

60 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
); \

61 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
)

	)

62 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

63 
ty³
 
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
è
¬gs
 
__THROW


	)

65 
	#_MdoubË_
 

	)

66 
	#__MATH_PRECNAME
(
Çme
,
r
è
	`__CONCAT
Òame,r)

	)

67 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

68 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

69 
	~<b™s/m©hÿÎs.h
>

70 #undeà
_MdoubË_


71 #undeà
_MdoubË_BEGIN_NAMESPACE


72 #undeà
_MdoubË_END_NAMESPACE


73 #undeà
__MATH_PRECNAME


75 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


81 #iâdeà
_Mæßt_


82 
	#_Mæßt_
 

	)

84 
	#_MdoubË_
 
_Mæßt_


	)

85 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f
##
	)
r

86 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

87 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

88 
	~<b™s/m©hÿÎs.h
>

89 #undeà
_MdoubË_


90 #undeà
_MdoubË_BEGIN_NAMESPACE


91 #undeà
_MdoubË_END_NAMESPACE


92 #undeà
__MATH_PRECNAME


94 #ià!(
defšed
 
__NO_LONG_DOUBLE_MATH
 && defšed 
_LIBC
) \

95 || 
defšed
 
__LDBL_COMPAT


96 #ifdeà
__LDBL_COMPAT


98 #ifdeà
__USE_ISOC99


99 
	$__Ædbl_Ãx‰ow¬df
 (
__x
, 
__y
)

100 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

101 #ifdeà
__REDIRECT_NTH


102 
	`__REDIRECT_NTH
 (
Ãx‰ow¬df
, (
__x
, 
__y
),

103 
__Ædbl_Ãx‰ow¬df
)

104 
	`__©Œibu‹__
 ((
__cÚ¡__
));

105 
	`__REDIRECT_NTH
 (
Ãx‰ow¬d
, (
__x
, 
__y
),

106 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

107 
	`__REDIRECT_NTH
 (
Ãx‰ow¬dl
,

108 (
__x
, 
__y
),

109 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

113 #undeà
__MATHDECL_1


114 
	#__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
®Ÿs
) \

115 
ty³
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
), \

116 
¬gs
, 
®Ÿs
)

	)

117 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

118 
	`__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
	`__CONCAT
(funùiÚ,suffix))

	)

124 #iâdeà
_MlÚg_doubË_


125 
	#_MlÚg_doubË_
 

	)

127 
	#_MdoubË_
 
_MlÚg_doubË_


	)

128 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
l
##
	)
r

129 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

130 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

131 
	#__MATH_DECLARE_LDOUBLE
 1

	)

132 
	~<b™s/m©hÿÎs.h
>

133 #undeà
_MdoubË_


134 #undeà
_MdoubË_BEGIN_NAMESPACE


135 #undeà
_MdoubË_END_NAMESPACE


136 #undeà
__MATH_PRECNAME


141 #undeà
__MATHDECL_1


142 #undeà
__MATHDECL


143 #undeà
__MATHCALL


146 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


148 
signgam
;

153 #ifdeà
__USE_ISOC99


191 
FP_NAN
 =

192 
	#FP_NAN
 0

	)

193 
FP_NAN
,

194 
FP_INFINITE
 =

195 
	#FP_INFINITE
 1

	)

196 
FP_INFINITE
,

197 
FP_ZERO
 =

198 
	#FP_ZERO
 2

	)

199 
FP_ZERO
,

200 
FP_SUBNORMAL
 =

201 
	#FP_SUBNORMAL
 3

	)

202 
FP_SUBNORMAL
,

203 
FP_NORMAL
 =

204 
	#FP_NORMAL
 4

	)

205 
FP_NORMAL


209 #ifdeà
__NO_LONG_DOUBLE_MATH


210 
	#åşassify
(
x
) \

211 ( (
x
è=ğ (è? 
	`__åşassifyf
 (xè: 
	`__åşassify
 (x))

	)

213 
	#åşassify
(
x
) \

214 ( (
x
) ==  () \

215 ? 
	`__åşassifyf
 (
x
) \

216 :  (
x
) ==  () \

217 ? 
	`__åşassify
 (
x
è: 
	`__åşassifyl
 (x))

	)

221 #ifdeà
__NO_LONG_DOUBLE_MATH


222 
	#signb™
(
x
) \

223 ( (
x
è=ğ (è? 
	`__signb™f
 (xè: 
	`__signb™
 (x))

	)

225 
	#signb™
(
x
) \

226 ( (
x
) ==  () \

227 ? 
	`__signb™f
 (
x
) \

228 :  (
x
) ==  () \

229 ? 
	`__signb™
 (
x
è: 
	`__signb™l
 (x))

	)

233 #ifdeà
__NO_LONG_DOUBLE_MATH


234 
	#isfš™e
(
x
) \

235 ( (
x
è=ğ (è? 
	`__fš™ef
 (xè: 
	`__fš™e
 (x))

	)

237 
	#isfš™e
(
x
) \

238 ( (
x
) ==  () \

239 ? 
	`__fš™ef
 (
x
) \

240 :  (
x
) ==  () \

241 ? 
	`__fš™e
 (
x
è: 
	`__fš™–
 (x))

	)

245 
	#i¢Üm®
(
x
è(
	`åşassify
 (xè=ğ
FP_NORMAL
)

	)

249 #ifdeà
__NO_LONG_DOUBLE_MATH


250 
	#i¢ª
(
x
) \

251 ( (
x
è=ğ (è? 
	`__i¢ªf
 (xè: 
	`__i¢ª
 (x))

	)

253 
	#i¢ª
(
x
) \

254 ( (
x
) ==  () \

255 ? 
	`__i¢ªf
 (
x
) \

256 :  (
x
) ==  () \

257 ? 
	`__i¢ª
 (
x
è: 
	`__i¢ªl
 (x))

	)

261 #ifdeà
__NO_LONG_DOUBLE_MATH


262 
	#isšf
(
x
) \

263 ( (
x
è=ğ (è? 
	`__isšff
 (xè: 
	`__isšf
 (x))

	)

265 
	#isšf
(
x
) \

266 ( (
x
) ==  () \

267 ? 
	`__isšff
 (
x
) \

268 :  (
x
) ==  () \

269 ? 
	`__isšf
 (
x
è: 
	`__isšæ
 (x))

	)

273 
	#MATH_ERRNO
 1

	)

274 
	#MATH_ERREXCEPT
 2

	)

279 #iâdeà
__FAST_MATH__


280 
	#m©h_”rhªdlšg
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

285 #ifdeà
__USE_GNU


287 #ifdeà
__NO_LONG_DOUBLE_MATH


288 
	#issigÇlšg
(
x
) \

289 ( (
x
è=ğ (è? 
	`__issigÇlšgf
 (xè: 
	`__issigÇlšg
 (x))

	)

291 
	#issigÇlšg
(
x
) \

292 ( (
x
) ==  () \

293 ? 
	`__issigÇlšgf
 (
x
) \

294 :  (
x
) ==  () \

295 ? 
	`__issigÇlšg
 (
x
è: 
	`__issigÇlšgl
 (x))

	)

299 #ifdef 
__USE_MISC


303 
_IEEE_
 = -1,

304 
_SVID_
,

305 
_XOPEN_
,

306 
_POSIX_
,

307 
_ISOC_


308 } 
	t_LIB_VERSION_TYPE
;

313 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

317 #ifdeà
__USE_SVID


323 #ifdeà
__ılu¥lus


324 
__exû±iÚ


326 
exû±iÚ


329 
ty³
;

330 *
Çme
;

331 
¬g1
;

332 
¬g2
;

333 
»tv®
;

334 
	}
};

336 #ifdeà
__ılu¥lus


337 
	$m©h”r
 (
__exû±iÚ
 *
__exc
è
	`throw
 ();

339 
	`m©h”r
 (
exû±iÚ
 *
__exc
);

342 
	#X_TLOSS
 1.41484755040568800000e+16

	)

345 
	#DOMAIN
 1

	)

346 
	#SING
 2

	)

347 
	#OVERFLOW
 3

	)

348 
	#UNDERFLOW
 4

	)

349 
	#TLOSS
 5

	)

350 
	#PLOSS
 6

	)

353 
	#HUGE
 3.40282347e+38F

	)

357 #ifdeà
__USE_XOPEN


359 
	#MAXFLOAT
 3.40282347e+38F

	)

366 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


367 
	#M_E
 2.7182818284590452354

	)

368 
	#M_LOG2E
 1.4426950408889634074

	)

369 
	#M_LOG10E
 0.43429448190325182765

	)

370 
	#M_LN2
 0.69314718055994530942

	)

371 
	#M_LN10
 2.30258509299404568402

	)

372 
	#M_PI
 3.14159265358979323846

	)

373 
	#M_PI_2
 1.57079632679489661923

	)

374 
	#M_PI_4
 0.78539816339744830962

	)

375 
	#M_1_PI
 0.31830988618379067154

	)

376 
	#M_2_PI
 0.63661977236758134308

	)

377 
	#M_2_SQRTPI
 1.12837916709551257390

	)

378 
	#M_SQRT2
 1.41421356237309504880

	)

379 
	#M_SQRT1_2
 0.70710678118654752440

	)

385 #ifdeà
__USE_GNU


386 
	#M_El
 2.718281828459045235360287471352662498L

	)

387 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

388 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

389 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

390 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

391 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

392 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

393 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

394 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

395 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

396 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

397 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

398 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

405 #ià
defšed
 
__STRICT_ANSI__
 && !defšed 
__NO_MATH_INLINES


406 
	#__NO_MATH_INLINES
 1

	)

409 #ià
defšed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

416 
	#isg»©”
(
x
, 
y
è
	`__butš_isg»©”
(x, y)

	)

417 
	#isg»©”equ®
(
x
, 
y
è
	`__butš_isg»©”equ®
(x, y)

	)

418 
	#i¦ess
(
x
, 
y
è
	`__butš_i¦ess
(x, y)

	)

419 
	#i¦es£qu®
(
x
, 
y
è
	`__butš_i¦es£qu®
(x, y)

	)

420 
	#i¦essg»©”
(
x
, 
y
è
	`__butš_i¦essg»©”
(x, y)

	)

421 
	#isunÜd”ed
(
u
, 
v
è
	`__butš_isunÜd”ed
(u, v)

	)

425 #ifdeà
__USE_EXTERN_INLINES


426 
	~<b™s/m©hšlše.h
>

431 #ià
defšed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

432 
	~<b™s/m©h-fš™e.h
>

435 #ifdeà
__USE_ISOC99


439 #iâdeà
isg»©”


440 
	#isg»©”
(
x
, 
y
) \

441 (
__ex‹nsiÚ__
 \

442 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

443 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x > __y; 
	}
}))

	)

447 #iâdeà
isg»©”equ®


448 
	#isg»©”equ®
(
x
, 
y
) \

449 (
__ex‹nsiÚ__
 \

450 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

451 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x >ğ__y; }))

	)

455 #iâdeà
i¦ess


456 
	#i¦ess
(
x
, 
y
) \

457 (
__ex‹nsiÚ__
 \

458 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

459 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x < __y; }))

	)

463 #iâdeà
i¦es£qu®


464 
	#i¦es£qu®
(
x
, 
y
) \

465 (
__ex‹nsiÚ__
 \

466 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

467 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x <ğ__y; }))

	)

471 #iâdeà
i¦essg»©”


472 
	#i¦essg»©”
(
x
, 
y
) \

473 (
__ex‹nsiÚ__
 \

474 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

475 !
	`isunÜd”ed
 (
__x
, 
__y
è&& (__x < __y || __y < __x); }))

	)

479 #iâdeà
isunÜd”ed


480 
	#isunÜd”ed
(
u
, 
v
) \

481 (
__ex‹nsiÚ__
 \

482 ({ 
	`__ty³of__
(
u
è
__u
 = (u); __ty³of__(
v
è
__v
 = (v); \

483 
	`åşassify
 (
__u
è=ğ
FP_NAN
 || fpşassify (
__v
è=ğFP_NAN; }))

	)

488 
	g__END_DECLS


	@/usr/include/memory.h

22 #iâdef 
_MEMORY_H


23 
	#_MEMORY_H
 1

	)

25 
	~<ã©u»s.h
>

28 #iâdef 
_STRING_H


29 
	~<¡ršg.h
>

	@/usr/include/stdio.h

23 #iâdeà
_STDIO_H


25 #ià!
defšed
 
__Ãed_FILE
 && !defšed 
__Ãed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	~<b™s/ty³s.h
>

36 
	#__Ãed_FILE


	)

37 
	#__Ãed___FILE


	)

41 #ià!
defšed
 
__FILE_defšed
 && defšed 
__Ãed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #ià
defšed
 
__USE_LARGEFILE64
 || defšed 
__USE_SVID
 || defšed 
__USE_POSIX
 \

51 || 
defšed
 
	g__USE_BSD
 || defšed 
	g__USE_ISOC99
 || defšed 
	g__USE_XOPEN
 \

52 || 
defšed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_defšed
 1

	)

58 #undeà
__Ãed_FILE


61 #ià!
defšed
 
____FILE_defšed
 && defšed 
__Ãed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_defšed
 1

	)

68 #undeà
__Ãed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


77 #ifdeà
__GNUC__


78 #iâdeà
_VA_LIST_DEFINED


79 
_G_va_li¡
 
	tva_li¡
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<¡d¬g.h
>

87 #ifdeà
__USE_XOPEN2K8


88 #iâdeà
__off_t_defšed


89 #iâdeà
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_defšed


	)

96 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_defšed


	)

101 #iâdeà
__ssize_t_defšed


102 
__ssize_t
 
	tssize_t
;

103 
	#__ssize_t_defšed


	)

108 
__BEGIN_NAMESPACE_STD


109 #iâdeà
__USE_FILE_OFFSET64


110 
_G_åos_t
 
	tåos_t
;

112 
_G_åos64_t
 
	tåos_t
;

114 
__END_NAMESPACE_STD


115 #ifdeà
__USE_LARGEFILE64


116 
_G_åos64_t
 
	tåos64_t
;

120 
	#_IOFBF
 0

	)

121 
	#_IOLBF
 1

	)

122 
	#_IONBF
 2

	)

126 #iâdeà
BUFSIZ


127 
	#BUFSIZ
 
_IO_BUFSIZ


	)

133 #iâdeà
EOF


134 
	#EOF
 (-1)

	)

140 
	#SEEK_SET
 0

	)

141 
	#SEEK_CUR
 1

	)

142 
	#SEEK_END
 2

	)

143 #ifdeà
__USE_GNU


144 
	#SEEK_DATA
 3

	)

145 
	#SEEK_HOLE
 4

	)

149 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


151 
	#P_tmpdœ
 "/tmp"

	)

164 
	~<b™s/¡dio_lim.h
>

168 
_IO_FILE
 *
¡dš
;

169 
_IO_FILE
 *
¡dout
;

170 
_IO_FILE
 *
¡d”r
;

172 
	#¡dš
 
¡dš


	)

173 
	#¡dout
 
¡dout


	)

174 
	#¡d”r
 
¡d”r


	)

176 
__BEGIN_NAMESPACE_STD


178 
	$»move
 (cÚ¡ *
__f’ame
è
__THROW
;

180 
	$»Çme
 (cÚ¡ *
__Şd
, cÚ¡ *
__Ãw
è
__THROW
;

181 
__END_NAMESPACE_STD


183 #ifdeà
__USE_ATFILE


185 
	$»Çm—t
 (
__Şdfd
, cÚ¡ *
__Şd
, 
__Ãwfd
,

186 cÚ¡ *
__Ãw
è
__THROW
;

189 
__BEGIN_NAMESPACE_STD


194 #iâdeà
__USE_FILE_OFFSET64


195 
FILE
 *
	$tmpfe
 (è
__wur
;

197 #ifdeà
__REDIRECT


198 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

200 
	#tmpfe
 
tmpfe64


	)

204 #ifdeà
__USE_LARGEFILE64


205 
FILE
 *
	$tmpfe64
 (è
__wur
;

209 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

210 
__END_NAMESPACE_STD


212 #ifdeà
__USE_MISC


215 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

219 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


227 *
	$‹m²am
 (cÚ¡ *
__dœ
, cÚ¡ *
__pfx
)

228 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

232 
__BEGIN_NAMESPACE_STD


237 
	`fşo£
 (
FILE
 *
__¡»am
);

242 
	`fæush
 (
FILE
 *
__¡»am
);

243 
__END_NAMESPACE_STD


245 #ifdeà
__USE_MISC


252 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

255 #ifdeà
__USE_GNU


262 
	`fşo£®l
 ();

266 
__BEGIN_NAMESPACE_STD


267 #iâdeà
__USE_FILE_OFFSET64


272 
FILE
 *
	$fİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

273 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

278 
FILE
 *
	$äeİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

279 cÚ¡ *
__»¡riù
 
__modes
,

280 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

282 #ifdeà
__REDIRECT


283 
FILE
 *
	`__REDIRECT
 (
fİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

284 cÚ¡ *
__»¡riù
 
__modes
), 
fİ’64
)

285 
__wur
;

286 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

287 cÚ¡ *
__»¡riù
 
__modes
,

288 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

289 
__wur
;

291 
	#fİ’
 
fİ’64


	)

292 
	#äeİ’
 
äeİ’64


	)

295 
__END_NAMESPACE_STD


296 #ifdeà
__USE_LARGEFILE64


297 
FILE
 *
	$fİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

298 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

299 
FILE
 *
	$äeİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

300 cÚ¡ *
__»¡riù
 
__modes
,

301 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

304 #ifdef 
__USE_POSIX


306 
FILE
 *
	$fdİ’
 (
__fd
, cÚ¡ *
__modes
è
__THROW
 
__wur
;

309 #ifdef 
__USE_GNU


312 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

313 cÚ¡ *
__»¡riù
 
__modes
,

314 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

317 #ifdeà
__USE_XOPEN2K8


319 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, cÚ¡ *
__modes
)

320 
__THROW
 
__wur
;

325 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

329 
__BEGIN_NAMESPACE_STD


332 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

336 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

337 
__modes
, 
size_t
 
__n
è
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdef 
__USE_BSD


343 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

344 
size_t
 
__size
è
__THROW
;

347 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

351 
__BEGIN_NAMESPACE_STD


356 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

357 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

362 
	`´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

364 
	$¥rštf
 (*
__»¡riù
 
__s
,

365 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

371 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

372 
_G_va_li¡
 
__¬g
);

377 
	`v´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

379 
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

380 
_G_va_li¡
 
__¬g
è
__THROWNL
;

381 
__END_NAMESPACE_STD


383 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_ISOC99
 || defšed 
__USE_UNIX98


384 
__BEGIN_NAMESPACE_C99


386 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

387 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

388 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

390 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

391 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

392 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

393 
__END_NAMESPACE_C99


396 #ifdeà
__USE_GNU


399 
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__f
,

400 
_G_va_li¡
 
__¬g
)

401 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

402 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

403 cÚ¡ *
__»¡riù
 
__fmt
, ...)

404 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

405 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

406 cÚ¡ *
__»¡riù
 
__fmt
, ...)

407 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

410 #ifdeà
__USE_XOPEN2K8


412 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
,

413 
_G_va_li¡
 
__¬g
)

414 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

415 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

416 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

420 
__BEGIN_NAMESPACE_STD


425 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

426 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

431 
	$sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

433 
	$ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

434 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

436 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

437 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

438 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

439 #ifdeà
__REDIRECT


443 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

444 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

445 
__isoc99_fsÿnf
è
__wur
;

446 
	`__REDIRECT
 (
sÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

447 
__isoc99_sÿnf
è
__wur
;

448 
	`__REDIRECT_NTH
 (
ssÿnf
, (cÚ¡ *
__»¡riù
 
__s
,

449 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

450 
__isoc99_ssÿnf
);

452 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

453 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

454 
	$__isoc99_sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

455 
	$__isoc99_ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

456 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

457 
	#fsÿnf
 
__isoc99_fsÿnf


	)

458 
	#sÿnf
 
__isoc99_sÿnf


	)

459 
	#ssÿnf
 
__isoc99_ssÿnf


	)

463 
__END_NAMESPACE_STD


465 #ifdef 
__USE_ISOC99


466 
__BEGIN_NAMESPACE_C99


471 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

472 
_G_va_li¡
 
__¬g
)

473 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

479 
	$vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

480 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

483 
	$vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

484 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

485 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

487 #ià!
defšed
 
__USE_GNU
 \

488 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

489 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

490 #ifdeà
__REDIRECT


494 
	`__REDIRECT
 (
vfsÿnf
,

495 (
FILE
 *
__»¡riù
 
__s
,

496 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

497 
__isoc99_vfsÿnf
)

498 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

499 
	`__REDIRECT
 (
vsÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
,

500 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

501 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

502 
	`__REDIRECT_NTH
 (
vssÿnf
,

503 (cÚ¡ *
__»¡riù
 
__s
,

504 cÚ¡ *
__»¡riù
 
__fÜm©
,

505 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

506 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

508 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

509 cÚ¡ *
__»¡riù
 
__fÜm©
,

510 
_G_va_li¡
 
__¬g
è
__wur
;

511 
	$__isoc99_vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
,

512 
_G_va_li¡
 
__¬g
è
__wur
;

513 
	$__isoc99_vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

514 cÚ¡ *
__»¡riù
 
__fÜm©
,

515 
_G_va_li¡
 
__¬g
è
__THROW
;

516 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

517 
	#vsÿnf
 
__isoc99_vsÿnf


	)

518 
	#vssÿnf
 
__isoc99_vssÿnf


	)

522 
__END_NAMESPACE_C99


526 
__BEGIN_NAMESPACE_STD


531 
	`fg‘c
 (
FILE
 *
__¡»am
);

532 
	`g‘c
 (
FILE
 *
__¡»am
);

538 
	`g‘ch¬
 ();

539 
__END_NAMESPACE_STD


543 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

545 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


550 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

551 
	`g‘ch¬_uÆocked
 ();

554 #ifdeà
__USE_MISC


561 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

565 
__BEGIN_NAMESPACE_STD


573 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

574 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

580 
	`putch¬
 (
__c
);

581 
__END_NAMESPACE_STD


585 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

587 #ifdeà
__USE_MISC


594 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

597 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


602 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

603 
	`putch¬_uÆocked
 (
__c
);

607 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 \

608 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

610 
	`g‘w
 (
FILE
 *
__¡»am
);

613 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

617 
__BEGIN_NAMESPACE_STD


622 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

623 
__wur
;

625 #ià!
defšed
 
__USE_ISOC11
 \

626 || (
defšed
 
__ılu¥lus
 && __cplusplus <= 201103L)

638 *
	$g‘s
 (*
__s
è
__wur
 
__©Œibu‹_d•»ÿ‹d__
;

640 
__END_NAMESPACE_STD


642 #ifdeà
__USE_GNU


649 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

650 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

654 #ifdef 
__USE_XOPEN2K8


665 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

666 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

667 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

668 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

669 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

670 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

678 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

679 
size_t
 *
__»¡riù
 
__n
,

680 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

684 
__BEGIN_NAMESPACE_STD


689 
	`åuts
 (cÚ¡ *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

695 
	`puts
 (cÚ¡ *
__s
);

702 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

709 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

710 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

715 
size_t
 
	`fwr™e
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

716 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

717 
__END_NAMESPACE_STD


719 #ifdeà
__USE_GNU


726 
	`åuts_uÆocked
 (cÚ¡ *
__»¡riù
 
__s
,

727 
FILE
 *
__»¡riù
 
__¡»am
);

730 #ifdeà
__USE_MISC


737 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

738 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

739 
size_t
 
	`fwr™e_uÆocked
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

740 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

744 
__BEGIN_NAMESPACE_STD


749 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

754 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

759 
	`»wšd
 (
FILE
 *
__¡»am
);

760 
__END_NAMESPACE_STD


767 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


768 #iâdeà
__USE_FILE_OFFSET64


773 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

778 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

780 #ifdeà
__REDIRECT


781 
	`__REDIRECT
 (
f£eko
,

782 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

783 
f£eko64
);

784 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

786 
	#f£eko
 
f£eko64


	)

787 
	#á–lo
 
á–lo64


	)

792 
__BEGIN_NAMESPACE_STD


793 #iâdeà
__USE_FILE_OFFSET64


798 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

803 
	`f£os
 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
);

805 #ifdeà
__REDIRECT


806 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

807 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

808 
	`__REDIRECT
 (
f£os
,

809 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
), 
f£os64
);

811 
	#fg‘pos
 
fg‘pos64


	)

812 
	#f£os
 
f£os64


	)

815 
__END_NAMESPACE_STD


817 #ifdeà
__USE_LARGEFILE64


818 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

819 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

820 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

821 
	`f£os64
 (
FILE
 *
__¡»am
, cÚ¡ 
åos64_t
 *
__pos
);

824 
__BEGIN_NAMESPACE_STD


826 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

828 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

830 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

831 
__END_NAMESPACE_STD


833 #ifdeà
__USE_MISC


835 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

836 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

837 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

841 
__BEGIN_NAMESPACE_STD


846 
	`³¼Ü
 (cÚ¡ *
__s
);

847 
__END_NAMESPACE_STD


853 
	~<b™s/sys_”¾i¡.h
>

856 #ifdef 
__USE_POSIX


858 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

861 #ifdeà
__USE_MISC


863 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

867 #ià(
defšed
 
__USE_POSIX2
 || defšed 
__USE_SVID
 || defšed 
__USE_BSD
 || \

868 
defšed
 
__USE_MISC
)

873 
FILE
 *
	$pİ’
 (cÚ¡ *
__commªd
, cÚ¡ *
__modes
è
__wur
;

879 
	`pşo£
 (
FILE
 *
__¡»am
);

883 #ifdef 
__USE_POSIX


885 *
	$ù”mid
 (*
__s
è
__THROW
;

889 #ifdeà
__USE_XOPEN


891 *
	`cu£rid
 (*
__s
);

895 #ifdef 
__USE_GNU


896 
ob¡ack
;

899 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

900 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

901 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

902 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

903 cÚ¡ *
__»¡riù
 
__fÜm©
,

904 
_G_va_li¡
 
__¬gs
)

905 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

909 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


913 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

917 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

920 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

923 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


927 
	#__Ãed_g‘İt


	)

928 
	~<g‘İt.h
>

933 #ifdeà
__USE_EXTERN_INLINES


934 
	~<b™s/¡dio.h
>

936 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__ex‹º_®ways_šlše


937 
	~<b™s/¡dio2.h
>

939 #ifdeà
__LDBL_COMPAT


940 
	~<b™s/¡dio-ldbl.h
>

943 
__END_DECLS


	@/usr/include/stdlib.h

22 #iâdef 
_STDLIB_H


24 
	~<ã©u»s.h
>

27 
	#__Ãed_size_t


	)

28 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


29 
	#__Ãed_wch¬_t


	)

30 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

34 
	g__BEGIN_DECLS


36 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


37 
	#_STDLIB_H
 1

	)

39 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


41 
	~<b™s/wa™æags.h
>

42 
	~<b™s/wa™¡©us.h
>

44 #ifdeà
__USE_BSD


49 #ià
defšed
 
__GNUC__
 && !defšed 
__ılu¥lus


50 
	#__WAIT_INT
(
¡©us
) \

51 (
	`__ex‹nsiÚ__
 (((uniÚ { 
	`__ty³of
(
¡©us
è
__š
; 
__i
; }) \

52 { .
__š
 = (
¡©us
è}).
__i
))

	)

54 
	#__WAIT_INT
(
¡©us
è(*(*è&(¡©us))

	)

62 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2 || defšed 
__ılu¥lus


63 
	#__WAIT_STATUS
 *

	)

64 
	#__WAIT_STATUS_DEFN
 *

	)

69 
wa™
 *
	m__u±r
;

70 *
	m__Œ
;

71 } 
	t__WAIT_STATUS
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

72 
	#__WAIT_STATUS_DEFN
 *

	)

77 
	#__WAIT_INT
(
¡©us
è(¡©us)

	)

78 
	#__WAIT_STATUS
 *

	)

79 
	#__WAIT_STATUS_DEFN
 *

	)

84 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (
	`__WAIT_INT
 (¡©us))

	)

85 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (
	`__WAIT_INT
 (¡©us))

	)

86 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (
	`__WAIT_INT
 (¡©us))

	)

87 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (
	`__WAIT_INT
 (¡©us))

	)

88 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (
	`__WAIT_INT
 (¡©us))

	)

89 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (
	`__WAIT_INT
 (¡©us))

	)

90 #ifdeà
__WIFCONTINUED


91 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (
	`__WAIT_INT
 (¡©us))

	)

95 
__BEGIN_NAMESPACE_STD


99 
	mquÙ
;

100 
	m»m
;

101 } 
	tdiv_t
;

104 #iâdeà
__ldiv_t_defšed


107 
	mquÙ
;

108 
	m»m
;

109 } 
	tldiv_t
;

110 
	#__ldiv_t_defšed
 1

	)

112 
	g__END_NAMESPACE_STD


114 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


115 
__BEGIN_NAMESPACE_C99


117 
__ex‹nsiÚ__
 struct

119 
	mquÙ
;

120 
	m»m
;

121 } 
	tÎdiv_t
;

122 
	#__Îdiv_t_defšed
 1

	)

123 
	g__END_NAMESPACE_C99


128 
	#RAND_MAX
 2147483647

	)

133 
	#EXIT_FAILURE
 1

	)

134 
	#EXIT_SUCCESS
 0

	)

138 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

139 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

142 
__BEGIN_NAMESPACE_STD


144 
	$©of
 (cÚ¡ *
__ÅŒ
)

145 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

147 
	$©oi
 (cÚ¡ *
__ÅŒ
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

150 
	$©Ş
 (cÚ¡ *
__ÅŒ
)

151 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

152 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_MISC


155 
__BEGIN_NAMESPACE_C99


157 
__ex‹nsiÚ__
 
	$©Şl
 (cÚ¡ *
__ÅŒ
)

158 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

159 
__END_NAMESPACE_C99


162 
__BEGIN_NAMESPACE_STD


164 
	$¡¹od
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

165 **
__»¡riù
 
__’d±r
)

166 
__THROW
 
	`__nÚnuÎ
 ((1));

167 
__END_NAMESPACE_STD


169 #ifdef 
__USE_ISOC99


170 
__BEGIN_NAMESPACE_C99


172 
	$¡¹of
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

173 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1));

175 
	$¡¹Şd
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

176 **
__»¡riù
 
__’d±r
)

177 
__THROW
 
	`__nÚnuÎ
 ((1));

178 
__END_NAMESPACE_C99


181 
__BEGIN_NAMESPACE_STD


183 
	$¡¹Ş
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

184 **
__»¡riù
 
__’d±r
, 
__ba£
)

185 
__THROW
 
	`__nÚnuÎ
 ((1));

187 
	$¡¹oul
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

188 **
__»¡riù
 
__’d±r
, 
__ba£
)

189 
__THROW
 
	`__nÚnuÎ
 ((1));

190 
__END_NAMESPACE_STD


192 #ifdeà
__USE_BSD


194 
__ex‹nsiÚ__


195 
	$¡¹oq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

196 **
__»¡riù
 
__’d±r
, 
__ba£
)

197 
__THROW
 
	`__nÚnuÎ
 ((1));

199 
__ex‹nsiÚ__


200 
	$¡¹ouq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

201 **
__»¡riù
 
__’d±r
, 
__ba£
)

202 
__THROW
 
	`__nÚnuÎ
 ((1));

205 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_MISC


206 
__BEGIN_NAMESPACE_C99


208 
__ex‹nsiÚ__


209 
	$¡¹Şl
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

210 **
__»¡riù
 
__’d±r
, 
__ba£
)

211 
__THROW
 
	`__nÚnuÎ
 ((1));

213 
__ex‹nsiÚ__


214 
	$¡¹ouÎ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

215 **
__»¡riù
 
__’d±r
, 
__ba£
)

216 
__THROW
 
	`__nÚnuÎ
 ((1));

217 
__END_NAMESPACE_C99


221 #ifdeà
__USE_GNU


235 
	~<xloÿË.h
>

239 
	$¡¹Ş_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

240 **
__»¡riù
 
__’d±r
, 
__ba£
,

241 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4));

243 
	$¡¹oul_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

244 **
__»¡riù
 
__’d±r
,

245 
__ba£
, 
__loÿË_t
 
__loc
)

246 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

248 
__ex‹nsiÚ__


249 
	$¡¹Şl_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

250 **
__»¡riù
 
__’d±r
, 
__ba£
,

251 
__loÿË_t
 
__loc
)

252 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

254 
__ex‹nsiÚ__


255 
	$¡¹ouÎ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

256 **
__»¡riù
 
__’d±r
,

257 
__ba£
, 
__loÿË_t
 
__loc
)

258 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

260 
	$¡¹od_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

261 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

262 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

264 
	$¡¹of_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

265 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

266 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

268 
	$¡¹Şd_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

269 **
__»¡riù
 
__’d±r
,

270 
__loÿË_t
 
__loc
)

271 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

275 #ifdeà
__USE_EXTERN_INLINES


276 
__BEGIN_NAMESPACE_STD


277 
__ex‹º_šlše
 

278 
	`__NTH
 (
	$©oi
 (cÚ¡ *
__ÅŒ
))

280  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

281 
	}
}

282 
__ex‹º_šlše
 

283 
__NTH
 (
	$©Ş
 (cÚ¡ *
__ÅŒ
))

285  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

286 
	}
}

287 
	g__END_NAMESPACE_STD


289 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_ISOC99


290 
__BEGIN_NAMESPACE_C99


291 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

292 
__NTH
 (
	$©Şl
 (cÚ¡ *
__ÅŒ
))

294  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

295 
	}
}

296 
	g__END_NAMESPACE_C99


301 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED


305 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

308 
	$a64l
 (cÚ¡ *
__s
)

309 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

313 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_BSD


314 
	~<sys/ty³s.h
>

321 
	$¿ndom
 (è
__THROW
;

324 
	$¤ªdom
 (
__£ed
è
__THROW
;

330 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

331 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

335 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

338 #ifdeà
__USE_MISC


343 
	s¿ndom_d©a


345 
št32_t
 *
åŒ
;

346 
št32_t
 *
½Œ
;

347 
št32_t
 *
¡©e
;

348 
¿nd_ty³
;

349 
¿nd_deg
;

350 
¿nd_£p
;

351 
št32_t
 *
’d_±r
;

354 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

355 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

357 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

358 
__THROW
 
	`__nÚnuÎ
 ((2));

360 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

361 
size_t
 
__¡©–’
,

362 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

363 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

365 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

366 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

367 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

372 
__BEGIN_NAMESPACE_STD


374 
	$¿nd
 (è
__THROW
;

376 
	$¤ªd
 (
__£ed
è
__THROW
;

377 
__END_NAMESPACE_STD


379 #ifdeà
__USE_POSIX


381 
	$¿nd_r
 (*
__£ed
è
__THROW
;

385 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


389 
	$d¿nd48
 (è
__THROW
;

390 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

393 
	$Ìªd48
 (è
__THROW
;

394 
	$Äªd48
 (
__xsubi
[3])

395 
__THROW
 
	`__nÚnuÎ
 ((1));

398 
	$m¿nd48
 (è
__THROW
;

399 
	$j¿nd48
 (
__xsubi
[3])

400 
__THROW
 
	`__nÚnuÎ
 ((1));

403 
	$¤ªd48
 (
__£edv®
è
__THROW
;

404 *
	$£ed48
 (
__£ed16v
[3])

405 
__THROW
 
	`__nÚnuÎ
 ((1));

406 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

408 #ifdeà
__USE_MISC


412 
	sd¿nd48_d©a


414 
__x
[3];

415 
__Şd_x
[3];

416 
__c
;

417 
__š™
;

418 
__ex‹nsiÚ__
 
__a
;

423 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

424 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

425 
	$”ªd48_r
 (
__xsubi
[3],

426 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

427 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

430 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

431 *
__»¡riù
 
__»suÉ
)

432 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

433 
	$Äªd48_r
 (
__xsubi
[3],

434 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

435 *
__»¡riù
 
__»suÉ
)

436 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

439 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

440 *
__»¡riù
 
__»suÉ
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

442 
	$j¿nd48_r
 (
__xsubi
[3],

443 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

444 *
__»¡riù
 
__»suÉ
)

445 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

448 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

449 
__THROW
 
	`__nÚnuÎ
 ((2));

451 
	$£ed48_r
 (
__£ed16v
[3],

452 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

454 
	$lcÚg48_r
 (
__·¿m
[7],

455 
d¿nd48_d©a
 *
__bufãr
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

462 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


463 
	#__m®loc_ªd_ÿÎoc_defšed


	)

464 
__BEGIN_NAMESPACE_STD


466 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

468 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

469 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

470 
__END_NAMESPACE_STD


473 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


474 
__BEGIN_NAMESPACE_STD


480 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

481 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

483 
	$ä“
 (*
__±r
è
__THROW
;

484 
__END_NAMESPACE_STD


486 #ifdef 
__USE_MISC


488 
	$cä“
 (*
__±r
è
__THROW
;

491 #ià
defšed
 
__USE_GNU
 || defšed 
__USE_BSD
 || defšed 
__USE_MISC


492 
	~<®loÿ.h
>

495 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

496 || 
defšed
 
__USE_BSD


498 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

501 #ifdeà
__USE_XOPEN2K


503 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

504 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

507 #ifdeà
__USE_ISOC11


509 *
	$®igÃd_®loc
 (
size_t
 
__®ignm’t
, size_ˆ
__size
)

510 
__THROW
 
__©Œibu‹_m®loc__
 
	`__©Œibu‹_®loc_size__
 ((2)è
__wur
;

513 
__BEGIN_NAMESPACE_STD


515 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

519 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

521 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


523 #ifdeà
__ılu¥lus


524 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

525 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

527 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

530 
__END_NAMESPACE_STD


532 #ifdef 
__USE_MISC


535 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

536 
__THROW
 
	`__nÚnuÎ
 ((1));

539 
__BEGIN_NAMESPACE_STD


543 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

545 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


549 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

551 
__END_NAMESPACE_STD


553 #ifdeà
__USE_ISOC99


554 
__BEGIN_NAMESPACE_C99


557 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

558 
__END_NAMESPACE_C99


562 
__BEGIN_NAMESPACE_STD


564 *
	$g‘’v
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

565 
__END_NAMESPACE_STD


567 #ifdeà
__USE_GNU


570 *
	$£cu»_g‘’v
 (cÚ¡ *
__Çme
)

571 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

574 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


578 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

581 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


584 
	$£‹nv
 (cÚ¡ *
__Çme
, cÚ¡ *
__v®ue
, 
__»¶aû
)

585 
__THROW
 
	`__nÚnuÎ
 ((2));

588 
	$un£‹nv
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

591 #ifdef 
__USE_MISC


595 
	$ş—»nv
 (è
__THROW
;

599 #ià
defšed
 
__USE_MISC
 \

600 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
)

606 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1));

609 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 \

610 || 
defšed
 
__USE_XOPEN2K8


619 #iâdeà
__USE_FILE_OFFSET64


620 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

622 #ifdeà
__REDIRECT


623 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

624 
	`__nÚnuÎ
 ((1)è
__wur
;

626 
	#mk¡emp
 
mk¡emp64


	)

629 #ifdeà
__USE_LARGEFILE64


630 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

634 #ifdeà
__USE_MISC


641 #iâdeà
__USE_FILE_OFFSET64


642 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

644 #ifdeà
__REDIRECT


645 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

646 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

648 
	#mk¡emps
 
mk¡emps64


	)

651 #ifdeà
__USE_LARGEFILE64


652 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

653 
	`__nÚnuÎ
 ((1)è
__wur
;

657 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K8


663 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

666 #ifdeà
__USE_GNU


673 #iâdeà
__USE_FILE_OFFSET64


674 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

676 #ifdeà
__REDIRECT


677 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

678 
	`__nÚnuÎ
 ((1)è
__wur
;

680 
	#mko¡emp
 
mko¡emp64


	)

683 #ifdeà
__USE_LARGEFILE64


684 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

693 #iâdeà
__USE_FILE_OFFSET64


694 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

695 
	`__nÚnuÎ
 ((1)è
__wur
;

697 #ifdeà
__REDIRECT


698 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

699 
__æags
), 
mko¡emps64
)

700 
	`__nÚnuÎ
 ((1)è
__wur
;

702 
	#mko¡emps
 
mko¡emps64


	)

705 #ifdeà
__USE_LARGEFILE64


706 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

707 
	`__nÚnuÎ
 ((1)è
__wur
;

712 
__BEGIN_NAMESPACE_STD


717 
	$sy¡em
 (cÚ¡ *
__commªd
è
__wur
;

718 
__END_NAMESPACE_STD


721 #ifdef 
__USE_GNU


724 *
	$ÿnÚiÿlize_fe_Çme
 (cÚ¡ *
__Çme
)

725 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

728 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


734 *
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
,

735 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

740 #iâdeà
__COMPAR_FN_T


741 
	#__COMPAR_FN_T


	)

742 (*
	t__com·r_â_t
) (const *, const *);

744 #ifdef 
__USE_GNU


745 
__com·r_â_t
 
	tcom·risÚ_â_t
;

748 #ifdeà
__USE_GNU


749 (*
	t__com·r_d_â_t
) (const *, const *, *);

752 
__BEGIN_NAMESPACE_STD


755 *
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
,

756 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

757 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

759 #ifdeà
__USE_EXTERN_INLINES


760 
	~<b™s/¡dlib-b£¬ch.h
>

765 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

766 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

767 #ifdeà
__USE_GNU


768 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

769 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

770 
	`__nÚnuÎ
 ((1, 4));

775 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

776 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

777 
__END_NAMESPACE_STD


779 #ifdeà
__USE_ISOC99


780 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

781 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

785 
__BEGIN_NAMESPACE_STD


789 
div_t
 
	$div
 (
__num”
, 
__d’om
)

790 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

791 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

792 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

793 
__END_NAMESPACE_STD


795 #ifdeà
__USE_ISOC99


796 
__BEGIN_NAMESPACE_C99


797 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

798 
__d’om
)

799 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

800 
__END_NAMESPACE_C99


804 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

805 || 
defšed
 
__USE_SVID


812 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

813 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

818 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

819 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

824 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

825 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

828 #ifdeà
__USE_MISC


830 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

831 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

832 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

833 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

834 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

835 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

836 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

837 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

842 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

843 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

844 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

845 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

846 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

847 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

849 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

850 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

851 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

852 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

853 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

854 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

855 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

856 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

860 
__BEGIN_NAMESPACE_STD


863 
	$mbËn
 (cÚ¡ *
__s
, 
size_t
 
__n
è
__THROW
;

866 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

867 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

870 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
;

874 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

875 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

877 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

878 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

879 
__THROW
;

880 
__END_NAMESPACE_STD


883 #ifdeà
__USE_SVID


888 
	$½m©ch
 (cÚ¡ *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

892 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


899 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

900 *cÚ¡ *
__»¡riù
 
__tok’s
,

901 **
__»¡riù
 
__v®u•
)

902 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

906 #ifdeà
__USE_XOPEN


908 
	$£tkey
 (cÚ¡ *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

914 #ifdeà
__USE_XOPEN2KXSI


916 
	$posix_İ’±
 (
__oæag
è
__wur
;

919 #ifdeà
__USE_XOPEN


924 
	$g¿Á±
 (
__fd
è
__THROW
;

928 
	$uÆock±
 (
__fd
è
__THROW
;

933 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

936 #ifdeà
__USE_GNU


940 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

941 
__THROW
 
	`__nÚnuÎ
 ((2));

944 
	`g‘±
 ();

947 #ifdeà
__USE_BSD


951 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

952 
__THROW
 
	`__nÚnuÎ
 ((1));

955 
	~<b™s/¡dlib-æßt.h
>

958 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


959 
	~<b™s/¡dlib.h
>

961 #ifdeà
__LDBL_COMPAT


962 
	~<b™s/¡dlib-ldbl.h
>

966 #undeà
__Ãed_m®loc_ªd_ÿÎoc


968 
__END_DECLS


	@/usr/include/string.h

22 #iâdef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


30 
	#__Ãed_size_t


	)

31 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

39 #ià
defšed
 
__ılu¥lus
 && (__ılu¥lu >ğ199711L || 
__GNUC_PREREQ
 (4, 4))

40 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

44 
__BEGIN_NAMESPACE_STD


46 *
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

47 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

50 *
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

51 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

52 
__END_NAMESPACE_STD


57 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN


58 *
	$memcıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

59 
__c
, 
size_t
 
__n
)

60 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

64 
__BEGIN_NAMESPACE_STD


66 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

69 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

70 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

73 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


76 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

77 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

78 cÚ¡ *
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

79 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

81 #ifdeà
__OPTIMIZE__


82 
__ex‹º_®ways_šlše
 *

83 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


85  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

88 
__ex‹º_®ways_šlše
 const *

89 
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


91  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

94 
	}
}

96 *
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

97 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

99 
__END_NAMESPACE_STD


101 #ifdeà
__USE_GNU


104 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


105 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

106 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

107 "C++" cÚ¡ *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

108 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

110 *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

111 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

115 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


116 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

117 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

118 "C++" cÚ¡ *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

119 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

121 *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

122 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

127 
__BEGIN_NAMESPACE_STD


129 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

130 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

132 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

133 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

134 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

137 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

138 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

140 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

141 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

144 
	$¡rcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

145 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

147 
	$¡ºcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

151 
	$¡rcŞl
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

152 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

154 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

155 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

156 
__THROW
 
	`__nÚnuÎ
 ((2));

157 
__END_NAMESPACE_STD


159 #ifdeà
__USE_XOPEN2K8


163 
	~<xloÿË.h
>

166 
	$¡rcŞl_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

167 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

169 
size_t
 
	$¡rxäm_l
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

170 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

173 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 \

174 || 
defšed
 
__USE_XOPEN2K8


176 *
	$¡rdup
 (cÚ¡ *
__s
)

177 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

183 #ià
defšed
 
__USE_XOPEN2K8


184 *
	$¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

185 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

188 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


190 
	#¡rdu·
(
s
) \

191 (
__ex‹nsiÚ__
 \

193 cÚ¡ *
__Şd
 = (
s
); \

194 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

195 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

196 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

197 
	}
}))

	)

200 
	#¡ºdu·
(
s
, 
n
) \

201 (
__ex‹nsiÚ__
 \

203 cÚ¡ *
__Şd
 = (
s
); \

204 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

205 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

206 
__Ãw
[
__Ën
] = '\0'; \

207 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

208 }))

	)

211 
	g__BEGIN_NAMESPACE_STD


213 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


216 *
¡rchr
 (*
__s
, 
__c
)

217 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

218 cÚ¡ *
¡rchr
 (cÚ¡ *
__s
, 
__c
)

219 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

221 #ifdeà
__OPTIMIZE__


222 
__ex‹º_®ways_šlše
 *

223 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


225  
__butš_¡rchr
 (
__s
, 
__c
);

228 
__ex‹º_®ways_šlše
 const *

229 
¡rchr
 (cÚ¡ *
__s
, 
__c
è
	g__THROW


231  
__butš_¡rchr
 (
__s
, 
__c
);

236 *
	$¡rchr
 (cÚ¡ *
__s
, 
__c
)

237 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

240 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


243 *
	`¡¼chr
 (*
__s
, 
__c
)

244 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

245 cÚ¡ *
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
)

246 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

248 #ifdeà
__OPTIMIZE__


249 
__ex‹º_®ways_šlše
 *

250 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


252  
	`__butš_¡¼chr
 (
__s
, 
__c
);

255 
__ex‹º_®ways_šlše
 const *

256 
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
è
__THROW


258  
	`__butš_¡¼chr
 (
__s
, 
__c
);

261 
	}
}

263 *
	$¡¼chr
 (cÚ¡ *
__s
, 
__c
)

264 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

266 
__END_NAMESPACE_STD


268 #ifdeà
__USE_GNU


271 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


272 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

273 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

274 "C++" cÚ¡ *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

275 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

277 *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

278 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

282 
__BEGIN_NAMESPACE_STD


285 
size_t
 
	$¡rc¥n
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

286 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

289 
size_t
 
	$¡r¥n
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

290 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

292 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


295 *
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
)

296 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

297 cÚ¡ *
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

298 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

300 #ifdeà
__OPTIMIZE__


301 
__ex‹º_®ways_šlše
 *

302 
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
è
__THROW


304  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

307 
__ex‹º_®ways_šlše
 const *

308 
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
è
__THROW


310  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

313 
	}
}

315 *
	$¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

316 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

319 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


322 *
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

323 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

324 cÚ¡ *
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

325 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

327 #ifdeà
__OPTIMIZE__


328 
__ex‹º_®ways_šlše
 *

329 
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


331  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

334 
__ex‹º_®ways_šlše
 const *

335 
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


337  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

340 
	}
}

342 *
	$¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

343 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

348 *
	$¡¹ok
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
)

349 
__THROW
 
	`__nÚnuÎ
 ((2));

350 
__END_NAMESPACE_STD


354 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

355 cÚ¡ *
__»¡riù
 
__d–im
,

356 **
__»¡riù
 
__§ve_±r
)

357 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

358 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


359 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
,

360 **
__»¡riù
 
__§ve_±r
)

361 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

364 #ifdeà
__USE_GNU


366 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


367 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

368 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

369 "C++" cÚ¡ *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
,

370 cÚ¡ *
__ÃedË
)

371 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

374 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

378 #ifdeà
__USE_GNU


382 *
	$memmem
 (cÚ¡ *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

383 cÚ¡ *
__ÃedË
, 
size_t
 
__ÃedËËn
)

384 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

388 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

389 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

390 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

392 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

397 
__BEGIN_NAMESPACE_STD


399 
size_t
 
	$¡¾’
 (cÚ¡ *
__s
)

400 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

401 
__END_NAMESPACE_STD


403 #ifdef 
__USE_XOPEN2K8


406 
size_t
 
	$¡ºËn
 (cÚ¡ *
__¡ršg
, 
size_t
 
__maxËn
)

407 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

411 
__BEGIN_NAMESPACE_STD


413 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

414 
__END_NAMESPACE_STD


415 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_MISC


423 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


426 #ifdeà
__REDIRECT_NTH


427 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

428 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

429 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

431 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

432 
__THROW
 
	`__nÚnuÎ
 ((2));

433 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

438 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

439 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

443 #ifdeà
__USE_XOPEN2K8


445 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

451 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

453 #ifdeà
__USE_BSD


455 
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
)

456 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

462 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

463 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

466 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


469 *
	`šdex
 (*
__s
, 
__c
)

470 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

471 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

472 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

474 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


475 
__ex‹º_®ways_šlše
 *

476 
	`šdex
 (*
__s
, 
__c
è
__THROW


478  
	`__butš_šdex
 (
__s
, 
__c
);

481 
__ex‹º_®ways_šlše
 const *

482 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


484  
	`__butš_šdex
 (
__s
, 
__c
);

487 
	}
}

489 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

490 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


497 *
	`ršdex
 (*
__s
, 
__c
)

498 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

499 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

500 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

502 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


503 
__ex‹º_®ways_šlše
 *

504 
	`ršdex
 (*
__s
, 
__c
è
__THROW


506  
	`__butš_ršdex
 (
__s
, 
__c
);

509 
__ex‹º_®ways_šlše
 const *

510 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


512  
	`__butš_ršdex
 (
__s
, 
__c
);

515 
	}
}

517 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

518 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

523 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

527 #ifdef 
__USE_GNU


528 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

530 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

534 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

535 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

538 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

539 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

542 #ifdef 
__USE_GNU


545 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

546 
__loÿË_t
 
__loc
)

547 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

549 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

550 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

551 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

554 #ifdef 
__USE_BSD


557 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

558 cÚ¡ *
__»¡riù
 
__d–im
)

559 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

562 #ifdef 
__USE_XOPEN2K8


564 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

567 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

568 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

569 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

570 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

574 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

575 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

576 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

577 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

578 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

579 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

582 #ifdef 
__USE_GNU


584 
	$¡rv”scmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

585 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

588 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

591 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

593 #iâdeà
ba£Çme


598 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


599 "C++" *
	$ba£Çme
 (*
__f’ame
)

600 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

601 "C++" cÚ¡ *
	$ba£Çme
 (cÚ¡ *
__f’ame
)

602 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

604 *
	$ba£Çme
 (cÚ¡ *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

610 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

611 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

612 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ılu¥lus


632 
	~<b™s/¡ršg.h
>

635 
	~<b™s/¡ršg2.h
>

638 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


640 
	~<b™s/¡ršg3.h
>

644 
__END_DECLS


	@/usr/include/time.h

22 #iâdef 
_TIME_H


24 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

25 ! 
defšed
 
	g__Ãed_time¥ec
)

26 
	#_TIME_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__Ãed_size_t


	)

36 
	#__Ãed_NULL


	)

37 
	~<¡ddef.h
>

41 
	~<b™s/time.h
>

44 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


45 #iâdeà
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

53 
	#__şock_t_defšed
 1

	)

55 
	~<b™s/ty³s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__şock_t
 
	tşock_t
;

60 
	g__END_NAMESPACE_STD


61 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


62 
	$__USING_NAMESPACE_STD
(
şock_t
)

66 #undeà
__Ãed_şock_t


68 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

69 
	#__time_t_defšed
 1

	)

71 
	~<b™s/ty³s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC
 || defšed 
__USE_SVID


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #undeà
__Ãed_time_t


84 #ià!
defšed
 
__şockid_t_defšed
 && \

85 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

86 
	#__şockid_t_defšed
 1

	)

88 
	~<b™s/ty³s.h
>

91 
__şockid_t
 
	tşockid_t
;

94 #undeà
__şockid_time_t


96 #ià!
defšed
 
__tim”_t_defšed
 && \

97 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

98 
	#__tim”_t_defšed
 1

	)

100 
	~<b™s/ty³s.h
>

103 
__tim”_t
 
	ttim”_t
;

106 #undeà
__Ãed_tim”_t


109 #ià(!
defšed
 
__time¥ec_defšed
 \

110 && ((
defšed
 
_TIME_H
 \

111 && (
defšed
 
__USE_POSIX199309
 || defšed 
__USE_MISC
 \

112 || 
defšed
 
__USE_ISOC11
)) \

113 || 
defšed
 
__Ãed_time¥ec
))

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
__sysÿÎ_¦Úg_t
 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_BSD


146 
tm_gmtoff
;

147 cÚ¡ *
tm_zÚe
;

149 
__tm_gmtoff
;

150 cÚ¡ *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX
 || defšed 
__USE_MISC


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 #ifdeà
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
şock_t
 
	$şock
 (è
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

195 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

196 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

199 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

205 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

206 cÚ¡ *
__»¡riù
 
__fÜm©
,

207 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifdeà
__USE_XOPEN


213 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

214 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

215 
__THROW
;

218 #ifdeà
__USE_XOPEN2K8


221 
	~<xloÿË.h
>

223 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

224 cÚ¡ *
__»¡riù
 
__fÜm©
,

225 cÚ¡ 
tm
 *
__»¡riù
 
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

229 #ifdeà
__USE_GNU


230 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

231 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

232 
__loÿË_t
 
__loc
è
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

243 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

244 
__END_NAMESPACE_STD


246 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


249 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

250 
tm
 *
__»¡riù
 
__
è
__THROW
;

254 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

255 
tm
 *
__»¡riù
 
__
è
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

264 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

265 
__END_NAMESPACE_STD


267 #ià
defšed
 
__USE_POSIX
 || defšed 
__USE_MISC


272 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

273 *
__»¡riù
 
__buf
è
__THROW
;

276 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

277 *
__»¡riù
 
__buf
è
__THROW
;

282 *
__tzÇme
[2];

283 
__daylight
;

284 
__timezÚe
;

287 #ifdef 
__USE_POSIX


289 *
tzÇme
[2];

293 
	$tz£t
 (è
__THROW
;

296 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_XOPEN


297 
daylight
;

298 
timezÚe
;

301 #ifdeà
__USE_SVID


304 
	$¡ime
 (cÚ¡ 
time_t
 *
__wh’
è
__THROW
;

310 
	#__i¦—p
(
y—r
) \

311 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

314 #ifdeà
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

322 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

325 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

329 #ifdeà
__USE_POSIX199309


334 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

335 
time¥ec
 *
__»maššg
);

339 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

342 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

345 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, cÚ¡ 
time¥ec
 *
__
)

346 
__THROW
;

348 #ifdeà
__USE_XOPEN2K


353 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

354 cÚ¡ 
time¥ec
 *
__»q
,

355 
time¥ec
 *
__»m
);

358 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

363 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

364 
sigev’t
 *
__»¡riù
 
__evp
,

365 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

368 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

371 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

372 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

373 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

376 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

377 
__THROW
;

380 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

384 #ifdeà
__USE_ISOC11


386 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__nÚnuÎ
 ((1));

391 #ifdeà
__USE_XOPEN_EXTENDED


403 
g‘d©e_”r
;

412 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

415 #ifdeà
__USE_GNU


426 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

427 
tm
 *
__»¡riù
 
__»sbuå
);

430 
__END_DECLS


	@/usr/include/unistd.h

22 #iâdef 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


32 #ifdeà
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #–ià
defšed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #–ià
defšed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #–ià
defšed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifdeà
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #–ià
defšed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #–ià
defšed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

71 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

75 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

79 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

83 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

86 #ifdeà
__USE_XOPEN2K8


87 
	#_XOPEN_VERSION
 700

	)

88 #–ià
defšed
 
__USE_XOPEN2K


89 
	#_XOPEN_VERSION
 600

	)

90 #–ià
defšed
 
__USE_UNIX98


91 
	#_XOPEN_VERSION
 500

	)

93 
	#_XOPEN_VERSION
 4

	)

97 
	#_XOPEN_XCU_VERSION
 4

	)

100 
	#_XOPEN_XPG2
 1

	)

101 
	#_XOPEN_XPG3
 1

	)

102 
	#_XOPEN_XPG4
 1

	)

105 
	#_XOPEN_UNIX
 1

	)

108 
	#_XOPEN_CRYPT
 1

	)

112 
	#_XOPEN_ENH_I18N
 1

	)

115 
	#_XOPEN_LEGACY
 1

	)

202 
	~<b™s/posix_İt.h
>

205 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


206 
	~<b™s/’vœÚm’ts.h
>

210 
	#STDIN_FILENO
 0

	)

211 
	#STDOUT_FILENO
 1

	)

212 
	#STDERR_FILENO
 2

	)

217 
	~<b™s/ty³s.h
>

219 #iâdef 
__ssize_t_defšed


220 
__ssize_t
 
	tssize_t
;

221 
	#__ssize_t_defšed


	)

224 
	#__Ãed_size_t


	)

225 
	#__Ãed_NULL


	)

226 
	~<¡ddef.h
>

228 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


231 #iâdeà
__gid_t_defšed


232 
__gid_t
 
	tgid_t
;

233 
	#__gid_t_defšed


	)

236 #iâdeà
__uid_t_defšed


237 
__uid_t
 
	tuid_t
;

238 
	#__uid_t_defšed


	)

241 #iâdeà
__off_t_defšed


242 #iâdeà
__USE_FILE_OFFSET64


243 
__off_t
 
	toff_t
;

245 
__off64_t
 
	toff_t
;

247 
	#__off_t_defšed


	)

249 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


250 
__off64_t
 
	toff64_t
;

251 
	#__off64_t_defšed


	)

254 #iâdeà
__u£cÚds_t_defšed


255 
__u£cÚds_t
 
	tu£cÚds_t
;

256 
	#__u£cÚds_t_defšed


	)

259 #iâdeà
__pid_t_defšed


260 
__pid_t
 
	tpid_t
;

261 
	#__pid_t_defšed


	)

265 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


266 #iâdeà
__šŒ_t_defšed


267 
__šŒ_t
 
	tšŒ_t
;

268 
	#__šŒ_t_defšed


	)

272 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN


273 #iâdeà
__sockËn_t_defšed


274 
__sockËn_t
 
	tsockËn_t
;

275 
	#__sockËn_t_defšed


	)

281 
	#R_OK
 4

	)

282 
	#W_OK
 2

	)

283 
	#X_OK
 1

	)

284 
	#F_OK
 0

	)

287 
	$acûss
 (cÚ¡ *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

289 #ifdeà
__USE_GNU


292 
	$euidacûss
 (cÚ¡ *
__Çme
, 
__ty³
)

293 
__THROW
 
	`__nÚnuÎ
 ((1));

296 
	$—cûss
 (cÚ¡ *
__Çme
, 
__ty³
)

297 
__THROW
 
	`__nÚnuÎ
 ((1));

300 #ifdeà
__USE_ATFILE


304 
	$çcûs§t
 (
__fd
, cÚ¡ *
__fe
, 
__ty³
, 
__æag
)

305 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

310 #iâdef 
_STDIO_H


311 
	#SEEK_SET
 0

	)

312 
	#SEEK_CUR
 1

	)

313 
	#SEEK_END
 2

	)

314 #ifdeà
__USE_GNU


315 
	#SEEK_DATA
 3

	)

316 
	#SEEK_HOLE
 4

	)

320 #ià
defšed
 
__USE_BSD
 && !defšed 
L_SET


322 
	#L_SET
 
SEEK_SET


	)

323 
	#L_INCR
 
SEEK_CUR


	)

324 
	#L_XTND
 
SEEK_END


	)

333 #iâdeà
__USE_FILE_OFFSET64


334 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

336 #ifdeà
__REDIRECT_NTH


337 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

338 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

339 
l£ek64
);

341 
	#l£ek
 
l£ek64


	)

344 #ifdeà
__USE_LARGEFILE64


345 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

346 
__THROW
;

353 
	`şo£
 (
__fd
);

360 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

366 
ssize_t
 
	$wr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
è
__wur
;

368 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


369 #iâdeà
__USE_FILE_OFFSET64


376 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

377 
__off_t
 
__off£t
è
__wur
;

384 
ssize_t
 
	$pwr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

385 
__off_t
 
__off£t
è
__wur
;

387 #ifdeà
__REDIRECT


388 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

389 
__off64_t
 
__off£t
),

390 
´—d64
è
__wur
;

391 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, cÚ¡ *
__buf
,

392 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

393 
pwr™e64
è
__wur
;

395 
	#´—d
 
´—d64


	)

396 
	#pwr™e
 
pwr™e64


	)

400 #ifdeà
__USE_LARGEFILE64


404 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

405 
__off64_t
 
__off£t
è
__wur
;

408 
ssize_t
 
	$pwr™e64
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

409 
__off64_t
 
__off£t
è
__wur
;

417 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

419 #ifdeà
__USE_GNU


422 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

432 
	$®¬m
 (
__£cÚds
è
__THROW
;

444 
	`¦“p
 (
__£cÚds
);

446 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

447 || 
defšed
 
__USE_BSD


452 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

453 
__THROW
;

460 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

469 
	`·u£
 ();

473 
	$chown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

474 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

476 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


478 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

483 
	$lchown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

484 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

488 #ifdeà
__USE_ATFILE


491 
	$fchowÇt
 (
__fd
, cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
,

492 
__gid_t
 
__group
, 
__æag
)

493 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

497 
	$chdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

499 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


501 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

511 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

513 #ifdef 
__USE_GNU


517 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

520 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

521 || 
defšed
 
__USE_BSD


525 *
	$g‘wd
 (*
__buf
)

526 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

531 
	$dup
 (
__fd
è
__THROW
 
__wur
;

534 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

536 #ifdeà
__USE_GNU


539 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

543 **
__’vœÚ
;

544 #ifdeà
__USE_GNU


545 **
’vœÚ
;

551 
	$execve
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[],

552 *cÚ¡ 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

554 #ifdeà
__USE_XOPEN2K8


557 
	$ãxecve
 (
__fd
, *cÚ¡ 
__¬gv
[], *cÚ¡ 
__’vp
[])

558 
__THROW
 
	`__nÚnuÎ
 ((2));

563 
	$execv
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[])

564 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

568 
	$exeşe
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

569 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

573 
	$exeş
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

574 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

578 
	$execvp
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[])

579 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

584 
	$exeşp
 (cÚ¡ *
__fe
, cÚ¡ *
__¬g
, ...)

585 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

587 #ifdeà
__USE_GNU


590 
	$execv³
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[],

591 *cÚ¡ 
__’vp
[])

592 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

596 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


598 
	$niû
 (
__šc
è
__THROW
 
__wur
;

603 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

609 
	~<b™s/cÚâame.h
>

612 
	$·thcÚf
 (cÚ¡ *
__·th
, 
__Çme
)

613 
__THROW
 
	`__nÚnuÎ
 ((1));

616 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

619 
	$syscÚf
 (
__Çme
è
__THROW
;

621 #ifdef 
__USE_POSIX2


623 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

628 
__pid_t
 
	$g‘pid
 (è
__THROW
;

631 
__pid_t
 
	$g‘µid
 (è
__THROW
;

634 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

637 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

638 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


639 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

646 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

648 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


660 
	$£g½
 (è
__THROW
;

667 
__pid_t
 
	$£tsid
 (è
__THROW
;

669 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


671 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

675 
__uid_t
 
	$g‘uid
 (è
__THROW
;

678 
__uid_t
 
	$g‘euid
 (è
__THROW
;

681 
__gid_t
 
	$g‘gid
 (è
__THROW
;

684 
__gid_t
 
	$g‘egid
 (è
__THROW
;

689 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

691 #ifdef 
__USE_GNU


693 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

700 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

702 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


705 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
 
__wur
;

708 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


710 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

717 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

719 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


722 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
 
__wur
;

725 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN2K


727 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

730 #ifdeà
__USE_GNU


733 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

734 
__THROW
;

738 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

739 
__THROW
;

743 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

744 
__THROW
 
__wur
;

748 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

749 
__THROW
 
__wur
;

756 
__pid_t
 
	$fÜk
 (è
__THROWNL
;

758 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

759 || 
defšed
 
__USE_BSD


764 
__pid_t
 
	$vfÜk
 (è
__THROW
;

770 *
	$‰yÇme
 (
__fd
è
__THROW
;

774 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

775 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

779 
	$i§‰y
 (
__fd
è
__THROW
;

781 #ià
defšed
 
__USE_BSD
 \

782 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_UNIX98
)

785 
	$‰y¦Ù
 (è
__THROW
;

790 
	$lšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

791 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

793 #ifdeà
__USE_ATFILE


796 
	$lšk©
 (
__äomfd
, cÚ¡ *
__äom
, 
__tofd
,

797 cÚ¡ *
__to
, 
__æags
)

798 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

801 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


803 
	$symlšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

804 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

809 
ssize_t
 
	$»adlšk
 (cÚ¡ *
__»¡riù
 
__·th
,

810 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

811 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

814 #ifdeà
__USE_ATFILE


816 
	$symlšk©
 (cÚ¡ *
__äom
, 
__tofd
,

817 cÚ¡ *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

820 
ssize_t
 
	$»adlšk©
 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

821 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

822 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

826 
	$uÆšk
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

828 #ifdeà
__USE_ATFILE


830 
	$uÆšk©
 (
__fd
, cÚ¡ *
__Çme
, 
__æag
)

831 
__THROW
 
	`__nÚnuÎ
 ((2));

835 
	$rmdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

839 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

842 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

849 *
	`g‘logš
 ();

850 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


857 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

860 #ifdef 
__USE_BSD


862 
	$£ogš
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

866 #ifdef 
__USE_POSIX2


870 
	#__Ãed_g‘İt


	)

871 
	~<g‘İt.h
>

875 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


879 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

883 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

886 
	$£tho¡Çme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

887 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

891 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

897 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

898 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

899 
	$£tdomašÇme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

900 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

906 
	$vhªgup
 (è
__THROW
;

909 
	$»voke
 (cÚ¡ *
__fe
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

917 
	$´of
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

918 
size_t
 
__off£t
, 
__sÿË
)

919 
__THROW
 
	`__nÚnuÎ
 ((1));

925 
	$acù
 (cÚ¡ *
__Çme
è
__THROW
;

929 *
	$g‘u£rsh–l
 (è
__THROW
;

930 
	$’du£rsh–l
 (è
__THROW
;

931 
	$£tu£rsh–l
 (è
__THROW
;

937 
	$d«mÚ
 (
__nochdœ
, 
__noşo£
è
__THROW
 
__wur
;

941 #ià
defšed
 
__USE_BSD
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

944 
	$chroÙ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

948 *
	$g‘·ss
 (cÚ¡ *
__´om±
è
	`__nÚnuÎ
 ((1));

956 
	`fsync
 (
__fd
);

959 #ifdeà
__USE_GNU


962 
	$syncfs
 (
__fd
è
__THROW
;

966 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED


969 
	`g‘ho¡id
 ();

972 
	$sync
 (è
__THROW
;

975 #ià
defšed
 
__USE_BSD
 || !defšed 
__USE_XOPEN2K


978 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

983 
	$g‘dbËsize
 (è
__THROW
;

989 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


992 #iâdeà
__USE_FILE_OFFSET64


993 
	$Œunÿ‹
 (cÚ¡ *
__fe
, 
__off_t
 
__Ëngth
)

994 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

996 #ifdeà
__REDIRECT_NTH


997 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

998 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
),

999 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1001 
	#Œunÿ‹
 
Œunÿ‹64


	)

1004 #ifdeà
__USE_LARGEFILE64


1005 
	$Œunÿ‹64
 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
)

1006 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1011 #ià
defšed
 
__USE_BSD
 || defšed 
__USE_POSIX199309
 \

1012 || 
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


1015 #iâdeà
__USE_FILE_OFFSET64


1016 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1018 #ifdeà
__REDIRECT_NTH


1019 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1020 
árunÿ‹64
è
__wur
;

1022 
	#árunÿ‹
 
árunÿ‹64


	)

1025 #ifdeà
__USE_LARGEFILE64


1026 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1032 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

1033 || 
defšed
 
__USE_MISC


1037 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1043 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1047 #ifdeà
__USE_MISC


1058 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1063 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1075 
	#F_ULOCK
 0

	)

1076 
	#F_LOCK
 1

	)

1077 
	#F_TLOCK
 2

	)

1078 
	#F_TEST
 3

	)

1080 #iâdeà
__USE_FILE_OFFSET64


1081 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1083 #ifdeà
__REDIRECT


1084 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1085 
lockf64
è
__wur
;

1087 
	#lockf
 
lockf64


	)

1090 #ifdeà
__USE_LARGEFILE64


1091 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1096 #ifdeà
__USE_GNU


1101 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1102 (
__ex‹nsiÚ__
 \

1103 ({ 
__»suÉ
; \

1104 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1105 
__»suÉ
 =ğ-1L && 
”ºo
 =ğ
EINTR
); \

1106 
__»suÉ
; 
	}
}))

	)

1109 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1112 
fd©async
 (
__fdes
);

1118 #ifdef 
__USE_XOPEN


1120 *
	$üy±
 (cÚ¡ *
__key
, cÚ¡ *
__§É
)

1121 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1125 
	$’üy±
 (*
__glibc_block
, 
__edæag
)

1126 
__THROW
 
	`__nÚnuÎ
 ((1));

1133 
	$swab
 (cÚ¡ *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1134 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1140 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K


1142 *
	$ù”mid
 (*
__s
è
__THROW
;

1147 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


1148 
	~<b™s/uni¡d.h
>

1151 
__END_DECLS


	@/usr/include/alloca.h

18 #iâdef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

26 
	g__BEGIN_DECLS


29 #undeà
®loÿ


32 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

34 #ifdef 
__GNUC__


35 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

38 
__END_DECLS


	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

101 #undeà
__USE_ISOC11


102 #undeà
__USE_ISOC99


103 #undeà
__USE_ISOC95


104 #undeà
__USE_ISOCXX11


105 #undeà
__USE_POSIX


106 #undeà
__USE_POSIX2


107 #undeà
__USE_POSIX199309


108 #undeà
__USE_POSIX199506


109 #undeà
__USE_XOPEN


110 #undeà
__USE_XOPEN_EXTENDED


111 #undeà
__USE_UNIX98


112 #undeà
__USE_XOPEN2K


113 #undeà
__USE_XOPEN2KXSI


114 #undeà
__USE_XOPEN2K8


115 #undeà
__USE_XOPEN2K8XSI


116 #undeà
__USE_LARGEFILE


117 #undeà
__USE_LARGEFILE64


118 #undeà
__USE_FILE_OFFSET64


119 #undeà
__USE_BSD


120 #undeà
__USE_SVID


121 #undeà
__USE_MISC


122 #undeà
__USE_ATFILE


123 #undeà
__USE_GNU


124 #undeà
__USE_REENTRANT


125 #undeà
__USE_FORTIFY_LEVEL


126 #undeà
__KERNEL_STRICT_NAMES


130 #iâdeà
_LOOSE_KERNEL_NAMES


131 
	#__KERNEL_STRICT_NAMES


	)

141 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


142 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

143 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

145 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

150 #ifdeà
_GNU_SOURCE


151 #undeà
_ISOC95_SOURCE


152 
	#_ISOC95_SOURCE
 1

	)

153 #undeà
_ISOC99_SOURCE


154 
	#_ISOC99_SOURCE
 1

	)

155 #undeà
_ISOC11_SOURCE


156 
	#_ISOC11_SOURCE
 1

	)

157 #undeà
_POSIX_SOURCE


158 
	#_POSIX_SOURCE
 1

	)

159 #undeà
_POSIX_C_SOURCE


160 
	#_POSIX_C_SOURCE
 200809L

	)

161 #undeà
_XOPEN_SOURCE


162 
	#_XOPEN_SOURCE
 700

	)

163 #undeà
_XOPEN_SOURCE_EXTENDED


164 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

165 #undeà
_LARGEFILE64_SOURCE


166 
	#_LARGEFILE64_SOURCE
 1

	)

167 #undeà
_DEFAULT_SOURCE


168 
	#_DEFAULT_SOURCE
 1

	)

169 #undeà
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #undeà
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(
defšed
 
_DEFAULT_SOURCE
 \

180 || (!
defšed
 
	g__STRICT_ANSI__
 \

181 && !
defšed
 
	g_ISOC99_SOURCE
 \

182 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

183 && !
defšed
 
	g_XOPEN_SOURCE
 \

184 && !
defšed
 
	g_BSD_SOURCE
 && !defšed 
	g_SVID_SOURCE
))

185 #undeà
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

187 #undeà
_BSD_SOURCE


188 
	#_BSD_SOURCE
 1

	)

189 #undeà
_SVID_SOURCE


190 
	#_SVID_SOURCE
 1

	)

194 #ià(
defšed
 
_ISOC11_SOURCE
 \

195 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

196 
	#__USE_ISOC11
 1

	)

200 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

201 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

202 
	#__USE_ISOC99
 1

	)

206 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

207 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

208 
	#__USE_ISOC95
 1

	)

215 #ià((
defšed
 
__ılu¥lus
 && __cplusplus >= 201103L) \

216 || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__
)

217 
	#__USE_ISOCXX11
 1

	)

223 #ifdeà
_DEFAULT_SOURCE


224 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


225 
	#__USE_POSIX_IMPLICITLY
 1

	)

227 #undeà
_POSIX_SOURCE


228 
	#_POSIX_SOURCE
 1

	)

229 #undeà
_POSIX_C_SOURCE


230 
	#_POSIX_C_SOURCE
 200809L

	)

232 #ià((!
defšed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

233 !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

234 
	#_POSIX_SOURCE
 1

	)

235 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

236 
	#_POSIX_C_SOURCE
 2

	)

237 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

238 
	#_POSIX_C_SOURCE
 199506L

	)

239 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

240 
	#_POSIX_C_SOURCE
 200112L

	)

242 
	#_POSIX_C_SOURCE
 200809L

	)

244 
	#__USE_POSIX_IMPLICITLY
 1

	)

247 #ià
defšed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >ğ1 || defšed 
_XOPEN_SOURCE


248 
	#__USE_POSIX
 1

	)

251 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


252 
	#__USE_POSIX2
 1

	)

255 #ià(
_POSIX_C_SOURCE
 - 0) >= 199309L

256 
	#__USE_POSIX199309
 1

	)

259 #ià(
_POSIX_C_SOURCE
 - 0) >= 199506L

260 
	#__USE_POSIX199506
 1

	)

263 #ià(
_POSIX_C_SOURCE
 - 0) >= 200112L

264 
	#__USE_XOPEN2K
 1

	)

265 #undeà
__USE_ISOC95


266 
	#__USE_ISOC95
 1

	)

267 #undeà
__USE_ISOC99


268 
	#__USE_ISOC99
 1

	)

271 #ià(
_POSIX_C_SOURCE
 - 0) >= 200809L

272 
	#__USE_XOPEN2K8
 1

	)

273 #undeà
_ATFILE_SOURCE


274 
	#_ATFILE_SOURCE
 1

	)

277 #ifdef 
_XOPEN_SOURCE


278 
	#__USE_XOPEN
 1

	)

279 #ià(
_XOPEN_SOURCE
 - 0) >= 500

280 
	#__USE_XOPEN_EXTENDED
 1

	)

281 
	#__USE_UNIX98
 1

	)

282 #undeà
_LARGEFILE_SOURCE


283 
	#_LARGEFILE_SOURCE
 1

	)

284 #ià(
_XOPEN_SOURCE
 - 0) >= 600

285 #ià(
_XOPEN_SOURCE
 - 0) >= 700

286 
	#__USE_XOPEN2K8
 1

	)

287 
	#__USE_XOPEN2K8XSI
 1

	)

289 
	#__USE_XOPEN2K
 1

	)

290 
	#__USE_XOPEN2KXSI
 1

	)

291 #undeà
__USE_ISOC95


292 
	#__USE_ISOC95
 1

	)

293 #undeà
__USE_ISOC99


294 
	#__USE_ISOC99
 1

	)

297 #ifdeà
_XOPEN_SOURCE_EXTENDED


298 
	#__USE_XOPEN_EXTENDED
 1

	)

303 #ifdeà
_LARGEFILE_SOURCE


304 
	#__USE_LARGEFILE
 1

	)

307 #ifdeà
_LARGEFILE64_SOURCE


308 
	#__USE_LARGEFILE64
 1

	)

311 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

312 
	#__USE_FILE_OFFSET64
 1

	)

315 #ià
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE


316 
	#__USE_MISC
 1

	)

319 #ifdef 
_BSD_SOURCE


320 
	#__USE_BSD
 1

	)

323 #ifdef 
_SVID_SOURCE


324 
	#__USE_SVID
 1

	)

327 #ifdef 
_ATFILE_SOURCE


328 
	#__USE_ATFILE
 1

	)

331 #ifdef 
_GNU_SOURCE


332 
	#__USE_GNU
 1

	)

335 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


336 
	#__USE_REENTRANT
 1

	)

339 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

340 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

341 #ià
_FORTIFY_SOURCE
 > 1

342 
	#__USE_FORTIFY_LEVEL
 2

	)

344 
	#__USE_FORTIFY_LEVEL
 1

	)

347 
	#__USE_FORTIFY_LEVEL
 0

	)

352 
	~<¡dc-´edef.h
>

360 #undeà
__GNU_LIBRARY__


361 
	#__GNU_LIBRARY__
 6

	)

365 
	#__GLIBC__
 2

	)

366 
	#__GLIBC_MINOR__
 19

	)

368 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

369 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

372 #iâdeà
__ASSEMBLER__


373 #iâdeà
_SYS_CDEFS_H


374 
	~<sys/cdefs.h
>

379 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


380 
	#__USE_LARGEFILE
 1

	)

381 
	#__USE_LARGEFILE64
 1

	)

387 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

388 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

389 && 
defšed
 
	g__ex‹º_šlše


390 
	#__USE_EXTERN_INLINES
 1

	)

398 
	~<gnu/¡ubs.h
>

	@/usr/include/getopt.h

19 #iâdeà
_GETOPT_H


21 #iâdeà
__Ãed_g‘İt


22 
	#_GETOPT_H
 1

	)

32 #ià!
defšed
 
__GNU_LIBRARY__


33 
	~<ùy³.h
>

36 #iâdeà
__THROW


37 #iâdeà
__GNUC_PREREQ


38 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

40 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

41 
	#__THROW
 
	`throw
 ()

	)

43 
	#__THROW


	)

47 #ifdef 
__ılu¥lus


57 *
İrg
;

71 
İtšd
;

76 
İ‹¼
;

80 
İtİt
;

82 #iâdeà
__Ãed_g‘İt


104 
	sİtiÚ


106 cÚ¡ *
	gÇme
;

109 
	ghas_¬g
;

110 *
	gæag
;

111 
	gv®
;

116 
	#no_¬gum’t
 0

	)

117 
	#»quœed_¬gum’t
 1

	)

118 
	#İtiÚ®_¬gum’t
 2

	)

146 #ifdeà
__GNU_LIBRARY__


150 
g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtİts
)

151 
__THROW
;

153 #ià
defšed
 
__Ãed_g‘İt
 && defšed 
__USE_POSIX2
 \

154 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


158 #ifdeà
__REDIRECT


159 
__REDIRECT_NTH
 (
g‘İt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

160 cÚ¡ *
__shÜtİts
),

161 
__posix_g‘İt
);

163 
__posix_g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

164 cÚ¡ *
__shÜtİts
è
__THROW
;

165 
	#g‘İt
 
__posix_g‘İt


	)

169 
g‘İt
 ();

172 #iâdeà
__Ãed_g‘İt


173 
g‘İt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

174 cÚ¡ *
__shÜtİts
,

175 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

176 
__THROW
;

177 
g‘İt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

178 cÚ¡ *
__shÜtİts
,

179 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

180 
__THROW
;

184 #ifdef 
__ılu¥lus


189 #undeà
__Ãed_g‘İt


	@/usr/include/libio.h

28 #iâdeà
_IO_STDIO_H


29 
	#_IO_STDIO_H


	)

31 
	~<_G_cÚfig.h
>

33 
	#_IO_åos_t
 
_G_åos_t


	)

34 
	#_IO_åos64_t
 
_G_åos64_t


	)

35 
	#_IO_size_t
 
size_t


	)

36 
	#_IO_ssize_t
 
__ssize_t


	)

37 
	#_IO_off_t
 
__off_t


	)

38 
	#_IO_off64_t
 
__off64_t


	)

39 
	#_IO_pid_t
 
__pid_t


	)

40 
	#_IO_uid_t
 
__uid_t


	)

41 
	#_IO_icÚv_t
 
_G_icÚv_t


	)

42 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

43 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

44 
	#_IO_va_li¡
 
_G_va_li¡


	)

45 
	#_IO_wšt_t
 
wšt_t


	)

48 
	#__Ãed___va_li¡


	)

49 
	~<¡d¬g.h
>

50 #ifdeà
__GNUC_VA_LIST


51 #undeà
_IO_va_li¡


52 
	#_IO_va_li¡
 
__gnuc_va_li¡


	)

55 #iâdeà
__P


56 
	~<sys/cdefs.h
>

59 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

61 #iâdeà
EOF


62 
	#EOF
 (-1)

	)

64 #iâdeà
NULL


65 #ià
defšed
 
__GNUG__
 && \

66 (
	g__GNUC__
 > 2 || (__GNUC__ =ğ2 && 
__GNUC_MINOR__
 >= 8))

67 
	#NULL
 (
__nuÎ
)

	)

69 #ià!
defšed
(
__ılu¥lus
)

70 
	#NULL
 ((*)0)

	)

72 
	#NULL
 (0)

	)

77 
	#_IOS_INPUT
 1

	)

78 
	#_IOS_OUTPUT
 2

	)

79 
	#_IOS_ATEND
 4

	)

80 
	#_IOS_APPEND
 8

	)

81 
	#_IOS_TRUNC
 16

	)

82 
	#_IOS_NOCREATE
 32

	)

83 
	#_IOS_NOREPLACE
 64

	)

84 
	#_IOS_BIN
 128

	)

92 
	#_IO_MAGIC
 0xFBAD0000

	)

93 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

94 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

95 
	#_IO_USER_BUF
 1

	)

96 
	#_IO_UNBUFFERED
 2

	)

97 
	#_IO_NO_READS
 4

	)

98 
	#_IO_NO_WRITES
 8

	)

99 
	#_IO_EOF_SEEN
 0x10

	)

100 
	#_IO_ERR_SEEN
 0x20

	)

101 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

102 
	#_IO_LINKED
 0x80

	)

103 
	#_IO_IN_BACKUP
 0x100

	)

104 
	#_IO_LINE_BUF
 0x200

	)

105 
	#_IO_TIED_PUT_GET
 0x400

	)

106 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

107 
	#_IO_IS_APPENDING
 0x1000

	)

108 
	#_IO_IS_FILEBUF
 0x2000

	)

109 
	#_IO_BAD_SEEN
 0x4000

	)

110 
	#_IO_USER_LOCK
 0x8000

	)

112 
	#_IO_FLAGS2_MMAP
 1

	)

113 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

114 #ifdeà
_LIBC


115 
	#_IO_FLAGS2_FORTIFY
 4

	)

117 
	#_IO_FLAGS2_USER_WBUF
 8

	)

118 #ifdeà
_LIBC


119 
	#_IO_FLAGS2_SCANF_STD
 16

	)

120 
	#_IO_FLAGS2_NOCLOSE
 32

	)

121 
	#_IO_FLAGS2_CLOEXEC
 64

	)

125 
	#_IO_SKIPWS
 01

	)

126 
	#_IO_LEFT
 02

	)

127 
	#_IO_RIGHT
 04

	)

128 
	#_IO_INTERNAL
 010

	)

129 
	#_IO_DEC
 020

	)

130 
	#_IO_OCT
 040

	)

131 
	#_IO_HEX
 0100

	)

132 
	#_IO_SHOWBASE
 0200

	)

133 
	#_IO_SHOWPOINT
 0400

	)

134 
	#_IO_UPPERCASE
 01000

	)

135 
	#_IO_SHOWPOS
 02000

	)

136 
	#_IO_SCIENTIFIC
 04000

	)

137 
	#_IO_FIXED
 010000

	)

138 
	#_IO_UNITBUF
 020000

	)

139 
	#_IO_STDIO
 040000

	)

140 
	#_IO_DONT_CLOSE
 0100000

	)

141 
	#_IO_BOOLALPHA
 0200000

	)

144 
_IO_jump_t
; 
	g_IO_FILE
;

147 #ifdeà
_IO_MTSAFE_IO


148 #ià
defšed
 
__GLIBC__
 && __GLIBC__ >= 2

149 
	~<b™s/¡dio-lock.h
>

154 
	t_IO_lock_t
;

160 
	s_IO_m¬k”
 {

161 
_IO_m¬k”
 *
	m_Ãxt
;

162 
_IO_FILE
 *
	m_sbuf
;

166 
	m_pos
;

168 
£t_¡»ampos
(
¡»ampos
 
¥
è{ 
	m_¥os
 = sp; }

169 
£t_off£t
(
off£t
è{ 
	m_pos
 = off£t; 
	m_¥os
 = (
¡»ampos
)(-2); }

170 
	mpublic
:

171 
¡»amm¬k”
(
¡»ambuf
 *
sb
);

172 ~
¡»amm¬k”
();

173 
§všg
(è{  
	m_¥os
 == -2; }

174 
d–
(
¡»amm¬k”
&);

175 
d–
();

180 
	e__codecvt_»suÉ


182 
	m__codecvt_ok
,

183 
	m__codecvt_·¹Ÿl
,

184 
	m__codecvt_”rÜ
,

185 
	m__codecvt_nocÚv


188 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


191 
	s_IO_codecvt


193 (*
	m__codecvt_de¡r
è(
	m_IO_codecvt
 *);

194 
__codecvt_»suÉ
 (*
__codecvt_do_out
è(
	m_IO_codecvt
 *,

195 
	m__mb¡©e_t
 *,

196 cÚ¡ 
	mwch¬_t
 *,

197 cÚ¡ 
	mwch¬_t
 *,

198 cÚ¡ 
	mwch¬_t
 **, *,

200 
__codecvt_»suÉ
 (*
__codecvt_do_unshiá
è(
	m_IO_codecvt
 *,

201 
	m__mb¡©e_t
 *, *,

203 
__codecvt_»suÉ
 (*
__codecvt_do_š
è(
	m_IO_codecvt
 *,

204 
	m__mb¡©e_t
 *,

206 cÚ¡ **, 
	mwch¬_t
 *,

207 
	mwch¬_t
 *, wchar_t **);

208 (*
	m__codecvt_do_’codšg
è(
	m_IO_codecvt
 *);

209 (*
	m__codecvt_do_®ways_nocÚv
è(
	m_IO_codecvt
 *);

210 (*
	m__codecvt_do_Ëngth
è(
	m_IO_codecvt
 *, 
	m__mb¡©e_t
 *,

211 cÚ¡ *, cÚ¡ *, 
	m_IO_size_t
);

212 (*
	m__codecvt_do_max_Ëngth
è(
	m_IO_codecvt
 *);

214 
_IO_icÚv_t
 
	m__cd_š
;

215 
_IO_icÚv_t
 
	m__cd_out
;

219 
	s_IO_wide_d©a


221 
wch¬_t
 *
	m_IO_»ad_±r
;

222 
wch¬_t
 *
	m_IO_»ad_’d
;

223 
wch¬_t
 *
	m_IO_»ad_ba£
;

224 
wch¬_t
 *
	m_IO_wr™e_ba£
;

225 
wch¬_t
 *
	m_IO_wr™e_±r
;

226 
wch¬_t
 *
	m_IO_wr™e_’d
;

227 
wch¬_t
 *
	m_IO_buf_ba£
;

228 
wch¬_t
 *
	m_IO_buf_’d
;

230 
wch¬_t
 *
	m_IO_§ve_ba£
;

231 
wch¬_t
 *
	m_IO_backup_ba£
;

233 
wch¬_t
 *
	m_IO_§ve_’d
;

235 
__mb¡©e_t
 
	m_IO_¡©e
;

236 
__mb¡©e_t
 
	m_IO_Ï¡_¡©e
;

237 
_IO_codecvt
 
	m_codecvt
;

239 
wch¬_t
 
	m_shÜtbuf
[1];

241 cÚ¡ 
_IO_jump_t
 *
	m_wide_vbË
;

245 
	s_IO_FILE
 {

246 
	m_æags
;

247 
	#_IO_fe_æags
 
_æags


	)

251 * 
	m_IO_»ad_±r
;

252 * 
	m_IO_»ad_’d
;

253 * 
	m_IO_»ad_ba£
;

254 * 
	m_IO_wr™e_ba£
;

255 * 
	m_IO_wr™e_±r
;

256 * 
	m_IO_wr™e_’d
;

257 * 
	m_IO_buf_ba£
;

258 * 
	m_IO_buf_’d
;

260 *
	m_IO_§ve_ba£
;

261 *
	m_IO_backup_ba£
;

262 *
	m_IO_§ve_’d
;

264 
_IO_m¬k”
 *
	m_m¬k”s
;

266 
_IO_FILE
 *
	m_chaš
;

268 
	m_f’o
;

270 
	m_blksize
;

272 
	m_æags2
;

274 
_IO_off_t
 
	m_Şd_off£t
;

276 
	#__HAVE_COLUMN


	)

278 
	m_cur_cŞumn
;

279 sigÃd 
	m_vbË_off£t
;

280 
	m_shÜtbuf
[1];

284 
_IO_lock_t
 *
	m_lock
;

285 #ifdeà
_IO_USE_OLD_IO_FILE


288 
	s_IO_FILE_com¶‘e


290 
_IO_FILE
 
	m_fe
;

292 #ià
defšed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

293 
_IO_off64_t
 
	m_off£t
;

294 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


296 
_IO_codecvt
 *
	m_codecvt
;

297 
_IO_wide_d©a
 *
	m_wide_d©a
;

298 
_IO_FILE
 *
	m_ä“»s_li¡
;

299 *
	m_ä“»s_buf
;

300 
size_t
 
	m_ä“»s_size
;

302 *
	m__·d1
;

303 *
	m__·d2
;

304 *
	m__·d3
;

305 *
	m__·d4
;

306 
size_t
 
	m__·d5
;

308 
	m_mode
;

310 
	m_unu£d2
[15 *  (è- 4 *  (*è-  (
size_t
)];

314 #iâdeà
__ılu¥lus


315 
_IO_FILE
 
	t_IO_FILE
;

318 
	g_IO_FILE_¶us
;

320 
_IO_FILE_¶us
 
_IO_2_1_¡dš_
;

321 
_IO_FILE_¶us
 
_IO_2_1_¡dout_
;

322 
_IO_FILE_¶us
 
_IO_2_1_¡d”r_
;

323 #iâdeà
_LIBC


324 
	#_IO_¡dš
 ((
_IO_FILE
*)(&
_IO_2_1_¡dš_
))

	)

325 
	#_IO_¡dout
 ((
_IO_FILE
*)(&
_IO_2_1_¡dout_
))

	)

326 
	#_IO_¡d”r
 ((
_IO_FILE
*)(&
_IO_2_1_¡d”r_
))

	)

328 
_IO_FILE
 *
_IO_¡dš
 
©Œibu‹_hidd’
;

329 
_IO_FILE
 *
_IO_¡dout
 
©Œibu‹_hidd’
;

330 
_IO_FILE
 *
_IO_¡d”r
 
©Œibu‹_hidd’
;

338 
__ssize_t
 
	t__io_»ad_â
 (*
	t__cook›
, *
	t__buf
, 
	tsize_t
 
	t__nby‹s
);

346 
__ssize_t
 
	t__io_wr™e_â
 (*
	t__cook›
, cÚ¡ *
	t__buf
,

347 
	tsize_t
 
	t__n
);

355 
	t__io_£ek_â
 (*
	t__cook›
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

358 
	t__io_şo£_â
 (*
	t__cook›
);

361 #ifdeà
_GNU_SOURCE


363 
__io_»ad_â
 
	tcook›_»ad_funùiÚ_t
;

364 
__io_wr™e_â
 
	tcook›_wr™e_funùiÚ_t
;

365 
__io_£ek_â
 
	tcook›_£ek_funùiÚ_t
;

366 
__io_şo£_â
 
	tcook›_şo£_funùiÚ_t
;

371 
__io_»ad_â
 *
	m»ad
;

372 
__io_wr™e_â
 *
	mwr™e
;

373 
__io_£ek_â
 *
	m£ek
;

374 
__io_şo£_â
 *
	mşo£
;

375 } 
	t_IO_cook›_io_funùiÚs_t
;

376 
_IO_cook›_io_funùiÚs_t
 
	tcook›_io_funùiÚs_t
;

378 
	g_IO_cook›_fe
;

381 
_IO_cook›_š™
 (
_IO_cook›_fe
 *
__cfe
, 
__»ad_wr™e
,

382 *
__cook›
, 
_IO_cook›_io_funùiÚs_t
 
__âs
);

386 #ifdeà
__ılu¥lus


390 
__und”æow
 (
_IO_FILE
 *);

391 
__uæow
 (
_IO_FILE
 *);

392 
__ov”æow
 (
_IO_FILE
 *, );

393 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


394 
_IO_wšt_t
 
__wund”æow
 (
_IO_FILE
 *);

395 
_IO_wšt_t
 
__wuæow
 (
_IO_FILE
 *);

396 
_IO_wšt_t
 
__wov”æow
 (
_IO_FILE
 *, _IO_wint_t);

399 #ià 
__GNUC__
 >= 3

400 
	#_IO_BE
(
ex´
, 
»s
è
	`__butš_ex³ù
 (Óx´),„es)

	)

402 
	#_IO_BE
(
ex´
, 
»s
èÓx´)

	)

405 
	#_IO_g‘c_uÆocked
(
_å
) \

406 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

407 ? 
	`__uæow
 (
_å
è: *(*è(_å)->
_IO_»ad_±r
++)

	)

408 
	#_IO_³ekc_uÆocked
(
_å
) \

409 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

410 && 
	`__und”æow
 (
_å
è=ğ
EOF
 ? EOF \

411 : *(*è(
_å
)->
_IO_»ad_±r
)

	)

412 
	#_IO_putc_uÆocked
(
_ch
, 
_å
) \

413 (
	`_IO_BE
 ((
_å
)->
_IO_wr™e_±r
 >ğ(_å)->
_IO_wr™e_’d
, 0) \

414 ? 
	`__ov”æow
 (
_å
, (è(
_ch
)) \

415 : (è(*(
_å
)->
_IO_wr™e_±r
++ = (
_ch
)))

	)

417 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


418 
	#_IO_g‘wc_uÆocked
(
_å
) \

419 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

420 || ((
_å
)->
_wide_d©a
->
_IO_»ad_±r
 \

421 >ğ(
_å
)->
_wide_d©a
->
_IO_»ad_’d
), 0) \

422 ? 
	`__wuæow
 (
_å
è: (
_IO_wšt_t
è*(_å)->
_wide_d©a
->
_IO_»ad_±r
++)

	)

423 
	#_IO_putwc_uÆocked
(
_wch
, 
_å
) \

424 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

425 || ((
_å
)->
_wide_d©a
->
_IO_wr™e_±r
 \

426 >ğ(
_å
)->
_wide_d©a
->
_IO_wr™e_’d
), 0) \

427 ? 
	`__wov”æow
 (
_å
, 
_wch
) \

428 : (
_IO_wšt_t
è(*(
_å
)->
_wide_d©a
->
_IO_wr™e_±r
++ = (
_wch
)))

	)

431 
	#_IO_ãof_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_EOF_SEEN
è!ğ0)

	)

432 
	#_IO_ã¼Ü_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_ERR_SEEN
è!ğ0)

	)

434 
_IO_g‘c
 (
_IO_FILE
 *
__å
);

435 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__å
);

436 
_IO_ãof
 (
_IO_FILE
 *
__å
è
__THROW
;

437 
_IO_ã¼Ü
 (
_IO_FILE
 *
__å
è
__THROW
;

439 
_IO_³ekc_locked
 (
_IO_FILE
 *
__å
);

442 
	#_IO_PENDING_OUTPUT_COUNT
(
_å
) \

443 ((
_å
)->
_IO_wr™e_±r
 - (_å)->
_IO_wr™e_ba£
)

	)

445 
_IO_æockfe
 (
_IO_FILE
 *è
__THROW
;

446 
_IO_fuÆockfe
 (
_IO_FILE
 *è
__THROW
;

447 
_IO_árylockfe
 (
_IO_FILE
 *è
__THROW
;

449 #ifdeà
_IO_MTSAFE_IO


450 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_locked
 (_å)

	)

451 
	#_IO_æockfe
(
_å
) \

452 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_æockfe
 (_å)

	)

453 
	#_IO_fuÆockfe
(
_å
) \

454 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_fuÆockfe
 (_å)

	)

456 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_uÆocked
 (_å)

	)

457 
	#_IO_æockfe
(
_å
è

	)

458 
	#_IO_fuÆockfe
(
_å
è

	)

459 
	#_IO_árylockfe
(
_å
è

	)

460 
	#_IO_ş—nup_»giÚ_¡¬t
(
_fù
, 
_å
è

	)

461 
	#_IO_ş—nup_»giÚ_’d
(
_Do™
è

	)

464 
_IO_vfsÿnf
 (
_IO_FILE
 * 
__»¡riù
, const * __restrict,

465 
_IO_va_li¡
, *
__»¡riù
);

466 
_IO_vårštf
 (
_IO_FILE
 *
__»¡riù
, const *__restrict,

467 
_IO_va_li¡
);

468 
_IO_ssize_t
 
_IO_·dn
 (
_IO_FILE
 *, , _IO_ssize_t);

469 
_IO_size_t
 
_IO_sg‘n
 (
_IO_FILE
 *, *, _IO_size_t);

471 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

472 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

474 
_IO_ä“_backup_¬—
 (
_IO_FILE
 *è
__THROW
;

476 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


477 
_IO_wšt_t
 
_IO_g‘wc
 (
_IO_FILE
 *
__å
);

478 
_IO_wšt_t
 
_IO_putwc
 (
wch¬_t
 
__wc
, 
_IO_FILE
 *
__å
);

479 
_IO_fwide
 (
_IO_FILE
 *
__å
, 
__mode
è
__THROW
;

480 #ià
__GNUC__
 >= 2

483 #ià
defšed
 
_LIBC
 && defšed 
SHARED


484 
	~<shlib-com·t.h
>

485 #ià
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

486 
	#_IO_fwide_maybe_šcom·tibË
 \

487 (
	`__butš_ex³ù
 (&
_IO_¡dš_u£d
 =ğ
NULL
, 0))

	)

488 cÚ¡ 
_IO_¡dš_u£d
;

489 
w—k_ex‹º
 (
_IO_¡dš_u£d
);

492 #iâdeà
_IO_fwide_maybe_šcom·tibË


493 
	#_IO_fwide_maybe_šcom·tibË
 (0)

	)

497 
	#_IO_fwide
(
__å
, 
__mode
) \

498 ({ 
__»suÉ
 = (
__mode
); \

499 ià(
__»suÉ
 < 0 && ! 
_IO_fwide_maybe_šcom·tibË
) \

501 ià((
__å
)->
_mode
 == 0) \

503 (
__å
)->
_mode
 = -1; \

504 
__»suÉ
 = (
__å
)->
_mode
; \

506 ià(
	`__butš_cÚ¡ªt_p
 (
__mode
) && (__mode) == 0) \

507 
__»suÉ
 = 
_IO_fwide_maybe_šcom·tibË
 ? -1 : (
__å
)->
_mode
; \

509 
__»suÉ
 = 
	`_IO_fwide
 (
__å
, __result); \

510 
__»suÉ
; })

	)

513 
_IO_vfwsÿnf
 (
_IO_FILE
 * 
__»¡riù
, cÚ¡ 
wch¬_t
 * __restrict,

514 
_IO_va_li¡
, *
__»¡riù
);

515 
_IO_vfw´štf
 (
_IO_FILE
 *
__»¡riù
, cÚ¡ 
wch¬_t
 *__restrict,

516 
_IO_va_li¡
);

517 
_IO_ssize_t
 
_IO_w·dn
 (
_IO_FILE
 *, 
wšt_t
, _IO_ssize_t);

518 
_IO_ä“_wbackup_¬—
 (
_IO_FILE
 *è
__THROW
;

521 #ifdeà
__LDBL_COMPAT


522 
	~<b™s/libio-ldbl.h
>

525 #ifdeà
__ılu¥lus


	@/usr/include/xlocale.h

20 #iâdeà
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loÿË_¡ruù


30 
__loÿË_d©a
 *
	m__loÿËs
[13];

33 cÚ¡ *
	m__ùy³_b
;

34 cÚ¡ *
	m__ùy³_tŞow”
;

35 cÚ¡ *
	m__ùy³_touµ”
;

38 cÚ¡ *
	m__Çmes
[13];

39 } *
	t__loÿË_t
;

42 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/_G_config.h

4 #iâdeà
_G_cÚfig_h


5 
	#_G_cÚfig_h
 1

	)

9 
	~<b™s/ty³s.h
>

10 
	#__Ãed_size_t


	)

11 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


12 
	#__Ãed_wch¬_t


	)

14 
	#__Ãed_NULL


	)

15 
	~<¡ddef.h
>

16 
	#__Ãed_mb¡©e_t


	)

17 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


18 
	#__Ãed_wšt_t


	)

20 
	~<wch¬.h
>

23 
__off_t
 
	m__pos
;

24 
__mb¡©e_t
 
	m__¡©e
;

25 } 
	t_G_åos_t
;

28 
__off64_t
 
	m__pos
;

29 
__mb¡©e_t
 
	m__¡©e
;

30 } 
	t_G_åos64_t
;

31 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gcÚv.h
>

35 
__gcÚv_šfo
 
	m__cd
;

38 
__gcÚv_šfo
 
	m__cd
;

39 
__gcÚv_¡•_d©a
 
	m__d©a
;

40 } 
	m__combšed
;

41 } 
	t_G_icÚv_t
;

46 
	#_G_va_li¡
 
__gnuc_va_li¡


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`defšed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/ctype.h

22 #iâdef 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 
	g__BEGIN_DECLS


30 #iâdeà
_ISb™


39 
	~<’dŸn.h
>

40 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


41 
	#_ISb™
(
b™
è(1 << (b™))

	)

43 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

48 
	m_ISuµ”
 = 
_ISb™
 (0),

49 
	m_ISlow”
 = 
_ISb™
 (1),

50 
	m_IS®pha
 = 
_ISb™
 (2),

51 
	m_ISdig™
 = 
_ISb™
 (3),

52 
	m_ISxdig™
 = 
_ISb™
 (4),

53 
	m_IS¥aû
 = 
_ISb™
 (5),

54 
	m_IS´št
 = 
_ISb™
 (6),

55 
	m_ISg¿ph
 = 
_ISb™
 (7),

56 
	m_ISbÏnk
 = 
_ISb™
 (8),

57 
	m_ISúŒl
 = 
_ISb™
 (9),

58 
	m_ISpunù
 = 
_ISb™
 (10),

59 
	m_IS®num
 = 
_ISb™
 (11)

79 cÚ¡ **
	$__ùy³_b_loc
 ()

80 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

81 cÚ¡ 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

83 cÚ¡ 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

87 #iâdeà
__ılu¥lus


88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

90 #–ià
defšed
 
__USE_EXTERN_INLINES


91 
	#__isùy³_f
(
ty³
) \

92 
__ex‹º_šlše
 \

93 
is
##
	`ty³
 (
__c
è
__THROW
 \

95  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

96 
	}

	)
}

99 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

100 
	#__tßscii
(
c
è((cè& 0x7fè

	)

102 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

104 
__BEGIN_NAMESPACE_STD


110 
__exùy³
 (
i§Êum
);

111 
__exùy³
 (
i§Íha
);

112 
__exùy³
 (
isúŒl
);

113 
__exùy³
 (
isdig™
);

114 
__exùy³
 (
i¦ow”
);

115 
__exùy³
 (
isg¿ph
);

116 
__exùy³
 (
i¥ršt
);

117 
__exùy³
 (
i¥unù
);

118 
__exùy³
 (
is¥aû
);

119 
__exùy³
 (
isuµ”
);

120 
__exùy³
 (
isxdig™
);

124 
	$tŞow”
 (
__c
è
__THROW
;

127 
	$touµ”
 (
__c
è
__THROW
;

129 
__END_NAMESPACE_STD


133 #ifdef 
__USE_ISOC99


134 
__BEGIN_NAMESPACE_C99


136 
	`__exùy³
 (
isbÏnk
);

138 
__END_NAMESPACE_C99


141 #ifdeà
__USE_GNU


143 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

146 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


150 
	$i§scii
 (
__c
è
__THROW
;

154 
	$tßscii
 (
__c
è
__THROW
;

158 
	`__exùy³
 (
_touµ”
);

159 
	`__exùy³
 (
_tŞow”
);

163 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

164 (
__ex‹nsiÚ__
 \

165 ({ 
__»s
; \

166 ià( (
c
) > 1) \

168 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

170 
__c
 = (
c
); \

171 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

174 
__»s
 = 
f
 
¬gs
; \

177 
__»s
 = (
a
)[(è(
c
)]; \

178 
__»s
; 
	}
}))

	)

180 #ià!
defšed
 
__NO_CTYPE


181 #ifdeà
__isùy³_f


182 
	$__isùy³_f
 (
®num
)

183 
	$__isùy³_f
 (
®pha
)

184 
	$__isùy³_f
 (
úŒl
)

185 
	$__isùy³_f
 (
dig™
)

186 
	$__isùy³_f
 (
low”
)

187 
	$__isùy³_f
 (
g¿ph
)

188 
	$__isùy³_f
 (
´št
)

189 
	$__isùy³_f
 (
punù
)

190 
	$__isùy³_f
 (
¥aû
)

191 
	$__isùy³_f
 (
uµ”
)

192 
	$__isùy³_f
 (
xdig™
)

193 #ifdeà
__USE_ISOC99


194 
	$__isùy³_f
 (
bÏnk
)

196 #–ià
defšed
 
__isùy³


197 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

198 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

199 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

200 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

201 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

202 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

203 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

204 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

205 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

206 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

207 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

208 #ifdeà
__USE_ISOC99


209 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

213 #ifdeà
__USE_EXTERN_INLINES


214 
__ex‹º_šlše
 

215 
	`__NTH
 (
	$tŞow”
 (
__c
))

217  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

218 
	}
}

220 
__ex‹º_šlše
 

221 
__NTH
 (
	$touµ”
 (
__c
))

223  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

224 
	}
}

227 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


228 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

229 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

232 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC
 || defšed 
__USE_XOPEN


233 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

234 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

236 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

237 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

243 #ifdeà
__USE_XOPEN2K8


257 
	~<xloÿË.h
>

261 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

262 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

264 
	#__exùy³_l
(
Çme
) \

265 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

271 
__exùy³_l
 (
i§Êum_l
);

272 
__exùy³_l
 (
i§Íha_l
);

273 
__exùy³_l
 (
isúŒl_l
);

274 
__exùy³_l
 (
isdig™_l
);

275 
__exùy³_l
 (
i¦ow”_l
);

276 
__exùy³_l
 (
isg¿ph_l
);

277 
__exùy³_l
 (
i¥ršt_l
);

278 
__exùy³_l
 (
i¥unù_l
);

279 
__exùy³_l
 (
is¥aû_l
);

280 
__exùy³_l
 (
isuµ”_l
);

281 
__exùy³_l
 (
isxdig™_l
);

283 
__exùy³_l
 (
isbÏnk_l
);

287 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

288 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

291 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

292 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

294 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


295 
	#__tŞow”_l
(
c
, 
loÿË
) \

296 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

297 
	#__touµ”_l
(
c
, 
loÿË
) \

298 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

299 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

300 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

304 #iâdeà
__NO_CTYPE


305 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

306 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

307 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

308 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

309 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

310 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

311 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

312 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

313 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

314 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

315 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

317 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

319 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


320 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

321 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

324 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

325 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

326 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

327 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

328 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

329 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

330 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

331 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

332 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

333 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

334 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

336 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

338 #ià
defšed
 
__USE_SVID
 || defšed 
__USE_MISC


339 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

340 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

347 
__END_DECLS


	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

54 
	#__STDC_ISO_10646__
 201103L

	)

57 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<b™s/’dŸn.h
>

40 #iâdeà
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_BSD


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

53 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

58 #ià
defšed
 
__USE_BSD
 && !defšed 
__ASSEMBLER__


60 
	~<b™s/by‹sw­.h
>

62 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


63 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

64 
	#htŞe16
(
x
è(x)

	)

65 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

66 
	#Ë16toh
(
x
è(x)

	)

68 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

69 
	#htŞe32
(
x
è(x)

	)

70 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

71 
	#Ë32toh
(
x
è(x)

	)

73 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

74 
	#htŞe64
(
x
è(x)

	)

75 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

76 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/gconv.h

22 #iâdeà
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	#__Ãed_mb¡©e_t


	)

27 
	#__Ãed_wšt_t


	)

28 
	~<wch¬.h
>

29 
	#__Ãed_size_t


	)

30 
	#__Ãed_wch¬_t


	)

31 
	~<¡ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch¬_t
è0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004

64 
	g__gcÚv_¡•
;

65 
	g__gcÚv_¡•_d©a
;

66 
	g__gcÚv_lßded_objeù
;

67 
	g__gcÚv_Œªs_d©a
;

71 (*
	t__gcÚv_fù
è(
	t__gcÚv_¡•
 *, 
	t__gcÚv_¡•_d©a
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wšt_t
 (*
	t__gcÚv_btowc_fù
è(
	t__gcÚv_¡•
 *, );

79 (*
	t__gcÚv_š™_fù
è(
	t__gcÚv_¡•
 *);

80 (*
	t__gcÚv_’d_fù
è(
	t__gcÚv_¡•
 *);

84 (*
	t__gcÚv_Œªs_fù
è(
	t__gcÚv_¡•
 *,

85 
	t__gcÚv_¡•_d©a
 *, *,

89 
	tsize_t
 *);

92 (*
	t__gcÚv_Œªs_cÚ‹xt_fù
) (*, const *,

97 (*
	t__gcÚv_Œªs_qu”y_fù
) (const *, const ***,

98 
	tsize_t
 *);

101 (*
	t__gcÚv_Œªs_š™_fù
) (**, const *);

102 (*
	t__gcÚv_Œªs_’d_fù
) (*);

104 
	s__gcÚv_Œªs_d©a


107 
__gcÚv_Œªs_fù
 
__Œªs_fù
;

108 
__gcÚv_Œªs_cÚ‹xt_fù
 
__Œªs_cÚ‹xt_fù
;

109 
__gcÚv_Œªs_’d_fù
 
__Œªs_’d_fù
;

110 *
__d©a
;

111 
__gcÚv_Œªs_d©a
 *
__Ãxt
;

116 
	s__gcÚv_¡•


118 
__gcÚv_lßded_objeù
 *
__shlib_hªdË
;

119 cÚ¡ *
__modÇme
;

121 
__couÁ”
;

123 *
__äom_Çme
;

124 *
__to_Çme
;

126 
__gcÚv_fù
 
__fù
;

127 
__gcÚv_btowc_fù
 
__btowc_fù
;

128 
__gcÚv_š™_fù
 
__š™_fù
;

129 
__gcÚv_’d_fù
 
__’d_fù
;

133 
__mš_Ãeded_äom
;

134 
__max_Ãeded_äom
;

135 
__mš_Ãeded_to
;

136 
__max_Ãeded_to
;

139 
__¡©eful
;

141 *
__d©a
;

146 
	s__gcÚv_¡•_d©a


148 *
__outbuf
;

149 *
__outbuãnd
;

153 
__æags
;

157 
__švoÿtiÚ_couÁ”
;

161 
__š‹º®_u£
;

163 
__mb¡©e_t
 *
__¡©•
;

164 
__mb¡©e_t
 
__¡©e
;

168 
__gcÚv_Œªs_d©a
 *
__Œªs
;

173 
	s__gcÚv_šfo


175 
size_t
 
__n¡•s
;

176 
__gcÚv_¡•
 *
__¡•s
;

177 
__ex‹nsiÚ__
 
__gcÚv_¡•_d©a
 
__d©a
 
__æex¬r
;

178 } *
	t__gcÚv_t
;

	@/usr/include/wchar.h

23 #iâdeà
_WCHAR_H


25 #ià!
defšed
 
__Ãed_mb¡©e_t
 && !defšed 
__Ãed_wšt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<ã©u»s.h
>

30 #ifdeà
_WCHAR_H


32 
	#__Ãed___FILE


	)

33 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


34 
	#__Ãed_FILE


	)

36 
	~<¡dio.h
>

38 
	#__Ãed___va_li¡


	)

39 
	~<¡d¬g.h
>

41 
	~<b™s/wch¬.h
>

44 
	#__Ãed_size_t


	)

45 
	#__Ãed_wch¬_t


	)

46 
	#__Ãed_NULL


	)

48 #ià
defšed
 
_WCHAR_H
 || defšed 
__Ãed_wšt_t
 || !defšed 
__WINT_TYPE__


49 #undeà
__Ãed_wšt_t


50 
	#__Ãed_wšt_t


	)

51 
	~<¡ddef.h
>

55 #iâdeà
_WINT_T


60 
	#_WINT_T


	)

61 
	twšt_t
;

65 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
defšed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twšt_t
;

69 
	g__END_NAMESPACE_STD


74 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #ià(
defšed
 
_WCHAR_H
 || defšed 
__Ãed_mb¡©e_t
è&& !defšed 
____mb¡©e_t_defšed


80 
	#____mb¡©e_t_defšed
 1

	)

84 
	m__couÁ
;

87 #ifdeà
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wšt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__v®ue
;

94 } 
	t__mb¡©e_t
;

96 #undeà
__Ãed_mb¡©e_t


101 #ifdeà
_WCHAR_H


103 #iâdeà
__mb¡©e_t_defšed


104 
__BEGIN_NAMESPACE_C99


106 
__mb¡©e_t
 
	tmb¡©e_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mb¡©e_t_defšed
 1

	)

111 #ifdeà
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mb¡©e_t
)

115 #iâdeà
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #iâdeà
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_UNIX98


128 
	~<wùy³.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch¬_t
 *
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

148 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

150 
wch¬_t
 *
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

151 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

152 
__THROW
;

155 
wch¬_t
 *
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

156 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

158 
wch¬_t
 *
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

159 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

160 
__THROW
;

163 
	$wcscmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
)

164 
__THROW
 
__©Œibu‹_pu»__
;

166 
	$wc¢cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

167 
__THROW
 
__©Œibu‹_pu»__
;

168 
__END_NAMESPACE_STD


170 #ifdeà
__USE_XOPEN2K8


172 
	$wcsÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

175 
	$wc¢ÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

176 
size_t
 
__n
è
__THROW
;

180 
	~<xloÿË.h
>

182 
	$wcsÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

183 
__loÿË_t
 
__loc
è
__THROW
;

185 
	$wc¢ÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

186 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

189 
__BEGIN_NAMESPACE_STD


192 
	$wcscŞl
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

196 
size_t
 
	$wcsxäm
 (
wch¬_t
 *
__»¡riù
 
__s1
,

197 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

198 
__END_NAMESPACE_STD


200 #ifdeà
__USE_XOPEN2K8


206 
	$wcscŞl_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

207 
__loÿË_t
 
__loc
è
__THROW
;

212 
size_t
 
	$wcsxäm_l
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

213 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

216 
wch¬_t
 *
	$wcsdup
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_m®loc__
;

219 
__BEGIN_NAMESPACE_STD


221 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


222 "C++" 
wch¬_t
 *
	$wcschr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

223 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

224 "C++" cÚ¡ 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

225 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

227 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

228 
__THROW
 
__©Œibu‹_pu»__
;

231 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


232 "C++" 
wch¬_t
 *
	$wc¤chr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

233 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

234 "C++" cÚ¡ 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

235 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

237 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

238 
__THROW
 
__©Œibu‹_pu»__
;

240 
__END_NAMESPACE_STD


242 #ifdeà
__USE_GNU


245 
wch¬_t
 *
	$wcschºul
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__wc
)

246 
__THROW
 
__©Œibu‹_pu»__
;

249 
__BEGIN_NAMESPACE_STD


252 
size_t
 
	$wcsc¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__»jeù
)

253 
__THROW
 
__©Œibu‹_pu»__
;

256 
size_t
 
	$wcs¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

257 
__THROW
 
__©Œibu‹_pu»__
;

259 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


260 "C++" 
wch¬_t
 *
	$wc¥brk
 (
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

261 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

262 "C++" cÚ¡ 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
,

263 cÚ¡ 
wch¬_t
 *
__acû±
)

264 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

266 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

267 
__THROW
 
__©Œibu‹_pu»__
;

270 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


271 "C++" 
wch¬_t
 *
	$wcs¡r
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

272 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

273 "C++" cÚ¡ 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

274 cÚ¡ 
wch¬_t
 *
__ÃedË
)

275 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

277 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

278 
__THROW
 
__©Œibu‹_pu»__
;

282 
wch¬_t
 *
	$wc¡ok
 (
wch¬_t
 *
__»¡riù
 
__s
,

283 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__d–im
,

284 
wch¬_t
 **
__»¡riù
 
__±r
è
__THROW
;

287 
size_t
 
	$wc¦’
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_pu»__
;

288 
__END_NAMESPACE_STD


290 #ifdeà
__USE_XOPEN


292 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


293 "C++" 
wch¬_t
 *
	$wcswcs
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

294 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

295 "C++" cÚ¡ 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

296 cÚ¡ 
wch¬_t
 *
__ÃedË
)

297 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

299 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

300 
__THROW
 
__©Œibu‹_pu»__
;

304 #ifdeà
__USE_XOPEN2K8


306 
size_t
 
	$wc¢Ën
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__maxËn
)

307 
__THROW
 
__©Œibu‹_pu»__
;

311 
__BEGIN_NAMESPACE_STD


313 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


314 "C++" 
wch¬_t
 *
	$wmemchr
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

315 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

316 "C++" cÚ¡ 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
,

317 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

320 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

321 
__THROW
 
__©Œibu‹_pu»__
;

325 
	$wmemcmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

326 
__THROW
 
__©Œibu‹_pu»__
;

329 
wch¬_t
 *
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

330 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

334 
wch¬_t
 *
	$wmemmove
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

335 
__THROW
;

338 
wch¬_t
 *
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
è
__THROW
;

339 
__END_NAMESPACE_STD


341 #ifdeà
__USE_GNU


344 
wch¬_t
 *
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

345 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

346 
__THROW
;

350 
__BEGIN_NAMESPACE_STD


353 
wšt_t
 
	$btowc
 (
__c
è
__THROW
;

357 
	$wùob
 (
wšt_t
 
__c
è
__THROW
;

361 
	$mbsš™
 (cÚ¡ 
mb¡©e_t
 *
__ps
è
__THROW
 
__©Œibu‹_pu»__
;

365 
size_t
 
	$mb¹owc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

366 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

367 
mb¡©e_t
 *
__»¡riù
 
__p
è
__THROW
;

370 
size_t
 
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wc
,

371 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

374 
size_t
 
	$__mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

375 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

376 
size_t
 
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

377 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

378 
__END_NAMESPACE_STD


380 #ifdeà
__USE_EXTERN_INLINES


386 
wšt_t
 
	$__btowc_®Ÿs
 (
__c
è
	`__asm
 ("btowc");

387 
__ex‹º_šlše
 
wšt_t


388 
	`__NTH
 (
	$btowc
 (
__c
))

389 {  (
	`__butš_cÚ¡ªt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

390 ? (
wšt_t
è
__c
 : 
	`__btowc_®Ÿs
 (__c)); 
	}
}

392 
	$__wùob_®Ÿs
 (
wšt_t
 
__c
è
	`__asm
 ("wctob");

393 
__ex‹º_šlše
 

394 
	`__NTH
 (
	$wùob
 (
wšt_t
 
__wc
))

395 {  (
	`__butš_cÚ¡ªt_p
 (
__wc
è&& __wø>ğ
L
'\0' && __wc <= L'\x7f'

396 ? (è
__wc
 : 
	`__wùob_®Ÿs
 (__wc)); 
	}
}

398 
__ex‹º_šlše
 
size_t


399 
__NTH
 (
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

400 
mb¡©e_t
 *
__»¡riù
 
__ps
))

401 {  (
__ps
 !ğ
NULL


402 ? 
	`mb¹owc
 (
NULL
, 
__s
, 
__n
, 
__ps
è: 
	`__mb¾’
 (__s, __n, NULL)); 
	}
}

405 
__BEGIN_NAMESPACE_STD


408 
size_t
 
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

409 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

410 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

414 
size_t
 
	$wc¤tombs
 (*
__»¡riù
 
__d¡
,

415 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

416 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

417 
__END_NAMESPACE_STD


420 #ifdef 
__USE_XOPEN2K8


423 
size_t
 
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

424 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

425 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

429 
size_t
 
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
,

430 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

431 
size_t
 
__nwc
, size_ˆ
__Ën
,

432 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

437 #ifdeà
__USE_XOPEN


439 
	$wcwidth
 (
wch¬_t
 
__c
è
__THROW
;

443 
	$wcswidth
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__n
è
__THROW
;

447 
__BEGIN_NAMESPACE_STD


450 
	$wc¡od
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

451 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

452 
__END_NAMESPACE_STD


454 #ifdeà
__USE_ISOC99


455 
__BEGIN_NAMESPACE_C99


457 
	$wc¡of
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

458 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

459 
	$wc¡Şd
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

460 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

461 
__END_NAMESPACE_C99


465 
__BEGIN_NAMESPACE_STD


468 
	$wc¡Ş
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

469 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

473 
	$wc¡oul
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

474 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

475 
__THROW
;

476 
__END_NAMESPACE_STD


478 #ifdeà
__USE_ISOC99


479 
__BEGIN_NAMESPACE_C99


482 
__ex‹nsiÚ__


483 
	$wc¡Şl
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

484 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

485 
__THROW
;

489 
__ex‹nsiÚ__


490 
	$wc¡ouÎ
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

491 
wch¬_t
 **
__»¡riù
 
__’d±r
,

492 
__ba£
è
__THROW
;

493 
__END_NAMESPACE_C99


496 #ifdeà
__USE_GNU


499 
__ex‹nsiÚ__


500 
	$wc¡oq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

501 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

502 
__THROW
;

506 
__ex‹nsiÚ__


507 
	$wc¡ouq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

508 
wch¬_t
 **
__»¡riù
 
__’d±r
,

509 
__ba£
è
__THROW
;

512 #ifdeà
__USE_GNU


526 
	~<xloÿË.h
>

530 
	$wc¡Ş_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

531 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
,

532 
__loÿË_t
 
__loc
è
__THROW
;

534 
	$wc¡oul_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

535 
wch¬_t
 **
__»¡riù
 
__’d±r
,

536 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

538 
__ex‹nsiÚ__


539 
	$wc¡Şl_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

540 
wch¬_t
 **
__»¡riù
 
__’d±r
,

541 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

543 
__ex‹nsiÚ__


544 
	$wc¡ouÎ_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

545 
wch¬_t
 **
__»¡riù
 
__’d±r
,

546 
__ba£
, 
__loÿË_t
 
__loc
)

547 
__THROW
;

549 
	$wc¡od_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

550 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

551 
__THROW
;

553 
	$wc¡of_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

554 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

555 
__THROW
;

557 
	$wc¡Şd_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

558 
wch¬_t
 **
__»¡riù
 
__’d±r
,

559 
__loÿË_t
 
__loc
è
__THROW
;

563 #ifdeà
__USE_XOPEN2K8


566 
wch¬_t
 *
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

567 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

571 
wch¬_t
 *
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

572 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

573 
__THROW
;

580 
__FILE
 *
	$İ’_wmem¡»am
 (
wch¬_t
 **
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
;

583 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


584 
__BEGIN_NAMESPACE_STD


587 
	$fwide
 (
__FILE
 *
__å
, 
__mode
è
__THROW
;

594 
	`fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

595 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

601 
	`w´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

604 
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

605 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

606 
__THROW
 ;

612 
	`vfw´štf
 (
__FILE
 *
__»¡riù
 
__s
,

613 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

614 
__gnuc_va_li¡
 
__¬g
)

620 
	`vw´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

621 
__gnuc_va_li¡
 
__¬g
)

625 
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

626 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

627 
__gnuc_va_li¡
 
__¬g
)

628 
__THROW
 ;

635 
	`fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

636 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

642 
	`wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

645 
	$swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

646 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

647 
__THROW
 ;

649 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

650 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

651 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

652 #ifdeà
__REDIRECT


656 
	`__REDIRECT
 (
fwsÿnf
, (
__FILE
 *
__»¡riù
 
__¡»am
,

657 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

658 
__isoc99_fwsÿnf
)

660 
	`__REDIRECT
 (
wsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

661 
__isoc99_wsÿnf
)

663 
	`__REDIRECT_NTH
 (
swsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

664 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

665 ...), 
__isoc99_swsÿnf
)

668 
	`__isoc99_fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

669 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

670 
	`__isoc99_wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

671 
	$__isoc99_swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

672 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

673 
__THROW
;

674 
	#fwsÿnf
 
__isoc99_fwsÿnf


	)

675 
	#wsÿnf
 
__isoc99_wsÿnf


	)

676 
	#swsÿnf
 
__isoc99_swsÿnf


	)

680 
__END_NAMESPACE_STD


683 #ifdeà
__USE_ISOC99


684 
__BEGIN_NAMESPACE_C99


689 
	`vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

690 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

691 
__gnuc_va_li¡
 
__¬g
)

697 
	`vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

698 
__gnuc_va_li¡
 
__¬g
)

701 
	$vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

702 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

703 
__gnuc_va_li¡
 
__¬g
)

704 
__THROW
 ;

706 #ià!
defšed
 
__USE_GNU
 \

707 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

708 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

709 #ifdeà
__REDIRECT


710 
	`__REDIRECT
 (
vfwsÿnf
, (
__FILE
 *
__»¡riù
 
__s
,

711 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

712 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vfwsÿnf
)

714 
	`__REDIRECT
 (
vwsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

715 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vwsÿnf
)

717 
	`__REDIRECT_NTH
 (
vswsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

718 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

719 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vswsÿnf
)

722 
	`__isoc99_vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

723 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

724 
__gnuc_va_li¡
 
__¬g
);

725 
	`__isoc99_vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

726 
__gnuc_va_li¡
 
__¬g
);

727 
	$__isoc99_vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

728 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

729 
__gnuc_va_li¡
 
__¬g
è
__THROW
;

730 
	#vfwsÿnf
 
__isoc99_vfwsÿnf


	)

731 
	#vwsÿnf
 
__isoc99_vwsÿnf


	)

732 
	#vswsÿnf
 
__isoc99_vswsÿnf


	)

736 
__END_NAMESPACE_C99


740 
__BEGIN_NAMESPACE_STD


745 
wšt_t
 
	`fg‘wc
 (
__FILE
 *
__¡»am
);

746 
wšt_t
 
	`g‘wc
 (
__FILE
 *
__¡»am
);

752 
wšt_t
 
	`g‘wch¬
 ();

759 
wšt_t
 
	`åutwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

760 
wšt_t
 
	`putwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

766 
wšt_t
 
	`putwch¬
 (
wch¬_t
 
__wc
);

774 
wch¬_t
 *
	`fg‘ws
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

775 
__FILE
 *
__»¡riù
 
__¡»am
);

781 
	`åutws
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

782 
__FILE
 *
__»¡riù
 
__¡»am
);

789 
wšt_t
 
	`ung‘wc
 (wšt_ˆ
__wc
, 
__FILE
 *
__¡»am
);

790 
__END_NAMESPACE_STD


793 #ifdeà
__USE_GNU


801 
wšt_t
 
	`g‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

802 
wšt_t
 
	`g‘wch¬_uÆocked
 ();

810 
wšt_t
 
	`fg‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

818 
wšt_t
 
	`åutwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

827 
wšt_t
 
	`putwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

828 
wšt_t
 
	`putwch¬_uÆocked
 (
wch¬_t
 
__wc
);

837 
wch¬_t
 *
	`fg‘ws_uÆocked
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

838 
__FILE
 *
__»¡riù
 
__¡»am
);

846 
	`åutws_uÆocked
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

847 
__FILE
 *
__»¡riù
 
__¡»am
);

851 
__BEGIN_NAMESPACE_C99


855 
size_t
 
	$wcsáime
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

856 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

857 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

858 
__END_NAMESPACE_C99


860 #ifdeà
__USE_GNU


861 
	~<xloÿË.h
>

865 
size_t
 
	$wcsáime_l
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

866 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

867 cÚ¡ 
tm
 *
__»¡riù
 
__
,

868 
__loÿË_t
 
__loc
è
__THROW
;

877 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_GNU


878 
	#__Ãed_iswxxx


	)

879 
	~<wùy³.h
>

883 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


884 
	~<b™s/wch¬2.h
>

887 #ifdeà
__LDBL_COMPAT


888 
	~<b™s/wch¬-ldbl.h
>

891 
__END_DECLS


899 #undeà
__Ãed_mb¡©e_t


900 #undeà
__Ãed_wšt_t


	@/usr/include/wctype.h

23 #iâdeà
_WCTYPE_H


25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 #iâdeà
__Ãed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__Ãed_wšt_t


	)

33 
	~<wch¬.h
>

37 #iâdeà
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #undeà
__Ãed_iswxxx


46 #iâdeà
__iswxxx_defšed


47 
	#__iswxxx_defšed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	twùy³_t
;

53 
	g__END_NAMESPACE_C99


55 #iâdeà
_ISwb™


60 
	~<’dŸn.h
>

61 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


62 
	#_ISwb™
(
b™
è(1 << (b™))

	)

64 
	#_ISwb™
(
b™
) \

65 ((
b™
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
b™
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
b™
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (è((1UL << (
b™
)è>> 24))))

	)

73 
	m__ISwuµ”
 = 0,

74 
	m__ISwlow”
 = 1,

75 
	m__ISw®pha
 = 2,

76 
	m__ISwdig™
 = 3,

77 
	m__ISwxdig™
 = 4,

78 
	m__ISw¥aû
 = 5,

79 
	m__ISw´št
 = 6,

80 
	m__ISwg¿ph
 = 7,

81 
	m__ISwbÏnk
 = 8,

82 
	m__ISwúŒl
 = 9,

83 
	m__ISwpunù
 = 10,

84 
	m__ISw®num
 = 11,

86 
	m_ISwuµ”
 = 
_ISwb™
 (
__ISwuµ”
),

87 
	m_ISwlow”
 = 
_ISwb™
 (
__ISwlow”
),

88 
	m_ISw®pha
 = 
_ISwb™
 (
__ISw®pha
),

89 
	m_ISwdig™
 = 
_ISwb™
 (
__ISwdig™
),

90 
	m_ISwxdig™
 = 
_ISwb™
 (
__ISwxdig™
),

91 
	m_ISw¥aû
 = 
_ISwb™
 (
__ISw¥aû
),

92 
	m_ISw´št
 = 
_ISwb™
 (
__ISw´št
),

93 
	m_ISwg¿ph
 = 
_ISwb™
 (
__ISwg¿ph
),

94 
	m_ISwbÏnk
 = 
_ISwb™
 (
__ISwbÏnk
),

95 
	m_ISwúŒl
 = 
_ISwb™
 (
__ISwúŒl
),

96 
	m_ISwpunù
 = 
_ISwb™
 (
__ISwpunù
),

97 
	m_ISw®num
 = 
_ISwb™
 (
__ISw®num
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$isw®num
 (
wšt_t
 
__wc
è
__THROW
;

117 
	$isw®pha
 (
wšt_t
 
__wc
è
__THROW
;

120 
	$iswúŒl
 (
wšt_t
 
__wc
è
__THROW
;

124 
	$iswdig™
 (
wšt_t
 
__wc
è
__THROW
;

128 
	$iswg¿ph
 (
wšt_t
 
__wc
è
__THROW
;

133 
	$iswlow”
 (
wšt_t
 
__wc
è
__THROW
;

136 
	$isw´št
 (
wšt_t
 
__wc
è
__THROW
;

141 
	$iswpunù
 (
wšt_t
 
__wc
è
__THROW
;

146 
	$isw¥aû
 (
wšt_t
 
__wc
è
__THROW
;

151 
	$iswuµ”
 (
wšt_t
 
__wc
è
__THROW
;

156 
	$iswxdig™
 (
wšt_t
 
__wc
è
__THROW
;

161 #ifdeà
__USE_ISOC99


162 
	$iswbÏnk
 (
wšt_t
 
__wc
è
__THROW
;

171 
wùy³_t
 
	$wùy³
 (cÚ¡ *
__´İ”ty
è
__THROW
;

175 
	$iswùy³
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
è
__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 cÚ¡ 
	t__št32_t
 *
	twù¿ns_t
;

187 
__END_NAMESPACE_C99


188 #ifdeà
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
wù¿ns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wšt_t
 
	$towlow”
 (
wšt_t
 
__wc
è
__THROW
;

197 
wšt_t
 
	$towuµ”
 (
wšt_t
 
__wc
è
__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifdeà
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
wù¿ns_t
 
	$wù¿ns
 (cÚ¡ *
__´İ”ty
è
__THROW
;

221 
wšt_t
 
	$towù¿ns
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
è
__THROW
;

222 
__END_NAMESPACE_C99


224 #ifdeà
__USE_XOPEN2K8


226 
	~<xloÿË.h
>

230 
	$isw®num_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

236 
	$isw®pha_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

239 
	$iswúŒl_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

243 
	$iswdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

247 
	$iswg¿ph_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

252 
	$iswlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

255 
	$isw´št_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

260 
	$iswpunù_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

265 
	$isw¥aû_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

270 
	$iswuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

275 
	$iswxdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

280 
	$iswbÏnk_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

284 
wùy³_t
 
	$wùy³_l
 (cÚ¡ *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

285 
__THROW
;

289 
	$iswùy³_l
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
, 
__loÿË_t
 
__loÿË
)

290 
__THROW
;

298 
wšt_t
 
	$towlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

301 
wšt_t
 
	$towuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

305 
wù¿ns_t
 
	$wù¿ns_l
 (cÚ¡ *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

306 
__THROW
;

309 
wšt_t
 
	$towù¿ns_l
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
,

310 
__loÿË_t
 
__loÿË
è
__THROW
;

314 
__END_DECLS


	@
1
.
1
/usr/include
69
1701
Anastruct.cpp
DistanceToPointSetFunction.cpp
FitUnlabeledPoints.cpp
FunctionExplorer.cpp
ImagePlanes.cpp
LandmarkDeformation.cpp
M3DAdaptiveRegistrationPGAOptimizer.cpp
M3DAdaptiveRegistrationPGAProblem.cpp
M3DBoundingSphere.cpp
M3DDeformationOptimizer.cpp
M3DDeformationProblem.cpp
M3DFigureElongater.cpp
M3DMainFigResidueCPNSProblem.cpp
M3DMainFigResiduePGAOptimizer.cpp
M3DMainFigResiduePGAProblem.cpp
M3DMainFigureOptimizer.cpp
M3DMainFigureProblem.cpp
M3DPrimitiveCorrector.cpp
M3DRegistrationOptimizer.cpp
M3DRegistrationPGAOptimizer.cpp
M3DRegistrationPGAProblem.cpp
M3DRegistrationProblem.cpp
M3DRegistrationSimilarityOptimizer.cpp
M3DRegistrationSimilarityProblem.cpp
M3DSRepOptimizer.cpp
M3DSRepProblem.cpp
M3DSimilarityCPNSOptimizer.cpp
M3DSimilarityCPNSProblem.cpp
M3DSimilarityElongationOptimizer.cpp
M3DSimilarityElongationProblem.cpp
M3DSimilarityPGAOptimizer.cpp
M3DSimilarityPGAProblem.cpp
M3DSpokeOptimizer.cpp
M3DSpokeProblem.cpp
M3DSubfigureOptimizer.cpp
M3DSubfigureProblem.cpp
M3DSubfigureTransformation.cpp
M3DTubeSimilarityPGAProblem.cpp
M3DVoxelOptimizer.cpp
M3DtoPovray.cpp
MakeOptimizationVideo.cpp
OctTreeTauBand.cpp
OptimizerBase.cpp
P3DControl.cpp
P3DUndoList.cpp
PCA.cpp
Trackball.cpp
readOldObjectFile.cpp
/usr/include/errno.h
/usr/include/limits.h
/usr/include/math.h
/usr/include/memory.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/alloca.h
/usr/include/features.h
/usr/include/getopt.h
/usr/include/libio.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/ctype.h
/usr/include/stdc-predef.h
/usr/include/endian.h
/usr/include/gconv.h
/usr/include/wchar.h
/usr/include/wctype.h
